{"html_base64":"PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjxodG1sIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIj4NCgk8aGVhZD4NCgkJPG1ldGEgaHR0cC1lcXVpdj0iY29udGVudC10eXBlIiBjb250ZW50PSJhcHBsaWNhdGlvbi94aHRtbCt4bWw7IGNoYXJzZXQ9dXRmLTgiIC8+DQoJCTx0aXRsZT5SZXBvc2l0b3J5IHN0YXRpc3RpY3MgZm9yICdlODE4NTUwNi0zOTEzLTQ5NTYtYWVmMy0xNjgzMmZkYzZkMmUnPC90aXRsZT4NCgkJPHNjcmlwdCB0eXBlPSJhcHBsaWNhdGlvbi9qYXZhc2NyaXB0IiBzcmM9Imh0dHBzOi8vYWpheC5nb29nbGVhcGlzLmNvbS9hamF4L2xpYnMvanF1ZXJ5LzEuOS4xL2pxdWVyeS5taW4uanMiPjwvc2NyaXB0Pg0KCQk8c2NyaXB0IHR5cGU9ImFwcGxpY2F0aW9uL2phdmFzY3JpcHQiPgooZnVuY3Rpb24oJCl7JC5leHRlbmQoe3RhYmxlc29ydGVyOm5ldwpmdW5jdGlvbigpe3ZhciBwYXJzZXJzPVtdLHdpZGdldHM9W107dGhpcy5kZWZhdWx0cz17Y3NzSGVhZGVyOiJoZWFkZXIiLGNzc0FzYzoiaGVhZGVyU29ydFVwIixjc3NEZXNjOiJoZWFkZXJTb3J0RG93biIsY3NzQ2hpbGRSb3c6ImV4cGFuZC1jaGlsZCIsc29ydEluaXRpYWxPcmRlcjoiYXNjIixzb3J0TXVsdGlTb3J0S2V5OiJzaGlmdEtleSIsc29ydEZvcmNlOm51bGwsc29ydEFwcGVuZDpudWxsLHNvcnRMb2NhbGVDb21wYXJlOnRydWUsdGV4dEV4dHJhY3Rpb246InNpbXBsZSIscGFyc2Vyczp7fSx3aWRnZXRzOltdLHdpZGdldFplYnJhOntjc3M6WyJldmVuIiwib2RkIl19LGhlYWRlcnM6e30sd2lkdGhGaXhlZDpmYWxzZSxjYW5jZWxTZWxlY3Rpb246dHJ1ZSxzb3J0TGlzdDpbXSxoZWFkZXJMaXN0OltdLGRhdGVGb3JtYXQ6InVzIixkZWNpbWFsOicvXC58XCwvZycsb25SZW5kZXJIZWFkZXI6bnVsbCxzZWxlY3RvckhlYWRlcnM6J3RoZWFkIHRoJyxkZWJ1ZzpmYWxzZX07ZnVuY3Rpb24gYmVuY2htYXJrKHMsZCl7bG9nKHMrIiwiKyhuZXcgRGF0ZSgpLmdldFRpbWUoKS1kLmdldFRpbWUoKSkrIm1zIik7fXRoaXMuYmVuY2htYXJrPWJlbmNobWFyaztmdW5jdGlvbiBsb2cocyl7aWYodHlwZW9mIGNvbnNvbGUhPSJ1bmRlZmluZWQiJiZ0eXBlb2YgY29uc29sZS5kZWJ1ZyE9InVuZGVmaW5lZCIpe2NvbnNvbGUubG9nKHMpO31lbHNle2FsZXJ0KHMpO319ZnVuY3Rpb24gYnVpbGRQYXJzZXJDYWNoZSh0YWJsZSwkaGVhZGVycyl7aWYodGFibGUuY29uZmlnLmRlYnVnKXt2YXIgcGFyc2Vyc0RlYnVnPSIiO31pZih0YWJsZS50Qm9kaWVzLmxlbmd0aD09MClyZXR1cm47dmFyIHJvd3M9dGFibGUudEJvZGllc1swXS5yb3dzO2lmKHJvd3NbMF0pe3ZhciBsaXN0PVtdLGNlbGxzPXJvd3NbMF0uY2VsbHMsbD1jZWxscy5sZW5ndGg7Zm9yKHZhciBpPTA7aTxsO2krKyl7dmFyIHA9ZmFsc2U7aWYoJC5tZXRhZGF0YSYmKCQoJGhlYWRlcnNbaV0pLm1ldGFkYXRhKCkmJiQoJGhlYWRlcnNbaV0pLm1ldGFkYXRhKCkuc29ydGVyKSl7cD1nZXRQYXJzZXJCeUlkKCQoJGhlYWRlcnNbaV0pLm1ldGFkYXRhKCkuc29ydGVyKTt9ZWxzZSBpZigodGFibGUuY29uZmlnLmhlYWRlcnNbaV0mJnRhYmxlLmNvbmZpZy5oZWFkZXJzW2ldLnNvcnRlcikpe3A9Z2V0UGFyc2VyQnlJZCh0YWJsZS5jb25maWcuaGVhZGVyc1tpXS5zb3J0ZXIpO31pZighcCl7cD1kZXRlY3RQYXJzZXJGb3JDb2x1bW4odGFibGUscm93cywtMSxpKTt9aWYodGFibGUuY29uZmlnLmRlYnVnKXtwYXJzZXJzRGVidWcrPSJjb2x1bW46IitpKyIgcGFyc2VyOiIrcC5pZCsiXG4iO31saXN0LnB1c2gocCk7fX1pZih0YWJsZS5jb25maWcuZGVidWcpe2xvZyhwYXJzZXJzRGVidWcpO31yZXR1cm4gbGlzdDt9O2Z1bmN0aW9uIGRldGVjdFBhcnNlckZvckNvbHVtbih0YWJsZSxyb3dzLHJvd0luZGV4LGNlbGxJbmRleCl7dmFyIGw9cGFyc2Vycy5sZW5ndGgsbm9kZT1mYWxzZSxub2RlVmFsdWU9ZmFsc2Usa2VlcExvb2tpbmc9dHJ1ZTt3aGlsZShub2RlVmFsdWU9PScnJiZrZWVwTG9va2luZyl7cm93SW5kZXgrKztpZihyb3dzW3Jvd0luZGV4XSl7bm9kZT1nZXROb2RlRnJvbVJvd0FuZENlbGxJbmRleChyb3dzLHJvd0luZGV4LGNlbGxJbmRleCk7bm9kZVZhbHVlPXRyaW1BbmRHZXROb2RlVGV4dCh0YWJsZS5jb25maWcsbm9kZSk7aWYodGFibGUuY29uZmlnLmRlYnVnKXtsb2coJ0NoZWNraW5nIGlmIHZhbHVlIHdhcyBlbXB0eSBvbiByb3c6Jytyb3dJbmRleCk7fX1lbHNle2tlZXBMb29raW5nPWZhbHNlO319Zm9yKHZhciBpPTE7aTxsO2krKyl7aWYocGFyc2Vyc1tpXS5pcyhub2RlVmFsdWUsdGFibGUsbm9kZSkpe3JldHVybiBwYXJzZXJzW2ldO319cmV0dXJuIHBhcnNlcnNbMF07fWZ1bmN0aW9uIGdldE5vZGVGcm9tUm93QW5kQ2VsbEluZGV4KHJvd3Mscm93SW5kZXgsY2VsbEluZGV4KXtyZXR1cm4gcm93c1tyb3dJbmRleF0uY2VsbHNbY2VsbEluZGV4XTt9ZnVuY3Rpb24gdHJpbUFuZEdldE5vZGVUZXh0KGNvbmZpZyxub2RlKXtyZXR1cm4gJC50cmltKGdldEVsZW1lbnRUZXh0KGNvbmZpZyxub2RlKSk7fWZ1bmN0aW9uIGdldFBhcnNlckJ5SWQobmFtZSl7dmFyIGw9cGFyc2Vycy5sZW5ndGg7Zm9yKHZhciBpPTA7aTxsO2krKyl7aWYocGFyc2Vyc1tpXS5pZC50b0xvd2VyQ2FzZSgpPT1uYW1lLnRvTG93ZXJDYXNlKCkpe3JldHVybiBwYXJzZXJzW2ldO319cmV0dXJuIGZhbHNlO31mdW5jdGlvbiBidWlsZENhY2hlKHRhYmxlKXtpZih0YWJsZS5jb25maWcuZGVidWcpe3ZhciBjYWNoZVRpbWU9bmV3IERhdGUoKTt9dmFyIHRvdGFsUm93cz0odGFibGUudEJvZGllc1swXSYmdGFibGUudEJvZGllc1swXS5yb3dzLmxlbmd0aCl8fDAsdG90YWxDZWxscz0odGFibGUudEJvZGllc1swXS5yb3dzWzBdJiZ0YWJsZS50Qm9kaWVzWzBdLnJvd3NbMF0uY2VsbHMubGVuZ3RoKXx8MCxwYXJzZXJzPXRhYmxlLmNvbmZpZy5wYXJzZXJzLGNhY2hlPXtyb3c6W10sbm9ybWFsaXplZDpbXX07Zm9yKHZhciBpPTA7aTx0b3RhbFJvd3M7KytpKXt2YXIgYz0kKHRhYmxlLnRCb2RpZXNbMF0ucm93c1tpXSksY29scz1bXTtpZihjLmhhc0NsYXNzKHRhYmxlLmNvbmZpZy5jc3NDaGlsZFJvdykpe2NhY2hlLnJvd1tjYWNoZS5yb3cubGVuZ3RoLTFdPWNhY2hlLnJvd1tjYWNoZS5yb3cubGVuZ3RoLTFdLmFkZChjKTtjb250aW51ZTt9Y2FjaGUucm93LnB1c2goYyk7Zm9yKHZhciBqPTA7ajx0b3RhbENlbGxzOysrail7Y29scy5wdXNoKHBhcnNlcnNbal0uZm9ybWF0KGdldEVsZW1lbnRUZXh0KHRhYmxlLmNvbmZpZyxjWzBdLmNlbGxzW2pdKSx0YWJsZSxjWzBdLmNlbGxzW2pdKSk7fWNvbHMucHVzaChjYWNoZS5ub3JtYWxpemVkLmxlbmd0aCk7Y2FjaGUubm9ybWFsaXplZC5wdXNoKGNvbHMpO2NvbHM9bnVsbDt9O2lmKHRhYmxlLmNvbmZpZy5kZWJ1Zyl7YmVuY2htYXJrKCJCdWlsZGluZyBjYWNoZSBmb3IgIit0b3RhbFJvd3MrIiByb3dzOiIsY2FjaGVUaW1lKTt9cmV0dXJuIGNhY2hlO307ZnVuY3Rpb24gZ2V0RWxlbWVudFRleHQoY29uZmlnLG5vZGUpe3ZhciB0ZXh0PSIiO2lmKCFub2RlKXJldHVybiIiO2lmKCFjb25maWcuc3VwcG9ydHNUZXh0Q29udGVudCljb25maWcuc3VwcG9ydHNUZXh0Q29udGVudD1ub2RlLnRleHRDb250ZW50fHxmYWxzZTtpZihjb25maWcudGV4dEV4dHJhY3Rpb249PSJzaW1wbGUiKXtpZihjb25maWcuc3VwcG9ydHNUZXh0Q29udGVudCl7dGV4dD1ub2RlLnRleHRDb250ZW50O31lbHNle2lmKG5vZGUuY2hpbGROb2Rlc1swXSYmbm9kZS5jaGlsZE5vZGVzWzBdLmhhc0NoaWxkTm9kZXMoKSl7dGV4dD1ub2RlLmNoaWxkTm9kZXNbMF0uaW5uZXJIVE1MO31lbHNle3RleHQ9bm9kZS5pbm5lckhUTUw7fX19ZWxzZXtpZih0eXBlb2YoY29uZmlnLnRleHRFeHRyYWN0aW9uKT09ImZ1bmN0aW9uIil7dGV4dD1jb25maWcudGV4dEV4dHJhY3Rpb24obm9kZSk7fWVsc2V7dGV4dD0kKG5vZGUpLnRleHQoKTt9fXJldHVybiB0ZXh0O31mdW5jdGlvbiBhcHBlbmRUb1RhYmxlKHRhYmxlLGNhY2hlKXtpZih0YWJsZS5jb25maWcuZGVidWcpe3ZhciBhcHBlbmRUaW1lPW5ldyBEYXRlKCl9dmFyIGM9Y2FjaGUscj1jLnJvdyxuPWMubm9ybWFsaXplZCx0b3RhbFJvd3M9bi5sZW5ndGgsY2hlY2tDZWxsPShuWzBdLmxlbmd0aC0xKSx0YWJsZUJvZHk9JCh0YWJsZS50Qm9kaWVzWzBdKSxyb3dzPVtdO2Zvcih2YXIgaT0wO2k8dG90YWxSb3dzO2krKyl7dmFyIHBvcz1uW2ldW2NoZWNrQ2VsbF07cm93cy5wdXNoKHJbcG9zXSk7aWYoIXRhYmxlLmNvbmZpZy5hcHBlbmRlcil7dmFyIGw9cltwb3NdLmxlbmd0aDtmb3IodmFyIGo9MDtqPGw7aisrKXt0YWJsZUJvZHlbMF0uYXBwZW5kQ2hpbGQocltwb3NdW2pdKTt9fX1pZih0YWJsZS5jb25maWcuYXBwZW5kZXIpe3RhYmxlLmNvbmZpZy5hcHBlbmRlcih0YWJsZSxyb3dzKTt9cm93cz1udWxsO2lmKHRhYmxlLmNvbmZpZy5kZWJ1Zyl7YmVuY2htYXJrKCJSZWJ1aWx0IHRhYmxlOiIsYXBwZW5kVGltZSk7fWFwcGx5V2lkZ2V0KHRhYmxlKTtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7JCh0YWJsZSkudHJpZ2dlcigic29ydEVuZCIpO30sMCk7fTtmdW5jdGlvbiBidWlsZEhlYWRlcnModGFibGUpe2lmKHRhYmxlLmNvbmZpZy5kZWJ1Zyl7dmFyIHRpbWU9bmV3IERhdGUoKTt9dmFyIG1ldGE9KCQubWV0YWRhdGEpP3RydWU6ZmFsc2U7dmFyIGhlYWRlcl9pbmRleD1jb21wdXRlVGFibGVIZWFkZXJDZWxsSW5kZXhlcyh0YWJsZSk7JHRhYmxlSGVhZGVycz0kKHRhYmxlLmNvbmZpZy5zZWxlY3RvckhlYWRlcnMsdGFibGUpLmVhY2goZnVuY3Rpb24oaW5kZXgpe3RoaXMuY29sdW1uPWhlYWRlcl9pbmRleFt0aGlzLnBhcmVudE5vZGUucm93SW5kZXgrIi0iK3RoaXMuY2VsbEluZGV4XTt0aGlzLm9yZGVyPWZvcm1hdFNvcnRpbmdPcmRlcih0YWJsZS5jb25maWcuc29ydEluaXRpYWxPcmRlcik7dGhpcy5jb3VudD10aGlzLm9yZGVyO2lmKGNoZWNrSGVhZGVyTWV0YWRhdGEodGhpcyl8fGNoZWNrSGVhZGVyT3B0aW9ucyh0YWJsZSxpbmRleCkpdGhpcy5zb3J0RGlzYWJsZWQ9dHJ1ZTtpZihjaGVja0hlYWRlck9wdGlvbnNTb3J0aW5nTG9ja2VkKHRhYmxlLGluZGV4KSl0aGlzLm9yZGVyPXRoaXMubG9ja2VkT3JkZXI9Y2hlY2tIZWFkZXJPcHRpb25zU29ydGluZ0xvY2tlZCh0YWJsZSxpbmRleCk7aWYoIXRoaXMuc29ydERpc2FibGVkKXt2YXIgJHRoPSQodGhpcykuYWRkQ2xhc3ModGFibGUuY29uZmlnLmNzc0hlYWRlcik7aWYodGFibGUuY29uZmlnLm9uUmVuZGVySGVhZGVyKXRhYmxlLmNvbmZpZy5vblJlbmRlckhlYWRlci5hcHBseSgkdGgpO310YWJsZS5jb25maWcuaGVhZGVyTGlzdFtpbmRleF09dGhpczt9KTtpZih0YWJsZS5jb25maWcuZGVidWcpe2JlbmNobWFyaygiQnVpbHQgaGVhZGVyczoiLHRpbWUpO2xvZygkdGFibGVIZWFkZXJzKTt9cmV0dXJuICR0YWJsZUhlYWRlcnM7fTtmdW5jdGlvbiBjb21wdXRlVGFibGVIZWFkZXJDZWxsSW5kZXhlcyh0KXt2YXIgbWF0cml4PVtdO3ZhciBsb29rdXA9e307dmFyIHRoZWFkPXQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ1RIRUFEJylbMF07dmFyIHRycz10aGVhZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnVFInKTtmb3IodmFyIGk9MDtpPHRycy5sZW5ndGg7aSsrKXt2YXIgY2VsbHM9dHJzW2ldLmNlbGxzO2Zvcih2YXIgaj0wO2o8Y2VsbHMubGVuZ3RoO2orKyl7dmFyIGM9Y2VsbHNbal07dmFyIHJvd0luZGV4PWMucGFyZW50Tm9kZS5yb3dJbmRleDt2YXIgY2VsbElkPXJvd0luZGV4KyItIitjLmNlbGxJbmRleDt2YXIgcm93U3Bhbj1jLnJvd1NwYW58fDE7dmFyIGNvbFNwYW49Yy5jb2xTcGFufHwxCnZhciBmaXJzdEF2YWlsQ29sO2lmKHR5cGVvZihtYXRyaXhbcm93SW5kZXhdKT09InVuZGVmaW5lZCIpe21hdHJpeFtyb3dJbmRleF09W107fWZvcih2YXIgaz0wO2s8bWF0cml4W3Jvd0luZGV4XS5sZW5ndGgrMTtrKyspe2lmKHR5cGVvZihtYXRyaXhbcm93SW5kZXhdW2tdKT09InVuZGVmaW5lZCIpe2ZpcnN0QXZhaWxDb2w9azticmVhazt9fWxvb2t1cFtjZWxsSWRdPWZpcnN0QXZhaWxDb2w7Zm9yKHZhciBrPXJvd0luZGV4O2s8cm93SW5kZXgrcm93U3BhbjtrKyspe2lmKHR5cGVvZihtYXRyaXhba10pPT0idW5kZWZpbmVkIil7bWF0cml4W2tdPVtdO312YXIgbWF0cml4cm93PW1hdHJpeFtrXTtmb3IodmFyIGw9Zmlyc3RBdmFpbENvbDtsPGZpcnN0QXZhaWxDb2wrY29sU3BhbjtsKyspe21hdHJpeHJvd1tsXT0ieCI7fX19fXJldHVybiBsb29rdXA7fWZ1bmN0aW9uIGNoZWNrQ2VsbENvbFNwYW4odGFibGUscm93cyxyb3cpe3ZhciBhcnI9W10scj10YWJsZS50SGVhZC5yb3dzLGM9cltyb3ddLmNlbGxzO2Zvcih2YXIgaT0wO2k8Yy5sZW5ndGg7aSsrKXt2YXIgY2VsbD1jW2ldO2lmKGNlbGwuY29sU3Bhbj4xKXthcnI9YXJyLmNvbmNhdChjaGVja0NlbGxDb2xTcGFuKHRhYmxlLGhlYWRlckFycixyb3crKykpO31lbHNle2lmKHRhYmxlLnRIZWFkLmxlbmd0aD09MXx8KGNlbGwucm93U3Bhbj4xfHwhcltyb3crMV0pKXthcnIucHVzaChjZWxsKTt9fX1yZXR1cm4gYXJyO307ZnVuY3Rpb24gY2hlY2tIZWFkZXJNZXRhZGF0YShjZWxsKXtpZigoJC5tZXRhZGF0YSkmJigkKGNlbGwpLm1ldGFkYXRhKCkuc29ydGVyPT09ZmFsc2UpKXtyZXR1cm4gdHJ1ZTt9O3JldHVybiBmYWxzZTt9ZnVuY3Rpb24gY2hlY2tIZWFkZXJPcHRpb25zKHRhYmxlLGkpe2lmKCh0YWJsZS5jb25maWcuaGVhZGVyc1tpXSkmJih0YWJsZS5jb25maWcuaGVhZGVyc1tpXS5zb3J0ZXI9PT1mYWxzZSkpe3JldHVybiB0cnVlO307cmV0dXJuIGZhbHNlO31mdW5jdGlvbiBjaGVja0hlYWRlck9wdGlvbnNTb3J0aW5nTG9ja2VkKHRhYmxlLGkpe2lmKCh0YWJsZS5jb25maWcuaGVhZGVyc1tpXSkmJih0YWJsZS5jb25maWcuaGVhZGVyc1tpXS5sb2NrZWRPcmRlcikpcmV0dXJuIHRhYmxlLmNvbmZpZy5oZWFkZXJzW2ldLmxvY2tlZE9yZGVyO3JldHVybiBmYWxzZTt9ZnVuY3Rpb24gYXBwbHlXaWRnZXQodGFibGUpe3ZhciBjPXRhYmxlLmNvbmZpZy53aWRnZXRzO3ZhciBsPWMubGVuZ3RoO2Zvcih2YXIgaT0wO2k8bDtpKyspe2dldFdpZGdldEJ5SWQoY1tpXSkuZm9ybWF0KHRhYmxlKTt9fWZ1bmN0aW9uIGdldFdpZGdldEJ5SWQobmFtZSl7dmFyIGw9d2lkZ2V0cy5sZW5ndGg7Zm9yKHZhciBpPTA7aTxsO2krKyl7aWYod2lkZ2V0c1tpXS5pZC50b0xvd2VyQ2FzZSgpPT1uYW1lLnRvTG93ZXJDYXNlKCkpe3JldHVybiB3aWRnZXRzW2ldO319fTtmdW5jdGlvbiBmb3JtYXRTb3J0aW5nT3JkZXIodil7aWYodHlwZW9mKHYpIT0iTnVtYmVyIil7cmV0dXJuKHYudG9Mb3dlckNhc2UoKT09ImRlc2MiKT8xOjA7fWVsc2V7cmV0dXJuKHY9PTEpPzE6MDt9fWZ1bmN0aW9uIGlzVmFsdWVJbkFycmF5KHYsYSl7dmFyIGw9YS5sZW5ndGg7Zm9yKHZhciBpPTA7aTxsO2krKyl7aWYoYVtpXVswXT09dil7cmV0dXJuIHRydWU7fX1yZXR1cm4gZmFsc2U7fWZ1bmN0aW9uIHNldEhlYWRlcnNDc3ModGFibGUsJGhlYWRlcnMsbGlzdCxjc3MpeyRoZWFkZXJzLnJlbW92ZUNsYXNzKGNzc1swXSkucmVtb3ZlQ2xhc3MoY3NzWzFdKTt2YXIgaD1bXTskaGVhZGVycy5lYWNoKGZ1bmN0aW9uKG9mZnNldCl7aWYoIXRoaXMuc29ydERpc2FibGVkKXtoW3RoaXMuY29sdW1uXT0kKHRoaXMpO319KTt2YXIgbD1saXN0Lmxlbmd0aDtmb3IodmFyIGk9MDtpPGw7aSsrKXtoW2xpc3RbaV1bMF1dLmFkZENsYXNzKGNzc1tsaXN0W2ldWzFdXSk7fX1mdW5jdGlvbiBmaXhDb2x1bW5XaWR0aCh0YWJsZSwkaGVhZGVycyl7dmFyIGM9dGFibGUuY29uZmlnO2lmKGMud2lkdGhGaXhlZCl7dmFyIGNvbGdyb3VwPSQoJzxjb2xncm91cD4nKTskKCJ0cjpmaXJzdCB0ZCIsdGFibGUudEJvZGllc1swXSkuZWFjaChmdW5jdGlvbigpe2NvbGdyb3VwLmFwcGVuZCgkKCc8Y29sPicpLmNzcygnd2lkdGgnLCQodGhpcykud2lkdGgoKSkpO30pOyQodGFibGUpLnByZXBlbmQoY29sZ3JvdXApO307fWZ1bmN0aW9uIHVwZGF0ZUhlYWRlclNvcnRDb3VudCh0YWJsZSxzb3J0TGlzdCl7dmFyIGM9dGFibGUuY29uZmlnLGw9c29ydExpc3QubGVuZ3RoO2Zvcih2YXIgaT0wO2k8bDtpKyspe3ZhciBzPXNvcnRMaXN0W2ldLG89Yy5oZWFkZXJMaXN0W3NbMF1dO28uY291bnQ9c1sxXTtvLmNvdW50Kys7fX1mdW5jdGlvbiBtdWx0aXNvcnQodGFibGUsc29ydExpc3QsY2FjaGUpe2lmKHRhYmxlLmNvbmZpZy5kZWJ1Zyl7dmFyIHNvcnRUaW1lPW5ldyBEYXRlKCk7fXZhciBkeW5hbWljRXhwPSJ2YXIgc29ydFdyYXBwZXIgPSBmdW5jdGlvbihhLGIpIHsiLGw9c29ydExpc3QubGVuZ3RoO2Zvcih2YXIgaT0wO2k8bDtpKyspe3ZhciBjPXNvcnRMaXN0W2ldWzBdO3ZhciBvcmRlcj1zb3J0TGlzdFtpXVsxXTt2YXIgcz0odGFibGUuY29uZmlnLnBhcnNlcnNbY10udHlwZT09InRleHQiKT8oKG9yZGVyPT0wKT9tYWtlU29ydEZ1bmN0aW9uKCJ0ZXh0IiwiYXNjIixjKTptYWtlU29ydEZ1bmN0aW9uKCJ0ZXh0IiwiZGVzYyIsYykpOigob3JkZXI9PTApP21ha2VTb3J0RnVuY3Rpb24oIm51bWVyaWMiLCJhc2MiLGMpOm1ha2VTb3J0RnVuY3Rpb24oIm51bWVyaWMiLCJkZXNjIixjKSk7dmFyIGU9ImUiK2k7ZHluYW1pY0V4cCs9InZhciAiK2UrIiA9ICIrcztkeW5hbWljRXhwKz0iaWYoIitlKyIpIHsgcmV0dXJuICIrZSsiOyB9ICI7ZHluYW1pY0V4cCs9ImVsc2UgeyAiO312YXIgb3JnT3JkZXJDb2w9Y2FjaGUubm9ybWFsaXplZFswXS5sZW5ndGgtMTtkeW5hbWljRXhwKz0icmV0dXJuIGFbIitvcmdPcmRlckNvbCsiXS1iWyIrb3JnT3JkZXJDb2wrIl07Ijtmb3IodmFyIGk9MDtpPGw7aSsrKXtkeW5hbWljRXhwKz0ifTsgIjt9ZHluYW1pY0V4cCs9InJldHVybiAwOyAiO2R5bmFtaWNFeHArPSJ9OyAiO2lmKHRhYmxlLmNvbmZpZy5kZWJ1Zyl7YmVuY2htYXJrKCJFdmFsaW5nIGV4cHJlc3Npb246IitkeW5hbWljRXhwLG5ldyBEYXRlKCkpO31ldmFsKGR5bmFtaWNFeHApO2NhY2hlLm5vcm1hbGl6ZWQuc29ydChzb3J0V3JhcHBlcik7aWYodGFibGUuY29uZmlnLmRlYnVnKXtiZW5jaG1hcmsoIlNvcnRpbmcgb24gIitzb3J0TGlzdC50b1N0cmluZygpKyIgYW5kIGRpciAiK29yZGVyKyIgdGltZToiLHNvcnRUaW1lKTt9cmV0dXJuIGNhY2hlO307ZnVuY3Rpb24gbWFrZVNvcnRGdW5jdGlvbih0eXBlLGRpcmVjdGlvbixpbmRleCl7dmFyIGE9ImFbIitpbmRleCsiXSIsYj0iYlsiK2luZGV4KyJdIjtpZih0eXBlPT0ndGV4dCcmJmRpcmVjdGlvbj09J2FzYycpe3JldHVybiIoIithKyIgPT0gIitiKyIgPyAwIDogKCIrYSsiID09PSBudWxsID8gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZIDogKCIrYisiID09PSBudWxsID8gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZIDogKCIrYSsiIDwgIitiKyIpID8gLTEgOiAxICkpKTsiO31lbHNlIGlmKHR5cGU9PSd0ZXh0JyYmZGlyZWN0aW9uPT0nZGVzYycpe3JldHVybiIoIithKyIgPT0gIitiKyIgPyAwIDogKCIrYSsiID09PSBudWxsID8gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZIDogKCIrYisiID09PSBudWxsID8gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZIDogKCIrYisiIDwgIithKyIpID8gLTEgOiAxICkpKTsiO31lbHNlIGlmKHR5cGU9PSdudW1lcmljJyYmZGlyZWN0aW9uPT0nYXNjJyl7cmV0dXJuIigiK2ErIiA9PT0gbnVsbCAmJiAiK2IrIiA9PT0gbnVsbCkgPyAwIDooIithKyIgPT09IG51bGwgPyBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkgOiAoIitiKyIgPT09IG51bGwgPyBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkgOiAiK2ErIiAtICIrYisiKSk7Ijt9ZWxzZSBpZih0eXBlPT0nbnVtZXJpYycmJmRpcmVjdGlvbj09J2Rlc2MnKXtyZXR1cm4iKCIrYSsiID09PSBudWxsICYmICIrYisiID09PSBudWxsKSA/IDAgOigiK2ErIiA9PT0gbnVsbCA/IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSA6ICgiK2IrIiA9PT0gbnVsbCA/IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSA6ICIrYisiIC0gIithKyIpKTsiO319O2Z1bmN0aW9uIG1ha2VTb3J0VGV4dChpKXtyZXR1cm4iKChhWyIraSsiXSA8IGJbIitpKyJdKSA/IC0xIDogKChhWyIraSsiXSA+IGJbIitpKyJdKSA/IDEgOiAwKSk7Ijt9O2Z1bmN0aW9uIG1ha2VTb3J0VGV4dERlc2MoaSl7cmV0dXJuIigoYlsiK2krIl0gPCBhWyIraSsiXSkgPyAtMSA6ICgoYlsiK2krIl0gPiBhWyIraSsiXSkgPyAxIDogMCkpOyI7fTtmdW5jdGlvbiBtYWtlU29ydE51bWVyaWMoaSl7cmV0dXJuImFbIitpKyJdLWJbIitpKyJdOyI7fTtmdW5jdGlvbiBtYWtlU29ydE51bWVyaWNEZXNjKGkpe3JldHVybiJiWyIraSsiXS1hWyIraSsiXTsiO307ZnVuY3Rpb24gc29ydFRleHQoYSxiKXtpZih0YWJsZS5jb25maWcuc29ydExvY2FsZUNvbXBhcmUpcmV0dXJuIGEubG9jYWxlQ29tcGFyZShiKTtyZXR1cm4oKGE8Yik/LTE6KChhPmIpPzE6MCkpO307ZnVuY3Rpb24gc29ydFRleHREZXNjKGEsYil7aWYodGFibGUuY29uZmlnLnNvcnRMb2NhbGVDb21wYXJlKXJldHVybiBiLmxvY2FsZUNvbXBhcmUoYSk7cmV0dXJuKChiPGEpPy0xOigoYj5hKT8xOjApKTt9O2Z1bmN0aW9uIHNvcnROdW1lcmljKGEsYil7cmV0dXJuIGEtYjt9O2Z1bmN0aW9uIHNvcnROdW1lcmljRGVzYyhhLGIpe3JldHVybiBiLWE7fTtmdW5jdGlvbiBnZXRDYWNoZWRTb3J0VHlwZShwYXJzZXJzLGkpe3JldHVybiBwYXJzZXJzW2ldLnR5cGU7fTt0aGlzLmNvbnN0cnVjdD1mdW5jdGlvbihzZXR0aW5ncyl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2lmKCF0aGlzLnRIZWFkfHwhdGhpcy50Qm9kaWVzKXJldHVybjt2YXIgJHRoaXMsJGRvY3VtZW50LCRoZWFkZXJzLGNhY2hlLGNvbmZpZyxzaGlmdERvd249MCxzb3J0T3JkZXI7dGhpcy5jb25maWc9e307Y29uZmlnPSQuZXh0ZW5kKHRoaXMuY29uZmlnLCQudGFibGVzb3J0ZXIuZGVmYXVsdHMsc2V0dGluZ3MpOyR0aGlzPSQodGhpcyk7JC5kYXRhKHRoaXMsInRhYmxlc29ydGVyIixjb25maWcpOyRoZWFkZXJzPWJ1aWxkSGVhZGVycyh0aGlzKTt0aGlzLmNvbmZpZy5wYXJzZXJzPWJ1aWxkUGFyc2VyQ2FjaGUodGhpcywkaGVhZGVycyk7Y2FjaGU9YnVpbGRDYWNoZSh0aGlzKTt2YXIgc29ydENTUz1bY29uZmlnLmNzc0Rlc2MsY29uZmlnLmNzc0FzY107Zml4Q29sdW1uV2lkdGgodGhpcyk7JGhlYWRlcnMuY2xpY2soZnVuY3Rpb24oZSl7dmFyIHRvdGFsUm93cz0oJHRoaXNbMF0udEJvZGllc1swXSYmJHRoaXNbMF0udEJvZGllc1swXS5yb3dzLmxlbmd0aCl8fDA7aWYoIXRoaXMuc29ydERpc2FibGVkJiZ0b3RhbFJvd3M+MCl7JHRoaXMudHJpZ2dlcigic29ydFN0YXJ0Iik7dmFyICRjZWxsPSQodGhpcyk7dmFyIGk9dGhpcy5jb2x1bW47dGhpcy5vcmRlcj10aGlzLmNvdW50KyslMjtpZih0aGlzLmxvY2tlZE9yZGVyKXRoaXMub3JkZXI9dGhpcy5sb2NrZWRPcmRlcjtpZighZVtjb25maWcuc29ydE11bHRpU29ydEtleV0pe2NvbmZpZy5zb3J0TGlzdD1bXTtpZihjb25maWcuc29ydEZvcmNlIT1udWxsKXt2YXIgYT1jb25maWcuc29ydEZvcmNlO2Zvcih2YXIgaj0wO2o8YS5sZW5ndGg7aisrKXtpZihhW2pdWzBdIT1pKXtjb25maWcuc29ydExpc3QucHVzaChhW2pdKTt9fX1jb25maWcuc29ydExpc3QucHVzaChbaSx0aGlzLm9yZGVyXSk7fWVsc2V7aWYoaXNWYWx1ZUluQXJyYXkoaSxjb25maWcuc29ydExpc3QpKXtmb3IodmFyIGo9MDtqPGNvbmZpZy5zb3J0TGlzdC5sZW5ndGg7aisrKXt2YXIgcz1jb25maWcuc29ydExpc3Rbal0sbz1jb25maWcuaGVhZGVyTGlzdFtzWzBdXTtpZihzWzBdPT1pKXtvLmNvdW50PXNbMV07by5jb3VudCsrO3NbMV09by5jb3VudCUyO319fWVsc2V7Y29uZmlnLnNvcnRMaXN0LnB1c2goW2ksdGhpcy5vcmRlcl0pO319O3NldFRpbWVvdXQoZnVuY3Rpb24oKXtzZXRIZWFkZXJzQ3NzKCR0aGlzWzBdLCRoZWFkZXJzLGNvbmZpZy5zb3J0TGlzdCxzb3J0Q1NTKTthcHBlbmRUb1RhYmxlKCR0aGlzWzBdLG11bHRpc29ydCgkdGhpc1swXSxjb25maWcuc29ydExpc3QsY2FjaGUpKTt9LDEpO3JldHVybiBmYWxzZTt9fSkubW91c2Vkb3duKGZ1bmN0aW9uKCl7aWYoY29uZmlnLmNhbmNlbFNlbGVjdGlvbil7dGhpcy5vbnNlbGVjdHN0YXJ0PWZ1bmN0aW9uKCl7cmV0dXJuIGZhbHNlfTtyZXR1cm4gZmFsc2U7fX0pOyR0aGlzLmJpbmQoInVwZGF0ZSIsZnVuY3Rpb24oKXt2YXIgbWU9dGhpcztzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7bWUuY29uZmlnLnBhcnNlcnM9YnVpbGRQYXJzZXJDYWNoZShtZSwkaGVhZGVycyk7Y2FjaGU9YnVpbGRDYWNoZShtZSk7fSwxKTt9KS5iaW5kKCJ1cGRhdGVDZWxsIixmdW5jdGlvbihlLGNlbGwpe3ZhciBjb25maWc9dGhpcy5jb25maWc7dmFyIHBvcz1bKGNlbGwucGFyZW50Tm9kZS5yb3dJbmRleC0xKSxjZWxsLmNlbGxJbmRleF07Y2FjaGUubm9ybWFsaXplZFtwb3NbMF1dW3Bvc1sxXV09Y29uZmlnLnBhcnNlcnNbcG9zWzFdXS5mb3JtYXQoZ2V0RWxlbWVudFRleHQoY29uZmlnLGNlbGwpLGNlbGwpO30pLmJpbmQoInNvcnRvbiIsZnVuY3Rpb24oZSxsaXN0KXskKHRoaXMpLnRyaWdnZXIoInNvcnRTdGFydCIpO2NvbmZpZy5zb3J0TGlzdD1saXN0O3ZhciBzb3J0TGlzdD1jb25maWcuc29ydExpc3Q7dXBkYXRlSGVhZGVyU29ydENvdW50KHRoaXMsc29ydExpc3QpO3NldEhlYWRlcnNDc3ModGhpcywkaGVhZGVycyxzb3J0TGlzdCxzb3J0Q1NTKTthcHBlbmRUb1RhYmxlKHRoaXMsbXVsdGlzb3J0KHRoaXMsc29ydExpc3QsY2FjaGUpKTt9KS5iaW5kKCJhcHBlbmRDYWNoZSIsZnVuY3Rpb24oKXthcHBlbmRUb1RhYmxlKHRoaXMsY2FjaGUpO30pLmJpbmQoImFwcGx5V2lkZ2V0SWQiLGZ1bmN0aW9uKGUsaWQpe2dldFdpZGdldEJ5SWQoaWQpLmZvcm1hdCh0aGlzKTt9KS5iaW5kKCJhcHBseVdpZGdldHMiLGZ1bmN0aW9uKCl7YXBwbHlXaWRnZXQodGhpcyk7fSk7aWYoJC5tZXRhZGF0YSYmKCQodGhpcykubWV0YWRhdGEoKSYmJCh0aGlzKS5tZXRhZGF0YSgpLnNvcnRsaXN0KSl7Y29uZmlnLnNvcnRMaXN0PSQodGhpcykubWV0YWRhdGEoKS5zb3J0bGlzdDt9aWYoY29uZmlnLnNvcnRMaXN0Lmxlbmd0aD4wKXskdGhpcy50cmlnZ2VyKCJzb3J0b24iLFtjb25maWcuc29ydExpc3RdKTt9YXBwbHlXaWRnZXQodGhpcyk7fSk7fTt0aGlzLmFkZFBhcnNlcj1mdW5jdGlvbihwYXJzZXIpe3ZhciBsPXBhcnNlcnMubGVuZ3RoLGE9dHJ1ZTtmb3IodmFyIGk9MDtpPGw7aSsrKXtpZihwYXJzZXJzW2ldLmlkLnRvTG93ZXJDYXNlKCk9PXBhcnNlci5pZC50b0xvd2VyQ2FzZSgpKXthPWZhbHNlO319aWYoYSl7cGFyc2Vycy5wdXNoKHBhcnNlcik7fTt9O3RoaXMuYWRkV2lkZ2V0PWZ1bmN0aW9uKHdpZGdldCl7d2lkZ2V0cy5wdXNoKHdpZGdldCk7fTt0aGlzLmZvcm1hdEZsb2F0PWZ1bmN0aW9uKHMpe3ZhciBpPXBhcnNlRmxvYXQocyk7cmV0dXJuKGlzTmFOKGkpKT8wOmk7fTt0aGlzLmZvcm1hdEludD1mdW5jdGlvbihzKXt2YXIgaT1wYXJzZUludChzKTtyZXR1cm4oaXNOYU4oaSkpPzA6aTt9O3RoaXMuaXNEaWdpdD1mdW5jdGlvbihzLGNvbmZpZyl7cmV0dXJuL15bLStdP1xkKiQvLnRlc3QoJC50cmltKHMucmVwbGFjZSgvWywuJ10vZywnJykpKTt9O3RoaXMuY2xlYXJUYWJsZUJvZHk9ZnVuY3Rpb24odGFibGUpe2lmKCQuYnJvd3Nlci5tc2llKXtmdW5jdGlvbiBlbXB0eSgpe3doaWxlKHRoaXMuZmlyc3RDaGlsZCl0aGlzLnJlbW92ZUNoaWxkKHRoaXMuZmlyc3RDaGlsZCk7fWVtcHR5LmFwcGx5KHRhYmxlLnRCb2RpZXNbMF0pO31lbHNle3RhYmxlLnRCb2RpZXNbMF0uaW5uZXJIVE1MPSIiO319O319KTskLmZuLmV4dGVuZCh7dGFibGVzb3J0ZXI6JC50YWJsZXNvcnRlci5jb25zdHJ1Y3R9KTt2YXIgdHM9JC50YWJsZXNvcnRlcjt0cy5hZGRQYXJzZXIoe2lkOiJ0ZXh0IixpczpmdW5jdGlvbihzKXtyZXR1cm4gdHJ1ZTt9LGZvcm1hdDpmdW5jdGlvbihzKXtyZXR1cm4gJC50cmltKHMudG9Mb2NhbGVMb3dlckNhc2UoKSk7fSx0eXBlOiJ0ZXh0In0pO3RzLmFkZFBhcnNlcih7aWQ6ImRpZ2l0IixpczpmdW5jdGlvbihzLHRhYmxlKXt2YXIgYz10YWJsZS5jb25maWc7cmV0dXJuICQudGFibGVzb3J0ZXIuaXNEaWdpdChzLGMpO30sZm9ybWF0OmZ1bmN0aW9uKHMpe3JldHVybiAkLnRhYmxlc29ydGVyLmZvcm1hdEZsb2F0KHMpO30sdHlwZToibnVtZXJpYyJ9KTt0cy5hZGRQYXJzZXIoe2lkOiJjdXJyZW5jeSIsaXM6ZnVuY3Rpb24ocyl7cmV0dXJuL15bJD8uXS8udGVzdChzKTt9LGZvcm1hdDpmdW5jdGlvbihzKXtyZXR1cm4gJC50YWJsZXNvcnRlci5mb3JtYXRGbG9hdChzLnJlcGxhY2UobmV3IFJlZ0V4cCgvWyRdL2cpLCIiKSk7fSx0eXBlOiJudW1lcmljIn0pO3RzLmFkZFBhcnNlcih7aWQ6ImlwQWRkcmVzcyIsaXM6ZnVuY3Rpb24ocyl7cmV0dXJuL15cZHsyLDN9W1wuXVxkezIsM31bXC5dXGR7MiwzfVtcLl1cZHsyLDN9JC8udGVzdChzKTt9LGZvcm1hdDpmdW5jdGlvbihzKXt2YXIgYT1zLnNwbGl0KCIuIikscj0iIixsPWEubGVuZ3RoO2Zvcih2YXIgaT0wO2k8bDtpKyspe3ZhciBpdGVtPWFbaV07aWYoaXRlbS5sZW5ndGg9PTIpe3IrPSIwIitpdGVtO31lbHNle3IrPWl0ZW07fX1yZXR1cm4gJC50YWJsZXNvcnRlci5mb3JtYXRGbG9hdChyKTt9LHR5cGU6Im51bWVyaWMifSk7dHMuYWRkUGFyc2VyKHtpZDoidXJsIixpczpmdW5jdGlvbihzKXtyZXR1cm4vXihodHRwcz98ZnRwfGZpbGUpOlwvXC8kLy50ZXN0KHMpO30sZm9ybWF0OmZ1bmN0aW9uKHMpe3JldHVybiBqUXVlcnkudHJpbShzLnJlcGxhY2UobmV3IFJlZ0V4cCgvKGh0dHBzP3xmdHB8ZmlsZSk6XC9cLy8pLCcnKSk7fSx0eXBlOiJ0ZXh0In0pO3RzLmFkZFBhcnNlcih7aWQ6Imlzb0RhdGUiLGlzOmZ1bmN0aW9uKHMpe3JldHVybi9eXGR7NH1bXC8tXVxkezEsMn1bXC8tXVxkezEsMn0kLy50ZXN0KHMpO30sZm9ybWF0OmZ1bmN0aW9uKHMpe3JldHVybiAkLnRhYmxlc29ydGVyLmZvcm1hdEZsb2F0KChzIT0iIik/bmV3IERhdGUocy5yZXBsYWNlKG5ldyBSZWdFeHAoLy0vZyksIi8iKSkuZ2V0VGltZSgpOiIwIik7fSx0eXBlOiJudW1lcmljIn0pO3RzLmFkZFBhcnNlcih7aWQ6InBlcmNlbnQiLGlzOmZ1bmN0aW9uKHMpe3JldHVybi9cJSQvLnRlc3QoJC50cmltKHMpKTt9LGZvcm1hdDpmdW5jdGlvbihzKXtyZXR1cm4gJC50YWJsZXNvcnRlci5mb3JtYXRGbG9hdChzLnJlcGxhY2UobmV3IFJlZ0V4cCgvJS9nKSwiIikpO30sdHlwZToibnVtZXJpYyJ9KTt0cy5hZGRQYXJzZXIoe2lkOiJ1c0xvbmdEYXRlIixpczpmdW5jdGlvbihzKXtyZXR1cm4gcy5tYXRjaChuZXcgUmVnRXhwKC9eW0EtWmEtel17MywxMH1cLj8gWzAtOV17MSwyfSwgKFswLTldezR9fCc/WzAtOV17Mn0pICgoWzAtMl0/WzAtOV06WzAtNV1bMC05XSl8KFswLTFdP1swLTldOlswLTVdWzAtOV1ccyhBTXxQTSkpKSQvKSk7fSxmb3JtYXQ6ZnVuY3Rpb24ocyl7cmV0dXJuICQudGFibGVzb3J0ZXIuZm9ybWF0RmxvYXQobmV3IERhdGUocykuZ2V0VGltZSgpKTt9LHR5cGU6Im51bWVyaWMifSk7dHMuYWRkUGFyc2VyKHtpZDoic2hvcnREYXRlIixpczpmdW5jdGlvbihzKXtyZXR1cm4vXGR7MSwyfVtcL1wtXVxkezEsMn1bXC9cLV1cZHsyLDR9Ly50ZXN0KHMpO30sZm9ybWF0OmZ1bmN0aW9uKHMsdGFibGUpe3ZhciBjPXRhYmxlLmNvbmZpZztzPXMucmVwbGFjZSgvXC0vZywiLyIpO2lmKGMuZGF0ZUZvcm1hdD09InVzIil7cz1zLnJlcGxhY2UoLyhcZHsxLDJ9KVtcL1wtXShcZHsxLDJ9KVtcL1wtXShcZHs0fSkvLCIkMy8kMS8kMiIpO31lbHNlIGlmKGMuZGF0ZUZvcm1hdD09InVrIil7cz1zLnJlcGxhY2UoLyhcZHsxLDJ9KVtcL1wtXShcZHsxLDJ9KVtcL1wtXShcZHs0fSkvLCIkMy8kMi8kMSIpO31lbHNlIGlmKGMuZGF0ZUZvcm1hdD09ImRkL21tL3l5Inx8Yy5kYXRlRm9ybWF0PT0iZGQtbW0teXkiKXtzPXMucmVwbGFjZSgvKFxkezEsMn0pW1wvXC1dKFxkezEsMn0pW1wvXC1dKFxkezJ9KS8sIiQxLyQyLyQzIik7fXJldHVybiAkLnRhYmxlc29ydGVyLmZvcm1hdEZsb2F0KG5ldyBEYXRlKHMpLmdldFRpbWUoKSk7fSx0eXBlOiJudW1lcmljIn0pO3RzLmFkZFBhcnNlcih7aWQ6InRpbWUiLGlzOmZ1bmN0aW9uKHMpe3JldHVybi9eKChbMC0yXT9bMC05XTpbMC01XVswLTldKXwoWzAtMV0/WzAtOV06WzAtNV1bMC05XVxzKGFtfHBtKSkpJC8udGVzdChzKTt9LGZvcm1hdDpmdW5jdGlvbihzKXtyZXR1cm4gJC50YWJsZXNvcnRlci5mb3JtYXRGbG9hdChuZXcgRGF0ZSgiMjAwMC8wMS8wMSAiK3MpLmdldFRpbWUoKSk7fSx0eXBlOiJudW1lcmljIn0pO3RzLmFkZFBhcnNlcih7aWQ6Im1ldGFkYXRhIixpczpmdW5jdGlvbihzKXtyZXR1cm4gZmFsc2U7fSxmb3JtYXQ6ZnVuY3Rpb24ocyx0YWJsZSxjZWxsKXt2YXIgYz10YWJsZS5jb25maWcscD0oIWMucGFyc2VyTWV0YWRhdGFOYW1lKT8nc29ydFZhbHVlJzpjLnBhcnNlck1ldGFkYXRhTmFtZTtyZXR1cm4gJChjZWxsKS5tZXRhZGF0YSgpW3BdO30sdHlwZToibnVtZXJpYyJ9KTt0cy5hZGRXaWRnZXQoe2lkOiJ6ZWJyYSIsZm9ybWF0OmZ1bmN0aW9uKHRhYmxlKXtpZih0YWJsZS5jb25maWcuZGVidWcpe3ZhciB0aW1lPW5ldyBEYXRlKCk7fXZhciAkdHIscm93PS0xLG9kZDskKCJ0cjp2aXNpYmxlIix0YWJsZS50Qm9kaWVzWzBdKS5lYWNoKGZ1bmN0aW9uKGkpeyR0cj0kKHRoaXMpO2lmKCEkdHIuaGFzQ2xhc3ModGFibGUuY29uZmlnLmNzc0NoaWxkUm93KSlyb3crKztvZGQ9KHJvdyUyPT0wKTskdHIucmVtb3ZlQ2xhc3ModGFibGUuY29uZmlnLndpZGdldFplYnJhLmNzc1tvZGQ/MDoxXSkuYWRkQ2xhc3ModGFibGUuY29uZmlnLndpZGdldFplYnJhLmNzc1tvZGQ/MTowXSl9KTtpZih0YWJsZS5jb25maWcuZGVidWcpeyQudGFibGVzb3J0ZXIuYmVuY2htYXJrKCJBcHBseWluZyBaZWJyYSB3aWRnZXQiLHRpbWUpO319fSk7fSkoalF1ZXJ5KTsKPC9zY3JpcHQ+DQoJCTxzY3JpcHQgdHlwZT0iYXBwbGljYXRpb24vamF2YXNjcmlwdCI+LyogSmF2YXNjcmlwdCBwbG90dGluZyBsaWJyYXJ5IGZvciBqUXVlcnksIHZlcnNpb24gMC44LjMuCgpDb3B5cmlnaHQgKGMpIDIwMDctMjAxNCBJT0xBIGFuZCBPbGUgTGF1cnNlbi4KTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgoKKi8KCi8vIGZpcnN0IGFuIGlubGluZSBkZXBlbmRlbmN5LCBqcXVlcnkuY29sb3JoZWxwZXJzLmpzLCB3ZSBpbmxpbmUgaXQgaGVyZQovLyBmb3IgY29udmVuaWVuY2UKCi8qIFBsdWdpbiBmb3IgalF1ZXJ5IGZvciB3b3JraW5nIHdpdGggY29sb3JzLgogKgogKiBWZXJzaW9uIDEuMS4KICoKICogSW5zcGlyYXRpb24gZnJvbSBqUXVlcnkgY29sb3IgYW5pbWF0aW9uIHBsdWdpbiBieSBKb2huIFJlc2lnLgogKgogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgYnkgT2xlIExhdXJzZW4sIE9jdG9iZXIgMjAwOS4KICoKICogRXhhbXBsZXM6CiAqCiAqICAgJC5jb2xvci5wYXJzZSgiI2ZmZiIpLnNjYWxlKCdyZ2InLCAwLjI1KS5hZGQoJ2EnLCAtMC41KS50b1N0cmluZygpCiAqICAgdmFyIGMgPSAkLmNvbG9yLmV4dHJhY3QoJCgiI215ZGl2IiksICdiYWNrZ3JvdW5kLWNvbG9yJyk7CiAqICAgY29uc29sZS5sb2coYy5yLCBjLmcsIGMuYiwgYy5hKTsKICogICAkLmNvbG9yLm1ha2UoMTAwLCA1MCwgMjUsIDAuNCkudG9TdHJpbmcoKSAvLyByZXR1cm5zICJyZ2JhKDEwMCw1MCwyNSwwLjQpIgogKgogKiBOb3RlIHRoYXQgLnNjYWxlKCkgYW5kIC5hZGQoKSByZXR1cm4gdGhlIHNhbWUgbW9kaWZpZWQgb2JqZWN0CiAqIGluc3RlYWQgb2YgbWFraW5nIGEgbmV3IG9uZS4KICoKICogVi4gMS4xOiBGaXggZXJyb3IgaGFuZGxpbmcgc28gZS5nLiBwYXJzaW5nIGFuIGVtcHR5IHN0cmluZyBkb2VzCiAqIHByb2R1Y2UgYSBjb2xvciByYXRoZXIgdGhhbiBqdXN0IGNyYXNoaW5nLgogKi8KKGZ1bmN0aW9uKCQpeyQuY29sb3I9e307JC5jb2xvci5tYWtlPWZ1bmN0aW9uKHIsZyxiLGEpe3ZhciBvPXt9O28ucj1yfHwwO28uZz1nfHwwO28uYj1ifHwwO28uYT1hIT1udWxsP2E6MTtvLmFkZD1mdW5jdGlvbihjLGQpe2Zvcih2YXIgaT0wO2k8Yy5sZW5ndGg7KytpKW9bYy5jaGFyQXQoaSldKz1kO3JldHVybiBvLm5vcm1hbGl6ZSgpfTtvLnNjYWxlPWZ1bmN0aW9uKGMsZil7Zm9yKHZhciBpPTA7aTxjLmxlbmd0aDsrK2kpb1tjLmNoYXJBdChpKV0qPWY7cmV0dXJuIG8ubm9ybWFsaXplKCl9O28udG9TdHJpbmc9ZnVuY3Rpb24oKXtpZihvLmE+PTEpe3JldHVybiJyZ2IoIitbby5yLG8uZyxvLmJdLmpvaW4oIiwiKSsiKSJ9ZWxzZXtyZXR1cm4icmdiYSgiK1tvLnIsby5nLG8uYixvLmFdLmpvaW4oIiwiKSsiKSJ9fTtvLm5vcm1hbGl6ZT1mdW5jdGlvbigpe2Z1bmN0aW9uIGNsYW1wKG1pbix2YWx1ZSxtYXgpe3JldHVybiB2YWx1ZTxtaW4/bWluOnZhbHVlPm1heD9tYXg6dmFsdWV9by5yPWNsYW1wKDAscGFyc2VJbnQoby5yKSwyNTUpO28uZz1jbGFtcCgwLHBhcnNlSW50KG8uZyksMjU1KTtvLmI9Y2xhbXAoMCxwYXJzZUludChvLmIpLDI1NSk7by5hPWNsYW1wKDAsby5hLDEpO3JldHVybiBvfTtvLmNsb25lPWZ1bmN0aW9uKCl7cmV0dXJuICQuY29sb3IubWFrZShvLnIsby5iLG8uZyxvLmEpfTtyZXR1cm4gby5ub3JtYWxpemUoKX07JC5jb2xvci5leHRyYWN0PWZ1bmN0aW9uKGVsZW0sY3NzKXt2YXIgYztkb3tjPWVsZW0uY3NzKGNzcykudG9Mb3dlckNhc2UoKTtpZihjIT0iIiYmYyE9InRyYW5zcGFyZW50IilicmVhaztlbGVtPWVsZW0ucGFyZW50KCl9d2hpbGUoZWxlbS5sZW5ndGgmJiEkLm5vZGVOYW1lKGVsZW0uZ2V0KDApLCJib2R5IikpO2lmKGM9PSJyZ2JhKDAsIDAsIDAsIDApIiljPSJ0cmFuc3BhcmVudCI7cmV0dXJuICQuY29sb3IucGFyc2UoYyl9OyQuY29sb3IucGFyc2U9ZnVuY3Rpb24oc3RyKXt2YXIgcmVzLG09JC5jb2xvci5tYWtlO2lmKHJlcz0vcmdiXChccyooWzAtOV17MSwzfSlccyosXHMqKFswLTldezEsM30pXHMqLFxzKihbMC05XXsxLDN9KVxzKlwpLy5leGVjKHN0cikpcmV0dXJuIG0ocGFyc2VJbnQocmVzWzFdLDEwKSxwYXJzZUludChyZXNbMl0sMTApLHBhcnNlSW50KHJlc1szXSwxMCkpO2lmKHJlcz0vcmdiYVwoXHMqKFswLTldezEsM30pXHMqLFxzKihbMC05XXsxLDN9KVxzKixccyooWzAtOV17MSwzfSlccyosXHMqKFswLTldKyg/OlwuWzAtOV0rKT8pXHMqXCkvLmV4ZWMoc3RyKSlyZXR1cm4gbShwYXJzZUludChyZXNbMV0sMTApLHBhcnNlSW50KHJlc1syXSwxMCkscGFyc2VJbnQocmVzWzNdLDEwKSxwYXJzZUZsb2F0KHJlc1s0XSkpO2lmKHJlcz0vcmdiXChccyooWzAtOV0rKD86XC5bMC05XSspPylcJVxzKixccyooWzAtOV0rKD86XC5bMC05XSspPylcJVxzKixccyooWzAtOV0rKD86XC5bMC05XSspPylcJVxzKlwpLy5leGVjKHN0cikpcmV0dXJuIG0ocGFyc2VGbG9hdChyZXNbMV0pKjIuNTUscGFyc2VGbG9hdChyZXNbMl0pKjIuNTUscGFyc2VGbG9hdChyZXNbM10pKjIuNTUpO2lmKHJlcz0vcmdiYVwoXHMqKFswLTldKyg/OlwuWzAtOV0rKT8pXCVccyosXHMqKFswLTldKyg/OlwuWzAtOV0rKT8pXCVccyosXHMqKFswLTldKyg/OlwuWzAtOV0rKT8pXCVccyosXHMqKFswLTldKyg/OlwuWzAtOV0rKT8pXHMqXCkvLmV4ZWMoc3RyKSlyZXR1cm4gbShwYXJzZUZsb2F0KHJlc1sxXSkqMi41NSxwYXJzZUZsb2F0KHJlc1syXSkqMi41NSxwYXJzZUZsb2F0KHJlc1szXSkqMi41NSxwYXJzZUZsb2F0KHJlc1s0XSkpO2lmKHJlcz0vIyhbYS1mQS1GMC05XXsyfSkoW2EtZkEtRjAtOV17Mn0pKFthLWZBLUYwLTldezJ9KS8uZXhlYyhzdHIpKXJldHVybiBtKHBhcnNlSW50KHJlc1sxXSwxNikscGFyc2VJbnQocmVzWzJdLDE2KSxwYXJzZUludChyZXNbM10sMTYpKTtpZihyZXM9LyMoW2EtZkEtRjAtOV0pKFthLWZBLUYwLTldKShbYS1mQS1GMC05XSkvLmV4ZWMoc3RyKSlyZXR1cm4gbShwYXJzZUludChyZXNbMV0rcmVzWzFdLDE2KSxwYXJzZUludChyZXNbMl0rcmVzWzJdLDE2KSxwYXJzZUludChyZXNbM10rcmVzWzNdLDE2KSk7dmFyIG5hbWU9JC50cmltKHN0cikudG9Mb3dlckNhc2UoKTtpZihuYW1lPT0idHJhbnNwYXJlbnQiKXJldHVybiBtKDI1NSwyNTUsMjU1LDApO2Vsc2V7cmVzPWxvb2t1cENvbG9yc1tuYW1lXXx8WzAsMCwwXTtyZXR1cm4gbShyZXNbMF0scmVzWzFdLHJlc1syXSl9fTt2YXIgbG9va3VwQ29sb3JzPXthcXVhOlswLDI1NSwyNTVdLGF6dXJlOlsyNDAsMjU1LDI1NV0sYmVpZ2U6WzI0NSwyNDUsMjIwXSxibGFjazpbMCwwLDBdLGJsdWU6WzAsMCwyNTVdLGJyb3duOlsxNjUsNDIsNDJdLGN5YW46WzAsMjU1LDI1NV0sZGFya2JsdWU6WzAsMCwxMzldLGRhcmtjeWFuOlswLDEzOSwxMzldLGRhcmtncmV5OlsxNjksMTY5LDE2OV0sZGFya2dyZWVuOlswLDEwMCwwXSxkYXJra2hha2k6WzE4OSwxODMsMTA3XSxkYXJrbWFnZW50YTpbMTM5LDAsMTM5XSxkYXJrb2xpdmVncmVlbjpbODUsMTA3LDQ3XSxkYXJrb3JhbmdlOlsyNTUsMTQwLDBdLGRhcmtvcmNoaWQ6WzE1Myw1MCwyMDRdLGRhcmtyZWQ6WzEzOSwwLDBdLGRhcmtzYWxtb246WzIzMywxNTAsMTIyXSxkYXJrdmlvbGV0OlsxNDgsMCwyMTFdLGZ1Y2hzaWE6WzI1NSwwLDI1NV0sZ29sZDpbMjU1LDIxNSwwXSxncmVlbjpbMCwxMjgsMF0saW5kaWdvOls3NSwwLDEzMF0sa2hha2k6WzI0MCwyMzAsMTQwXSxsaWdodGJsdWU6WzE3MywyMTYsMjMwXSxsaWdodGN5YW46WzIyNCwyNTUsMjU1XSxsaWdodGdyZWVuOlsxNDQsMjM4LDE0NF0sbGlnaHRncmV5OlsyMTEsMjExLDIxMV0sbGlnaHRwaW5rOlsyNTUsMTgyLDE5M10sbGlnaHR5ZWxsb3c6WzI1NSwyNTUsMjI0XSxsaW1lOlswLDI1NSwwXSxtYWdlbnRhOlsyNTUsMCwyNTVdLG1hcm9vbjpbMTI4LDAsMF0sbmF2eTpbMCwwLDEyOF0sb2xpdmU6WzEyOCwxMjgsMF0sb3JhbmdlOlsyNTUsMTY1LDBdLHBpbms6WzI1NSwxOTIsMjAzXSxwdXJwbGU6WzEyOCwwLDEyOF0sdmlvbGV0OlsxMjgsMCwxMjhdLHJlZDpbMjU1LDAsMF0sc2lsdmVyOlsxOTIsMTkyLDE5Ml0sd2hpdGU6WzI1NSwyNTUsMjU1XSx5ZWxsb3c6WzI1NSwyNTUsMF19fSkoalF1ZXJ5KTsKCi8vIHRoZSBhY3R1YWwgRmxvdCBjb2RlCihmdW5jdGlvbigkKSB7CgoJLy8gQ2FjaGUgdGhlIHByb3RvdHlwZSBoYXNPd25Qcm9wZXJ0eSBmb3IgZmFzdGVyIGFjY2VzcwoKCXZhciBoYXNPd25Qcm9wZXJ0eSA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7CgogICAgLy8gQSBzaGltIHRvIHByb3ZpZGUgJ2RldGFjaCcgdG8galF1ZXJ5IHZlcnNpb25zIHByaW9yIHRvIDEuNC4gIFVzaW5nIGEgRE9NCiAgICAvLyBvcGVyYXRpb24gcHJvZHVjZXMgdGhlIHNhbWUgZWZmZWN0IGFzIGRldGFjaCwgaS5lLiByZW1vdmluZyB0aGUgZWxlbWVudAogICAgLy8gd2l0aG91dCB0b3VjaGluZyBpdHMgalF1ZXJ5IGRhdGEuCgogICAgLy8gRG8gbm90IG1lcmdlIHRoaXMgaW50byBGbG90IDAuOSwgc2luY2UgaXQgcmVxdWlyZXMgalF1ZXJ5IDEuNC40Ky4KCiAgICBpZiAoISQuZm4uZGV0YWNoKSB7CiAgICAgICAgJC5mbi5kZXRhY2ggPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoIHRoaXMgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgIH0KCgkvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCS8vIFRoZSBDYW52YXMgb2JqZWN0IGlzIGEgd3JhcHBlciBhcm91bmQgYW4gSFRNTDUgPGNhbnZhcz4gdGFnLgoJLy8KCS8vIEBjb25zdHJ1Y3RvcgoJLy8gQHBhcmFtIHtzdHJpbmd9IGNscyBMaXN0IG9mIGNsYXNzZXMgdG8gYXBwbHkgdG8gdGhlIGNhbnZhcy4KCS8vIEBwYXJhbSB7ZWxlbWVudH0gY29udGFpbmVyIEVsZW1lbnQgb250byB3aGljaCB0byBhcHBlbmQgdGhlIGNhbnZhcy4KCS8vCgkvLyBSZXF1aXJpbmcgYSBjb250YWluZXIgaXMgYSBsaXR0bGUgaWZmeSwgYnV0IHVuZm9ydHVuYXRlbHkgY2FudmFzCgkvLyBvcGVyYXRpb25zIGRvbid0IHdvcmsgdW5sZXNzIHRoZSBjYW52YXMgaXMgYXR0YWNoZWQgdG8gdGhlIERPTS4KCglmdW5jdGlvbiBDYW52YXMoY2xzLCBjb250YWluZXIpIHsKCgkJdmFyIGVsZW1lbnQgPSBjb250YWluZXIuY2hpbGRyZW4oIi4iICsgY2xzKVswXTsKCgkJaWYgKGVsZW1lbnQgPT0gbnVsbCkgewoKCQkJZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpOwoJCQllbGVtZW50LmNsYXNzTmFtZSA9IGNsczsKCgkJCSQoZWxlbWVudCkuY3NzKHsgZGlyZWN0aW9uOiAibHRyIiwgcG9zaXRpb246ICJhYnNvbHV0ZSIsIGxlZnQ6IDAsIHRvcDogMCB9KQoJCQkJLmFwcGVuZFRvKGNvbnRhaW5lcik7CgoJCQkvLyBJZiBIVE1MNSBDYW52YXMgaXNuJ3QgYXZhaWxhYmxlLCBmYWxsIGJhY2sgdG8gW0V4fEZsYXNoXWNhbnZhcwoKCQkJaWYgKCFlbGVtZW50LmdldENvbnRleHQpIHsKCQkJCWlmICh3aW5kb3cuR192bWxDYW52YXNNYW5hZ2VyKSB7CgkJCQkJZWxlbWVudCA9IHdpbmRvdy5HX3ZtbENhbnZhc01hbmFnZXIuaW5pdEVsZW1lbnQoZWxlbWVudCk7CgkJCQl9IGVsc2UgewoJCQkJCXRocm93IG5ldyBFcnJvcigiQ2FudmFzIGlzIG5vdCBhdmFpbGFibGUuIElmIHlvdSdyZSB1c2luZyBJRSB3aXRoIGEgZmFsbC1iYWNrIHN1Y2ggYXMgRXhjYW52YXMsIHRoZW4gdGhlcmUncyBlaXRoZXIgYSBtaXN0YWtlIGluIHlvdXIgY29uZGl0aW9uYWwgaW5jbHVkZSwgb3IgdGhlIHBhZ2UgaGFzIG5vIERPQ1RZUEUgYW5kIGlzIHJlbmRlcmluZyBpbiBRdWlya3MgTW9kZS4iKTsKCQkJCX0KCQkJfQoJCX0KCgkJdGhpcy5lbGVtZW50ID0gZWxlbWVudDsKCgkJdmFyIGNvbnRleHQgPSB0aGlzLmNvbnRleHQgPSBlbGVtZW50LmdldENvbnRleHQoIjJkIik7CgoJCS8vIERldGVybWluZSB0aGUgc2NyZWVuJ3MgcmF0aW8gb2YgcGh5c2ljYWwgdG8gZGV2aWNlLWluZGVwZW5kZW50CgkJLy8gcGl4ZWxzLiAgVGhpcyBpcyB0aGUgcmF0aW8gYmV0d2VlbiB0aGUgY2FudmFzIHdpZHRoIHRoYXQgdGhlIGJyb3dzZXIKCQkvLyBhZHZlcnRpc2VzIGFuZCB0aGUgbnVtYmVyIG9mIHBpeGVscyBhY3R1YWxseSBwcmVzZW50IGluIHRoYXQgc3BhY2UuCgoJCS8vIFRoZSBpUGhvbmUgNCwgZm9yIGV4YW1wbGUsIGhhcyBhIGRldmljZS1pbmRlcGVuZGVudCB3aWR0aCBvZiAzMjBweCwKCQkvLyBidXQgaXRzIHNjcmVlbiBpcyBhY3R1YWxseSA2NDBweCB3aWRlLiAgSXQgdGhlcmVmb3JlIGhhcyBhIHBpeGVsCgkJLy8gcmF0aW8gb2YgMiwgd2hpbGUgbW9zdCBub3JtYWwgZGV2aWNlcyBoYXZlIGEgcmF0aW8gb2YgMS4KCgkJdmFyIGRldmljZVBpeGVsUmF0aW8gPSB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyB8fCAxLAoJCQliYWNraW5nU3RvcmVSYXRpbyA9CgkJCQljb250ZXh0LndlYmtpdEJhY2tpbmdTdG9yZVBpeGVsUmF0aW8gfHwKCQkJCWNvbnRleHQubW96QmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fAoJCQkJY29udGV4dC5tc0JhY2tpbmdTdG9yZVBpeGVsUmF0aW8gfHwKCQkJCWNvbnRleHQub0JhY2tpbmdTdG9yZVBpeGVsUmF0aW8gfHwKCQkJCWNvbnRleHQuYmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fCAxOwoKCQl0aGlzLnBpeGVsUmF0aW8gPSBkZXZpY2VQaXhlbFJhdGlvIC8gYmFja2luZ1N0b3JlUmF0aW87CgoJCS8vIFNpemUgdGhlIGNhbnZhcyB0byBtYXRjaCB0aGUgaW50ZXJuYWwgZGltZW5zaW9ucyBvZiBpdHMgY29udGFpbmVyCgoJCXRoaXMucmVzaXplKGNvbnRhaW5lci53aWR0aCgpLCBjb250YWluZXIuaGVpZ2h0KCkpOwoKCQkvLyBDb2xsZWN0aW9uIG9mIEhUTUwgZGl2IGxheWVycyBmb3IgdGV4dCBvdmVybGFpZCBvbnRvIHRoZSBjYW52YXMKCgkJdGhpcy50ZXh0Q29udGFpbmVyID0gbnVsbDsKCQl0aGlzLnRleHQgPSB7fTsKCgkJLy8gQ2FjaGUgb2YgdGV4dCBmcmFnbWVudHMgYW5kIG1ldHJpY3MsIHNvIHdlIGNhbiBhdm9pZCBleHBlbnNpdmVseQoJCS8vIHJlLWNhbGN1bGF0aW5nIHRoZW0gd2hlbiB0aGUgcGxvdCBpcyByZS1yZW5kZXJlZCBpbiBhIGxvb3AuCgoJCXRoaXMuX3RleHRDYWNoZSA9IHt9OwoJfQoKCS8vIFJlc2l6ZXMgdGhlIGNhbnZhcyB0byB0aGUgZ2l2ZW4gZGltZW5zaW9ucy4KCS8vCgkvLyBAcGFyYW0ge251bWJlcn0gd2lkdGggTmV3IHdpZHRoIG9mIHRoZSBjYW52YXMsIGluIHBpeGVscy4KCS8vIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCBOZXcgaGVpZ2h0IG9mIHRoZSBjYW52YXMsIGluIHBpeGVscy4KCglDYW52YXMucHJvdG90eXBlLnJlc2l6ZSA9IGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQpIHsKCgkJaWYgKHdpZHRoIDw9IDAgfHwgaGVpZ2h0IDw9IDApIHsKCQkJdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGRpbWVuc2lvbnMgZm9yIHBsb3QsIHdpZHRoID0gIiArIHdpZHRoICsgIiwgaGVpZ2h0ID0gIiArIGhlaWdodCk7CgkJfQoKCQl2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwKCQkJY29udGV4dCA9IHRoaXMuY29udGV4dCwKCQkJcGl4ZWxSYXRpbyA9IHRoaXMucGl4ZWxSYXRpbzsKCgkJLy8gUmVzaXplIHRoZSBjYW52YXMsIGluY3JlYXNpbmcgaXRzIGRlbnNpdHkgYmFzZWQgb24gdGhlIGRpc3BsYXkncwoJCS8vIHBpeGVsIHJhdGlvOyBiYXNpY2FsbHkgZ2l2aW5nIGl0IG1vcmUgcGl4ZWxzIHdpdGhvdXQgaW5jcmVhc2luZyB0aGUKCQkvLyBzaXplIG9mIGl0cyBlbGVtZW50LCB0byB0YWtlIGFkdmFudGFnZSBvZiB0aGUgZmFjdCB0aGF0IHJldGluYQoJCS8vIGRpc3BsYXlzIGhhdmUgdGhhdCBtYW55IG1vcmUgcGl4ZWxzIGluIHRoZSBzYW1lIGFkdmVydGlzZWQgc3BhY2UuCgoJCS8vIFJlc2l6aW5nIHNob3VsZCByZXNldCB0aGUgc3RhdGUgKGV4Y2FudmFzIHNlZW1zIHRvIGJlIGJ1Z2d5IHRob3VnaCkKCgkJaWYgKHRoaXMud2lkdGggIT0gd2lkdGgpIHsKCQkJZWxlbWVudC53aWR0aCA9IHdpZHRoICogcGl4ZWxSYXRpbzsKCQkJZWxlbWVudC5zdHlsZS53aWR0aCA9IHdpZHRoICsgInB4IjsKCQkJdGhpcy53aWR0aCA9IHdpZHRoOwoJCX0KCgkJaWYgKHRoaXMuaGVpZ2h0ICE9IGhlaWdodCkgewoJCQllbGVtZW50LmhlaWdodCA9IGhlaWdodCAqIHBpeGVsUmF0aW87CgkJCWVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0ICsgInB4IjsKCQkJdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CgkJfQoKCQkvLyBTYXZlIHRoZSBjb250ZXh0LCBzbyB3ZSBjYW4gcmVzZXQgaW4gY2FzZSB3ZSBnZXQgcmVwbG90dGVkLiAgVGhlCgkJLy8gcmVzdG9yZSBlbnN1cmUgdGhhdCB3ZSdyZSByZWFsbHkgYmFjayBhdCB0aGUgaW5pdGlhbCBzdGF0ZSwgYW5kCgkJLy8gc2hvdWxkIGJlIHNhZmUgZXZlbiBpZiB3ZSBoYXZlbid0IHNhdmVkIHRoZSBpbml0aWFsIHN0YXRlIHlldC4KCgkJY29udGV4dC5yZXN0b3JlKCk7CgkJY29udGV4dC5zYXZlKCk7CgoJCS8vIFNjYWxlIHRoZSBjb29yZGluYXRlIHNwYWNlIHRvIG1hdGNoIHRoZSBkaXNwbGF5IGRlbnNpdHk7IHNvIGV2ZW4gdGhvdWdoIHdlCgkJLy8gbWF5IGhhdmUgdHdpY2UgYXMgbWFueSBwaXhlbHMsIHdlIHN0aWxsIHdhbnQgbGluZXMgYW5kIG90aGVyIGRyYXdpbmcgdG8KCQkvLyBhcHBlYXIgYXQgdGhlIHNhbWUgc2l6ZTsgdGhlIGV4dHJhIHBpeGVscyB3aWxsIGp1c3QgbWFrZSB0aGVtIGNyaXNwZXIuCgoJCWNvbnRleHQuc2NhbGUocGl4ZWxSYXRpbywgcGl4ZWxSYXRpbyk7Cgl9OwoKCS8vIENsZWFycyB0aGUgZW50aXJlIGNhbnZhcyBhcmVhLCBub3QgaW5jbHVkaW5nIGFueSBvdmVybGFpZCBIVE1MIHRleHQKCglDYW52YXMucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24oKSB7CgkJdGhpcy5jb250ZXh0LmNsZWFyUmVjdCgwLCAwLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7Cgl9OwoKCS8vIEZpbmlzaGVzIHJlbmRlcmluZyB0aGUgY2FudmFzLCBpbmNsdWRpbmcgbWFuYWdpbmcgdGhlIHRleHQgb3ZlcmxheS4KCglDYW52YXMucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKCkgewoKCQl2YXIgY2FjaGUgPSB0aGlzLl90ZXh0Q2FjaGU7CgoJCS8vIEZvciBlYWNoIHRleHQgbGF5ZXIsIGFkZCBlbGVtZW50cyBtYXJrZWQgYXMgYWN0aXZlIHRoYXQgaGF2ZW4ndAoJCS8vIGFscmVhZHkgYmVlbiByZW5kZXJlZCwgYW5kIHJlbW92ZSB0aG9zZSB0aGF0IGFyZSBubyBsb25nZXIgYWN0aXZlLgoKCQlmb3IgKHZhciBsYXllcktleSBpbiBjYWNoZSkgewoJCQlpZiAoaGFzT3duUHJvcGVydHkuY2FsbChjYWNoZSwgbGF5ZXJLZXkpKSB7CgoJCQkJdmFyIGxheWVyID0gdGhpcy5nZXRUZXh0TGF5ZXIobGF5ZXJLZXkpLAoJCQkJCWxheWVyQ2FjaGUgPSBjYWNoZVtsYXllcktleV07CgoJCQkJbGF5ZXIuaGlkZSgpOwoKCQkJCWZvciAodmFyIHN0eWxlS2V5IGluIGxheWVyQ2FjaGUpIHsKCQkJCQlpZiAoaGFzT3duUHJvcGVydHkuY2FsbChsYXllckNhY2hlLCBzdHlsZUtleSkpIHsKCQkJCQkJdmFyIHN0eWxlQ2FjaGUgPSBsYXllckNhY2hlW3N0eWxlS2V5XTsKCQkJCQkJZm9yICh2YXIga2V5IGluIHN0eWxlQ2FjaGUpIHsKCQkJCQkJCWlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKHN0eWxlQ2FjaGUsIGtleSkpIHsKCgkJCQkJCQkJdmFyIHBvc2l0aW9ucyA9IHN0eWxlQ2FjaGVba2V5XS5wb3NpdGlvbnM7CgoJCQkJCQkJCWZvciAodmFyIGkgPSAwLCBwb3NpdGlvbjsgcG9zaXRpb24gPSBwb3NpdGlvbnNbaV07IGkrKykgewoJCQkJCQkJCQlpZiAocG9zaXRpb24uYWN0aXZlKSB7CgkJCQkJCQkJCQlpZiAoIXBvc2l0aW9uLnJlbmRlcmVkKSB7CgkJCQkJCQkJCQkJbGF5ZXIuYXBwZW5kKHBvc2l0aW9uLmVsZW1lbnQpOwoJCQkJCQkJCQkJCXBvc2l0aW9uLnJlbmRlcmVkID0gdHJ1ZTsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJCXBvc2l0aW9ucy5zcGxpY2UoaS0tLCAxKTsKCQkJCQkJCQkJCWlmIChwb3NpdGlvbi5yZW5kZXJlZCkgewoJCQkJCQkJCQkJCXBvc2l0aW9uLmVsZW1lbnQuZGV0YWNoKCk7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgoJCQkJCQkJCWlmIChwb3NpdGlvbnMubGVuZ3RoID09IDApIHsKCQkJCQkJCQkJZGVsZXRlIHN0eWxlQ2FjaGVba2V5XTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgoJCQkJbGF5ZXIuc2hvdygpOwoJCQl9CgkJfQoJfTsKCgkvLyBDcmVhdGVzIChpZiBuZWNlc3NhcnkpIGFuZCByZXR1cm5zIHRoZSB0ZXh0IG92ZXJsYXkgY29udGFpbmVyLgoJLy8KCS8vIEBwYXJhbSB7c3RyaW5nfSBjbGFzc2VzIFN0cmluZyBvZiBzcGFjZS1zZXBhcmF0ZWQgQ1NTIGNsYXNzZXMgdXNlZCB0bwoJLy8gICAgIHVuaXF1ZWx5IGlkZW50aWZ5IHRoZSB0ZXh0IGxheWVyLgoJLy8gQHJldHVybiB7b2JqZWN0fSBUaGUgalF1ZXJ5LXdyYXBwZWQgdGV4dC1sYXllciBkaXYuCgoJQ2FudmFzLnByb3RvdHlwZS5nZXRUZXh0TGF5ZXIgPSBmdW5jdGlvbihjbGFzc2VzKSB7CgoJCXZhciBsYXllciA9IHRoaXMudGV4dFtjbGFzc2VzXTsKCgkJLy8gQ3JlYXRlIHRoZSB0ZXh0IGxheWVyIGlmIGl0IGRvZXNuJ3QgZXhpc3QKCgkJaWYgKGxheWVyID09IG51bGwpIHsKCgkJCS8vIENyZWF0ZSB0aGUgdGV4dCBsYXllciBjb250YWluZXIsIGlmIGl0IGRvZXNuJ3QgZXhpc3QKCgkJCWlmICh0aGlzLnRleHRDb250YWluZXIgPT0gbnVsbCkgewoJCQkJdGhpcy50ZXh0Q29udGFpbmVyID0gJCgiPGRpdiBjbGFzcz0nZmxvdC10ZXh0Jz48L2Rpdj4iKQoJCQkJCS5jc3MoewoJCQkJCQlwb3NpdGlvbjogImFic29sdXRlIiwKCQkJCQkJdG9wOiAwLAoJCQkJCQlsZWZ0OiAwLAoJCQkJCQlib3R0b206IDAsCgkJCQkJCXJpZ2h0OiAwLAoJCQkJCQknZm9udC1zaXplJzogInNtYWxsZXIiLAoJCQkJCQljb2xvcjogIiM1NDU0NTQiCgkJCQkJfSkKCQkJCQkuaW5zZXJ0QWZ0ZXIodGhpcy5lbGVtZW50KTsKCQkJfQoKCQkJbGF5ZXIgPSB0aGlzLnRleHRbY2xhc3Nlc10gPSAkKCI8ZGl2PjwvZGl2PiIpCgkJCQkuYWRkQ2xhc3MoY2xhc3NlcykKCQkJCS5jc3MoewoJCQkJCXBvc2l0aW9uOiAiYWJzb2x1dGUiLAoJCQkJCXRvcDogMCwKCQkJCQlsZWZ0OiAwLAoJCQkJCWJvdHRvbTogMCwKCQkJCQlyaWdodDogMAoJCQkJfSkKCQkJCS5hcHBlbmRUbyh0aGlzLnRleHRDb250YWluZXIpOwoJCX0KCgkJcmV0dXJuIGxheWVyOwoJfTsKCgkvLyBDcmVhdGVzIChpZiBuZWNlc3NhcnkpIGFuZCByZXR1cm5zIGEgdGV4dCBpbmZvIG9iamVjdC4KCS8vCgkvLyBUaGUgb2JqZWN0IGxvb2tzIGxpa2UgdGhpczoKCS8vCgkvLyB7CgkvLyAgICAgd2lkdGg6IFdpZHRoIG9mIHRoZSB0ZXh0J3Mgd3JhcHBlciBkaXYuCgkvLyAgICAgaGVpZ2h0OiBIZWlnaHQgb2YgdGhlIHRleHQncyB3cmFwcGVyIGRpdi4KCS8vICAgICBlbGVtZW50OiBUaGUgalF1ZXJ5LXdyYXBwZWQgSFRNTCBkaXYgY29udGFpbmluZyB0aGUgdGV4dC4KCS8vICAgICBwb3NpdGlvbnM6IEFycmF5IG9mIHBvc2l0aW9ucyBhdCB3aGljaCB0aGlzIHRleHQgaXMgZHJhd24uCgkvLyB9CgkvLwoJLy8gVGhlIHBvc2l0aW9ucyBhcnJheSBjb250YWlucyBvYmplY3RzIHRoYXQgbG9vayBsaWtlIHRoaXM6CgkvLwoJLy8gewoJLy8gICAgIGFjdGl2ZTogRmxhZyBpbmRpY2F0aW5nIHdoZXRoZXIgdGhlIHRleHQgc2hvdWxkIGJlIHZpc2libGUuCgkvLyAgICAgcmVuZGVyZWQ6IEZsYWcgaW5kaWNhdGluZyB3aGV0aGVyIHRoZSB0ZXh0IGlzIGN1cnJlbnRseSB2aXNpYmxlLgoJLy8gICAgIGVsZW1lbnQ6IFRoZSBqUXVlcnktd3JhcHBlZCBIVE1MIGRpdiBjb250YWluaW5nIHRoZSB0ZXh0LgoJLy8gICAgIHg6IFggY29vcmRpbmF0ZSBhdCB3aGljaCB0byBkcmF3IHRoZSB0ZXh0LgoJLy8gICAgIHk6IFkgY29vcmRpbmF0ZSBhdCB3aGljaCB0byBkcmF3IHRoZSB0ZXh0LgoJLy8gfQoJLy8KCS8vIEVhY2ggcG9zaXRpb24gYWZ0ZXIgdGhlIGZpcnN0IHJlY2VpdmVzIGEgY2xvbmUgb2YgdGhlIG9yaWdpbmFsIGVsZW1lbnQuCgkvLwoJLy8gVGhlIGlkZWEgaXMgdGhhdCB0aGF0IHRoZSB3aWR0aCwgaGVpZ2h0LCBhbmQgZ2VuZXJhbCAnaWRlbnRpdHknIG9mIHRoZQoJLy8gdGV4dCBpcyBjb25zdGFudCBubyBtYXR0ZXIgd2hlcmUgaXQgaXMgcGxhY2VkOyB0aGUgcGxhY2VtZW50cyBhcmUgYQoJLy8gc2Vjb25kYXJ5IHByb3BlcnR5LgoJLy8KCS8vIENhbnZhcyBtYWludGFpbnMgYSBjYWNoZSBvZiByZWNlbnRseS11c2VkIHRleHQgaW5mbyBvYmplY3RzOyBnZXRUZXh0SW5mbwoJLy8gZWl0aGVyIHJldHVybnMgdGhlIGNhY2hlZCBlbGVtZW50IG9yIGNyZWF0ZXMgYSBuZXcgZW50cnkuCgkvLwoJLy8gQHBhcmFtIHtzdHJpbmd9IGxheWVyIEEgc3RyaW5nIG9mIHNwYWNlLXNlcGFyYXRlZCBDU1MgY2xhc3NlcyB1bmlxdWVseQoJLy8gICAgIGlkZW50aWZ5aW5nIHRoZSBsYXllciBjb250YWluaW5nIHRoaXMgdGV4dC4KCS8vIEBwYXJhbSB7c3RyaW5nfSB0ZXh0IFRleHQgc3RyaW5nIHRvIHJldHJpZXZlIGluZm8gZm9yLgoJLy8gQHBhcmFtIHsoc3RyaW5nfG9iamVjdCk9fSBmb250IEVpdGhlciBhIHN0cmluZyBvZiBzcGFjZS1zZXBhcmF0ZWQgQ1NTCgkvLyAgICAgY2xhc3NlcyBvciBhIGZvbnQtc3BlYyBvYmplY3QsIGRlZmluaW5nIHRoZSB0ZXh0J3MgZm9udCBhbmQgc3R5bGUuCgkvLyBAcGFyYW0ge251bWJlcj19IGFuZ2xlIEFuZ2xlIGF0IHdoaWNoIHRvIHJvdGF0ZSB0aGUgdGV4dCwgaW4gZGVncmVlcy4KCS8vICAgICBBbmdsZSBpcyBjdXJyZW50bHkgdW51c2VkLCBpdCB3aWxsIGJlIGltcGxlbWVudGVkIGluIHRoZSBmdXR1cmUuCgkvLyBAcGFyYW0ge251bWJlcj19IHdpZHRoIE1heGltdW0gd2lkdGggb2YgdGhlIHRleHQgYmVmb3JlIGl0IHdyYXBzLgoJLy8gQHJldHVybiB7b2JqZWN0fSBhIHRleHQgaW5mbyBvYmplY3QuCgoJQ2FudmFzLnByb3RvdHlwZS5nZXRUZXh0SW5mbyA9IGZ1bmN0aW9uKGxheWVyLCB0ZXh0LCBmb250LCBhbmdsZSwgd2lkdGgpIHsKCgkJdmFyIHRleHRTdHlsZSwgbGF5ZXJDYWNoZSwgc3R5bGVDYWNoZSwgaW5mbzsKCgkJLy8gQ2FzdCB0aGUgdmFsdWUgdG8gYSBzdHJpbmcsIGluIGNhc2Ugd2Ugd2VyZSBnaXZlbiBhIG51bWJlciBvciBzdWNoCgoJCXRleHQgPSAiIiArIHRleHQ7CgoJCS8vIElmIHRoZSBmb250IGlzIGEgZm9udC1zcGVjIG9iamVjdCwgZ2VuZXJhdGUgYSBDU1MgZm9udCBkZWZpbml0aW9uCgoJCWlmICh0eXBlb2YgZm9udCA9PT0gIm9iamVjdCIpIHsKCQkJdGV4dFN0eWxlID0gZm9udC5zdHlsZSArICIgIiArIGZvbnQudmFyaWFudCArICIgIiArIGZvbnQud2VpZ2h0ICsgIiAiICsgZm9udC5zaXplICsgInB4LyIgKyBmb250LmxpbmVIZWlnaHQgKyAicHggIiArIGZvbnQuZmFtaWx5OwoJCX0gZWxzZSB7CgkJCXRleHRTdHlsZSA9IGZvbnQ7CgkJfQoKCQkvLyBSZXRyaWV2ZSAob3IgY3JlYXRlKSB0aGUgY2FjaGUgZm9yIHRoZSB0ZXh0J3MgbGF5ZXIgYW5kIHN0eWxlcwoKCQlsYXllckNhY2hlID0gdGhpcy5fdGV4dENhY2hlW2xheWVyXTsKCgkJaWYgKGxheWVyQ2FjaGUgPT0gbnVsbCkgewoJCQlsYXllckNhY2hlID0gdGhpcy5fdGV4dENhY2hlW2xheWVyXSA9IHt9OwoJCX0KCgkJc3R5bGVDYWNoZSA9IGxheWVyQ2FjaGVbdGV4dFN0eWxlXTsKCgkJaWYgKHN0eWxlQ2FjaGUgPT0gbnVsbCkgewoJCQlzdHlsZUNhY2hlID0gbGF5ZXJDYWNoZVt0ZXh0U3R5bGVdID0ge307CgkJfQoKCQlpbmZvID0gc3R5bGVDYWNoZVt0ZXh0XTsKCgkJLy8gSWYgd2UgY2FuJ3QgZmluZCBhIG1hdGNoaW5nIGVsZW1lbnQgaW4gb3VyIGNhY2hlLCBjcmVhdGUgYSBuZXcgb25lCgoJCWlmIChpbmZvID09IG51bGwpIHsKCgkJCXZhciBlbGVtZW50ID0gJCgiPGRpdj48L2Rpdj4iKS5odG1sKHRleHQpCgkJCQkuY3NzKHsKCQkJCQlwb3NpdGlvbjogImFic29sdXRlIiwKCQkJCQknbWF4LXdpZHRoJzogd2lkdGgsCgkJCQkJdG9wOiAtOTk5OQoJCQkJfSkKCQkJCS5hcHBlbmRUbyh0aGlzLmdldFRleHRMYXllcihsYXllcikpOwoKCQkJaWYgKHR5cGVvZiBmb250ID09PSAib2JqZWN0IikgewoJCQkJZWxlbWVudC5jc3MoewoJCQkJCWZvbnQ6IHRleHRTdHlsZSwKCQkJCQljb2xvcjogZm9udC5jb2xvcgoJCQkJfSk7CgkJCX0gZWxzZSBpZiAodHlwZW9mIGZvbnQgPT09ICJzdHJpbmciKSB7CgkJCQllbGVtZW50LmFkZENsYXNzKGZvbnQpOwoJCQl9CgoJCQlpbmZvID0gc3R5bGVDYWNoZVt0ZXh0XSA9IHsKCQkJCXdpZHRoOiBlbGVtZW50Lm91dGVyV2lkdGgodHJ1ZSksCgkJCQloZWlnaHQ6IGVsZW1lbnQub3V0ZXJIZWlnaHQodHJ1ZSksCgkJCQllbGVtZW50OiBlbGVtZW50LAoJCQkJcG9zaXRpb25zOiBbXQoJCQl9OwoKCQkJZWxlbWVudC5kZXRhY2goKTsKCQl9CgoJCXJldHVybiBpbmZvOwoJfTsKCgkvLyBBZGRzIGEgdGV4dCBzdHJpbmcgdG8gdGhlIGNhbnZhcyB0ZXh0IG92ZXJsYXkuCgkvLwoJLy8gVGhlIHRleHQgaXNuJ3QgZHJhd24gaW1tZWRpYXRlbHk7IGl0IGlzIG1hcmtlZCBhcyByZW5kZXJpbmcsIHdoaWNoIHdpbGwKCS8vIHJlc3VsdCBpbiBpdHMgYWRkaXRpb24gdG8gdGhlIGNhbnZhcyBvbiB0aGUgbmV4dCByZW5kZXIgcGFzcy4KCS8vCgkvLyBAcGFyYW0ge3N0cmluZ30gbGF5ZXIgQSBzdHJpbmcgb2Ygc3BhY2Utc2VwYXJhdGVkIENTUyBjbGFzc2VzIHVuaXF1ZWx5CgkvLyAgICAgaWRlbnRpZnlpbmcgdGhlIGxheWVyIGNvbnRhaW5pbmcgdGhpcyB0ZXh0LgoJLy8gQHBhcmFtIHtudW1iZXJ9IHggWCBjb29yZGluYXRlIGF0IHdoaWNoIHRvIGRyYXcgdGhlIHRleHQuCgkvLyBAcGFyYW0ge251bWJlcn0geSBZIGNvb3JkaW5hdGUgYXQgd2hpY2ggdG8gZHJhdyB0aGUgdGV4dC4KCS8vIEBwYXJhbSB7c3RyaW5nfSB0ZXh0IFRleHQgc3RyaW5nIHRvIGRyYXcuCgkvLyBAcGFyYW0geyhzdHJpbmd8b2JqZWN0KT19IGZvbnQgRWl0aGVyIGEgc3RyaW5nIG9mIHNwYWNlLXNlcGFyYXRlZCBDU1MKCS8vICAgICBjbGFzc2VzIG9yIGEgZm9udC1zcGVjIG9iamVjdCwgZGVmaW5pbmcgdGhlIHRleHQncyBmb250IGFuZCBzdHlsZS4KCS8vIEBwYXJhbSB7bnVtYmVyPX0gYW5nbGUgQW5nbGUgYXQgd2hpY2ggdG8gcm90YXRlIHRoZSB0ZXh0LCBpbiBkZWdyZWVzLgoJLy8gICAgIEFuZ2xlIGlzIGN1cnJlbnRseSB1bnVzZWQsIGl0IHdpbGwgYmUgaW1wbGVtZW50ZWQgaW4gdGhlIGZ1dHVyZS4KCS8vIEBwYXJhbSB7bnVtYmVyPX0gd2lkdGggTWF4aW11bSB3aWR0aCBvZiB0aGUgdGV4dCBiZWZvcmUgaXQgd3JhcHMuCgkvLyBAcGFyYW0ge3N0cmluZz19IGhhbGlnbiBIb3Jpem9udGFsIGFsaWdubWVudCBvZiB0aGUgdGV4dDsgZWl0aGVyICJsZWZ0IiwKCS8vICAgICAiY2VudGVyIiBvciAicmlnaHQiLgoJLy8gQHBhcmFtIHtzdHJpbmc9fSB2YWxpZ24gVmVydGljYWwgYWxpZ25tZW50IG9mIHRoZSB0ZXh0OyBlaXRoZXIgInRvcCIsCgkvLyAgICAgIm1pZGRsZSIgb3IgImJvdHRvbSIuCgoJQ2FudmFzLnByb3RvdHlwZS5hZGRUZXh0ID0gZnVuY3Rpb24obGF5ZXIsIHgsIHksIHRleHQsIGZvbnQsIGFuZ2xlLCB3aWR0aCwgaGFsaWduLCB2YWxpZ24pIHsKCgkJdmFyIGluZm8gPSB0aGlzLmdldFRleHRJbmZvKGxheWVyLCB0ZXh0LCBmb250LCBhbmdsZSwgd2lkdGgpLAoJCQlwb3NpdGlvbnMgPSBpbmZvLnBvc2l0aW9uczsKCgkJLy8gVHdlYWsgdGhlIGRpdidzIHBvc2l0aW9uIHRvIG1hdGNoIHRoZSB0ZXh0J3MgYWxpZ25tZW50CgoJCWlmIChoYWxpZ24gPT0gImNlbnRlciIpIHsKCQkJeCAtPSBpbmZvLndpZHRoIC8gMjsKCQl9IGVsc2UgaWYgKGhhbGlnbiA9PSAicmlnaHQiKSB7CgkJCXggLT0gaW5mby53aWR0aDsKCQl9CgoJCWlmICh2YWxpZ24gPT0gIm1pZGRsZSIpIHsKCQkJeSAtPSBpbmZvLmhlaWdodCAvIDI7CgkJfSBlbHNlIGlmICh2YWxpZ24gPT0gImJvdHRvbSIpIHsKCQkJeSAtPSBpbmZvLmhlaWdodDsKCQl9CgoJCS8vIERldGVybWluZSB3aGV0aGVyIHRoaXMgdGV4dCBhbHJlYWR5IGV4aXN0cyBhdCB0aGlzIHBvc2l0aW9uLgoJCS8vIElmIHNvLCBtYXJrIGl0IGZvciBpbmNsdXNpb24gaW4gdGhlIG5leHQgcmVuZGVyIHBhc3MuCgoJCWZvciAodmFyIGkgPSAwLCBwb3NpdGlvbjsgcG9zaXRpb24gPSBwb3NpdGlvbnNbaV07IGkrKykgewoJCQlpZiAocG9zaXRpb24ueCA9PSB4ICYmIHBvc2l0aW9uLnkgPT0geSkgewoJCQkJcG9zaXRpb24uYWN0aXZlID0gdHJ1ZTsKCQkJCXJldHVybjsKCQkJfQoJCX0KCgkJLy8gSWYgdGhlIHRleHQgZG9lc24ndCBleGlzdCBhdCB0aGlzIHBvc2l0aW9uLCBjcmVhdGUgYSBuZXcgZW50cnkKCgkJLy8gRm9yIHRoZSB2ZXJ5IGZpcnN0IHBvc2l0aW9uIHdlJ2xsIHJlLXVzZSB0aGUgb3JpZ2luYWwgZWxlbWVudCwKCQkvLyB3aGlsZSBmb3Igc3Vic2VxdWVudCBvbmVzIHdlJ2xsIGNsb25lIGl0LgoKCQlwb3NpdGlvbiA9IHsKCQkJYWN0aXZlOiB0cnVlLAoJCQlyZW5kZXJlZDogZmFsc2UsCgkJCWVsZW1lbnQ6IHBvc2l0aW9ucy5sZW5ndGggPyBpbmZvLmVsZW1lbnQuY2xvbmUoKSA6IGluZm8uZWxlbWVudCwKCQkJeDogeCwKCQkJeTogeQoJCX07CgoJCXBvc2l0aW9ucy5wdXNoKHBvc2l0aW9uKTsKCgkJLy8gTW92ZSB0aGUgZWxlbWVudCB0byBpdHMgZmluYWwgcG9zaXRpb24gd2l0aGluIHRoZSBjb250YWluZXIKCgkJcG9zaXRpb24uZWxlbWVudC5jc3MoewoJCQl0b3A6IE1hdGgucm91bmQoeSksCgkJCWxlZnQ6IE1hdGgucm91bmQoeCksCgkJCSd0ZXh0LWFsaWduJzogaGFsaWduCS8vIEluIGNhc2UgdGhlIHRleHQgd3JhcHMKCQl9KTsKCX07CgoJLy8gUmVtb3ZlcyBvbmUgb3IgbW9yZSB0ZXh0IHN0cmluZ3MgZnJvbSB0aGUgY2FudmFzIHRleHQgb3ZlcmxheS4KCS8vCgkvLyBJZiBubyBwYXJhbWV0ZXJzIGFyZSBnaXZlbiwgYWxsIHRleHQgd2l0aGluIHRoZSBsYXllciBpcyByZW1vdmVkLgoJLy8KCS8vIE5vdGUgdGhhdCB0aGUgdGV4dCBpcyBub3QgaW1tZWRpYXRlbHkgcmVtb3ZlZDsgaXQgaXMgc2ltcGx5IG1hcmtlZCBhcwoJLy8gaW5hY3RpdmUsIHdoaWNoIHdpbGwgcmVzdWx0IGluIGl0cyByZW1vdmFsIG9uIHRoZSBuZXh0IHJlbmRlciBwYXNzLgoJLy8gVGhpcyBhdm9pZHMgdGhlIHBlcmZvcm1hbmNlIHBlbmFsdHkgZm9yICdjbGVhciBhbmQgcmVkcmF3JyBiZWhhdmlvciwKCS8vIHdoZXJlIHdlIHBvdGVudGlhbGx5IGdldCByaWQgb2YgYWxsIHRleHQgb24gYSBsYXllciwgYnV0IHdpbGwgbGlrZWx5CgkvLyBhZGQgYmFjayBtb3N0IG9yIGFsbCBvZiBpdCBsYXRlciwgYXMgd2hlbiByZWRyYXdpbmcgYXhlcywgZm9yIGV4YW1wbGUuCgkvLwoJLy8gQHBhcmFtIHtzdHJpbmd9IGxheWVyIEEgc3RyaW5nIG9mIHNwYWNlLXNlcGFyYXRlZCBDU1MgY2xhc3NlcyB1bmlxdWVseQoJLy8gICAgIGlkZW50aWZ5aW5nIHRoZSBsYXllciBjb250YWluaW5nIHRoaXMgdGV4dC4KCS8vIEBwYXJhbSB7bnVtYmVyPX0geCBYIGNvb3JkaW5hdGUgb2YgdGhlIHRleHQuCgkvLyBAcGFyYW0ge251bWJlcj19IHkgWSBjb29yZGluYXRlIG9mIHRoZSB0ZXh0LgoJLy8gQHBhcmFtIHtzdHJpbmc9fSB0ZXh0IFRleHQgc3RyaW5nIHRvIHJlbW92ZS4KCS8vIEBwYXJhbSB7KHN0cmluZ3xvYmplY3QpPX0gZm9udCBFaXRoZXIgYSBzdHJpbmcgb2Ygc3BhY2Utc2VwYXJhdGVkIENTUwoJLy8gICAgIGNsYXNzZXMgb3IgYSBmb250LXNwZWMgb2JqZWN0LCBkZWZpbmluZyB0aGUgdGV4dCdzIGZvbnQgYW5kIHN0eWxlLgoJLy8gQHBhcmFtIHtudW1iZXI9fSBhbmdsZSBBbmdsZSBhdCB3aGljaCB0aGUgdGV4dCBpcyByb3RhdGVkLCBpbiBkZWdyZWVzLgoJLy8gICAgIEFuZ2xlIGlzIGN1cnJlbnRseSB1bnVzZWQsIGl0IHdpbGwgYmUgaW1wbGVtZW50ZWQgaW4gdGhlIGZ1dHVyZS4KCglDYW52YXMucHJvdG90eXBlLnJlbW92ZVRleHQgPSBmdW5jdGlvbihsYXllciwgeCwgeSwgdGV4dCwgZm9udCwgYW5nbGUpIHsKCQlpZiAodGV4dCA9PSBudWxsKSB7CgkJCXZhciBsYXllckNhY2hlID0gdGhpcy5fdGV4dENhY2hlW2xheWVyXTsKCQkJaWYgKGxheWVyQ2FjaGUgIT0gbnVsbCkgewoJCQkJZm9yICh2YXIgc3R5bGVLZXkgaW4gbGF5ZXJDYWNoZSkgewoJCQkJCWlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKGxheWVyQ2FjaGUsIHN0eWxlS2V5KSkgewoJCQkJCQl2YXIgc3R5bGVDYWNoZSA9IGxheWVyQ2FjaGVbc3R5bGVLZXldOwoJCQkJCQlmb3IgKHZhciBrZXkgaW4gc3R5bGVDYWNoZSkgewoJCQkJCQkJaWYgKGhhc093blByb3BlcnR5LmNhbGwoc3R5bGVDYWNoZSwga2V5KSkgewoJCQkJCQkJCXZhciBwb3NpdGlvbnMgPSBzdHlsZUNhY2hlW2tleV0ucG9zaXRpb25zOwoJCQkJCQkJCWZvciAodmFyIGkgPSAwLCBwb3NpdGlvbjsgcG9zaXRpb24gPSBwb3NpdGlvbnNbaV07IGkrKykgewoJCQkJCQkJCQlwb3NpdGlvbi5hY3RpdmUgPSBmYWxzZTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQl9IGVsc2UgewoJCQl2YXIgcG9zaXRpb25zID0gdGhpcy5nZXRUZXh0SW5mbyhsYXllciwgdGV4dCwgZm9udCwgYW5nbGUpLnBvc2l0aW9uczsKCQkJZm9yICh2YXIgaSA9IDAsIHBvc2l0aW9uOyBwb3NpdGlvbiA9IHBvc2l0aW9uc1tpXTsgaSsrKSB7CgkJCQlpZiAocG9zaXRpb24ueCA9PSB4ICYmIHBvc2l0aW9uLnkgPT0geSkgewoJCQkJCXBvc2l0aW9uLmFjdGl2ZSA9IGZhbHNlOwoJCQkJfQoJCQl9CgkJfQoJfTsKCgkvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCS8vIFRoZSB0b3AtbGV2ZWwgY29udGFpbmVyIGZvciB0aGUgZW50aXJlIHBsb3QuCgogICAgZnVuY3Rpb24gUGxvdChwbGFjZWhvbGRlciwgZGF0YV8sIG9wdGlvbnNfLCBwbHVnaW5zKSB7CiAgICAgICAgLy8gZGF0YSBpcyBvbiB0aGUgZm9ybToKICAgICAgICAvLyAgIFsgc2VyaWVzMSwgc2VyaWVzMiAuLi4gXQogICAgICAgIC8vIHdoZXJlIHNlcmllcyBpcyBlaXRoZXIganVzdCB0aGUgZGF0YSBhcyBbIFt4MSwgeTFdLCBbeDIsIHkyXSwgLi4uIF0KICAgICAgICAvLyBvciB7IGRhdGE6IFsgW3gxLCB5MV0sIFt4MiwgeTJdLCAuLi4gXSwgbGFiZWw6ICJzb21lIGxhYmVsIiwgLi4uIH0KCiAgICAgICAgdmFyIHNlcmllcyA9IFtdLAogICAgICAgICAgICBvcHRpb25zID0gewogICAgICAgICAgICAgICAgLy8gdGhlIGNvbG9yIHRoZW1lIHVzZWQgZm9yIGdyYXBocwogICAgICAgICAgICAgICAgY29sb3JzOiBbIiNlZGMyNDAiLCAiI2FmZDhmOCIsICIjY2I0YjRiIiwgIiM0ZGE3NGQiLCAiIzk0NDBlZCJdLAogICAgICAgICAgICAgICAgbGVnZW5kOiB7CiAgICAgICAgICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBub0NvbHVtbnM6IDEsIC8vIG51bWJlciBvZiBjb2x1bXMgaW4gbGVnZW5kIHRhYmxlCiAgICAgICAgICAgICAgICAgICAgbGFiZWxGb3JtYXR0ZXI6IG51bGwsIC8vIGZuOiBzdHJpbmcgLT4gc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgbGFiZWxCb3hCb3JkZXJDb2xvcjogIiNjY2MiLCAvLyBib3JkZXIgY29sb3IgZm9yIHRoZSBsaXR0bGUgbGFiZWwgYm94ZXMKICAgICAgICAgICAgICAgICAgICBjb250YWluZXI6IG51bGwsIC8vIGNvbnRhaW5lciAoYXMgalF1ZXJ5IG9iamVjdCkgdG8gcHV0IGxlZ2VuZCBpbiwgbnVsbCBtZWFucyBkZWZhdWx0IG9uIHRvcCBvZiBncmFwaAogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAibmUiLCAvLyBwb3NpdGlvbiBvZiBkZWZhdWx0IGxlZ2VuZCBjb250YWluZXIgd2l0aGluIHBsb3QKICAgICAgICAgICAgICAgICAgICBtYXJnaW46IDUsIC8vIGRpc3RhbmNlIGZyb20gZ3JpZCBlZGdlIHRvIGRlZmF1bHQgbGVnZW5kIGNvbnRhaW5lciB3aXRoaW4gcGxvdAogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogbnVsbCwgLy8gbnVsbCBtZWFucyBhdXRvLWRldGVjdAogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRPcGFjaXR5OiAwLjg1LCAvLyBzZXQgdG8gMCB0byBhdm9pZCBiYWNrZ3JvdW5kCiAgICAgICAgICAgICAgICAgICAgc29ydGVkOiBudWxsICAgIC8vIGRlZmF1bHQgdG8gbm8gbGVnZW5kIHNvcnRpbmcKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB4YXhpczogewogICAgICAgICAgICAgICAgICAgIHNob3c6IG51bGwsIC8vIG51bGwgPSBhdXRvLWRldGVjdCwgdHJ1ZSA9IGFsd2F5cywgZmFsc2UgPSBuZXZlcgogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAiYm90dG9tIiwgLy8gb3IgInRvcCIKICAgICAgICAgICAgICAgICAgICBtb2RlOiBudWxsLCAvLyBudWxsIG9yICJ0aW1lIgogICAgICAgICAgICAgICAgICAgIGZvbnQ6IG51bGwsIC8vIG51bGwgKGRlcml2ZWQgZnJvbSBDU1MgaW4gcGxhY2Vob2xkZXIpIG9yIG9iamVjdCBsaWtlIHsgc2l6ZTogMTEsIGxpbmVIZWlnaHQ6IDEzLCBzdHlsZTogIml0YWxpYyIsIHdlaWdodDogImJvbGQiLCBmYW1pbHk6ICJzYW5zLXNlcmlmIiwgdmFyaWFudDogInNtYWxsLWNhcHMiIH0KICAgICAgICAgICAgICAgICAgICBjb2xvcjogbnVsbCwgLy8gYmFzZSBjb2xvciwgbGFiZWxzLCB0aWNrcwogICAgICAgICAgICAgICAgICAgIHRpY2tDb2xvcjogbnVsbCwgLy8gcG9zc2libHkgZGlmZmVyZW50IGNvbG9yIG9mIHRpY2tzLCBlLmcuICJyZ2JhKDAsMCwwLDAuMTUpIgogICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogbnVsbCwgLy8gbnVsbCBvciBmOiBudW1iZXIgLT4gbnVtYmVyIHRvIHRyYW5zZm9ybSBheGlzCiAgICAgICAgICAgICAgICAgICAgaW52ZXJzZVRyYW5zZm9ybTogbnVsbCwgLy8gaWYgdHJhbnNmb3JtIGlzIHNldCwgdGhpcyBzaG91bGQgYmUgdGhlIGludmVyc2UgZnVuY3Rpb24KICAgICAgICAgICAgICAgICAgICBtaW46IG51bGwsIC8vIG1pbi4gdmFsdWUgdG8gc2hvdywgbnVsbCBtZWFucyBzZXQgYXV0b21hdGljYWxseQogICAgICAgICAgICAgICAgICAgIG1heDogbnVsbCwgLy8gbWF4LiB2YWx1ZSB0byBzaG93LCBudWxsIG1lYW5zIHNldCBhdXRvbWF0aWNhbGx5CiAgICAgICAgICAgICAgICAgICAgYXV0b3NjYWxlTWFyZ2luOiBudWxsLCAvLyBtYXJnaW4gaW4gJSB0byBhZGQgaWYgYXV0by1zZXR0aW5nIG1pbi9tYXgKICAgICAgICAgICAgICAgICAgICB0aWNrczogbnVsbCwgLy8gZWl0aGVyIFsxLCAzXSBvciBbWzEsICJhIl0sIDNdIG9yIChmbjogYXhpcyBpbmZvIC0+IHRpY2tzKSBvciBhcHAuIG51bWJlciBvZiB0aWNrcyBmb3IgYXV0by10aWNrcwogICAgICAgICAgICAgICAgICAgIHRpY2tGb3JtYXR0ZXI6IG51bGwsIC8vIGZuOiBudW1iZXIgLT4gc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgbGFiZWxXaWR0aDogbnVsbCwgLy8gc2l6ZSBvZiB0aWNrIGxhYmVscyBpbiBwaXhlbHMKICAgICAgICAgICAgICAgICAgICBsYWJlbEhlaWdodDogbnVsbCwKICAgICAgICAgICAgICAgICAgICByZXNlcnZlU3BhY2U6IG51bGwsIC8vIHdoZXRoZXIgdG8gcmVzZXJ2ZSBzcGFjZSBldmVuIGlmIGF4aXMgaXNuJ3Qgc2hvd24KICAgICAgICAgICAgICAgICAgICB0aWNrTGVuZ3RoOiBudWxsLCAvLyBzaXplIGluIHBpeGVscyBvZiB0aWNrcywgb3IgImZ1bGwiIGZvciB3aG9sZSBsaW5lCiAgICAgICAgICAgICAgICAgICAgYWxpZ25UaWNrc1dpdGhBeGlzOiBudWxsLCAvLyBheGlzIG51bWJlciBvciBudWxsIGZvciBubyBzeW5jCiAgICAgICAgICAgICAgICAgICAgdGlja0RlY2ltYWxzOiBudWxsLCAvLyBuby4gb2YgZGVjaW1hbHMsIG51bGwgbWVhbnMgYXV0bwogICAgICAgICAgICAgICAgICAgIHRpY2tTaXplOiBudWxsLCAvLyBudW1iZXIgb3IgW251bWJlciwgInVuaXQiXQogICAgICAgICAgICAgICAgICAgIG1pblRpY2tTaXplOiBudWxsIC8vIG51bWJlciBvciBbbnVtYmVyLCAidW5pdCJdCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgeWF4aXM6IHsKICAgICAgICAgICAgICAgICAgICBhdXRvc2NhbGVNYXJnaW46IDAuMDIsCiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJsZWZ0IiAvLyBvciAicmlnaHQiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgeGF4ZXM6IFtdLAogICAgICAgICAgICAgICAgeWF4ZXM6IFtdLAogICAgICAgICAgICAgICAgc2VyaWVzOiB7CiAgICAgICAgICAgICAgICAgICAgcG9pbnRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNob3c6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICByYWRpdXM6IDMsCiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVXaWR0aDogMiwgLy8gaW4gcGl4ZWxzCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGw6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxDb2xvcjogIiNmZmZmZmYiLAogICAgICAgICAgICAgICAgICAgICAgICBzeW1ib2w6ICJjaXJjbGUiIC8vIG9yIGNhbGxiYWNrCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBsaW5lczogewogICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSBkb24ndCBwdXQgaW4gc2hvdzogZmFsc2Ugc28gd2UgY2FuIHNlZQogICAgICAgICAgICAgICAgICAgICAgICAvLyB3aGV0aGVyIGxpbmVzIHdlcmUgYWN0aXZlbHkgZGlzYWJsZWQKICAgICAgICAgICAgICAgICAgICAgICAgbGluZVdpZHRoOiAyLCAvLyBpbiBwaXhlbHMKICAgICAgICAgICAgICAgICAgICAgICAgZmlsbDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxDb2xvcjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgc3RlcHM6IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE9taXQgJ3plcm8nLCBzbyB3ZSBjYW4gbGF0ZXIgZGVmYXVsdCBpdHMgdmFsdWUgdG8KICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWF0Y2ggdGhhdCBvZiB0aGUgJ2ZpbGwnIG9wdGlvbi4KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGJhcnM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2hvdzogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVXaWR0aDogMiwgLy8gaW4gcGl4ZWxzCiAgICAgICAgICAgICAgICAgICAgICAgIGJhcldpZHRoOiAxLCAvLyBpbiB1bml0cyBvZiB0aGUgeCBheGlzCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGw6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxDb2xvcjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgYWxpZ246ICJsZWZ0IiwgLy8gImxlZnQiLCAicmlnaHQiLCBvciAiY2VudGVyIgogICAgICAgICAgICAgICAgICAgICAgICBob3Jpem9udGFsOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgemVybzogdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2hhZG93U2l6ZTogMywKICAgICAgICAgICAgICAgICAgICBoaWdobGlnaHRDb2xvcjogbnVsbAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGdyaWQ6IHsKICAgICAgICAgICAgICAgICAgICBzaG93OiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGFib3ZlRGF0YTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgY29sb3I6ICIjNTQ1NDU0IiwgLy8gcHJpbWFyeSBjb2xvciB1c2VkIGZvciBvdXRsaW5lIGFuZCBsYWJlbHMKICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IG51bGwsIC8vIG51bGwgZm9yIHRyYW5zcGFyZW50LCBlbHNlIGNvbG9yCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IG51bGwsIC8vIHNldCBpZiBkaWZmZXJlbnQgZnJvbSB0aGUgZ3JpZCBjb2xvcgogICAgICAgICAgICAgICAgICAgIHRpY2tDb2xvcjogbnVsbCwgLy8gY29sb3IgZm9yIHRoZSB0aWNrcywgZS5nLiAicmdiYSgwLDAsMCwwLjE1KSIKICAgICAgICAgICAgICAgICAgICBtYXJnaW46IDAsIC8vIGRpc3RhbmNlIGZyb20gdGhlIGNhbnZhcyBlZGdlIHRvIHRoZSBncmlkCiAgICAgICAgICAgICAgICAgICAgbGFiZWxNYXJnaW46IDUsIC8vIGluIHBpeGVscwogICAgICAgICAgICAgICAgICAgIGF4aXNNYXJnaW46IDgsIC8vIGluIHBpeGVscwogICAgICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoOiAyLCAvLyBpbiBwaXhlbHMKICAgICAgICAgICAgICAgICAgICBtaW5Cb3JkZXJNYXJnaW46IG51bGwsIC8vIGluIHBpeGVscywgbnVsbCBtZWFucyB0YWtlbiBmcm9tIHBvaW50cyByYWRpdXMKICAgICAgICAgICAgICAgICAgICBtYXJraW5nczogbnVsbCwgLy8gYXJyYXkgb2YgcmFuZ2VzIG9yIGZuOiBheGVzIC0+IGFycmF5IG9mIHJhbmdlcwogICAgICAgICAgICAgICAgICAgIG1hcmtpbmdzQ29sb3I6ICIjZjRmNGY0IiwKICAgICAgICAgICAgICAgICAgICBtYXJraW5nc0xpbmVXaWR0aDogMiwKICAgICAgICAgICAgICAgICAgICAvLyBpbnRlcmFjdGl2ZSBzdHVmZgogICAgICAgICAgICAgICAgICAgIGNsaWNrYWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgaG92ZXJhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBhdXRvSGlnaGxpZ2h0OiB0cnVlLCAvLyBoaWdobGlnaHQgaW4gY2FzZSBtb3VzZSBpcyBuZWFyCiAgICAgICAgICAgICAgICAgICAgbW91c2VBY3RpdmVSYWRpdXM6IDEwIC8vIGhvdyBmYXIgdGhlIG1vdXNlIGNhbiBiZSBhd2F5IHRvIGFjdGl2YXRlIGFuIGl0ZW0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBpbnRlcmFjdGlvbjogewogICAgICAgICAgICAgICAgICAgIHJlZHJhd092ZXJsYXlJbnRlcnZhbDogMTAwMC82MCAvLyB0aW1lIGJldHdlZW4gdXBkYXRlcywgLTEgbWVhbnMgaW4gc2FtZSBmbG93CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgaG9va3M6IHt9CiAgICAgICAgICAgIH0sCiAgICAgICAgc3VyZmFjZSA9IG51bGwsICAgICAvLyB0aGUgY2FudmFzIGZvciB0aGUgcGxvdCBpdHNlbGYKICAgICAgICBvdmVybGF5ID0gbnVsbCwgICAgIC8vIGNhbnZhcyBmb3IgaW50ZXJhY3RpdmUgc3R1ZmYgb24gdG9wIG9mIHBsb3QKICAgICAgICBldmVudEhvbGRlciA9IG51bGwsIC8vIGpRdWVyeSBvYmplY3QgdGhhdCBldmVudHMgc2hvdWxkIGJlIGJvdW5kIHRvCiAgICAgICAgY3R4ID0gbnVsbCwgb2N0eCA9IG51bGwsCiAgICAgICAgeGF4ZXMgPSBbXSwgeWF4ZXMgPSBbXSwKICAgICAgICBwbG90T2Zmc2V0ID0geyBsZWZ0OiAwLCByaWdodDogMCwgdG9wOiAwLCBib3R0b206IDB9LAogICAgICAgIHBsb3RXaWR0aCA9IDAsIHBsb3RIZWlnaHQgPSAwLAogICAgICAgIGhvb2tzID0gewogICAgICAgICAgICBwcm9jZXNzT3B0aW9uczogW10sCiAgICAgICAgICAgIHByb2Nlc3NSYXdEYXRhOiBbXSwKICAgICAgICAgICAgcHJvY2Vzc0RhdGFwb2ludHM6IFtdLAogICAgICAgICAgICBwcm9jZXNzT2Zmc2V0OiBbXSwKICAgICAgICAgICAgZHJhd0JhY2tncm91bmQ6IFtdLAogICAgICAgICAgICBkcmF3U2VyaWVzOiBbXSwKICAgICAgICAgICAgZHJhdzogW10sCiAgICAgICAgICAgIGJpbmRFdmVudHM6IFtdLAogICAgICAgICAgICBkcmF3T3ZlcmxheTogW10sCiAgICAgICAgICAgIHNodXRkb3duOiBbXQogICAgICAgIH0sCiAgICAgICAgcGxvdCA9IHRoaXM7CgogICAgICAgIC8vIHB1YmxpYyBmdW5jdGlvbnMKICAgICAgICBwbG90LnNldERhdGEgPSBzZXREYXRhOwogICAgICAgIHBsb3Quc2V0dXBHcmlkID0gc2V0dXBHcmlkOwogICAgICAgIHBsb3QuZHJhdyA9IGRyYXc7CiAgICAgICAgcGxvdC5nZXRQbGFjZWhvbGRlciA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gcGxhY2Vob2xkZXI7IH07CiAgICAgICAgcGxvdC5nZXRDYW52YXMgPSBmdW5jdGlvbigpIHsgcmV0dXJuIHN1cmZhY2UuZWxlbWVudDsgfTsKICAgICAgICBwbG90LmdldFBsb3RPZmZzZXQgPSBmdW5jdGlvbigpIHsgcmV0dXJuIHBsb3RPZmZzZXQ7IH07CiAgICAgICAgcGxvdC53aWR0aCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHBsb3RXaWR0aDsgfTsKICAgICAgICBwbG90LmhlaWdodCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHBsb3RIZWlnaHQ7IH07CiAgICAgICAgcGxvdC5vZmZzZXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBvID0gZXZlbnRIb2xkZXIub2Zmc2V0KCk7CiAgICAgICAgICAgIG8ubGVmdCArPSBwbG90T2Zmc2V0LmxlZnQ7CiAgICAgICAgICAgIG8udG9wICs9IHBsb3RPZmZzZXQudG9wOwogICAgICAgICAgICByZXR1cm4gbzsKICAgICAgICB9OwogICAgICAgIHBsb3QuZ2V0RGF0YSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHNlcmllczsgfTsKICAgICAgICBwbG90LmdldEF4ZXMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciByZXMgPSB7fSwgaTsKICAgICAgICAgICAgJC5lYWNoKHhheGVzLmNvbmNhdCh5YXhlcyksIGZ1bmN0aW9uIChfLCBheGlzKSB7CiAgICAgICAgICAgICAgICBpZiAoYXhpcykKICAgICAgICAgICAgICAgICAgICByZXNbYXhpcy5kaXJlY3Rpb24gKyAoYXhpcy5uICE9IDEgPyBheGlzLm4gOiAiIikgKyAiYXhpcyJdID0gYXhpczsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgfTsKICAgICAgICBwbG90LmdldFhBeGVzID0gZnVuY3Rpb24gKCkgeyByZXR1cm4geGF4ZXM7IH07CiAgICAgICAgcGxvdC5nZXRZQXhlcyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHlheGVzOyB9OwogICAgICAgIHBsb3QuYzJwID0gY2FudmFzVG9BeGlzQ29vcmRzOwogICAgICAgIHBsb3QucDJjID0gYXhpc1RvQ2FudmFzQ29vcmRzOwogICAgICAgIHBsb3QuZ2V0T3B0aW9ucyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG9wdGlvbnM7IH07CiAgICAgICAgcGxvdC5oaWdobGlnaHQgPSBoaWdobGlnaHQ7CiAgICAgICAgcGxvdC51bmhpZ2hsaWdodCA9IHVuaGlnaGxpZ2h0OwogICAgICAgIHBsb3QudHJpZ2dlclJlZHJhd092ZXJsYXkgPSB0cmlnZ2VyUmVkcmF3T3ZlcmxheTsKICAgICAgICBwbG90LnBvaW50T2Zmc2V0ID0gZnVuY3Rpb24ocG9pbnQpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGxlZnQ6IHBhcnNlSW50KHhheGVzW2F4aXNOdW1iZXIocG9pbnQsICJ4IikgLSAxXS5wMmMoK3BvaW50LngpICsgcGxvdE9mZnNldC5sZWZ0LCAxMCksCiAgICAgICAgICAgICAgICB0b3A6IHBhcnNlSW50KHlheGVzW2F4aXNOdW1iZXIocG9pbnQsICJ5IikgLSAxXS5wMmMoK3BvaW50LnkpICsgcGxvdE9mZnNldC50b3AsIDEwKQogICAgICAgICAgICB9OwogICAgICAgIH07CiAgICAgICAgcGxvdC5zaHV0ZG93biA9IHNodXRkb3duOwogICAgICAgIHBsb3QuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgc2h1dGRvd24oKTsKICAgICAgICAgICAgcGxhY2Vob2xkZXIucmVtb3ZlRGF0YSgicGxvdCIpLmVtcHR5KCk7CgogICAgICAgICAgICBzZXJpZXMgPSBbXTsKICAgICAgICAgICAgb3B0aW9ucyA9IG51bGw7CiAgICAgICAgICAgIHN1cmZhY2UgPSBudWxsOwogICAgICAgICAgICBvdmVybGF5ID0gbnVsbDsKICAgICAgICAgICAgZXZlbnRIb2xkZXIgPSBudWxsOwogICAgICAgICAgICBjdHggPSBudWxsOwogICAgICAgICAgICBvY3R4ID0gbnVsbDsKICAgICAgICAgICAgeGF4ZXMgPSBbXTsKICAgICAgICAgICAgeWF4ZXMgPSBbXTsKICAgICAgICAgICAgaG9va3MgPSBudWxsOwogICAgICAgICAgICBoaWdobGlnaHRzID0gW107CiAgICAgICAgICAgIHBsb3QgPSBudWxsOwogICAgICAgIH07CiAgICAgICAgcGxvdC5yZXNpemUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgCXZhciB3aWR0aCA9IHBsYWNlaG9sZGVyLndpZHRoKCksCiAgICAgICAgCQloZWlnaHQgPSBwbGFjZWhvbGRlci5oZWlnaHQoKTsKICAgICAgICAgICAgc3VyZmFjZS5yZXNpemUod2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIG92ZXJsYXkucmVzaXplKHdpZHRoLCBoZWlnaHQpOwogICAgICAgIH07CgogICAgICAgIC8vIHB1YmxpYyBhdHRyaWJ1dGVzCiAgICAgICAgcGxvdC5ob29rcyA9IGhvb2tzOwoKICAgICAgICAvLyBpbml0aWFsaXplCiAgICAgICAgaW5pdFBsdWdpbnMocGxvdCk7CiAgICAgICAgcGFyc2VPcHRpb25zKG9wdGlvbnNfKTsKICAgICAgICBzZXR1cENhbnZhc2VzKCk7CiAgICAgICAgc2V0RGF0YShkYXRhXyk7CiAgICAgICAgc2V0dXBHcmlkKCk7CiAgICAgICAgZHJhdygpOwogICAgICAgIGJpbmRFdmVudHMoKTsKCgogICAgICAgIGZ1bmN0aW9uIGV4ZWN1dGVIb29rcyhob29rLCBhcmdzKSB7CiAgICAgICAgICAgIGFyZ3MgPSBbcGxvdF0uY29uY2F0KGFyZ3MpOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhvb2subGVuZ3RoOyArK2kpCiAgICAgICAgICAgICAgICBob29rW2ldLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gaW5pdFBsdWdpbnMoKSB7CgogICAgICAgICAgICAvLyBSZWZlcmVuY2VzIHRvIGtleSBjbGFzc2VzLCBhbGxvd2luZyBwbHVnaW5zIHRvIG1vZGlmeSB0aGVtCgogICAgICAgICAgICB2YXIgY2xhc3NlcyA9IHsKICAgICAgICAgICAgICAgIENhbnZhczogQ2FudmFzCiAgICAgICAgICAgIH07CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBsdWdpbnMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICAgIHZhciBwID0gcGx1Z2luc1tpXTsKICAgICAgICAgICAgICAgIHAuaW5pdChwbG90LCBjbGFzc2VzKTsKICAgICAgICAgICAgICAgIGlmIChwLm9wdGlvbnMpCiAgICAgICAgICAgICAgICAgICAgJC5leHRlbmQodHJ1ZSwgb3B0aW9ucywgcC5vcHRpb25zKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcGFyc2VPcHRpb25zKG9wdHMpIHsKCiAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIG9wdGlvbnMsIG9wdHMpOwoKICAgICAgICAgICAgLy8gJC5leHRlbmQgbWVyZ2VzIGFycmF5cywgcmF0aGVyIHRoYW4gcmVwbGFjaW5nIHRoZW0uICBXaGVuIGxlc3MKICAgICAgICAgICAgLy8gY29sb3JzIGFyZSBwcm92aWRlZCB0aGFuIHRoZSBzaXplIG9mIHRoZSBkZWZhdWx0IHBhbGV0dGUsIHdlCiAgICAgICAgICAgIC8vIGVuZCB1cCB3aXRoIHRob3NlIGNvbG9ycyBwbHVzIHRoZSByZW1haW5pbmcgZGVmYXVsdHMsIHdoaWNoIGlzCiAgICAgICAgICAgIC8vIG5vdCBleHBlY3RlZCBiZWhhdmlvcjsgYXZvaWQgaXQgYnkgcmVwbGFjaW5nIHRoZW0gaGVyZS4KCiAgICAgICAgICAgIGlmIChvcHRzICYmIG9wdHMuY29sb3JzKSB7CiAgICAgICAgICAgIAlvcHRpb25zLmNvbG9ycyA9IG9wdHMuY29sb3JzOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAob3B0aW9ucy54YXhpcy5jb2xvciA9PSBudWxsKQogICAgICAgICAgICAgICAgb3B0aW9ucy54YXhpcy5jb2xvciA9ICQuY29sb3IucGFyc2Uob3B0aW9ucy5ncmlkLmNvbG9yKS5zY2FsZSgnYScsIDAuMjIpLnRvU3RyaW5nKCk7CiAgICAgICAgICAgIGlmIChvcHRpb25zLnlheGlzLmNvbG9yID09IG51bGwpCiAgICAgICAgICAgICAgICBvcHRpb25zLnlheGlzLmNvbG9yID0gJC5jb2xvci5wYXJzZShvcHRpb25zLmdyaWQuY29sb3IpLnNjYWxlKCdhJywgMC4yMikudG9TdHJpbmcoKTsKCiAgICAgICAgICAgIGlmIChvcHRpb25zLnhheGlzLnRpY2tDb2xvciA9PSBudWxsKSAvLyBncmlkLnRpY2tDb2xvciBmb3IgYmFjay1jb21wYXRpYmlsaXR5CiAgICAgICAgICAgICAgICBvcHRpb25zLnhheGlzLnRpY2tDb2xvciA9IG9wdGlvbnMuZ3JpZC50aWNrQ29sb3IgfHwgb3B0aW9ucy54YXhpcy5jb2xvcjsKICAgICAgICAgICAgaWYgKG9wdGlvbnMueWF4aXMudGlja0NvbG9yID09IG51bGwpIC8vIGdyaWQudGlja0NvbG9yIGZvciBiYWNrLWNvbXBhdGliaWxpdHkKICAgICAgICAgICAgICAgIG9wdGlvbnMueWF4aXMudGlja0NvbG9yID0gb3B0aW9ucy5ncmlkLnRpY2tDb2xvciB8fCBvcHRpb25zLnlheGlzLmNvbG9yOwoKICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ3JpZC5ib3JkZXJDb2xvciA9PSBudWxsKQogICAgICAgICAgICAgICAgb3B0aW9ucy5ncmlkLmJvcmRlckNvbG9yID0gb3B0aW9ucy5ncmlkLmNvbG9yOwogICAgICAgICAgICBpZiAob3B0aW9ucy5ncmlkLnRpY2tDb2xvciA9PSBudWxsKQogICAgICAgICAgICAgICAgb3B0aW9ucy5ncmlkLnRpY2tDb2xvciA9ICQuY29sb3IucGFyc2Uob3B0aW9ucy5ncmlkLmNvbG9yKS5zY2FsZSgnYScsIDAuMjIpLnRvU3RyaW5nKCk7CgogICAgICAgICAgICAvLyBGaWxsIGluIGRlZmF1bHRzIGZvciBheGlzIG9wdGlvbnMsIGluY2x1ZGluZyBhbnkgdW5zcGVjaWZpZWQKICAgICAgICAgICAgLy8gZm9udC1zcGVjIGZpZWxkcywgaWYgYSBmb250LXNwZWMgd2FzIHByb3ZpZGVkLgoKICAgICAgICAgICAgLy8gSWYgbm8geC95IGF4aXMgb3B0aW9ucyB3ZXJlIHByb3ZpZGVkLCBjcmVhdGUgb25lIG9mIGVhY2ggYW55d2F5LAogICAgICAgICAgICAvLyBzaW5jZSB0aGUgcmVzdCBvZiB0aGUgY29kZSBhc3N1bWVzIHRoYXQgdGhleSBleGlzdC4KCiAgICAgICAgICAgIHZhciBpLCBheGlzT3B0aW9ucywgYXhpc0NvdW50LAogICAgICAgICAgICAgICAgZm9udFNpemUgPSBwbGFjZWhvbGRlci5jc3MoImZvbnQtc2l6ZSIpLAogICAgICAgICAgICAgICAgZm9udFNpemVEZWZhdWx0ID0gZm9udFNpemUgPyArZm9udFNpemUucmVwbGFjZSgicHgiLCAiIikgOiAxMywKICAgICAgICAgICAgICAgIGZvbnREZWZhdWx0cyA9IHsKICAgICAgICAgICAgICAgICAgICBzdHlsZTogcGxhY2Vob2xkZXIuY3NzKCJmb250LXN0eWxlIiksCiAgICAgICAgICAgICAgICAgICAgc2l6ZTogTWF0aC5yb3VuZCgwLjggKiBmb250U2l6ZURlZmF1bHQpLAogICAgICAgICAgICAgICAgICAgIHZhcmlhbnQ6IHBsYWNlaG9sZGVyLmNzcygiZm9udC12YXJpYW50IiksCiAgICAgICAgICAgICAgICAgICAgd2VpZ2h0OiBwbGFjZWhvbGRlci5jc3MoImZvbnQtd2VpZ2h0IiksCiAgICAgICAgICAgICAgICAgICAgZmFtaWx5OiBwbGFjZWhvbGRlci5jc3MoImZvbnQtZmFtaWx5IikKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICBheGlzQ291bnQgPSBvcHRpb25zLnhheGVzLmxlbmd0aCB8fCAxOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYXhpc0NvdW50OyArK2kpIHsKCiAgICAgICAgICAgICAgICBheGlzT3B0aW9ucyA9IG9wdGlvbnMueGF4ZXNbaV07CiAgICAgICAgICAgICAgICBpZiAoYXhpc09wdGlvbnMgJiYgIWF4aXNPcHRpb25zLnRpY2tDb2xvcikgewogICAgICAgICAgICAgICAgICAgIGF4aXNPcHRpb25zLnRpY2tDb2xvciA9IGF4aXNPcHRpb25zLmNvbG9yOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGF4aXNPcHRpb25zID0gJC5leHRlbmQodHJ1ZSwge30sIG9wdGlvbnMueGF4aXMsIGF4aXNPcHRpb25zKTsKICAgICAgICAgICAgICAgIG9wdGlvbnMueGF4ZXNbaV0gPSBheGlzT3B0aW9uczsKCiAgICAgICAgICAgICAgICBpZiAoYXhpc09wdGlvbnMuZm9udCkgewogICAgICAgICAgICAgICAgICAgIGF4aXNPcHRpb25zLmZvbnQgPSAkLmV4dGVuZCh7fSwgZm9udERlZmF1bHRzLCBheGlzT3B0aW9ucy5mb250KTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWF4aXNPcHRpb25zLmZvbnQuY29sb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXhpc09wdGlvbnMuZm9udC5jb2xvciA9IGF4aXNPcHRpb25zLmNvbG9yOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoIWF4aXNPcHRpb25zLmZvbnQubGluZUhlaWdodCkgewogICAgICAgICAgICAgICAgICAgICAgICBheGlzT3B0aW9ucy5mb250LmxpbmVIZWlnaHQgPSBNYXRoLnJvdW5kKGF4aXNPcHRpb25zLmZvbnQuc2l6ZSAqIDEuMTUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgYXhpc0NvdW50ID0gb3B0aW9ucy55YXhlcy5sZW5ndGggfHwgMTsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGF4aXNDb3VudDsgKytpKSB7CgogICAgICAgICAgICAgICAgYXhpc09wdGlvbnMgPSBvcHRpb25zLnlheGVzW2ldOwogICAgICAgICAgICAgICAgaWYgKGF4aXNPcHRpb25zICYmICFheGlzT3B0aW9ucy50aWNrQ29sb3IpIHsKICAgICAgICAgICAgICAgICAgICBheGlzT3B0aW9ucy50aWNrQ29sb3IgPSBheGlzT3B0aW9ucy5jb2xvcjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBheGlzT3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBvcHRpb25zLnlheGlzLCBheGlzT3B0aW9ucyk7CiAgICAgICAgICAgICAgICBvcHRpb25zLnlheGVzW2ldID0gYXhpc09wdGlvbnM7CgogICAgICAgICAgICAgICAgaWYgKGF4aXNPcHRpb25zLmZvbnQpIHsKICAgICAgICAgICAgICAgICAgICBheGlzT3B0aW9ucy5mb250ID0gJC5leHRlbmQoe30sIGZvbnREZWZhdWx0cywgYXhpc09wdGlvbnMuZm9udCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFheGlzT3B0aW9ucy5mb250LmNvbG9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGF4aXNPcHRpb25zLmZvbnQuY29sb3IgPSBheGlzT3B0aW9ucy5jb2xvcjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCFheGlzT3B0aW9ucy5mb250LmxpbmVIZWlnaHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXhpc09wdGlvbnMuZm9udC5saW5lSGVpZ2h0ID0gTWF0aC5yb3VuZChheGlzT3B0aW9ucy5mb250LnNpemUgKiAxLjE1KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LCB0byBiZSByZW1vdmVkIGluIGZ1dHVyZQogICAgICAgICAgICBpZiAob3B0aW9ucy54YXhpcy5ub1RpY2tzICYmIG9wdGlvbnMueGF4aXMudGlja3MgPT0gbnVsbCkKICAgICAgICAgICAgICAgIG9wdGlvbnMueGF4aXMudGlja3MgPSBvcHRpb25zLnhheGlzLm5vVGlja3M7CiAgICAgICAgICAgIGlmIChvcHRpb25zLnlheGlzLm5vVGlja3MgJiYgb3B0aW9ucy55YXhpcy50aWNrcyA9PSBudWxsKQogICAgICAgICAgICAgICAgb3B0aW9ucy55YXhpcy50aWNrcyA9IG9wdGlvbnMueWF4aXMubm9UaWNrczsKICAgICAgICAgICAgaWYgKG9wdGlvbnMueDJheGlzKSB7CiAgICAgICAgICAgICAgICBvcHRpb25zLnhheGVzWzFdID0gJC5leHRlbmQodHJ1ZSwge30sIG9wdGlvbnMueGF4aXMsIG9wdGlvbnMueDJheGlzKTsKICAgICAgICAgICAgICAgIG9wdGlvbnMueGF4ZXNbMV0ucG9zaXRpb24gPSAidG9wIjsKICAgICAgICAgICAgICAgIC8vIE92ZXJyaWRlIHRoZSBpbmhlcml0IHRvIGFsbG93IHRoZSBheGlzIHRvIGF1dG8tc2NhbGUKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLngyYXhpcy5taW4gPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMueGF4ZXNbMV0ubWluID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLngyYXhpcy5tYXggPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMueGF4ZXNbMV0ubWF4ID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3B0aW9ucy55MmF4aXMpIHsKICAgICAgICAgICAgICAgIG9wdGlvbnMueWF4ZXNbMV0gPSAkLmV4dGVuZCh0cnVlLCB7fSwgb3B0aW9ucy55YXhpcywgb3B0aW9ucy55MmF4aXMpOwogICAgICAgICAgICAgICAgb3B0aW9ucy55YXhlc1sxXS5wb3NpdGlvbiA9ICJyaWdodCI7CiAgICAgICAgICAgICAgICAvLyBPdmVycmlkZSB0aGUgaW5oZXJpdCB0byBhbGxvdyB0aGUgYXhpcyB0byBhdXRvLXNjYWxlCiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy55MmF4aXMubWluID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnlheGVzWzFdLm1pbiA9IG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy55MmF4aXMubWF4ID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnlheGVzWzFdLm1heCA9IG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ3JpZC5jb2xvcmVkQXJlYXMpCiAgICAgICAgICAgICAgICBvcHRpb25zLmdyaWQubWFya2luZ3MgPSBvcHRpb25zLmdyaWQuY29sb3JlZEFyZWFzOwogICAgICAgICAgICBpZiAob3B0aW9ucy5ncmlkLmNvbG9yZWRBcmVhc0NvbG9yKQogICAgICAgICAgICAgICAgb3B0aW9ucy5ncmlkLm1hcmtpbmdzQ29sb3IgPSBvcHRpb25zLmdyaWQuY29sb3JlZEFyZWFzQ29sb3I7CiAgICAgICAgICAgIGlmIChvcHRpb25zLmxpbmVzKQogICAgICAgICAgICAgICAgJC5leHRlbmQodHJ1ZSwgb3B0aW9ucy5zZXJpZXMubGluZXMsIG9wdGlvbnMubGluZXMpOwogICAgICAgICAgICBpZiAob3B0aW9ucy5wb2ludHMpCiAgICAgICAgICAgICAgICAkLmV4dGVuZCh0cnVlLCBvcHRpb25zLnNlcmllcy5wb2ludHMsIG9wdGlvbnMucG9pbnRzKTsKICAgICAgICAgICAgaWYgKG9wdGlvbnMuYmFycykKICAgICAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIG9wdGlvbnMuc2VyaWVzLmJhcnMsIG9wdGlvbnMuYmFycyk7CiAgICAgICAgICAgIGlmIChvcHRpb25zLnNoYWRvd1NpemUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIG9wdGlvbnMuc2VyaWVzLnNoYWRvd1NpemUgPSBvcHRpb25zLnNoYWRvd1NpemU7CiAgICAgICAgICAgIGlmIChvcHRpb25zLmhpZ2hsaWdodENvbG9yICE9IG51bGwpCiAgICAgICAgICAgICAgICBvcHRpb25zLnNlcmllcy5oaWdobGlnaHRDb2xvciA9IG9wdGlvbnMuaGlnaGxpZ2h0Q29sb3I7CgogICAgICAgICAgICAvLyBzYXZlIG9wdGlvbnMgb24gYXhlcyBmb3IgZnV0dXJlIHJlZmVyZW5jZQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgb3B0aW9ucy54YXhlcy5sZW5ndGg7ICsraSkKICAgICAgICAgICAgICAgIGdldE9yQ3JlYXRlQXhpcyh4YXhlcywgaSArIDEpLm9wdGlvbnMgPSBvcHRpb25zLnhheGVzW2ldOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgb3B0aW9ucy55YXhlcy5sZW5ndGg7ICsraSkKICAgICAgICAgICAgICAgIGdldE9yQ3JlYXRlQXhpcyh5YXhlcywgaSArIDEpLm9wdGlvbnMgPSBvcHRpb25zLnlheGVzW2ldOwoKICAgICAgICAgICAgLy8gYWRkIGhvb2tzIGZyb20gb3B0aW9ucwogICAgICAgICAgICBmb3IgKHZhciBuIGluIGhvb2tzKQogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuaG9va3Nbbl0gJiYgb3B0aW9ucy5ob29rc1tuXS5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgaG9va3Nbbl0gPSBob29rc1tuXS5jb25jYXQob3B0aW9ucy5ob29rc1tuXSk7CgogICAgICAgICAgICBleGVjdXRlSG9va3MoaG9va3MucHJvY2Vzc09wdGlvbnMsIFtvcHRpb25zXSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzZXREYXRhKGQpIHsKICAgICAgICAgICAgc2VyaWVzID0gcGFyc2VEYXRhKGQpOwogICAgICAgICAgICBmaWxsSW5TZXJpZXNPcHRpb25zKCk7CiAgICAgICAgICAgIHByb2Nlc3NEYXRhKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBwYXJzZURhdGEoZCkgewogICAgICAgICAgICB2YXIgcmVzID0gW107CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZC5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgdmFyIHMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgb3B0aW9ucy5zZXJpZXMpOwoKICAgICAgICAgICAgICAgIGlmIChkW2ldLmRhdGEgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHMuZGF0YSA9IGRbaV0uZGF0YTsgLy8gbW92ZSB0aGUgZGF0YSBpbnN0ZWFkIG9mIGRlZXAtY29weQogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBkW2ldLmRhdGE7CgogICAgICAgICAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIHMsIGRbaV0pOwoKICAgICAgICAgICAgICAgICAgICBkW2ldLmRhdGEgPSBzLmRhdGE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgcy5kYXRhID0gZFtpXTsKICAgICAgICAgICAgICAgIHJlcy5wdXNoKHMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYXhpc051bWJlcihvYmosIGNvb3JkKSB7CiAgICAgICAgICAgIHZhciBhID0gb2JqW2Nvb3JkICsgImF4aXMiXTsKICAgICAgICAgICAgaWYgKHR5cGVvZiBhID09ICJvYmplY3QiKSAvLyBpZiB3ZSBnb3QgYSByZWFsIGF4aXMsIGV4dHJhY3QgbnVtYmVyCiAgICAgICAgICAgICAgICBhID0gYS5uOwogICAgICAgICAgICBpZiAodHlwZW9mIGEgIT0gIm51bWJlciIpCiAgICAgICAgICAgICAgICBhID0gMTsgLy8gZGVmYXVsdCB0byBmaXJzdCBheGlzCiAgICAgICAgICAgIHJldHVybiBhOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYWxsQXhlcygpIHsKICAgICAgICAgICAgLy8gcmV0dXJuIGZsYXQgYXJyYXkgd2l0aG91dCBhbm5veWluZyBudWxsIGVudHJpZXMKICAgICAgICAgICAgcmV0dXJuICQuZ3JlcCh4YXhlcy5jb25jYXQoeWF4ZXMpLCBmdW5jdGlvbiAoYSkgeyByZXR1cm4gYTsgfSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBjYW52YXNUb0F4aXNDb29yZHMocG9zKSB7CiAgICAgICAgICAgIC8vIHJldHVybiBhbiBvYmplY3Qgd2l0aCB4L3kgY29ycmVzcG9uZGluZyB0byBhbGwgdXNlZCBheGVzCiAgICAgICAgICAgIHZhciByZXMgPSB7fSwgaSwgYXhpczsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHhheGVzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgICAgICBheGlzID0geGF4ZXNbaV07CiAgICAgICAgICAgICAgICBpZiAoYXhpcyAmJiBheGlzLnVzZWQpCiAgICAgICAgICAgICAgICAgICAgcmVzWyJ4IiArIGF4aXMubl0gPSBheGlzLmMycChwb3MubGVmdCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB5YXhlcy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgYXhpcyA9IHlheGVzW2ldOwogICAgICAgICAgICAgICAgaWYgKGF4aXMgJiYgYXhpcy51c2VkKQogICAgICAgICAgICAgICAgICAgIHJlc1sieSIgKyBheGlzLm5dID0gYXhpcy5jMnAocG9zLnRvcCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChyZXMueDEgIT09IHVuZGVmaW5lZCkKICAgICAgICAgICAgICAgIHJlcy54ID0gcmVzLngxOwogICAgICAgICAgICBpZiAocmVzLnkxICE9PSB1bmRlZmluZWQpCiAgICAgICAgICAgICAgICByZXMueSA9IHJlcy55MTsKCiAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBheGlzVG9DYW52YXNDb29yZHMocG9zKSB7CiAgICAgICAgICAgIC8vIGdldCBjYW52YXMgY29vcmRzIGZyb20gdGhlIGZpcnN0IHBhaXIgb2YgeC95IGZvdW5kIGluIHBvcwogICAgICAgICAgICB2YXIgcmVzID0ge30sIGksIGF4aXMsIGtleTsKCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB4YXhlcy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgYXhpcyA9IHhheGVzW2ldOwogICAgICAgICAgICAgICAgaWYgKGF4aXMgJiYgYXhpcy51c2VkKSB7CiAgICAgICAgICAgICAgICAgICAga2V5ID0gIngiICsgYXhpcy5uOwogICAgICAgICAgICAgICAgICAgIGlmIChwb3Nba2V5XSA9PSBudWxsICYmIGF4aXMubiA9PSAxKQogICAgICAgICAgICAgICAgICAgICAgICBrZXkgPSAieCI7CgogICAgICAgICAgICAgICAgICAgIGlmIChwb3Nba2V5XSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5sZWZ0ID0gYXhpcy5wMmMocG9zW2tleV0pOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB5YXhlcy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgYXhpcyA9IHlheGVzW2ldOwogICAgICAgICAgICAgICAgaWYgKGF4aXMgJiYgYXhpcy51c2VkKSB7CiAgICAgICAgICAgICAgICAgICAga2V5ID0gInkiICsgYXhpcy5uOwogICAgICAgICAgICAgICAgICAgIGlmIChwb3Nba2V5XSA9PSBudWxsICYmIGF4aXMubiA9PSAxKQogICAgICAgICAgICAgICAgICAgICAgICBrZXkgPSAieSI7CgogICAgICAgICAgICAgICAgICAgIGlmIChwb3Nba2V5XSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlcy50b3AgPSBheGlzLnAyYyhwb3Nba2V5XSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdldE9yQ3JlYXRlQXhpcyhheGVzLCBudW1iZXIpIHsKICAgICAgICAgICAgaWYgKCFheGVzW251bWJlciAtIDFdKQogICAgICAgICAgICAgICAgYXhlc1tudW1iZXIgLSAxXSA9IHsKICAgICAgICAgICAgICAgICAgICBuOiBudW1iZXIsIC8vIHNhdmUgdGhlIG51bWJlciBmb3IgZnV0dXJlIHJlZmVyZW5jZQogICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogYXhlcyA9PSB4YXhlcyA/ICJ4IiA6ICJ5IiwKICAgICAgICAgICAgICAgICAgICBvcHRpb25zOiAkLmV4dGVuZCh0cnVlLCB7fSwgYXhlcyA9PSB4YXhlcyA/IG9wdGlvbnMueGF4aXMgOiBvcHRpb25zLnlheGlzKQogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJldHVybiBheGVzW251bWJlciAtIDFdOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZmlsbEluU2VyaWVzT3B0aW9ucygpIHsKCiAgICAgICAgICAgIHZhciBuZWVkZWRDb2xvcnMgPSBzZXJpZXMubGVuZ3RoLCBtYXhJbmRleCA9IC0xLCBpOwoKICAgICAgICAgICAgLy8gU3VidHJhY3QgdGhlIG51bWJlciBvZiBzZXJpZXMgdGhhdCBhbHJlYWR5IGhhdmUgZml4ZWQgY29sb3JzIG9yCiAgICAgICAgICAgIC8vIGNvbG9yIGluZGV4ZXMgZnJvbSB0aGUgbnVtYmVyIHRoYXQgd2Ugc3RpbGwgbmVlZCB0byBnZW5lcmF0ZS4KCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzZXJpZXMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICAgIHZhciBzYyA9IHNlcmllc1tpXS5jb2xvcjsKICAgICAgICAgICAgICAgIGlmIChzYyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgbmVlZGVkQ29sb3JzLS07CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzYyA9PSAibnVtYmVyIiAmJiBzYyA+IG1heEluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1heEluZGV4ID0gc2M7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBJZiBhbnkgb2YgdGhlIHNlcmllcyBoYXZlIGZpeGVkIGNvbG9yIGluZGV4ZXMsIHRoZW4gd2UgbmVlZCB0bwogICAgICAgICAgICAvLyBnZW5lcmF0ZSBhdCBsZWFzdCBhcyBtYW55IGNvbG9ycyBhcyB0aGUgaGlnaGVzdCBpbmRleC4KCiAgICAgICAgICAgIGlmIChuZWVkZWRDb2xvcnMgPD0gbWF4SW5kZXgpIHsKICAgICAgICAgICAgICAgIG5lZWRlZENvbG9ycyA9IG1heEluZGV4ICsgMTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gR2VuZXJhdGUgYWxsIHRoZSBjb2xvcnMsIHVzaW5nIGZpcnN0IHRoZSBvcHRpb24gY29sb3JzIGFuZCB0aGVuCiAgICAgICAgICAgIC8vIHZhcmlhdGlvbnMgb24gdGhvc2UgY29sb3JzIG9uY2UgdGhleSdyZSBleGhhdXN0ZWQuCgogICAgICAgICAgICB2YXIgYywgY29sb3JzID0gW10sIGNvbG9yUG9vbCA9IG9wdGlvbnMuY29sb3JzLAogICAgICAgICAgICAgICAgY29sb3JQb29sU2l6ZSA9IGNvbG9yUG9vbC5sZW5ndGgsIHZhcmlhdGlvbiA9IDA7CgogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbmVlZGVkQ29sb3JzOyBpKyspIHsKCiAgICAgICAgICAgICAgICBjID0gJC5jb2xvci5wYXJzZShjb2xvclBvb2xbaSAlIGNvbG9yUG9vbFNpemVdIHx8ICIjNjY2Iik7CgogICAgICAgICAgICAgICAgLy8gRWFjaCB0aW1lIHdlIGV4aGF1c3QgdGhlIGNvbG9ycyBpbiB0aGUgcG9vbCB3ZSBhZGp1c3QKICAgICAgICAgICAgICAgIC8vIGEgc2NhbGluZyBmYWN0b3IgdXNlZCB0byBwcm9kdWNlIG1vcmUgdmFyaWF0aW9ucyBvbgogICAgICAgICAgICAgICAgLy8gdGhvc2UgY29sb3JzLiBUaGUgZmFjdG9yIGFsdGVybmF0ZXMgbmVnYXRpdmUvcG9zaXRpdmUKICAgICAgICAgICAgICAgIC8vIHRvIHByb2R1Y2UgbGlnaHRlci9kYXJrZXIgY29sb3JzLgoKICAgICAgICAgICAgICAgIC8vIFJlc2V0IHRoZSB2YXJpYXRpb24gYWZ0ZXIgZXZlcnkgZmV3IGN5Y2xlcywgb3IgZWxzZQogICAgICAgICAgICAgICAgLy8gaXQgd2lsbCBlbmQgdXAgcHJvZHVjaW5nIG9ubHkgd2hpdGUgb3IgYmxhY2sgY29sb3JzLgoKICAgICAgICAgICAgICAgIGlmIChpICUgY29sb3JQb29sU2l6ZSA9PSAwICYmIGkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodmFyaWF0aW9uID49IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhcmlhdGlvbiA8IDAuNSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyaWF0aW9uID0gLXZhcmlhdGlvbiAtIDAuMjsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHZhcmlhdGlvbiA9IDA7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHZhcmlhdGlvbiA9IC12YXJpYXRpb247CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29sb3JzW2ldID0gYy5zY2FsZSgncmdiJywgMSArIHZhcmlhdGlvbik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEZpbmFsaXplIHRoZSBzZXJpZXMgb3B0aW9ucywgZmlsbGluZyBpbiB0aGVpciBjb2xvcnMKCiAgICAgICAgICAgIHZhciBjb2xvcmkgPSAwLCBzOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc2VyaWVzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgICAgICBzID0gc2VyaWVzW2ldOwoKICAgICAgICAgICAgICAgIC8vIGFzc2lnbiBjb2xvcnMKICAgICAgICAgICAgICAgIGlmIChzLmNvbG9yID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBzLmNvbG9yID0gY29sb3JzW2NvbG9yaV0udG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICArK2NvbG9yaTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBzLmNvbG9yID09ICJudW1iZXIiKQogICAgICAgICAgICAgICAgICAgIHMuY29sb3IgPSBjb2xvcnNbcy5jb2xvcl0udG9TdHJpbmcoKTsKCiAgICAgICAgICAgICAgICAvLyB0dXJuIG9uIGxpbmVzIGF1dG9tYXRpY2FsbHkgaW4gY2FzZSBub3RoaW5nIGlzIHNldAogICAgICAgICAgICAgICAgaWYgKHMubGluZXMuc2hvdyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHYsIHNob3cgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGZvciAodiBpbiBzKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc1t2XSAmJiBzW3ZdLnNob3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3cgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHNob3cpCiAgICAgICAgICAgICAgICAgICAgICAgIHMubGluZXMuc2hvdyA9IHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gSWYgbm90aGluZyB3YXMgcHJvdmlkZWQgZm9yIGxpbmVzLnplcm8sIGRlZmF1bHQgaXQgdG8gbWF0Y2gKICAgICAgICAgICAgICAgIC8vIGxpbmVzLmZpbGwsIHNpbmNlIGFyZWFzIGJ5IGRlZmF1bHQgc2hvdWxkIGV4dGVuZCB0byB6ZXJvLgoKICAgICAgICAgICAgICAgIGlmIChzLmxpbmVzLnplcm8gPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHMubGluZXMuemVybyA9ICEhcy5saW5lcy5maWxsOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIHNldHVwIGF4ZXMKICAgICAgICAgICAgICAgIHMueGF4aXMgPSBnZXRPckNyZWF0ZUF4aXMoeGF4ZXMsIGF4aXNOdW1iZXIocywgIngiKSk7CiAgICAgICAgICAgICAgICBzLnlheGlzID0gZ2V0T3JDcmVhdGVBeGlzKHlheGVzLCBheGlzTnVtYmVyKHMsICJ5IikpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBwcm9jZXNzRGF0YSgpIHsKICAgICAgICAgICAgdmFyIHRvcFNlbnRyeSA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSwKICAgICAgICAgICAgICAgIGJvdHRvbVNlbnRyeSA9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSwKICAgICAgICAgICAgICAgIGZha2VJbmZpbml0eSA9IE51bWJlci5NQVhfVkFMVUUsCiAgICAgICAgICAgICAgICBpLCBqLCBrLCBtLCBsZW5ndGgsCiAgICAgICAgICAgICAgICBzLCBwb2ludHMsIHBzLCB4LCB5LCBheGlzLCB2YWwsIGYsIHAsCiAgICAgICAgICAgICAgICBkYXRhLCBmb3JtYXQ7CgogICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVBeGlzKGF4aXMsIG1pbiwgbWF4KSB7CiAgICAgICAgICAgICAgICBpZiAobWluIDwgYXhpcy5kYXRhbWluICYmIG1pbiAhPSAtZmFrZUluZmluaXR5KQogICAgICAgICAgICAgICAgICAgIGF4aXMuZGF0YW1pbiA9IG1pbjsKICAgICAgICAgICAgICAgIGlmIChtYXggPiBheGlzLmRhdGFtYXggJiYgbWF4ICE9IGZha2VJbmZpbml0eSkKICAgICAgICAgICAgICAgICAgICBheGlzLmRhdGFtYXggPSBtYXg7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICQuZWFjaChhbGxBeGVzKCksIGZ1bmN0aW9uIChfLCBheGlzKSB7CiAgICAgICAgICAgICAgICAvLyBpbml0IGF4aXMKICAgICAgICAgICAgICAgIGF4aXMuZGF0YW1pbiA9IHRvcFNlbnRyeTsKICAgICAgICAgICAgICAgIGF4aXMuZGF0YW1heCA9IGJvdHRvbVNlbnRyeTsKICAgICAgICAgICAgICAgIGF4aXMudXNlZCA9IGZhbHNlOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzZXJpZXMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICAgIHMgPSBzZXJpZXNbaV07CiAgICAgICAgICAgICAgICBzLmRhdGFwb2ludHMgPSB7IHBvaW50czogW10gfTsKCiAgICAgICAgICAgICAgICBleGVjdXRlSG9va3MoaG9va3MucHJvY2Vzc1Jhd0RhdGEsIFsgcywgcy5kYXRhLCBzLmRhdGFwb2ludHMgXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGZpcnN0IHBhc3M6IGNsZWFuIGFuZCBjb3B5IGRhdGEKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNlcmllcy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgcyA9IHNlcmllc1tpXTsKCiAgICAgICAgICAgICAgICBkYXRhID0gcy5kYXRhOwogICAgICAgICAgICAgICAgZm9ybWF0ID0gcy5kYXRhcG9pbnRzLmZvcm1hdDsKCiAgICAgICAgICAgICAgICBpZiAoIWZvcm1hdCkgewogICAgICAgICAgICAgICAgICAgIGZvcm1hdCA9IFtdOwogICAgICAgICAgICAgICAgICAgIC8vIGZpbmQgb3V0IGhvdyB0byBjb3B5CiAgICAgICAgICAgICAgICAgICAgZm9ybWF0LnB1c2goeyB4OiB0cnVlLCBudW1iZXI6IHRydWUsIHJlcXVpcmVkOiB0cnVlIH0pOwogICAgICAgICAgICAgICAgICAgIGZvcm1hdC5wdXNoKHsgeTogdHJ1ZSwgbnVtYmVyOiB0cnVlLCByZXF1aXJlZDogdHJ1ZSB9KTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHMuYmFycy5zaG93IHx8IChzLmxpbmVzLnNob3cgJiYgcy5saW5lcy5maWxsKSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXV0b3NjYWxlID0gISEoKHMuYmFycy5zaG93ICYmIHMuYmFycy56ZXJvKSB8fCAocy5saW5lcy5zaG93ICYmIHMubGluZXMuemVybykpOwogICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQucHVzaCh7IHk6IHRydWUsIG51bWJlcjogdHJ1ZSwgcmVxdWlyZWQ6IGZhbHNlLCBkZWZhdWx0VmFsdWU6IDAsIGF1dG9zY2FsZTogYXV0b3NjYWxlIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocy5iYXJzLmhvcml6b250YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBmb3JtYXRbZm9ybWF0Lmxlbmd0aCAtIDFdLnk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXRbZm9ybWF0Lmxlbmd0aCAtIDFdLnggPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBzLmRhdGFwb2ludHMuZm9ybWF0ID0gZm9ybWF0OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChzLmRhdGFwb2ludHMucG9pbnRzaXplICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7IC8vIGFscmVhZHkgZmlsbGVkIGluCgogICAgICAgICAgICAgICAgcy5kYXRhcG9pbnRzLnBvaW50c2l6ZSA9IGZvcm1hdC5sZW5ndGg7CgogICAgICAgICAgICAgICAgcHMgPSBzLmRhdGFwb2ludHMucG9pbnRzaXplOwogICAgICAgICAgICAgICAgcG9pbnRzID0gcy5kYXRhcG9pbnRzLnBvaW50czsKCiAgICAgICAgICAgICAgICB2YXIgaW5zZXJ0U3RlcHMgPSBzLmxpbmVzLnNob3cgJiYgcy5saW5lcy5zdGVwczsKICAgICAgICAgICAgICAgIHMueGF4aXMudXNlZCA9IHMueWF4aXMudXNlZCA9IHRydWU7CgogICAgICAgICAgICAgICAgZm9yIChqID0gayA9IDA7IGogPCBkYXRhLmxlbmd0aDsgKytqLCBrICs9IHBzKSB7CiAgICAgICAgICAgICAgICAgICAgcCA9IGRhdGFbal07CgogICAgICAgICAgICAgICAgICAgIHZhciBudWxsaWZ5ID0gcCA9PSBudWxsOwogICAgICAgICAgICAgICAgICAgIGlmICghbnVsbGlmeSkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKG0gPSAwOyBtIDwgcHM7ICsrbSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gcFttXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBmb3JtYXRbbV07CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZi5udW1iZXIgJiYgdmFsICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gK3ZhbDsgLy8gY29udmVydCB0byBudW1iZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzTmFOKHZhbCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWwgPT0gSW5maW5pdHkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBmYWtlSW5maW5pdHk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHZhbCA9PSAtSW5maW5pdHkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSAtZmFrZUluZmluaXR5OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmLnJlcXVpcmVkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbGlmeSA9IHRydWU7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZi5kZWZhdWx0VmFsdWUgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IGYuZGVmYXVsdFZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHNbayArIG1dID0gdmFsOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAobnVsbGlmeSkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKG0gPSAwOyBtIDwgcHM7ICsrbSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gcG9pbnRzW2sgKyBtXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWwgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBmb3JtYXRbbV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXh0cmFjdCBtaW4vbWF4IGluZm8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZi5hdXRvc2NhbGUgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmLngpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUF4aXMocy54YXhpcywgdmFsLCB2YWwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmLnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUF4aXMocy55YXhpcywgdmFsLCB2YWwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzW2sgKyBtXSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGEgbGl0dGxlIGJpdCBvZiBsaW5lIHNwZWNpZmljIHN0dWZmIHRoYXQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGVyaGFwcyBzaG91bGRuJ3QgYmUgaGVyZSwgYnV0IGxhY2tpbmcKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYmV0dGVyIG1lYW5zLi4uCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnNlcnRTdGVwcyAmJiBrID4gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgcG9pbnRzW2sgLSBwc10gIT0gbnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgcG9pbnRzW2sgLSBwc10gIT0gcG9pbnRzW2tdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiBwb2ludHNbayAtIHBzICsgMV0gIT0gcG9pbnRzW2sgKyAxXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29weSB0aGUgcG9pbnQgdG8gbWFrZSByb29tIGZvciBhIG1pZGRsZSBwb2ludAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChtID0gMDsgbSA8IHBzOyArK20pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzW2sgKyBwcyArIG1dID0gcG9pbnRzW2sgKyBtXTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBtaWRkbGUgcG9pbnQgaGFzIHNhbWUgeQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzW2sgKyAxXSA9IHBvaW50c1trIC0gcHMgKyAxXTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSd2ZSBhZGRlZCBhIHBvaW50LCBiZXR0ZXIgcmVmbGVjdCB0aGF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrICs9IHBzOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBnaXZlIHRoZSBob29rcyBhIGNoYW5jZSB0byBydW4KICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNlcmllcy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgcyA9IHNlcmllc1tpXTsKCiAgICAgICAgICAgICAgICBleGVjdXRlSG9va3MoaG9va3MucHJvY2Vzc0RhdGFwb2ludHMsIFsgcywgcy5kYXRhcG9pbnRzXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHNlY29uZCBwYXNzOiBmaW5kIGRhdGFtYXgvZGF0YW1pbiBmb3IgYXV0by1zY2FsaW5nCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzZXJpZXMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICAgIHMgPSBzZXJpZXNbaV07CiAgICAgICAgICAgICAgICBwb2ludHMgPSBzLmRhdGFwb2ludHMucG9pbnRzOwogICAgICAgICAgICAgICAgcHMgPSBzLmRhdGFwb2ludHMucG9pbnRzaXplOwogICAgICAgICAgICAgICAgZm9ybWF0ID0gcy5kYXRhcG9pbnRzLmZvcm1hdDsKCiAgICAgICAgICAgICAgICB2YXIgeG1pbiA9IHRvcFNlbnRyeSwgeW1pbiA9IHRvcFNlbnRyeSwKICAgICAgICAgICAgICAgICAgICB4bWF4ID0gYm90dG9tU2VudHJ5LCB5bWF4ID0gYm90dG9tU2VudHJ5OwoKICAgICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBwb2ludHMubGVuZ3RoOyBqICs9IHBzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBvaW50c1tqXSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAgZm9yIChtID0gMDsgbSA8IHBzOyArK20pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gcG9pbnRzW2ogKyBtXTsKICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGZvcm1hdFttXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmIHx8IGYuYXV0b3NjYWxlID09PSBmYWxzZSB8fCB2YWwgPT0gZmFrZUluZmluaXR5IHx8IHZhbCA9PSAtZmFrZUluZmluaXR5KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZi54KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsIDwgeG1pbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4bWluID0gdmFsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbCA+IHhtYXgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeG1heCA9IHZhbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZi55KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsIDwgeW1pbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5bWluID0gdmFsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbCA+IHltYXgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeW1heCA9IHZhbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAocy5iYXJzLnNob3cpIHsKICAgICAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgd2UgZ290IHJvb20gZm9yIHRoZSBiYXIgb24gdGhlIGRhbmNpbmcgZmxvb3IKICAgICAgICAgICAgICAgICAgICB2YXIgZGVsdGE7CgogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAocy5iYXJzLmFsaWduKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImxlZnQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsdGEgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInJpZ2h0IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbHRhID0gLXMuYmFycy5iYXJXaWR0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsdGEgPSAtcy5iYXJzLmJhcldpZHRoIC8gMjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChzLmJhcnMuaG9yaXpvbnRhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB5bWluICs9IGRlbHRhOwogICAgICAgICAgICAgICAgICAgICAgICB5bWF4ICs9IGRlbHRhICsgcy5iYXJzLmJhcldpZHRoOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgeG1pbiArPSBkZWx0YTsKICAgICAgICAgICAgICAgICAgICAgICAgeG1heCArPSBkZWx0YSArIHMuYmFycy5iYXJXaWR0aDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdXBkYXRlQXhpcyhzLnhheGlzLCB4bWluLCB4bWF4KTsKICAgICAgICAgICAgICAgIHVwZGF0ZUF4aXMocy55YXhpcywgeW1pbiwgeW1heCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICQuZWFjaChhbGxBeGVzKCksIGZ1bmN0aW9uIChfLCBheGlzKSB7CiAgICAgICAgICAgICAgICBpZiAoYXhpcy5kYXRhbWluID09IHRvcFNlbnRyeSkKICAgICAgICAgICAgICAgICAgICBheGlzLmRhdGFtaW4gPSBudWxsOwogICAgICAgICAgICAgICAgaWYgKGF4aXMuZGF0YW1heCA9PSBib3R0b21TZW50cnkpCiAgICAgICAgICAgICAgICAgICAgYXhpcy5kYXRhbWF4ID0gbnVsbDsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzZXR1cENhbnZhc2VzKCkgewoKICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHRoZSBwbGFjZWhvbGRlciBpcyBjbGVhciBvZiBldmVyeXRoaW5nIGV4Y2VwdCBjYW52YXNlcwogICAgICAgICAgICAvLyBmcm9tIGEgcHJldmlvdXMgcGxvdCBpbiB0aGlzIGNvbnRhaW5lciB0aGF0IHdlJ2xsIHRyeSB0byByZS11c2UuCgogICAgICAgICAgICBwbGFjZWhvbGRlci5jc3MoInBhZGRpbmciLCAwKSAvLyBwYWRkaW5nIG1lc3NlcyB1cCB0aGUgcG9zaXRpb25pbmcKICAgICAgICAgICAgICAgIC5jaGlsZHJlbigpLmZpbHRlcihmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAhJCh0aGlzKS5oYXNDbGFzcygiZmxvdC1vdmVybGF5IikgJiYgISQodGhpcykuaGFzQ2xhc3MoJ2Zsb3QtYmFzZScpOwogICAgICAgICAgICAgICAgfSkucmVtb3ZlKCk7CgogICAgICAgICAgICBpZiAocGxhY2Vob2xkZXIuY3NzKCJwb3NpdGlvbiIpID09ICdzdGF0aWMnKQogICAgICAgICAgICAgICAgcGxhY2Vob2xkZXIuY3NzKCJwb3NpdGlvbiIsICJyZWxhdGl2ZSIpOyAvLyBmb3IgcG9zaXRpb25pbmcgbGFiZWxzIGFuZCBvdmVybGF5CgogICAgICAgICAgICBzdXJmYWNlID0gbmV3IENhbnZhcygiZmxvdC1iYXNlIiwgcGxhY2Vob2xkZXIpOwogICAgICAgICAgICBvdmVybGF5ID0gbmV3IENhbnZhcygiZmxvdC1vdmVybGF5IiwgcGxhY2Vob2xkZXIpOyAvLyBvdmVybGF5IGNhbnZhcyBmb3IgaW50ZXJhY3RpdmUgZmVhdHVyZXMKCiAgICAgICAgICAgIGN0eCA9IHN1cmZhY2UuY29udGV4dDsKICAgICAgICAgICAgb2N0eCA9IG92ZXJsYXkuY29udGV4dDsKCiAgICAgICAgICAgIC8vIGRlZmluZSB3aGljaCBlbGVtZW50IHdlJ3JlIGxpc3RlbmluZyBmb3IgZXZlbnRzIG9uCiAgICAgICAgICAgIGV2ZW50SG9sZGVyID0gJChvdmVybGF5LmVsZW1lbnQpLnVuYmluZCgpOwoKICAgICAgICAgICAgLy8gSWYgd2UncmUgcmUtdXNpbmcgYSBwbG90IG9iamVjdCwgc2h1dCBkb3duIHRoZSBvbGQgb25lCgogICAgICAgICAgICB2YXIgZXhpc3RpbmcgPSBwbGFjZWhvbGRlci5kYXRhKCJwbG90Iik7CgogICAgICAgICAgICBpZiAoZXhpc3RpbmcpIHsKICAgICAgICAgICAgICAgIGV4aXN0aW5nLnNodXRkb3duKCk7CiAgICAgICAgICAgICAgICBvdmVybGF5LmNsZWFyKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHNhdmUgaW4gY2FzZSB3ZSBnZXQgcmVwbG90dGVkCiAgICAgICAgICAgIHBsYWNlaG9sZGVyLmRhdGEoInBsb3QiLCBwbG90KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGJpbmRFdmVudHMoKSB7CiAgICAgICAgICAgIC8vIGJpbmQgZXZlbnRzCiAgICAgICAgICAgIGlmIChvcHRpb25zLmdyaWQuaG92ZXJhYmxlKSB7CiAgICAgICAgICAgICAgICBldmVudEhvbGRlci5tb3VzZW1vdmUob25Nb3VzZU1vdmUpOwoKICAgICAgICAgICAgICAgIC8vIFVzZSBiaW5kLCByYXRoZXIgdGhhbiAubW91c2VsZWF2ZSwgYmVjYXVzZSB3ZSBvZmZpY2lhbGx5CiAgICAgICAgICAgICAgICAvLyBzdGlsbCBzdXBwb3J0IGpRdWVyeSAxLjIuNiwgd2hpY2ggZG9lc24ndCBkZWZpbmUgYSBzaG9ydGN1dAogICAgICAgICAgICAgICAgLy8gZm9yIG1vdXNlZW50ZXIgb3IgbW91c2VsZWF2ZS4gIFRoaXMgd2FzIGEgYnVnL292ZXJzaWdodCB0aGF0CiAgICAgICAgICAgICAgICAvLyB3YXMgZml4ZWQgc29tZXdoZXJlIGFyb3VuZCAxLjMueC4gIFdlIGNhbiByZXR1cm4gdG8gdXNpbmcKICAgICAgICAgICAgICAgIC8vIC5tb3VzZWxlYXZlIHdoZW4gd2UgZHJvcCBzdXBwb3J0IGZvciAxLjIuNi4KCiAgICAgICAgICAgICAgICBldmVudEhvbGRlci5iaW5kKCJtb3VzZWxlYXZlIiwgb25Nb3VzZUxlYXZlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ3JpZC5jbGlja2FibGUpCiAgICAgICAgICAgICAgICBldmVudEhvbGRlci5jbGljayhvbkNsaWNrKTsKCiAgICAgICAgICAgIGV4ZWN1dGVIb29rcyhob29rcy5iaW5kRXZlbnRzLCBbZXZlbnRIb2xkZXJdKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNodXRkb3duKCkgewogICAgICAgICAgICBpZiAocmVkcmF3VGltZW91dCkKICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChyZWRyYXdUaW1lb3V0KTsKCiAgICAgICAgICAgIGV2ZW50SG9sZGVyLnVuYmluZCgibW91c2Vtb3ZlIiwgb25Nb3VzZU1vdmUpOwogICAgICAgICAgICBldmVudEhvbGRlci51bmJpbmQoIm1vdXNlbGVhdmUiLCBvbk1vdXNlTGVhdmUpOwogICAgICAgICAgICBldmVudEhvbGRlci51bmJpbmQoImNsaWNrIiwgb25DbGljayk7CgogICAgICAgICAgICBleGVjdXRlSG9va3MoaG9va3Muc2h1dGRvd24sIFtldmVudEhvbGRlcl0pOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2V0VHJhbnNmb3JtYXRpb25IZWxwZXJzKGF4aXMpIHsKICAgICAgICAgICAgLy8gc2V0IGhlbHBlciBmdW5jdGlvbnMgb24gdGhlIGF4aXMsIGFzc3VtZXMgcGxvdCBhcmVhCiAgICAgICAgICAgIC8vIGhhcyBiZWVuIGNvbXB1dGVkIGFscmVhZHkKCiAgICAgICAgICAgIGZ1bmN0aW9uIGlkZW50aXR5KHgpIHsgcmV0dXJuIHg7IH0KCiAgICAgICAgICAgIHZhciBzLCBtLCB0ID0gYXhpcy5vcHRpb25zLnRyYW5zZm9ybSB8fCBpZGVudGl0eSwKICAgICAgICAgICAgICAgIGl0ID0gYXhpcy5vcHRpb25zLmludmVyc2VUcmFuc2Zvcm07CgogICAgICAgICAgICAvLyBwcmVjb21wdXRlIGhvdyBtdWNoIHRoZSBheGlzIGlzIHNjYWxpbmcgYSBwb2ludAogICAgICAgICAgICAvLyBpbiBjYW52YXMgc3BhY2UKICAgICAgICAgICAgaWYgKGF4aXMuZGlyZWN0aW9uID09ICJ4IikgewogICAgICAgICAgICAgICAgcyA9IGF4aXMuc2NhbGUgPSBwbG90V2lkdGggLyBNYXRoLmFicyh0KGF4aXMubWF4KSAtIHQoYXhpcy5taW4pKTsKICAgICAgICAgICAgICAgIG0gPSBNYXRoLm1pbih0KGF4aXMubWF4KSwgdChheGlzLm1pbikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgcyA9IGF4aXMuc2NhbGUgPSBwbG90SGVpZ2h0IC8gTWF0aC5hYnModChheGlzLm1heCkgLSB0KGF4aXMubWluKSk7CiAgICAgICAgICAgICAgICBzID0gLXM7CiAgICAgICAgICAgICAgICBtID0gTWF0aC5tYXgodChheGlzLm1heCksIHQoYXhpcy5taW4pKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gZGF0YSBwb2ludCB0byBjYW52YXMgY29vcmRpbmF0ZQogICAgICAgICAgICBpZiAodCA9PSBpZGVudGl0eSkgLy8gc2xpZ2h0IG9wdGltaXphdGlvbgogICAgICAgICAgICAgICAgYXhpcy5wMmMgPSBmdW5jdGlvbiAocCkgeyByZXR1cm4gKHAgLSBtKSAqIHM7IH07CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGF4aXMucDJjID0gZnVuY3Rpb24gKHApIHsgcmV0dXJuICh0KHApIC0gbSkgKiBzOyB9OwogICAgICAgICAgICAvLyBjYW52YXMgY29vcmRpbmF0ZSB0byBkYXRhIHBvaW50CiAgICAgICAgICAgIGlmICghaXQpCiAgICAgICAgICAgICAgICBheGlzLmMycCA9IGZ1bmN0aW9uIChjKSB7IHJldHVybiBtICsgYyAvIHM7IH07CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGF4aXMuYzJwID0gZnVuY3Rpb24gKGMpIHsgcmV0dXJuIGl0KG0gKyBjIC8gcyk7IH07CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBtZWFzdXJlVGlja0xhYmVscyhheGlzKSB7CgogICAgICAgICAgICB2YXIgb3B0cyA9IGF4aXMub3B0aW9ucywKICAgICAgICAgICAgICAgIHRpY2tzID0gYXhpcy50aWNrcyB8fCBbXSwKICAgICAgICAgICAgICAgIGxhYmVsV2lkdGggPSBvcHRzLmxhYmVsV2lkdGggfHwgMCwKICAgICAgICAgICAgICAgIGxhYmVsSGVpZ2h0ID0gb3B0cy5sYWJlbEhlaWdodCB8fCAwLAogICAgICAgICAgICAgICAgbWF4V2lkdGggPSBsYWJlbFdpZHRoIHx8IChheGlzLmRpcmVjdGlvbiA9PSAieCIgPyBNYXRoLmZsb29yKHN1cmZhY2Uud2lkdGggLyAodGlja3MubGVuZ3RoIHx8IDEpKSA6IG51bGwpLAogICAgICAgICAgICAgICAgbGVnYWN5U3R5bGVzID0gYXhpcy5kaXJlY3Rpb24gKyAiQXhpcyAiICsgYXhpcy5kaXJlY3Rpb24gKyBheGlzLm4gKyAiQXhpcyIsCiAgICAgICAgICAgICAgICBsYXllciA9ICJmbG90LSIgKyBheGlzLmRpcmVjdGlvbiArICItYXhpcyBmbG90LSIgKyBheGlzLmRpcmVjdGlvbiArIGF4aXMubiArICItYXhpcyAiICsgbGVnYWN5U3R5bGVzLAogICAgICAgICAgICAgICAgZm9udCA9IG9wdHMuZm9udCB8fCAiZmxvdC10aWNrLWxhYmVsIHRpY2tMYWJlbCI7CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRpY2tzLmxlbmd0aDsgKytpKSB7CgogICAgICAgICAgICAgICAgdmFyIHQgPSB0aWNrc1tpXTsKCiAgICAgICAgICAgICAgICBpZiAoIXQubGFiZWwpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgdmFyIGluZm8gPSBzdXJmYWNlLmdldFRleHRJbmZvKGxheWVyLCB0LmxhYmVsLCBmb250LCBudWxsLCBtYXhXaWR0aCk7CgogICAgICAgICAgICAgICAgbGFiZWxXaWR0aCA9IE1hdGgubWF4KGxhYmVsV2lkdGgsIGluZm8ud2lkdGgpOwogICAgICAgICAgICAgICAgbGFiZWxIZWlnaHQgPSBNYXRoLm1heChsYWJlbEhlaWdodCwgaW5mby5oZWlnaHQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBheGlzLmxhYmVsV2lkdGggPSBvcHRzLmxhYmVsV2lkdGggfHwgbGFiZWxXaWR0aDsKICAgICAgICAgICAgYXhpcy5sYWJlbEhlaWdodCA9IG9wdHMubGFiZWxIZWlnaHQgfHwgbGFiZWxIZWlnaHQ7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhbGxvY2F0ZUF4aXNCb3hGaXJzdFBoYXNlKGF4aXMpIHsKICAgICAgICAgICAgLy8gZmluZCB0aGUgYm91bmRpbmcgYm94IG9mIHRoZSBheGlzIGJ5IGxvb2tpbmcgYXQgbGFiZWwKICAgICAgICAgICAgLy8gd2lkdGhzL2hlaWdodHMgYW5kIHRpY2tzLCBtYWtlIHJvb20gYnkgZGltaW5pc2hpbmcgdGhlCiAgICAgICAgICAgIC8vIHBsb3RPZmZzZXQ7IHRoaXMgZmlyc3QgcGhhc2Ugb25seSBsb29rcyBhdCBvbmUKICAgICAgICAgICAgLy8gZGltZW5zaW9uIHBlciBheGlzLCB0aGUgb3RoZXIgZGltZW5zaW9uIGRlcGVuZHMgb24gdGhlCiAgICAgICAgICAgIC8vIG90aGVyIGF4ZXMgc28gd2lsbCBoYXZlIHRvIHdhaXQKCiAgICAgICAgICAgIHZhciBsdyA9IGF4aXMubGFiZWxXaWR0aCwKICAgICAgICAgICAgICAgIGxoID0gYXhpcy5sYWJlbEhlaWdodCwKICAgICAgICAgICAgICAgIHBvcyA9IGF4aXMub3B0aW9ucy5wb3NpdGlvbiwKICAgICAgICAgICAgICAgIGlzWEF4aXMgPSBheGlzLmRpcmVjdGlvbiA9PT0gIngiLAogICAgICAgICAgICAgICAgdGlja0xlbmd0aCA9IGF4aXMub3B0aW9ucy50aWNrTGVuZ3RoLAogICAgICAgICAgICAgICAgYXhpc01hcmdpbiA9IG9wdGlvbnMuZ3JpZC5heGlzTWFyZ2luLAogICAgICAgICAgICAgICAgcGFkZGluZyA9IG9wdGlvbnMuZ3JpZC5sYWJlbE1hcmdpbiwKICAgICAgICAgICAgICAgIGlubmVybW9zdCA9IHRydWUsCiAgICAgICAgICAgICAgICBvdXRlcm1vc3QgPSB0cnVlLAogICAgICAgICAgICAgICAgZmlyc3QgPSB0cnVlLAogICAgICAgICAgICAgICAgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICAgIC8vIERldGVybWluZSB0aGUgYXhpcydzIHBvc2l0aW9uIGluIGl0cyBkaXJlY3Rpb24gYW5kIG9uIGl0cyBzaWRlCgogICAgICAgICAgICAkLmVhY2goaXNYQXhpcyA/IHhheGVzIDogeWF4ZXMsIGZ1bmN0aW9uKGksIGEpIHsKICAgICAgICAgICAgICAgIGlmIChhICYmIChhLnNob3cgfHwgYS5yZXNlcnZlU3BhY2UpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGEgPT09IGF4aXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYS5vcHRpb25zLnBvc2l0aW9uID09PSBwb3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvdW5kKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRlcm1vc3QgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlubmVybW9zdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3QgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gVGhlIG91dGVybW9zdCBheGlzIG9uIGVhY2ggc2lkZSBoYXMgbm8gbWFyZ2luCgogICAgICAgICAgICBpZiAob3V0ZXJtb3N0KSB7CiAgICAgICAgICAgICAgICBheGlzTWFyZ2luID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVGhlIHRpY2tzIGZvciB0aGUgZmlyc3QgYXhpcyBpbiBlYWNoIGRpcmVjdGlvbiBzdHJldGNoIGFjcm9zcwoKICAgICAgICAgICAgaWYgKHRpY2tMZW5ndGggPT0gbnVsbCkgewogICAgICAgICAgICAgICAgdGlja0xlbmd0aCA9IGZpcnN0ID8gImZ1bGwiIDogNTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFpc05hTigrdGlja0xlbmd0aCkpCiAgICAgICAgICAgICAgICBwYWRkaW5nICs9ICt0aWNrTGVuZ3RoOwoKICAgICAgICAgICAgaWYgKGlzWEF4aXMpIHsKICAgICAgICAgICAgICAgIGxoICs9IHBhZGRpbmc7CgogICAgICAgICAgICAgICAgaWYgKHBvcyA9PSAiYm90dG9tIikgewogICAgICAgICAgICAgICAgICAgIHBsb3RPZmZzZXQuYm90dG9tICs9IGxoICsgYXhpc01hcmdpbjsKICAgICAgICAgICAgICAgICAgICBheGlzLmJveCA9IHsgdG9wOiBzdXJmYWNlLmhlaWdodCAtIHBsb3RPZmZzZXQuYm90dG9tLCBoZWlnaHQ6IGxoIH07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBheGlzLmJveCA9IHsgdG9wOiBwbG90T2Zmc2V0LnRvcCArIGF4aXNNYXJnaW4sIGhlaWdodDogbGggfTsKICAgICAgICAgICAgICAgICAgICBwbG90T2Zmc2V0LnRvcCArPSBsaCArIGF4aXNNYXJnaW47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBsdyArPSBwYWRkaW5nOwoKICAgICAgICAgICAgICAgIGlmIChwb3MgPT0gImxlZnQiKSB7CiAgICAgICAgICAgICAgICAgICAgYXhpcy5ib3ggPSB7IGxlZnQ6IHBsb3RPZmZzZXQubGVmdCArIGF4aXNNYXJnaW4sIHdpZHRoOiBsdyB9OwogICAgICAgICAgICAgICAgICAgIHBsb3RPZmZzZXQubGVmdCArPSBsdyArIGF4aXNNYXJnaW47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBwbG90T2Zmc2V0LnJpZ2h0ICs9IGx3ICsgYXhpc01hcmdpbjsKICAgICAgICAgICAgICAgICAgICBheGlzLmJveCA9IHsgbGVmdDogc3VyZmFjZS53aWR0aCAtIHBsb3RPZmZzZXQucmlnaHQsIHdpZHRoOiBsdyB9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAgLy8gc2F2ZSBmb3IgZnV0dXJlIHJlZmVyZW5jZQogICAgICAgICAgICBheGlzLnBvc2l0aW9uID0gcG9zOwogICAgICAgICAgICBheGlzLnRpY2tMZW5ndGggPSB0aWNrTGVuZ3RoOwogICAgICAgICAgICBheGlzLmJveC5wYWRkaW5nID0gcGFkZGluZzsKICAgICAgICAgICAgYXhpcy5pbm5lcm1vc3QgPSBpbm5lcm1vc3Q7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhbGxvY2F0ZUF4aXNCb3hTZWNvbmRQaGFzZShheGlzKSB7CiAgICAgICAgICAgIC8vIG5vdyB0aGF0IGFsbCBheGlzIGJveGVzIGhhdmUgYmVlbiBwbGFjZWQgaW4gb25lCiAgICAgICAgICAgIC8vIGRpbWVuc2lvbiwgd2UgY2FuIHNldCB0aGUgcmVtYWluaW5nIGRpbWVuc2lvbiBjb29yZGluYXRlcwogICAgICAgICAgICBpZiAoYXhpcy5kaXJlY3Rpb24gPT0gIngiKSB7CiAgICAgICAgICAgICAgICBheGlzLmJveC5sZWZ0ID0gcGxvdE9mZnNldC5sZWZ0IC0gYXhpcy5sYWJlbFdpZHRoIC8gMjsKICAgICAgICAgICAgICAgIGF4aXMuYm94LndpZHRoID0gc3VyZmFjZS53aWR0aCAtIHBsb3RPZmZzZXQubGVmdCAtIHBsb3RPZmZzZXQucmlnaHQgKyBheGlzLmxhYmVsV2lkdGg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBheGlzLmJveC50b3AgPSBwbG90T2Zmc2V0LnRvcCAtIGF4aXMubGFiZWxIZWlnaHQgLyAyOwogICAgICAgICAgICAgICAgYXhpcy5ib3guaGVpZ2h0ID0gc3VyZmFjZS5oZWlnaHQgLSBwbG90T2Zmc2V0LmJvdHRvbSAtIHBsb3RPZmZzZXQudG9wICsgYXhpcy5sYWJlbEhlaWdodDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYWRqdXN0TGF5b3V0Rm9yVGhpbmdzU3RpY2tpbmdPdXQoKSB7CiAgICAgICAgICAgIC8vIHBvc3NpYmx5IGFkanVzdCBwbG90IG9mZnNldCB0byBlbnN1cmUgZXZlcnl0aGluZyBzdGF5cwogICAgICAgICAgICAvLyBpbnNpZGUgdGhlIGNhbnZhcyBhbmQgaXNuJ3QgY2xpcHBlZCBvZmYKCiAgICAgICAgICAgIHZhciBtaW5NYXJnaW4gPSBvcHRpb25zLmdyaWQubWluQm9yZGVyTWFyZ2luLAogICAgICAgICAgICAgICAgYXhpcywgaTsKCiAgICAgICAgICAgIC8vIGNoZWNrIHN0dWZmIGZyb20gdGhlIHBsb3QgKEZJWE1FOiB0aGlzIHNob3VsZCBqdXN0IHJlYWQKICAgICAgICAgICAgLy8gYSB2YWx1ZSBmcm9tIHRoZSBzZXJpZXMsIG90aGVyd2lzZSBpdCdzIGltcG9zc2libGUgdG8KICAgICAgICAgICAgLy8gY3VzdG9taXplKQogICAgICAgICAgICBpZiAobWluTWFyZ2luID09IG51bGwpIHsKICAgICAgICAgICAgICAgIG1pbk1hcmdpbiA9IDA7CiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc2VyaWVzLmxlbmd0aDsgKytpKQogICAgICAgICAgICAgICAgICAgIG1pbk1hcmdpbiA9IE1hdGgubWF4KG1pbk1hcmdpbiwgMiAqIChzZXJpZXNbaV0ucG9pbnRzLnJhZGl1cyArIHNlcmllc1tpXS5wb2ludHMubGluZVdpZHRoLzIpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIG1hcmdpbnMgPSB7CiAgICAgICAgICAgICAgICBsZWZ0OiBtaW5NYXJnaW4sCiAgICAgICAgICAgICAgICByaWdodDogbWluTWFyZ2luLAogICAgICAgICAgICAgICAgdG9wOiBtaW5NYXJnaW4sCiAgICAgICAgICAgICAgICBib3R0b206IG1pbk1hcmdpbgogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8gY2hlY2sgYXhpcyBsYWJlbHMsIG5vdGUgd2UgZG9uJ3QgY2hlY2sgdGhlIGFjdHVhbAogICAgICAgICAgICAvLyBsYWJlbHMgYnV0IGluc3RlYWQgdXNlIHRoZSBvdmVyYWxsIHdpZHRoL2hlaWdodCB0byBub3QKICAgICAgICAgICAgLy8ganVtcCBhcyBtdWNoIGFyb3VuZCB3aXRoIHJlcGxvdHMKICAgICAgICAgICAgJC5lYWNoKGFsbEF4ZXMoKSwgZnVuY3Rpb24gKF8sIGF4aXMpIHsKICAgICAgICAgICAgICAgIGlmIChheGlzLnJlc2VydmVTcGFjZSAmJiBheGlzLnRpY2tzICYmIGF4aXMudGlja3MubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGF4aXMuZGlyZWN0aW9uID09PSAieCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2lucy5sZWZ0ID0gTWF0aC5tYXgobWFyZ2lucy5sZWZ0LCBheGlzLmxhYmVsV2lkdGggLyAyKTsKICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2lucy5yaWdodCA9IE1hdGgubWF4KG1hcmdpbnMucmlnaHQsIGF4aXMubGFiZWxXaWR0aCAvIDIpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hcmdpbnMuYm90dG9tID0gTWF0aC5tYXgobWFyZ2lucy5ib3R0b20sIGF4aXMubGFiZWxIZWlnaHQgLyAyKTsKICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2lucy50b3AgPSBNYXRoLm1heChtYXJnaW5zLnRvcCwgYXhpcy5sYWJlbEhlaWdodCAvIDIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBwbG90T2Zmc2V0LmxlZnQgPSBNYXRoLmNlaWwoTWF0aC5tYXgobWFyZ2lucy5sZWZ0LCBwbG90T2Zmc2V0LmxlZnQpKTsKICAgICAgICAgICAgcGxvdE9mZnNldC5yaWdodCA9IE1hdGguY2VpbChNYXRoLm1heChtYXJnaW5zLnJpZ2h0LCBwbG90T2Zmc2V0LnJpZ2h0KSk7CiAgICAgICAgICAgIHBsb3RPZmZzZXQudG9wID0gTWF0aC5jZWlsKE1hdGgubWF4KG1hcmdpbnMudG9wLCBwbG90T2Zmc2V0LnRvcCkpOwogICAgICAgICAgICBwbG90T2Zmc2V0LmJvdHRvbSA9IE1hdGguY2VpbChNYXRoLm1heChtYXJnaW5zLmJvdHRvbSwgcGxvdE9mZnNldC5ib3R0b20pKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNldHVwR3JpZCgpIHsKICAgICAgICAgICAgdmFyIGksIGF4ZXMgPSBhbGxBeGVzKCksIHNob3dHcmlkID0gb3B0aW9ucy5ncmlkLnNob3c7CgogICAgICAgICAgICAvLyBJbml0aWFsaXplIHRoZSBwbG90J3Mgb2Zmc2V0IGZyb20gdGhlIGVkZ2Ugb2YgdGhlIGNhbnZhcwoKICAgICAgICAgICAgZm9yICh2YXIgYSBpbiBwbG90T2Zmc2V0KSB7CiAgICAgICAgICAgICAgICB2YXIgbWFyZ2luID0gb3B0aW9ucy5ncmlkLm1hcmdpbiB8fCAwOwogICAgICAgICAgICAgICAgcGxvdE9mZnNldFthXSA9IHR5cGVvZiBtYXJnaW4gPT0gIm51bWJlciIgPyBtYXJnaW4gOiBtYXJnaW5bYV0gfHwgMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZXhlY3V0ZUhvb2tzKGhvb2tzLnByb2Nlc3NPZmZzZXQsIFtwbG90T2Zmc2V0XSk7CgogICAgICAgICAgICAvLyBJZiB0aGUgZ3JpZCBpcyB2aXNpYmxlLCBhZGQgaXRzIGJvcmRlciB3aWR0aCB0byB0aGUgb2Zmc2V0CgogICAgICAgICAgICBmb3IgKHZhciBhIGluIHBsb3RPZmZzZXQpIHsKICAgICAgICAgICAgICAgIGlmKHR5cGVvZihvcHRpb25zLmdyaWQuYm9yZGVyV2lkdGgpID09ICJvYmplY3QiKSB7CiAgICAgICAgICAgICAgICAgICAgcGxvdE9mZnNldFthXSArPSBzaG93R3JpZCA/IG9wdGlvbnMuZ3JpZC5ib3JkZXJXaWR0aFthXSA6IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBwbG90T2Zmc2V0W2FdICs9IHNob3dHcmlkID8gb3B0aW9ucy5ncmlkLmJvcmRlcldpZHRoIDogMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJC5lYWNoKGF4ZXMsIGZ1bmN0aW9uIChfLCBheGlzKSB7CiAgICAgICAgICAgICAgICB2YXIgYXhpc09wdHMgPSBheGlzLm9wdGlvbnM7CiAgICAgICAgICAgICAgICBheGlzLnNob3cgPSBheGlzT3B0cy5zaG93ID09IG51bGwgPyBheGlzLnVzZWQgOiBheGlzT3B0cy5zaG93OwogICAgICAgICAgICAgICAgYXhpcy5yZXNlcnZlU3BhY2UgPSBheGlzT3B0cy5yZXNlcnZlU3BhY2UgPT0gbnVsbCA/IGF4aXMuc2hvdyA6IGF4aXNPcHRzLnJlc2VydmVTcGFjZTsKICAgICAgICAgICAgICAgIHNldFJhbmdlKGF4aXMpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChzaG93R3JpZCkgewoKICAgICAgICAgICAgICAgIHZhciBhbGxvY2F0ZWRBeGVzID0gJC5ncmVwKGF4ZXMsIGZ1bmN0aW9uIChheGlzKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGF4aXMuc2hvdyB8fCBheGlzLnJlc2VydmVTcGFjZTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICQuZWFjaChhbGxvY2F0ZWRBeGVzLCBmdW5jdGlvbiAoXywgYXhpcykgewogICAgICAgICAgICAgICAgICAgIC8vIG1ha2UgdGhlIHRpY2tzCiAgICAgICAgICAgICAgICAgICAgc2V0dXBUaWNrR2VuZXJhdGlvbihheGlzKTsKICAgICAgICAgICAgICAgICAgICBzZXRUaWNrcyhheGlzKTsKICAgICAgICAgICAgICAgICAgICBzbmFwUmFuZ2VUb1RpY2tzKGF4aXMsIGF4aXMudGlja3MpOwogICAgICAgICAgICAgICAgICAgIC8vIGZpbmQgbGFiZWxXaWR0aC9IZWlnaHQgZm9yIGF4aXMKICAgICAgICAgICAgICAgICAgICBtZWFzdXJlVGlja0xhYmVscyhheGlzKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIC8vIHdpdGggYWxsIGRpbWVuc2lvbnMgY2FsY3VsYXRlZCwgd2UgY2FuIGNvbXB1dGUgdGhlCiAgICAgICAgICAgICAgICAvLyBheGlzIGJvdW5kaW5nIGJveGVzLCBzdGFydCBmcm9tIHRoZSBvdXRzaWRlCiAgICAgICAgICAgICAgICAvLyAocmV2ZXJzZSBvcmRlcikKICAgICAgICAgICAgICAgIGZvciAoaSA9IGFsbG9jYXRlZEF4ZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpCiAgICAgICAgICAgICAgICAgICAgYWxsb2NhdGVBeGlzQm94Rmlyc3RQaGFzZShhbGxvY2F0ZWRBeGVzW2ldKTsKCiAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgd2UndmUgZ290IGVub3VnaCBzcGFjZSBmb3IgdGhpbmdzIHRoYXQKICAgICAgICAgICAgICAgIC8vIG1pZ2h0IHN0aWNrIG91dAogICAgICAgICAgICAgICAgYWRqdXN0TGF5b3V0Rm9yVGhpbmdzU3RpY2tpbmdPdXQoKTsKCiAgICAgICAgICAgICAgICAkLmVhY2goYWxsb2NhdGVkQXhlcywgZnVuY3Rpb24gKF8sIGF4aXMpIHsKICAgICAgICAgICAgICAgICAgICBhbGxvY2F0ZUF4aXNCb3hTZWNvbmRQaGFzZShheGlzKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwbG90V2lkdGggPSBzdXJmYWNlLndpZHRoIC0gcGxvdE9mZnNldC5sZWZ0IC0gcGxvdE9mZnNldC5yaWdodDsKICAgICAgICAgICAgcGxvdEhlaWdodCA9IHN1cmZhY2UuaGVpZ2h0IC0gcGxvdE9mZnNldC5ib3R0b20gLSBwbG90T2Zmc2V0LnRvcDsKCiAgICAgICAgICAgIC8vIG5vdyB3ZSBnb3QgdGhlIHByb3BlciBwbG90IGRpbWVuc2lvbnMsIHdlIGNhbiBjb21wdXRlIHRoZSBzY2FsaW5nCiAgICAgICAgICAgICQuZWFjaChheGVzLCBmdW5jdGlvbiAoXywgYXhpcykgewogICAgICAgICAgICAgICAgc2V0VHJhbnNmb3JtYXRpb25IZWxwZXJzKGF4aXMpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChzaG93R3JpZCkgewogICAgICAgICAgICAgICAgZHJhd0F4aXNMYWJlbHMoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW5zZXJ0TGVnZW5kKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzZXRSYW5nZShheGlzKSB7CiAgICAgICAgICAgIHZhciBvcHRzID0gYXhpcy5vcHRpb25zLAogICAgICAgICAgICAgICAgbWluID0gKyhvcHRzLm1pbiAhPSBudWxsID8gb3B0cy5taW4gOiBheGlzLmRhdGFtaW4pLAogICAgICAgICAgICAgICAgbWF4ID0gKyhvcHRzLm1heCAhPSBudWxsID8gb3B0cy5tYXggOiBheGlzLmRhdGFtYXgpLAogICAgICAgICAgICAgICAgZGVsdGEgPSBtYXggLSBtaW47CgogICAgICAgICAgICBpZiAoZGVsdGEgPT0gMC4wKSB7CiAgICAgICAgICAgICAgICAvLyBkZWdlbmVyYXRlIGNhc2UKICAgICAgICAgICAgICAgIHZhciB3aWRlbiA9IG1heCA9PSAwID8gMSA6IDAuMDE7CgogICAgICAgICAgICAgICAgaWYgKG9wdHMubWluID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgbWluIC09IHdpZGVuOwogICAgICAgICAgICAgICAgLy8gYWx3YXlzIHdpZGVuIG1heCBpZiB3ZSBjb3VsZG4ndCB3aWRlbiBtaW4gdG8gZW5zdXJlIHdlCiAgICAgICAgICAgICAgICAvLyBkb24ndCBmYWxsIGludG8gbWluID09IG1heCB3aGljaCBkb2Vzbid0IHdvcmsKICAgICAgICAgICAgICAgIGlmIChvcHRzLm1heCA9PSBudWxsIHx8IG9wdHMubWluICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgbWF4ICs9IHdpZGVuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8gY29uc2lkZXIgYXV0b3NjYWxpbmcKICAgICAgICAgICAgICAgIHZhciBtYXJnaW4gPSBvcHRzLmF1dG9zY2FsZU1hcmdpbjsKICAgICAgICAgICAgICAgIGlmIChtYXJnaW4gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGlmIChvcHRzLm1pbiA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1pbiAtPSBkZWx0YSAqIG1hcmdpbjsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHdlIGRvbid0IGdvIGJlbG93IHplcm8gaWYgYWxsIHZhbHVlcwogICAgICAgICAgICAgICAgICAgICAgICAvLyBhcmUgcG9zaXRpdmUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1pbiA8IDAgJiYgYXhpcy5kYXRhbWluICE9IG51bGwgJiYgYXhpcy5kYXRhbWluID49IDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW4gPSAwOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAob3B0cy5tYXggPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBtYXggKz0gZGVsdGEgKiBtYXJnaW47CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXggPiAwICYmIGF4aXMuZGF0YW1heCAhPSBudWxsICYmIGF4aXMuZGF0YW1heCA8PSAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4ID0gMDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXhpcy5taW4gPSBtaW47CiAgICAgICAgICAgIGF4aXMubWF4ID0gbWF4OwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2V0dXBUaWNrR2VuZXJhdGlvbihheGlzKSB7CiAgICAgICAgICAgIHZhciBvcHRzID0gYXhpcy5vcHRpb25zOwoKICAgICAgICAgICAgLy8gZXN0aW1hdGUgbnVtYmVyIG9mIHRpY2tzCiAgICAgICAgICAgIHZhciBub1RpY2tzOwogICAgICAgICAgICBpZiAodHlwZW9mIG9wdHMudGlja3MgPT0gIm51bWJlciIgJiYgb3B0cy50aWNrcyA+IDApCiAgICAgICAgICAgICAgICBub1RpY2tzID0gb3B0cy50aWNrczsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgLy8gaGV1cmlzdGljIGJhc2VkIG9uIHRoZSBtb2RlbCBhKnNxcnQoeCkgZml0dGVkIHRvCiAgICAgICAgICAgICAgICAvLyBzb21lIGRhdGEgcG9pbnRzIHRoYXQgc2VlbWVkIHJlYXNvbmFibGUKICAgICAgICAgICAgICAgIG5vVGlja3MgPSAwLjMgKiBNYXRoLnNxcnQoYXhpcy5kaXJlY3Rpb24gPT0gIngiID8gc3VyZmFjZS53aWR0aCA6IHN1cmZhY2UuaGVpZ2h0KTsKCiAgICAgICAgICAgIHZhciBkZWx0YSA9IChheGlzLm1heCAtIGF4aXMubWluKSAvIG5vVGlja3MsCiAgICAgICAgICAgICAgICBkZWMgPSAtTWF0aC5mbG9vcihNYXRoLmxvZyhkZWx0YSkgLyBNYXRoLkxOMTApLAogICAgICAgICAgICAgICAgbWF4RGVjID0gb3B0cy50aWNrRGVjaW1hbHM7CgogICAgICAgICAgICBpZiAobWF4RGVjICE9IG51bGwgJiYgZGVjID4gbWF4RGVjKSB7CiAgICAgICAgICAgICAgICBkZWMgPSBtYXhEZWM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBtYWduID0gTWF0aC5wb3coMTAsIC1kZWMpLAogICAgICAgICAgICAgICAgbm9ybSA9IGRlbHRhIC8gbWFnbiwgLy8gbm9ybSBpcyBiZXR3ZWVuIDEuMCBhbmQgMTAuMAogICAgICAgICAgICAgICAgc2l6ZTsKCiAgICAgICAgICAgIGlmIChub3JtIDwgMS41KSB7CiAgICAgICAgICAgICAgICBzaXplID0gMTsKICAgICAgICAgICAgfSBlbHNlIGlmIChub3JtIDwgMykgewogICAgICAgICAgICAgICAgc2l6ZSA9IDI7CiAgICAgICAgICAgICAgICAvLyBzcGVjaWFsIGNhc2UgZm9yIDIuNSwgcmVxdWlyZXMgYW4gZXh0cmEgZGVjaW1hbAogICAgICAgICAgICAgICAgaWYgKG5vcm0gPiAyLjI1ICYmIChtYXhEZWMgPT0gbnVsbCB8fCBkZWMgKyAxIDw9IG1heERlYykpIHsKICAgICAgICAgICAgICAgICAgICBzaXplID0gMi41OwogICAgICAgICAgICAgICAgICAgICsrZGVjOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKG5vcm0gPCA3LjUpIHsKICAgICAgICAgICAgICAgIHNpemUgPSA1OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2l6ZSA9IDEwOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzaXplICo9IG1hZ247CgogICAgICAgICAgICBpZiAob3B0cy5taW5UaWNrU2l6ZSAhPSBudWxsICYmIHNpemUgPCBvcHRzLm1pblRpY2tTaXplKSB7CiAgICAgICAgICAgICAgICBzaXplID0gb3B0cy5taW5UaWNrU2l6ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYXhpcy5kZWx0YSA9IGRlbHRhOwogICAgICAgICAgICBheGlzLnRpY2tEZWNpbWFscyA9IE1hdGgubWF4KDAsIG1heERlYyAhPSBudWxsID8gbWF4RGVjIDogZGVjKTsKICAgICAgICAgICAgYXhpcy50aWNrU2l6ZSA9IG9wdHMudGlja1NpemUgfHwgc2l6ZTsKCiAgICAgICAgICAgIC8vIFRpbWUgbW9kZSB3YXMgbW92ZWQgdG8gYSBwbHVnLWluIGluIDAuOCwgYW5kIHNpbmNlIHNvIG1hbnkgcGVvcGxlIHVzZSBpdAogICAgICAgICAgICAvLyB3ZSdsbCBhZGQgYW4gZXNwZWNpYWxseSBmcmllbmRseSByZW1pbmRlciB0byBtYWtlIHN1cmUgdGhleSBpbmNsdWRlZCBpdC4KCiAgICAgICAgICAgIGlmIChvcHRzLm1vZGUgPT0gInRpbWUiICYmICFheGlzLnRpY2tHZW5lcmF0b3IpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVGltZSBtb2RlIHJlcXVpcmVzIHRoZSBmbG90LnRpbWUgcGx1Z2luLiIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBGbG90IHN1cHBvcnRzIGJhc2UtMTAgYXhlczsgYW55IG90aGVyIG1vZGUgZWxzZSBpcyBoYW5kbGVkIGJ5IGEgcGx1Zy1pbiwKICAgICAgICAgICAgLy8gbGlrZSBmbG90LnRpbWUuanMuCgogICAgICAgICAgICBpZiAoIWF4aXMudGlja0dlbmVyYXRvcikgewoKICAgICAgICAgICAgICAgIGF4aXMudGlja0dlbmVyYXRvciA9IGZ1bmN0aW9uIChheGlzKSB7CgogICAgICAgICAgICAgICAgICAgIHZhciB0aWNrcyA9IFtdLAogICAgICAgICAgICAgICAgICAgICAgICBzdGFydCA9IGZsb29ySW5CYXNlKGF4aXMubWluLCBheGlzLnRpY2tTaXplKSwKICAgICAgICAgICAgICAgICAgICAgICAgaSA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIHYgPSBOdW1iZXIuTmFOLAogICAgICAgICAgICAgICAgICAgICAgICBwcmV2OwoKICAgICAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByZXYgPSB2OwogICAgICAgICAgICAgICAgICAgICAgICB2ID0gc3RhcnQgKyBpICogYXhpcy50aWNrU2l6ZTsKICAgICAgICAgICAgICAgICAgICAgICAgdGlja3MucHVzaCh2KTsKICAgICAgICAgICAgICAgICAgICAgICAgKytpOwogICAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKHYgPCBheGlzLm1heCAmJiB2ICE9IHByZXYpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aWNrczsKICAgICAgICAgICAgICAgIH07CgoJCQkJYXhpcy50aWNrRm9ybWF0dGVyID0gZnVuY3Rpb24gKHZhbHVlLCBheGlzKSB7CgoJCQkJCXZhciBmYWN0b3IgPSBheGlzLnRpY2tEZWNpbWFscyA/IE1hdGgucG93KDEwLCBheGlzLnRpY2tEZWNpbWFscykgOiAxOwoJCQkJCXZhciBmb3JtYXR0ZWQgPSAiIiArIE1hdGgucm91bmQodmFsdWUgKiBmYWN0b3IpIC8gZmFjdG9yOwoKCQkJCQkvLyBJZiB0aWNrRGVjaW1hbHMgd2FzIHNwZWNpZmllZCwgZW5zdXJlIHRoYXQgd2UgaGF2ZSBleGFjdGx5IHRoYXQKCQkJCQkvLyBtdWNoIHByZWNpc2lvbjsgb3RoZXJ3aXNlIGRlZmF1bHQgdG8gdGhlIHZhbHVlJ3Mgb3duIHByZWNpc2lvbi4KCgkJCQkJaWYgKGF4aXMudGlja0RlY2ltYWxzICE9IG51bGwpIHsKCQkJCQkJdmFyIGRlY2ltYWwgPSBmb3JtYXR0ZWQuaW5kZXhPZigiLiIpOwoJCQkJCQl2YXIgcHJlY2lzaW9uID0gZGVjaW1hbCA9PSAtMSA/IDAgOiBmb3JtYXR0ZWQubGVuZ3RoIC0gZGVjaW1hbCAtIDE7CgkJCQkJCWlmIChwcmVjaXNpb24gPCBheGlzLnRpY2tEZWNpbWFscykgewoJCQkJCQkJcmV0dXJuIChwcmVjaXNpb24gPyBmb3JtYXR0ZWQgOiBmb3JtYXR0ZWQgKyAiLiIpICsgKCIiICsgZmFjdG9yKS5zdWJzdHIoMSwgYXhpcy50aWNrRGVjaW1hbHMgLSBwcmVjaXNpb24pOwoJCQkJCQl9CgkJCQkJfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm9ybWF0dGVkOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCQuaXNGdW5jdGlvbihvcHRzLnRpY2tGb3JtYXR0ZXIpKQogICAgICAgICAgICAgICAgYXhpcy50aWNrRm9ybWF0dGVyID0gZnVuY3Rpb24gKHYsIGF4aXMpIHsgcmV0dXJuICIiICsgb3B0cy50aWNrRm9ybWF0dGVyKHYsIGF4aXMpOyB9OwoKICAgICAgICAgICAgaWYgKG9wdHMuYWxpZ25UaWNrc1dpdGhBeGlzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHZhciBvdGhlckF4aXMgPSAoYXhpcy5kaXJlY3Rpb24gPT0gIngiID8geGF4ZXMgOiB5YXhlcylbb3B0cy5hbGlnblRpY2tzV2l0aEF4aXMgLSAxXTsKICAgICAgICAgICAgICAgIGlmIChvdGhlckF4aXMgJiYgb3RoZXJBeGlzLnVzZWQgJiYgb3RoZXJBeGlzICE9IGF4aXMpIHsKICAgICAgICAgICAgICAgICAgICAvLyBjb25zaWRlciBzbmFwcGluZyBtaW4vbWF4IHRvIG91dGVybW9zdCBuaWNlIHRpY2tzCiAgICAgICAgICAgICAgICAgICAgdmFyIG5pY2VUaWNrcyA9IGF4aXMudGlja0dlbmVyYXRvcihheGlzKTsKICAgICAgICAgICAgICAgICAgICBpZiAobmljZVRpY2tzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdHMubWluID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBheGlzLm1pbiA9IE1hdGgubWluKGF4aXMubWluLCBuaWNlVGlja3NbMF0pOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0cy5tYXggPT0gbnVsbCAmJiBuaWNlVGlja3MubGVuZ3RoID4gMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF4aXMubWF4ID0gTWF0aC5tYXgoYXhpcy5tYXgsIG5pY2VUaWNrc1tuaWNlVGlja3MubGVuZ3RoIC0gMV0pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgYXhpcy50aWNrR2VuZXJhdG9yID0gZnVuY3Rpb24gKGF4aXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29weSB0aWNrcywgc2NhbGVkIHRvIHRoaXMgYXhpcwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGlja3MgPSBbXSwgdiwgaTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IG90aGVyQXhpcy50aWNrcy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdiA9IChvdGhlckF4aXMudGlja3NbaV0udiAtIG90aGVyQXhpcy5taW4pIC8gKG90aGVyQXhpcy5tYXggLSBvdGhlckF4aXMubWluKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYgPSBheGlzLm1pbiArIHYgKiAoYXhpcy5tYXggLSBheGlzLm1pbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aWNrcy5wdXNoKHYpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aWNrczsKICAgICAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgICAvLyB3ZSBtaWdodCBuZWVkIGFuIGV4dHJhIGRlY2ltYWwgc2luY2UgZm9yY2VkCiAgICAgICAgICAgICAgICAgICAgLy8gdGlja3MgZG9uJ3QgbmVjZXNzYXJpbHkgZml0IG5hdHVyYWxseQogICAgICAgICAgICAgICAgICAgIGlmICghYXhpcy5tb2RlICYmIG9wdHMudGlja0RlY2ltYWxzID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGV4dHJhRGVjID0gTWF0aC5tYXgoMCwgLU1hdGguZmxvb3IoTWF0aC5sb2coYXhpcy5kZWx0YSkgLyBNYXRoLkxOMTApICsgMSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cyA9IGF4aXMudGlja0dlbmVyYXRvcihheGlzKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9ubHkgcHJvY2VlZCBpZiB0aGUgdGljayBpbnRlcnZhbCByb3VuZGVkCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdpdGggYW4gZXh0cmEgZGVjaW1hbCBkb2Vzbid0IGdpdmUgdXMgYQogICAgICAgICAgICAgICAgICAgICAgICAvLyB6ZXJvIGF0IGVuZAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoISh0cy5sZW5ndGggPiAxICYmIC9cLi4qMCQvLnRlc3QoKHRzWzFdIC0gdHNbMF0pLnRvRml4ZWQoZXh0cmFEZWMpKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBheGlzLnRpY2tEZWNpbWFscyA9IGV4dHJhRGVjOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2V0VGlja3MoYXhpcykgewogICAgICAgICAgICB2YXIgb3RpY2tzID0gYXhpcy5vcHRpb25zLnRpY2tzLCB0aWNrcyA9IFtdOwogICAgICAgICAgICBpZiAob3RpY2tzID09IG51bGwgfHwgKHR5cGVvZiBvdGlja3MgPT0gIm51bWJlciIgJiYgb3RpY2tzID4gMCkpCiAgICAgICAgICAgICAgICB0aWNrcyA9IGF4aXMudGlja0dlbmVyYXRvcihheGlzKTsKICAgICAgICAgICAgZWxzZSBpZiAob3RpY2tzKSB7CiAgICAgICAgICAgICAgICBpZiAoJC5pc0Z1bmN0aW9uKG90aWNrcykpCiAgICAgICAgICAgICAgICAgICAgLy8gZ2VuZXJhdGUgdGhlIHRpY2tzCiAgICAgICAgICAgICAgICAgICAgdGlja3MgPSBvdGlja3MoYXhpcyk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgdGlja3MgPSBvdGlja3M7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGNsZWFuIHVwL2xhYmVsaWZ5IHRoZSBzdXBwbGllZCB0aWNrcywgY29weSB0aGVtIG92ZXIKICAgICAgICAgICAgdmFyIGksIHY7CiAgICAgICAgICAgIGF4aXMudGlja3MgPSBbXTsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHRpY2tzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgICAgICB2YXIgbGFiZWwgPSBudWxsOwogICAgICAgICAgICAgICAgdmFyIHQgPSB0aWNrc1tpXTsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdCA9PSAib2JqZWN0IikgewogICAgICAgICAgICAgICAgICAgIHYgPSArdFswXTsKICAgICAgICAgICAgICAgICAgICBpZiAodC5sZW5ndGggPiAxKQogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCA9IHRbMV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgdiA9ICt0OwogICAgICAgICAgICAgICAgaWYgKGxhYmVsID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgbGFiZWwgPSBheGlzLnRpY2tGb3JtYXR0ZXIodiwgYXhpcyk7CiAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKHYpKQogICAgICAgICAgICAgICAgICAgIGF4aXMudGlja3MucHVzaCh7IHY6IHYsIGxhYmVsOiBsYWJlbCB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc25hcFJhbmdlVG9UaWNrcyhheGlzLCB0aWNrcykgewogICAgICAgICAgICBpZiAoYXhpcy5vcHRpb25zLmF1dG9zY2FsZU1hcmdpbiAmJiB0aWNrcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAvLyBzbmFwIHRvIHRpY2tzCiAgICAgICAgICAgICAgICBpZiAoYXhpcy5vcHRpb25zLm1pbiA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGF4aXMubWluID0gTWF0aC5taW4oYXhpcy5taW4sIHRpY2tzWzBdLnYpOwogICAgICAgICAgICAgICAgaWYgKGF4aXMub3B0aW9ucy5tYXggPT0gbnVsbCAmJiB0aWNrcy5sZW5ndGggPiAxKQogICAgICAgICAgICAgICAgICAgIGF4aXMubWF4ID0gTWF0aC5tYXgoYXhpcy5tYXgsIHRpY2tzW3RpY2tzLmxlbmd0aCAtIDFdLnYpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBkcmF3KCkgewoKICAgICAgICAgICAgc3VyZmFjZS5jbGVhcigpOwoKICAgICAgICAgICAgZXhlY3V0ZUhvb2tzKGhvb2tzLmRyYXdCYWNrZ3JvdW5kLCBbY3R4XSk7CgogICAgICAgICAgICB2YXIgZ3JpZCA9IG9wdGlvbnMuZ3JpZDsKCiAgICAgICAgICAgIC8vIGRyYXcgYmFja2dyb3VuZCwgaWYgYW55CiAgICAgICAgICAgIGlmIChncmlkLnNob3cgJiYgZ3JpZC5iYWNrZ3JvdW5kQ29sb3IpCiAgICAgICAgICAgICAgICBkcmF3QmFja2dyb3VuZCgpOwoKICAgICAgICAgICAgaWYgKGdyaWQuc2hvdyAmJiAhZ3JpZC5hYm92ZURhdGEpIHsKICAgICAgICAgICAgICAgIGRyYXdHcmlkKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VyaWVzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgICAgICBleGVjdXRlSG9va3MoaG9va3MuZHJhd1NlcmllcywgW2N0eCwgc2VyaWVzW2ldXSk7CiAgICAgICAgICAgICAgICBkcmF3U2VyaWVzKHNlcmllc1tpXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGV4ZWN1dGVIb29rcyhob29rcy5kcmF3LCBbY3R4XSk7CgogICAgICAgICAgICBpZiAoZ3JpZC5zaG93ICYmIGdyaWQuYWJvdmVEYXRhKSB7CiAgICAgICAgICAgICAgICBkcmF3R3JpZCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzdXJmYWNlLnJlbmRlcigpOwoKICAgICAgICAgICAgLy8gQSBkcmF3IGltcGxpZXMgdGhhdCBlaXRoZXIgdGhlIGF4ZXMgb3IgZGF0YSBoYXZlIGNoYW5nZWQsIHNvIHdlCiAgICAgICAgICAgIC8vIHNob3VsZCBwcm9iYWJseSB1cGRhdGUgdGhlIG92ZXJsYXkgaGlnaGxpZ2h0cyBhcyB3ZWxsLgoKICAgICAgICAgICAgdHJpZ2dlclJlZHJhd092ZXJsYXkoKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGV4dHJhY3RSYW5nZShyYW5nZXMsIGNvb3JkKSB7CiAgICAgICAgICAgIHZhciBheGlzLCBmcm9tLCB0bywga2V5LCBheGVzID0gYWxsQXhlcygpOwoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBheGVzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgICAgICBheGlzID0gYXhlc1tpXTsKICAgICAgICAgICAgICAgIGlmIChheGlzLmRpcmVjdGlvbiA9PSBjb29yZCkgewogICAgICAgICAgICAgICAgICAgIGtleSA9IGNvb3JkICsgYXhpcy5uICsgImF4aXMiOwogICAgICAgICAgICAgICAgICAgIGlmICghcmFuZ2VzW2tleV0gJiYgYXhpcy5uID09IDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGtleSA9IGNvb3JkICsgImF4aXMiOyAvLyBzdXBwb3J0IHgxYXhpcyBhcyB4YXhpcwogICAgICAgICAgICAgICAgICAgIGlmIChyYW5nZXNba2V5XSkgewogICAgICAgICAgICAgICAgICAgICAgICBmcm9tID0gcmFuZ2VzW2tleV0uZnJvbTsKICAgICAgICAgICAgICAgICAgICAgICAgdG8gPSByYW5nZXNba2V5XS50bzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBiYWNrd2FyZHMtY29tcGF0IHN0dWZmIC0gdG8gYmUgcmVtb3ZlZCBpbiBmdXR1cmUKICAgICAgICAgICAgaWYgKCFyYW5nZXNba2V5XSkgewogICAgICAgICAgICAgICAgYXhpcyA9IGNvb3JkID09ICJ4IiA/IHhheGVzWzBdIDogeWF4ZXNbMF07CiAgICAgICAgICAgICAgICBmcm9tID0gcmFuZ2VzW2Nvb3JkICsgIjEiXTsKICAgICAgICAgICAgICAgIHRvID0gcmFuZ2VzW2Nvb3JkICsgIjIiXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gYXV0by1yZXZlcnNlIGFzIGFuIGFkZGVkIGJvbnVzCiAgICAgICAgICAgIGlmIChmcm9tICE9IG51bGwgJiYgdG8gIT0gbnVsbCAmJiBmcm9tID4gdG8pIHsKICAgICAgICAgICAgICAgIHZhciB0bXAgPSBmcm9tOwogICAgICAgICAgICAgICAgZnJvbSA9IHRvOwogICAgICAgICAgICAgICAgdG8gPSB0bXA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB7IGZyb206IGZyb20sIHRvOiB0bywgYXhpczogYXhpcyB9OwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZHJhd0JhY2tncm91bmQoKSB7CiAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUocGxvdE9mZnNldC5sZWZ0LCBwbG90T2Zmc2V0LnRvcCk7CgogICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gZ2V0Q29sb3JPckdyYWRpZW50KG9wdGlvbnMuZ3JpZC5iYWNrZ3JvdW5kQ29sb3IsIHBsb3RIZWlnaHQsIDAsICJyZ2JhKDI1NSwgMjU1LCAyNTUsIDApIik7CiAgICAgICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCBwbG90V2lkdGgsIHBsb3RIZWlnaHQpOwogICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZHJhd0dyaWQoKSB7CiAgICAgICAgICAgIHZhciBpLCBheGVzLCBidywgYmM7CgogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHgudHJhbnNsYXRlKHBsb3RPZmZzZXQubGVmdCwgcGxvdE9mZnNldC50b3ApOwoKICAgICAgICAgICAgLy8gZHJhdyBtYXJraW5ncwogICAgICAgICAgICB2YXIgbWFya2luZ3MgPSBvcHRpb25zLmdyaWQubWFya2luZ3M7CiAgICAgICAgICAgIGlmIChtYXJraW5ncykgewogICAgICAgICAgICAgICAgaWYgKCQuaXNGdW5jdGlvbihtYXJraW5ncykpIHsKICAgICAgICAgICAgICAgICAgICBheGVzID0gcGxvdC5nZXRBeGVzKCk7CiAgICAgICAgICAgICAgICAgICAgLy8geG1pbiBldGMuIGlzIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LCB0byBiZQogICAgICAgICAgICAgICAgICAgIC8vIHJlbW92ZWQgaW4gdGhlIGZ1dHVyZQogICAgICAgICAgICAgICAgICAgIGF4ZXMueG1pbiA9IGF4ZXMueGF4aXMubWluOwogICAgICAgICAgICAgICAgICAgIGF4ZXMueG1heCA9IGF4ZXMueGF4aXMubWF4OwogICAgICAgICAgICAgICAgICAgIGF4ZXMueW1pbiA9IGF4ZXMueWF4aXMubWluOwogICAgICAgICAgICAgICAgICAgIGF4ZXMueW1heCA9IGF4ZXMueWF4aXMubWF4OwoKICAgICAgICAgICAgICAgICAgICBtYXJraW5ncyA9IG1hcmtpbmdzKGF4ZXMpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBtYXJraW5ncy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgICAgIHZhciBtID0gbWFya2luZ3NbaV0sCiAgICAgICAgICAgICAgICAgICAgICAgIHhyYW5nZSA9IGV4dHJhY3RSYW5nZShtLCAieCIpLAogICAgICAgICAgICAgICAgICAgICAgICB5cmFuZ2UgPSBleHRyYWN0UmFuZ2UobSwgInkiKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gZmlsbCBpbiBtaXNzaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgKHhyYW5nZS5mcm9tID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHhyYW5nZS5mcm9tID0geHJhbmdlLmF4aXMubWluOwogICAgICAgICAgICAgICAgICAgIGlmICh4cmFuZ2UudG8gPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgeHJhbmdlLnRvID0geHJhbmdlLmF4aXMubWF4OwogICAgICAgICAgICAgICAgICAgIGlmICh5cmFuZ2UuZnJvbSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICB5cmFuZ2UuZnJvbSA9IHlyYW5nZS5heGlzLm1pbjsKICAgICAgICAgICAgICAgICAgICBpZiAoeXJhbmdlLnRvID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHlyYW5nZS50byA9IHlyYW5nZS5heGlzLm1heDsKCiAgICAgICAgICAgICAgICAgICAgLy8gY2xpcAogICAgICAgICAgICAgICAgICAgIGlmICh4cmFuZ2UudG8gPCB4cmFuZ2UuYXhpcy5taW4gfHwgeHJhbmdlLmZyb20gPiB4cmFuZ2UuYXhpcy5tYXggfHwKICAgICAgICAgICAgICAgICAgICAgICAgeXJhbmdlLnRvIDwgeXJhbmdlLmF4aXMubWluIHx8IHlyYW5nZS5mcm9tID4geXJhbmdlLmF4aXMubWF4KQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAgeHJhbmdlLmZyb20gPSBNYXRoLm1heCh4cmFuZ2UuZnJvbSwgeHJhbmdlLmF4aXMubWluKTsKICAgICAgICAgICAgICAgICAgICB4cmFuZ2UudG8gPSBNYXRoLm1pbih4cmFuZ2UudG8sIHhyYW5nZS5heGlzLm1heCk7CiAgICAgICAgICAgICAgICAgICAgeXJhbmdlLmZyb20gPSBNYXRoLm1heCh5cmFuZ2UuZnJvbSwgeXJhbmdlLmF4aXMubWluKTsKICAgICAgICAgICAgICAgICAgICB5cmFuZ2UudG8gPSBNYXRoLm1pbih5cmFuZ2UudG8sIHlyYW5nZS5heGlzLm1heCk7CgogICAgICAgICAgICAgICAgICAgIHZhciB4ZXF1YWwgPSB4cmFuZ2UuZnJvbSA9PT0geHJhbmdlLnRvLAogICAgICAgICAgICAgICAgICAgICAgICB5ZXF1YWwgPSB5cmFuZ2UuZnJvbSA9PT0geXJhbmdlLnRvOwoKICAgICAgICAgICAgICAgICAgICBpZiAoeGVxdWFsICYmIHllcXVhbCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIHRoZW4gZHJhdwogICAgICAgICAgICAgICAgICAgIHhyYW5nZS5mcm9tID0gTWF0aC5mbG9vcih4cmFuZ2UuYXhpcy5wMmMoeHJhbmdlLmZyb20pKTsKICAgICAgICAgICAgICAgICAgICB4cmFuZ2UudG8gPSBNYXRoLmZsb29yKHhyYW5nZS5heGlzLnAyYyh4cmFuZ2UudG8pKTsKICAgICAgICAgICAgICAgICAgICB5cmFuZ2UuZnJvbSA9IE1hdGguZmxvb3IoeXJhbmdlLmF4aXMucDJjKHlyYW5nZS5mcm9tKSk7CiAgICAgICAgICAgICAgICAgICAgeXJhbmdlLnRvID0gTWF0aC5mbG9vcih5cmFuZ2UuYXhpcy5wMmMoeXJhbmdlLnRvKSk7CgogICAgICAgICAgICAgICAgICAgIGlmICh4ZXF1YWwgfHwgeWVxdWFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsaW5lV2lkdGggPSBtLmxpbmVXaWR0aCB8fCBvcHRpb25zLmdyaWQubWFya2luZ3NMaW5lV2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJQaXhlbCA9IGxpbmVXaWR0aCAlIDIgPyAwLjUgOiAwOwogICAgICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9IG0uY29sb3IgfHwgb3B0aW9ucy5ncmlkLm1hcmtpbmdzQ29sb3I7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSBsaW5lV2lkdGg7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh4ZXF1YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5tb3ZlVG8oeHJhbmdlLnRvICsgc3ViUGl4ZWwsIHlyYW5nZS5mcm9tKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5saW5lVG8oeHJhbmdlLnRvICsgc3ViUGl4ZWwsIHlyYW5nZS50byk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgubW92ZVRvKHhyYW5nZS5mcm9tLCB5cmFuZ2UudG8gKyBzdWJQaXhlbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgubGluZVRvKHhyYW5nZS50bywgeXJhbmdlLnRvICsgc3ViUGl4ZWwpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IG0uY29sb3IgfHwgb3B0aW9ucy5ncmlkLm1hcmtpbmdzQ29sb3I7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5maWxsUmVjdCh4cmFuZ2UuZnJvbSwgeXJhbmdlLnRvLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeHJhbmdlLnRvIC0geHJhbmdlLmZyb20sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5cmFuZ2UuZnJvbSAtIHlyYW5nZS50byk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBkcmF3IHRoZSB0aWNrcwogICAgICAgICAgICBheGVzID0gYWxsQXhlcygpOwogICAgICAgICAgICBidyA9IG9wdGlvbnMuZ3JpZC5ib3JkZXJXaWR0aDsKCiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgYXhlcy5sZW5ndGg7ICsraikgewogICAgICAgICAgICAgICAgdmFyIGF4aXMgPSBheGVzW2pdLCBib3ggPSBheGlzLmJveCwKICAgICAgICAgICAgICAgICAgICB0ID0gYXhpcy50aWNrTGVuZ3RoLCB4LCB5LCB4b2ZmLCB5b2ZmOwogICAgICAgICAgICAgICAgaWYgKCFheGlzLnNob3cgfHwgYXhpcy50aWNrcy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICBjdHgubGluZVdpZHRoID0gMTsKCiAgICAgICAgICAgICAgICAvLyBmaW5kIHRoZSBlZGdlcwogICAgICAgICAgICAgICAgaWYgKGF4aXMuZGlyZWN0aW9uID09ICJ4IikgewogICAgICAgICAgICAgICAgICAgIHggPSAwOwogICAgICAgICAgICAgICAgICAgIGlmICh0ID09ICJmdWxsIikKICAgICAgICAgICAgICAgICAgICAgICAgeSA9IChheGlzLnBvc2l0aW9uID09ICJ0b3AiID8gMCA6IHBsb3RIZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgeSA9IGJveC50b3AgLSBwbG90T2Zmc2V0LnRvcCArIChheGlzLnBvc2l0aW9uID09ICJ0b3AiID8gYm94LmhlaWdodCA6IDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgeSA9IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKHQgPT0gImZ1bGwiKQogICAgICAgICAgICAgICAgICAgICAgICB4ID0gKGF4aXMucG9zaXRpb24gPT0gImxlZnQiID8gMCA6IHBsb3RXaWR0aCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICB4ID0gYm94LmxlZnQgLSBwbG90T2Zmc2V0LmxlZnQgKyAoYXhpcy5wb3NpdGlvbiA9PSAibGVmdCIgPyBib3gud2lkdGggOiAwKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBkcmF3IHRpY2sgYmFyCiAgICAgICAgICAgICAgICBpZiAoIWF4aXMuaW5uZXJtb3N0KSB7CiAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gYXhpcy5vcHRpb25zLmNvbG9yOwogICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgICAgICB4b2ZmID0geW9mZiA9IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKGF4aXMuZGlyZWN0aW9uID09ICJ4IikKICAgICAgICAgICAgICAgICAgICAgICAgeG9mZiA9IHBsb3RXaWR0aCArIDE7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICB5b2ZmID0gcGxvdEhlaWdodCArIDE7CgogICAgICAgICAgICAgICAgICAgIGlmIChjdHgubGluZVdpZHRoID09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF4aXMuZGlyZWN0aW9uID09ICJ4IikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgeSA9IE1hdGguZmxvb3IoeSkgKyAwLjU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4ID0gTWF0aC5mbG9vcih4KSArIDAuNTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY3R4Lm1vdmVUbyh4LCB5KTsKICAgICAgICAgICAgICAgICAgICBjdHgubGluZVRvKHggKyB4b2ZmLCB5ICsgeW9mZik7CiAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGRyYXcgdGlja3MKCiAgICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSBheGlzLm9wdGlvbnMudGlja0NvbG9yOwoKICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBheGlzLnRpY2tzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHYgPSBheGlzLnRpY2tzW2ldLnY7CgogICAgICAgICAgICAgICAgICAgIHhvZmYgPSB5b2ZmID0gMDsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTmFOKHYpIHx8IHYgPCBheGlzLm1pbiB8fCB2ID4gYXhpcy5tYXgKICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2tpcCB0aG9zZSBseWluZyBvbiB0aGUgYXhlcyBpZiB3ZSBnb3QgYSBib3JkZXIKICAgICAgICAgICAgICAgICAgICAgICAgfHwgKHQgPT0gImZ1bGwiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiAoKHR5cGVvZiBidyA9PSAib2JqZWN0IiAmJiBid1theGlzLnBvc2l0aW9uXSA+IDApIHx8IGJ3ID4gMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmICh2ID09IGF4aXMubWluIHx8IHYgPT0gYXhpcy5tYXgpKSkKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgIGlmIChheGlzLmRpcmVjdGlvbiA9PSAieCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgeCA9IGF4aXMucDJjKHYpOwogICAgICAgICAgICAgICAgICAgICAgICB5b2ZmID0gdCA9PSAiZnVsbCIgPyAtcGxvdEhlaWdodCA6IHQ7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXhpcy5wb3NpdGlvbiA9PSAidG9wIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlvZmYgPSAteW9mZjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHkgPSBheGlzLnAyYyh2KTsKICAgICAgICAgICAgICAgICAgICAgICAgeG9mZiA9IHQgPT0gImZ1bGwiID8gLXBsb3RXaWR0aCA6IHQ7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXhpcy5wb3NpdGlvbiA9PSAibGVmdCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4b2ZmID0gLXhvZmY7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoY3R4LmxpbmVXaWR0aCA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChheGlzLmRpcmVjdGlvbiA9PSAieCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4ID0gTWF0aC5mbG9vcih4KSArIDAuNTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeSA9IE1hdGguZmxvb3IoeSkgKyAwLjU7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBjdHgubW92ZVRvKHgsIHkpOwogICAgICAgICAgICAgICAgICAgIGN0eC5saW5lVG8oeCArIHhvZmYsIHkgKyB5b2ZmKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgICAgIH0KCgogICAgICAgICAgICAvLyBkcmF3IGJvcmRlcgogICAgICAgICAgICBpZiAoYncpIHsKICAgICAgICAgICAgICAgIC8vIElmIGVpdGhlciBib3JkZXJXaWR0aCBvciBib3JkZXJDb2xvciBpcyBhbiBvYmplY3QsIHRoZW4gZHJhdyB0aGUgYm9yZGVyCiAgICAgICAgICAgICAgICAvLyBsaW5lIGJ5IGxpbmUgaW5zdGVhZCBvZiBhcyBvbmUgcmVjdGFuZ2xlCiAgICAgICAgICAgICAgICBiYyA9IG9wdGlvbnMuZ3JpZC5ib3JkZXJDb2xvcjsKICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBidyA9PSAib2JqZWN0IiB8fCB0eXBlb2YgYmMgPT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGJ3ICE9PSAib2JqZWN0IikgewogICAgICAgICAgICAgICAgICAgICAgICBidyA9IHt0b3A6IGJ3LCByaWdodDogYncsIGJvdHRvbTogYncsIGxlZnQ6IGJ3fTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBiYyAhPT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYmMgPSB7dG9wOiBiYywgcmlnaHQ6IGJjLCBib3R0b206IGJjLCBsZWZ0OiBiY307CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoYncudG9wID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSBiYy50b3A7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSBidy50b3A7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4Lm1vdmVUbygwIC0gYncubGVmdCwgMCAtIGJ3LnRvcC8yKTsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVUbyhwbG90V2lkdGgsIDAgLSBidy50b3AvMik7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChidy5yaWdodCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gYmMucmlnaHQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSBidy5yaWdodDsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICAgICAgICAgICAgICBjdHgubW92ZVRvKHBsb3RXaWR0aCArIGJ3LnJpZ2h0IC8gMiwgMCAtIGJ3LnRvcCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5saW5lVG8ocGxvdFdpZHRoICsgYncucmlnaHQgLyAyLCBwbG90SGVpZ2h0KTsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKGJ3LmJvdHRvbSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gYmMuYm90dG9tOwogICAgICAgICAgICAgICAgICAgICAgICBjdHgubGluZVdpZHRoID0gYncuYm90dG9tOwogICAgICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5tb3ZlVG8ocGxvdFdpZHRoICsgYncucmlnaHQsIHBsb3RIZWlnaHQgKyBidy5ib3R0b20gLyAyKTsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVUbygwLCBwbG90SGVpZ2h0ICsgYncuYm90dG9tIC8gMik7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChidy5sZWZ0ID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSBiYy5sZWZ0OwogICAgICAgICAgICAgICAgICAgICAgICBjdHgubGluZVdpZHRoID0gYncubGVmdDsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICAgICAgICAgICAgICBjdHgubW92ZVRvKDAgLSBidy5sZWZ0LzIsIHBsb3RIZWlnaHQgKyBidy5ib3R0b20pOwogICAgICAgICAgICAgICAgICAgICAgICBjdHgubGluZVRvKDAtIGJ3LmxlZnQvMiwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjdHgubGluZVdpZHRoID0gYnc7CiAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gb3B0aW9ucy5ncmlkLmJvcmRlckNvbG9yOwogICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2VSZWN0KC1idy8yLCAtYncvMiwgcGxvdFdpZHRoICsgYncsIHBsb3RIZWlnaHQgKyBidyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBkcmF3QXhpc0xhYmVscygpIHsKCiAgICAgICAgICAgICQuZWFjaChhbGxBeGVzKCksIGZ1bmN0aW9uIChfLCBheGlzKSB7CiAgICAgICAgICAgICAgICB2YXIgYm94ID0gYXhpcy5ib3gsCiAgICAgICAgICAgICAgICAgICAgbGVnYWN5U3R5bGVzID0gYXhpcy5kaXJlY3Rpb24gKyAiQXhpcyAiICsgYXhpcy5kaXJlY3Rpb24gKyBheGlzLm4gKyAiQXhpcyIsCiAgICAgICAgICAgICAgICAgICAgbGF5ZXIgPSAiZmxvdC0iICsgYXhpcy5kaXJlY3Rpb24gKyAiLWF4aXMgZmxvdC0iICsgYXhpcy5kaXJlY3Rpb24gKyBheGlzLm4gKyAiLWF4aXMgIiArIGxlZ2FjeVN0eWxlcywKICAgICAgICAgICAgICAgICAgICBmb250ID0gYXhpcy5vcHRpb25zLmZvbnQgfHwgImZsb3QtdGljay1sYWJlbCB0aWNrTGFiZWwiLAogICAgICAgICAgICAgICAgICAgIHRpY2ssIHgsIHksIGhhbGlnbiwgdmFsaWduOwoKICAgICAgICAgICAgICAgIC8vIFJlbW92ZSB0ZXh0IGJlZm9yZSBjaGVja2luZyBmb3IgYXhpcy5zaG93IGFuZCB0aWNrcy5sZW5ndGg7CiAgICAgICAgICAgICAgICAvLyBvdGhlcndpc2UgcGx1Z2lucywgbGlrZSBmbG90LXRpY2tyb3RvciwgdGhhdCBkcmF3IHRoZWlyIG93bgogICAgICAgICAgICAgICAgLy8gdGljayBsYWJlbHMgd2lsbCBlbmQgdXAgd2l0aCBib3RoIHRoZWlycyBhbmQgdGhlIGRlZmF1bHRzLgoKICAgICAgICAgICAgICAgIHN1cmZhY2UucmVtb3ZlVGV4dChsYXllcik7CgogICAgICAgICAgICAgICAgaWYgKCFheGlzLnNob3cgfHwgYXhpcy50aWNrcy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBheGlzLnRpY2tzLmxlbmd0aDsgKytpKSB7CgogICAgICAgICAgICAgICAgICAgIHRpY2sgPSBheGlzLnRpY2tzW2ldOwogICAgICAgICAgICAgICAgICAgIGlmICghdGljay5sYWJlbCB8fCB0aWNrLnYgPCBheGlzLm1pbiB8fCB0aWNrLnYgPiBheGlzLm1heCkKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgIGlmIChheGlzLmRpcmVjdGlvbiA9PSAieCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaGFsaWduID0gImNlbnRlciI7CiAgICAgICAgICAgICAgICAgICAgICAgIHggPSBwbG90T2Zmc2V0LmxlZnQgKyBheGlzLnAyYyh0aWNrLnYpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXhpcy5wb3NpdGlvbiA9PSAiYm90dG9tIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgeSA9IGJveC50b3AgKyBib3gucGFkZGluZzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSBib3gudG9wICsgYm94LmhlaWdodCAtIGJveC5wYWRkaW5nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWduID0gImJvdHRvbSI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB2YWxpZ24gPSAibWlkZGxlIjsKICAgICAgICAgICAgICAgICAgICAgICAgeSA9IHBsb3RPZmZzZXQudG9wICsgYXhpcy5wMmModGljay52KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF4aXMucG9zaXRpb24gPT0gImxlZnQiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4ID0gYm94LmxlZnQgKyBib3gud2lkdGggLSBib3gucGFkZGluZzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbGlnbiA9ICJyaWdodCI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4ID0gYm94LmxlZnQgKyBib3gucGFkZGluZzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgc3VyZmFjZS5hZGRUZXh0KGxheWVyLCB4LCB5LCB0aWNrLmxhYmVsLCBmb250LCBudWxsLCBudWxsLCBoYWxpZ24sIHZhbGlnbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZHJhd1NlcmllcyhzZXJpZXMpIHsKICAgICAgICAgICAgaWYgKHNlcmllcy5saW5lcy5zaG93KQogICAgICAgICAgICAgICAgZHJhd1Nlcmllc0xpbmVzKHNlcmllcyk7CiAgICAgICAgICAgIGlmIChzZXJpZXMuYmFycy5zaG93KQogICAgICAgICAgICAgICAgZHJhd1Nlcmllc0JhcnMoc2VyaWVzKTsKICAgICAgICAgICAgaWYgKHNlcmllcy5wb2ludHMuc2hvdykKICAgICAgICAgICAgICAgIGRyYXdTZXJpZXNQb2ludHMoc2VyaWVzKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGRyYXdTZXJpZXNMaW5lcyhzZXJpZXMpIHsKICAgICAgICAgICAgZnVuY3Rpb24gcGxvdExpbmUoZGF0YXBvaW50cywgeG9mZnNldCwgeW9mZnNldCwgYXhpc3gsIGF4aXN5KSB7CiAgICAgICAgICAgICAgICB2YXIgcG9pbnRzID0gZGF0YXBvaW50cy5wb2ludHMsCiAgICAgICAgICAgICAgICAgICAgcHMgPSBkYXRhcG9pbnRzLnBvaW50c2l6ZSwKICAgICAgICAgICAgICAgICAgICBwcmV2eCA9IG51bGwsIHByZXZ5ID0gbnVsbDsKCiAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gcHM7IGkgPCBwb2ludHMubGVuZ3RoOyBpICs9IHBzKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHgxID0gcG9pbnRzW2kgLSBwc10sIHkxID0gcG9pbnRzW2kgLSBwcyArIDFdLAogICAgICAgICAgICAgICAgICAgICAgICB4MiA9IHBvaW50c1tpXSwgeTIgPSBwb2ludHNbaSArIDFdOwoKICAgICAgICAgICAgICAgICAgICBpZiAoeDEgPT0gbnVsbCB8fCB4MiA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAgLy8gY2xpcCB3aXRoIHltaW4KICAgICAgICAgICAgICAgICAgICBpZiAoeTEgPD0geTIgJiYgeTEgPCBheGlzeS5taW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHkyIDwgYXhpc3kubWluKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7ICAgLy8gbGluZSBzZWdtZW50IGlzIG91dHNpZGUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29tcHV0ZSBuZXcgaW50ZXJzZWN0aW9uIHBvaW50CiAgICAgICAgICAgICAgICAgICAgICAgIHgxID0gKGF4aXN5Lm1pbiAtIHkxKSAvICh5MiAtIHkxKSAqICh4MiAtIHgxKSArIHgxOwogICAgICAgICAgICAgICAgICAgICAgICB5MSA9IGF4aXN5Lm1pbjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoeTIgPD0geTEgJiYgeTIgPCBheGlzeS5taW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHkxIDwgYXhpc3kubWluKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHgyID0gKGF4aXN5Lm1pbiAtIHkxKSAvICh5MiAtIHkxKSAqICh4MiAtIHgxKSArIHgxOwogICAgICAgICAgICAgICAgICAgICAgICB5MiA9IGF4aXN5Lm1pbjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIGNsaXAgd2l0aCB5bWF4CiAgICAgICAgICAgICAgICAgICAgaWYgKHkxID49IHkyICYmIHkxID4gYXhpc3kubWF4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh5MiA+IGF4aXN5Lm1heCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICB4MSA9IChheGlzeS5tYXggLSB5MSkgLyAoeTIgLSB5MSkgKiAoeDIgLSB4MSkgKyB4MTsKICAgICAgICAgICAgICAgICAgICAgICAgeTEgPSBheGlzeS5tYXg7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHkyID49IHkxICYmIHkyID4gYXhpc3kubWF4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh5MSA+IGF4aXN5Lm1heCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICB4MiA9IChheGlzeS5tYXggLSB5MSkgLyAoeTIgLSB5MSkgKiAoeDIgLSB4MSkgKyB4MTsKICAgICAgICAgICAgICAgICAgICAgICAgeTIgPSBheGlzeS5tYXg7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBjbGlwIHdpdGggeG1pbgogICAgICAgICAgICAgICAgICAgIGlmICh4MSA8PSB4MiAmJiB4MSA8IGF4aXN4Lm1pbikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoeDIgPCBheGlzeC5taW4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgeTEgPSAoYXhpc3gubWluIC0geDEpIC8gKHgyIC0geDEpICogKHkyIC0geTEpICsgeTE7CiAgICAgICAgICAgICAgICAgICAgICAgIHgxID0gYXhpc3gubWluOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh4MiA8PSB4MSAmJiB4MiA8IGF4aXN4Lm1pbikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoeDEgPCBheGlzeC5taW4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgeTIgPSAoYXhpc3gubWluIC0geDEpIC8gKHgyIC0geDEpICogKHkyIC0geTEpICsgeTE7CiAgICAgICAgICAgICAgICAgICAgICAgIHgyID0gYXhpc3gubWluOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gY2xpcCB3aXRoIHhtYXgKICAgICAgICAgICAgICAgICAgICBpZiAoeDEgPj0geDIgJiYgeDEgPiBheGlzeC5tYXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHgyID4gYXhpc3gubWF4KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHkxID0gKGF4aXN4Lm1heCAtIHgxKSAvICh4MiAtIHgxKSAqICh5MiAtIHkxKSArIHkxOwogICAgICAgICAgICAgICAgICAgICAgICB4MSA9IGF4aXN4Lm1heDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoeDIgPj0geDEgJiYgeDIgPiBheGlzeC5tYXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHgxID4gYXhpc3gubWF4KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHkyID0gKGF4aXN4Lm1heCAtIHgxKSAvICh4MiAtIHgxKSAqICh5MiAtIHkxKSArIHkxOwogICAgICAgICAgICAgICAgICAgICAgICB4MiA9IGF4aXN4Lm1heDsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICh4MSAhPSBwcmV2eCB8fCB5MSAhPSBwcmV2eSkKICAgICAgICAgICAgICAgICAgICAgICAgY3R4Lm1vdmVUbyhheGlzeC5wMmMoeDEpICsgeG9mZnNldCwgYXhpc3kucDJjKHkxKSArIHlvZmZzZXQpOwoKICAgICAgICAgICAgICAgICAgICBwcmV2eCA9IHgyOwogICAgICAgICAgICAgICAgICAgIHByZXZ5ID0geTI7CiAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVUbyhheGlzeC5wMmMoeDIpICsgeG9mZnNldCwgYXhpc3kucDJjKHkyKSArIHlvZmZzZXQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBwbG90TGluZUFyZWEoZGF0YXBvaW50cywgYXhpc3gsIGF4aXN5KSB7CiAgICAgICAgICAgICAgICB2YXIgcG9pbnRzID0gZGF0YXBvaW50cy5wb2ludHMsCiAgICAgICAgICAgICAgICAgICAgcHMgPSBkYXRhcG9pbnRzLnBvaW50c2l6ZSwKICAgICAgICAgICAgICAgICAgICBib3R0b20gPSBNYXRoLm1pbihNYXRoLm1heCgwLCBheGlzeS5taW4pLCBheGlzeS5tYXgpLAogICAgICAgICAgICAgICAgICAgIGkgPSAwLCB0b3AsIGFyZWFPcGVuID0gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgeXBvcyA9IDEsIHNlZ21lbnRTdGFydCA9IDAsIHNlZ21lbnRFbmQgPSAwOwoKICAgICAgICAgICAgICAgIC8vIHdlIHByb2Nlc3MgZWFjaCBzZWdtZW50IGluIHR3byB0dXJucywgZmlyc3QgZm9yd2FyZAogICAgICAgICAgICAgICAgLy8gZGlyZWN0aW9uIHRvIHNrZXRjaCBvdXQgdG9wLCB0aGVuIG9uY2Ugd2UgaGl0IHRoZQogICAgICAgICAgICAgICAgLy8gZW5kIHdlIGdvIGJhY2t3YXJkcyB0byBza2V0Y2ggdGhlIGJvdHRvbQogICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocHMgPiAwICYmIGkgPiBwb2ludHMubGVuZ3RoICsgcHMpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICBpICs9IHBzOyAvLyBwcyBpcyBuZWdhdGl2ZSBpZiBnb2luZyBiYWNrd2FyZHMKCiAgICAgICAgICAgICAgICAgICAgdmFyIHgxID0gcG9pbnRzW2kgLSBwc10sCiAgICAgICAgICAgICAgICAgICAgICAgIHkxID0gcG9pbnRzW2kgLSBwcyArIHlwb3NdLAogICAgICAgICAgICAgICAgICAgICAgICB4MiA9IHBvaW50c1tpXSwgeTIgPSBwb2ludHNbaSArIHlwb3NdOwoKICAgICAgICAgICAgICAgICAgICBpZiAoYXJlYU9wZW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBzID4gMCAmJiB4MSAhPSBudWxsICYmIHgyID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGF0IHR1cm5pbmcgcG9pbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnRFbmQgPSBpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHMgPSAtcHM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5cG9zID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAocHMgPCAwICYmIGkgPT0gc2VnbWVudFN0YXJ0ICsgcHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRvbmUgd2l0aCB0aGUgcmV2ZXJzZSBzd2VlcAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZWFPcGVuID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcyA9IC1wczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlwb3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaSA9IHNlZ21lbnRTdGFydCA9IHNlZ21lbnRFbmQgKyBwczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoeDEgPT0gbnVsbCB8fCB4MiA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAgLy8gY2xpcCB4IHZhbHVlcwoKICAgICAgICAgICAgICAgICAgICAvLyBjbGlwIHdpdGggeG1pbgogICAgICAgICAgICAgICAgICAgIGlmICh4MSA8PSB4MiAmJiB4MSA8IGF4aXN4Lm1pbikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoeDIgPCBheGlzeC5taW4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgeTEgPSAoYXhpc3gubWluIC0geDEpIC8gKHgyIC0geDEpICogKHkyIC0geTEpICsgeTE7CiAgICAgICAgICAgICAgICAgICAgICAgIHgxID0gYXhpc3gubWluOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh4MiA8PSB4MSAmJiB4MiA8IGF4aXN4Lm1pbikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoeDEgPCBheGlzeC5taW4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgeTIgPSAoYXhpc3gubWluIC0geDEpIC8gKHgyIC0geDEpICogKHkyIC0geTEpICsgeTE7CiAgICAgICAgICAgICAgICAgICAgICAgIHgyID0gYXhpc3gubWluOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gY2xpcCB3aXRoIHhtYXgKICAgICAgICAgICAgICAgICAgICBpZiAoeDEgPj0geDIgJiYgeDEgPiBheGlzeC5tYXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHgyID4gYXhpc3gubWF4KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHkxID0gKGF4aXN4Lm1heCAtIHgxKSAvICh4MiAtIHgxKSAqICh5MiAtIHkxKSArIHkxOwogICAgICAgICAgICAgICAgICAgICAgICB4MSA9IGF4aXN4Lm1heDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoeDIgPj0geDEgJiYgeDIgPiBheGlzeC5tYXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHgxID4gYXhpc3gubWF4KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHkyID0gKGF4aXN4Lm1heCAtIHgxKSAvICh4MiAtIHgxKSAqICh5MiAtIHkxKSArIHkxOwogICAgICAgICAgICAgICAgICAgICAgICB4MiA9IGF4aXN4Lm1heDsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICghYXJlYU9wZW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gb3BlbiBhcmVhCiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4Lm1vdmVUbyhheGlzeC5wMmMoeDEpLCBheGlzeS5wMmMoYm90dG9tKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFyZWFPcGVuID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIG5vdyBmaXJzdCBjaGVjayB0aGUgY2FzZSB3aGVyZSBib3RoIGlzIG91dHNpZGUKICAgICAgICAgICAgICAgICAgICBpZiAoeTEgPj0gYXhpc3kubWF4ICYmIHkyID49IGF4aXN5Lm1heCkgewogICAgICAgICAgICAgICAgICAgICAgICBjdHgubGluZVRvKGF4aXN4LnAyYyh4MSksIGF4aXN5LnAyYyhheGlzeS5tYXgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVUbyhheGlzeC5wMmMoeDIpLCBheGlzeS5wMmMoYXhpc3kubWF4KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh5MSA8PSBheGlzeS5taW4gJiYgeTIgPD0gYXhpc3kubWluKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5saW5lVG8oYXhpc3gucDJjKHgxKSwgYXhpc3kucDJjKGF4aXN5Lm1pbikpOwogICAgICAgICAgICAgICAgICAgICAgICBjdHgubGluZVRvKGF4aXN4LnAyYyh4MiksIGF4aXN5LnAyYyhheGlzeS5taW4pKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBlbHNlIGl0J3MgYSBiaXQgbW9yZSBjb21wbGljYXRlZCwgdGhlcmUgbWlnaHQKICAgICAgICAgICAgICAgICAgICAvLyBiZSBhIGZsYXQgbWF4ZWQgb3V0IHJlY3RhbmdsZSBmaXJzdCwgdGhlbiBhCiAgICAgICAgICAgICAgICAgICAgLy8gdHJpYW5ndWxhciBjdXRvdXQgb3IgcmV2ZXJzZTsgdG8gZmluZCB0aGVzZQogICAgICAgICAgICAgICAgICAgIC8vIGtlZXAgdHJhY2sgb2YgdGhlIGN1cnJlbnQgeCB2YWx1ZXMKICAgICAgICAgICAgICAgICAgICB2YXIgeDFvbGQgPSB4MSwgeDJvbGQgPSB4MjsKCiAgICAgICAgICAgICAgICAgICAgLy8gY2xpcCB0aGUgeSB2YWx1ZXMsIHdpdGhvdXQgc2hvcnRjdXR0aW5nLCB3ZQogICAgICAgICAgICAgICAgICAgIC8vIGdvIHRocm91Z2ggYWxsIGNhc2VzIGluIHR1cm4KCiAgICAgICAgICAgICAgICAgICAgLy8gY2xpcCB3aXRoIHltaW4KICAgICAgICAgICAgICAgICAgICBpZiAoeTEgPD0geTIgJiYgeTEgPCBheGlzeS5taW4gJiYgeTIgPj0gYXhpc3kubWluKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHgxID0gKGF4aXN5Lm1pbiAtIHkxKSAvICh5MiAtIHkxKSAqICh4MiAtIHgxKSArIHgxOwogICAgICAgICAgICAgICAgICAgICAgICB5MSA9IGF4aXN5Lm1pbjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoeTIgPD0geTEgJiYgeTIgPCBheGlzeS5taW4gJiYgeTEgPj0gYXhpc3kubWluKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHgyID0gKGF4aXN5Lm1pbiAtIHkxKSAvICh5MiAtIHkxKSAqICh4MiAtIHgxKSArIHgxOwogICAgICAgICAgICAgICAgICAgICAgICB5MiA9IGF4aXN5Lm1pbjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIGNsaXAgd2l0aCB5bWF4CiAgICAgICAgICAgICAgICAgICAgaWYgKHkxID49IHkyICYmIHkxID4gYXhpc3kubWF4ICYmIHkyIDw9IGF4aXN5Lm1heCkgewogICAgICAgICAgICAgICAgICAgICAgICB4MSA9IChheGlzeS5tYXggLSB5MSkgLyAoeTIgLSB5MSkgKiAoeDIgLSB4MSkgKyB4MTsKICAgICAgICAgICAgICAgICAgICAgICAgeTEgPSBheGlzeS5tYXg7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHkyID49IHkxICYmIHkyID4gYXhpc3kubWF4ICYmIHkxIDw9IGF4aXN5Lm1heCkgewogICAgICAgICAgICAgICAgICAgICAgICB4MiA9IChheGlzeS5tYXggLSB5MSkgLyAoeTIgLSB5MSkgKiAoeDIgLSB4MSkgKyB4MTsKICAgICAgICAgICAgICAgICAgICAgICAgeTIgPSBheGlzeS5tYXg7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGUgeCB2YWx1ZSB3YXMgY2hhbmdlZCB3ZSBnb3QgYSByZWN0YW5nbGUKICAgICAgICAgICAgICAgICAgICAvLyB0byBmaWxsCiAgICAgICAgICAgICAgICAgICAgaWYgKHgxICE9IHgxb2xkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5saW5lVG8oYXhpc3gucDJjKHgxb2xkKSwgYXhpc3kucDJjKHkxKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGl0IGdvZXMgdG8gKHgxLCB5MSksIGJ1dCB3ZSBmaWxsIHRoYXQgYmVsb3cKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIGZpbGwgdHJpYW5ndWxhciBzZWN0aW9uLCB0aGlzIHNvbWV0aW1lcyByZXN1bHQKICAgICAgICAgICAgICAgICAgICAvLyBpbiByZWR1bmRhbnQgcG9pbnRzIGlmICh4MSwgeTEpIGhhc24ndCBjaGFuZ2VkCiAgICAgICAgICAgICAgICAgICAgLy8gZnJvbSBwcmV2aW91cyBsaW5lIHRvLCBidXQgd2UganVzdCBpZ25vcmUgdGhhdAogICAgICAgICAgICAgICAgICAgIGN0eC5saW5lVG8oYXhpc3gucDJjKHgxKSwgYXhpc3kucDJjKHkxKSk7CiAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVUbyhheGlzeC5wMmMoeDIpLCBheGlzeS5wMmMoeTIpKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gZmlsbCB0aGUgb3RoZXIgcmVjdGFuZ2xlIGlmIGl0J3MgdGhlcmUKICAgICAgICAgICAgICAgICAgICBpZiAoeDIgIT0geDJvbGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVUbyhheGlzeC5wMmMoeDIpLCBheGlzeS5wMmMoeTIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVUbyhheGlzeC5wMmMoeDJvbGQpLCBheGlzeS5wMmMoeTIpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUocGxvdE9mZnNldC5sZWZ0LCBwbG90T2Zmc2V0LnRvcCk7CiAgICAgICAgICAgIGN0eC5saW5lSm9pbiA9ICJyb3VuZCI7CgogICAgICAgICAgICB2YXIgbHcgPSBzZXJpZXMubGluZXMubGluZVdpZHRoLAogICAgICAgICAgICAgICAgc3cgPSBzZXJpZXMuc2hhZG93U2l6ZTsKICAgICAgICAgICAgLy8gRklYTUU6IGNvbnNpZGVyIGFub3RoZXIgZm9ybSBvZiBzaGFkb3cgd2hlbiBmaWxsaW5nIGlzIHR1cm5lZCBvbgogICAgICAgICAgICBpZiAobHcgPiAwICYmIHN3ID4gMCkgewogICAgICAgICAgICAgICAgLy8gZHJhdyBzaGFkb3cgYXMgYSB0aGljayBhbmQgdGhpbiBsaW5lIHdpdGggdHJhbnNwYXJlbmN5CiAgICAgICAgICAgICAgICBjdHgubGluZVdpZHRoID0gc3c7CiAgICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAicmdiYSgwLDAsMCwwLjEpIjsKICAgICAgICAgICAgICAgIC8vIHBvc2l0aW9uIHNoYWRvdyBhdCBhbmdsZSBmcm9tIHRoZSBtaWQgb2YgbGluZQogICAgICAgICAgICAgICAgdmFyIGFuZ2xlID0gTWF0aC5QSS8xODsKICAgICAgICAgICAgICAgIHBsb3RMaW5lKHNlcmllcy5kYXRhcG9pbnRzLCBNYXRoLnNpbihhbmdsZSkgKiAobHcvMiArIHN3LzIpLCBNYXRoLmNvcyhhbmdsZSkgKiAobHcvMiArIHN3LzIpLCBzZXJpZXMueGF4aXMsIHNlcmllcy55YXhpcyk7CiAgICAgICAgICAgICAgICBjdHgubGluZVdpZHRoID0gc3cvMjsKICAgICAgICAgICAgICAgIHBsb3RMaW5lKHNlcmllcy5kYXRhcG9pbnRzLCBNYXRoLnNpbihhbmdsZSkgKiAobHcvMiArIHN3LzQpLCBNYXRoLmNvcyhhbmdsZSkgKiAobHcvMiArIHN3LzQpLCBzZXJpZXMueGF4aXMsIHNlcmllcy55YXhpcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSBsdzsKICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gc2VyaWVzLmNvbG9yOwogICAgICAgICAgICB2YXIgZmlsbFN0eWxlID0gZ2V0RmlsbFN0eWxlKHNlcmllcy5saW5lcywgc2VyaWVzLmNvbG9yLCAwLCBwbG90SGVpZ2h0KTsKICAgICAgICAgICAgaWYgKGZpbGxTdHlsZSkgewogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGZpbGxTdHlsZTsKICAgICAgICAgICAgICAgIHBsb3RMaW5lQXJlYShzZXJpZXMuZGF0YXBvaW50cywgc2VyaWVzLnhheGlzLCBzZXJpZXMueWF4aXMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobHcgPiAwKQogICAgICAgICAgICAgICAgcGxvdExpbmUoc2VyaWVzLmRhdGFwb2ludHMsIDAsIDAsIHNlcmllcy54YXhpcywgc2VyaWVzLnlheGlzKTsKICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGRyYXdTZXJpZXNQb2ludHMoc2VyaWVzKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIHBsb3RQb2ludHMoZGF0YXBvaW50cywgcmFkaXVzLCBmaWxsU3R5bGUsIG9mZnNldCwgc2hhZG93LCBheGlzeCwgYXhpc3ksIHN5bWJvbCkgewogICAgICAgICAgICAgICAgdmFyIHBvaW50cyA9IGRhdGFwb2ludHMucG9pbnRzLCBwcyA9IGRhdGFwb2ludHMucG9pbnRzaXplOwoKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSArPSBwcykgewogICAgICAgICAgICAgICAgICAgIHZhciB4ID0gcG9pbnRzW2ldLCB5ID0gcG9pbnRzW2kgKyAxXTsKICAgICAgICAgICAgICAgICAgICBpZiAoeCA9PSBudWxsIHx8IHggPCBheGlzeC5taW4gfHwgeCA+IGF4aXN4Lm1heCB8fCB5IDwgYXhpc3kubWluIHx8IHkgPiBheGlzeS5tYXgpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICAgICAgeCA9IGF4aXN4LnAyYyh4KTsKICAgICAgICAgICAgICAgICAgICB5ID0gYXhpc3kucDJjKHkpICsgb2Zmc2V0OwogICAgICAgICAgICAgICAgICAgIGlmIChzeW1ib2wgPT0gImNpcmNsZSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5hcmMoeCwgeSwgcmFkaXVzLCAwLCBzaGFkb3cgPyBNYXRoLlBJIDogTWF0aC5QSSAqIDIsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHN5bWJvbChjdHgsIHgsIHksIHJhZGl1cywgc2hhZG93KTsKICAgICAgICAgICAgICAgICAgICBjdHguY2xvc2VQYXRoKCk7CgogICAgICAgICAgICAgICAgICAgIGlmIChmaWxsU3R5bGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGZpbGxTdHlsZTsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHgudHJhbnNsYXRlKHBsb3RPZmZzZXQubGVmdCwgcGxvdE9mZnNldC50b3ApOwoKICAgICAgICAgICAgdmFyIGx3ID0gc2VyaWVzLnBvaW50cy5saW5lV2lkdGgsCiAgICAgICAgICAgICAgICBzdyA9IHNlcmllcy5zaGFkb3dTaXplLAogICAgICAgICAgICAgICAgcmFkaXVzID0gc2VyaWVzLnBvaW50cy5yYWRpdXMsCiAgICAgICAgICAgICAgICBzeW1ib2wgPSBzZXJpZXMucG9pbnRzLnN5bWJvbDsKCiAgICAgICAgICAgIC8vIElmIHRoZSB1c2VyIHNldHMgdGhlIGxpbmUgd2lkdGggdG8gMCwgd2UgY2hhbmdlIGl0IHRvIGEgdmVyeSAKICAgICAgICAgICAgLy8gc21hbGwgdmFsdWUuIEEgbGluZSB3aWR0aCBvZiAwIHNlZW1zIHRvIGZvcmNlIHRoZSBkZWZhdWx0IG9mIDEuCiAgICAgICAgICAgIC8vIERvaW5nIHRoZSBjb25kaXRpb25hbCBoZXJlIGFsbG93cyB0aGUgc2hhZG93IHNldHRpbmcgdG8gc3RpbGwgYmUgCiAgICAgICAgICAgIC8vIG9wdGlvbmFsIGV2ZW4gd2l0aCBhIGxpbmVXaWR0aCBvZiAwLgoKICAgICAgICAgICAgaWYoIGx3ID09IDAgKQogICAgICAgICAgICAgICAgbHcgPSAwLjAwMDE7CgogICAgICAgICAgICBpZiAobHcgPiAwICYmIHN3ID4gMCkgewogICAgICAgICAgICAgICAgLy8gZHJhdyBzaGFkb3cgaW4gdHdvIHN0ZXBzCiAgICAgICAgICAgICAgICB2YXIgdyA9IHN3IC8gMjsKICAgICAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSB3OwogICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gInJnYmEoMCwwLDAsMC4xKSI7CiAgICAgICAgICAgICAgICBwbG90UG9pbnRzKHNlcmllcy5kYXRhcG9pbnRzLCByYWRpdXMsIG51bGwsIHcgKyB3LzIsIHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcmllcy54YXhpcywgc2VyaWVzLnlheGlzLCBzeW1ib2wpOwoKICAgICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICJyZ2JhKDAsMCwwLDAuMikiOwogICAgICAgICAgICAgICAgcGxvdFBvaW50cyhzZXJpZXMuZGF0YXBvaW50cywgcmFkaXVzLCBudWxsLCB3LzIsIHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcmllcy54YXhpcywgc2VyaWVzLnlheGlzLCBzeW1ib2wpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjdHgubGluZVdpZHRoID0gbHc7CiAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9IHNlcmllcy5jb2xvcjsKICAgICAgICAgICAgcGxvdFBvaW50cyhzZXJpZXMuZGF0YXBvaW50cywgcmFkaXVzLAogICAgICAgICAgICAgICAgICAgICAgIGdldEZpbGxTdHlsZShzZXJpZXMucG9pbnRzLCBzZXJpZXMuY29sb3IpLCAwLCBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICBzZXJpZXMueGF4aXMsIHNlcmllcy55YXhpcywgc3ltYm9sKTsKICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGRyYXdCYXIoeCwgeSwgYiwgYmFyTGVmdCwgYmFyUmlnaHQsIGZpbGxTdHlsZUNhbGxiYWNrLCBheGlzeCwgYXhpc3ksIGMsIGhvcml6b250YWwsIGxpbmVXaWR0aCkgewogICAgICAgICAgICB2YXIgbGVmdCwgcmlnaHQsIGJvdHRvbSwgdG9wLAogICAgICAgICAgICAgICAgZHJhd0xlZnQsIGRyYXdSaWdodCwgZHJhd1RvcCwgZHJhd0JvdHRvbSwKICAgICAgICAgICAgICAgIHRtcDsKCiAgICAgICAgICAgIC8vIGluIGhvcml6b250YWwgbW9kZSwgd2Ugc3RhcnQgdGhlIGJhciBmcm9tIHRoZSBsZWZ0CiAgICAgICAgICAgIC8vIGluc3RlYWQgb2YgZnJvbSB0aGUgYm90dG9tIHNvIGl0IGFwcGVhcnMgdG8gYmUKICAgICAgICAgICAgLy8gaG9yaXpvbnRhbCByYXRoZXIgdGhhbiB2ZXJ0aWNhbAogICAgICAgICAgICBpZiAoaG9yaXpvbnRhbCkgewogICAgICAgICAgICAgICAgZHJhd0JvdHRvbSA9IGRyYXdSaWdodCA9IGRyYXdUb3AgPSB0cnVlOwogICAgICAgICAgICAgICAgZHJhd0xlZnQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGxlZnQgPSBiOwogICAgICAgICAgICAgICAgcmlnaHQgPSB4OwogICAgICAgICAgICAgICAgdG9wID0geSArIGJhckxlZnQ7CiAgICAgICAgICAgICAgICBib3R0b20gPSB5ICsgYmFyUmlnaHQ7CgogICAgICAgICAgICAgICAgLy8gYWNjb3VudCBmb3IgbmVnYXRpdmUgYmFycwogICAgICAgICAgICAgICAgaWYgKHJpZ2h0IDwgbGVmdCkgewogICAgICAgICAgICAgICAgICAgIHRtcCA9IHJpZ2h0OwogICAgICAgICAgICAgICAgICAgIHJpZ2h0ID0gbGVmdDsKICAgICAgICAgICAgICAgICAgICBsZWZ0ID0gdG1wOwogICAgICAgICAgICAgICAgICAgIGRyYXdMZWZ0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBkcmF3UmlnaHQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGRyYXdMZWZ0ID0gZHJhd1JpZ2h0ID0gZHJhd1RvcCA9IHRydWU7CiAgICAgICAgICAgICAgICBkcmF3Qm90dG9tID0gZmFsc2U7CiAgICAgICAgICAgICAgICBsZWZ0ID0geCArIGJhckxlZnQ7CiAgICAgICAgICAgICAgICByaWdodCA9IHggKyBiYXJSaWdodDsKICAgICAgICAgICAgICAgIGJvdHRvbSA9IGI7CiAgICAgICAgICAgICAgICB0b3AgPSB5OwoKICAgICAgICAgICAgICAgIC8vIGFjY291bnQgZm9yIG5lZ2F0aXZlIGJhcnMKICAgICAgICAgICAgICAgIGlmICh0b3AgPCBib3R0b20pIHsKICAgICAgICAgICAgICAgICAgICB0bXAgPSB0b3A7CiAgICAgICAgICAgICAgICAgICAgdG9wID0gYm90dG9tOwogICAgICAgICAgICAgICAgICAgIGJvdHRvbSA9IHRtcDsKICAgICAgICAgICAgICAgICAgICBkcmF3Qm90dG9tID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBkcmF3VG9wID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGNsaXAKICAgICAgICAgICAgaWYgKHJpZ2h0IDwgYXhpc3gubWluIHx8IGxlZnQgPiBheGlzeC5tYXggfHwKICAgICAgICAgICAgICAgIHRvcCA8IGF4aXN5Lm1pbiB8fCBib3R0b20gPiBheGlzeS5tYXgpCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICBpZiAobGVmdCA8IGF4aXN4Lm1pbikgewogICAgICAgICAgICAgICAgbGVmdCA9IGF4aXN4Lm1pbjsKICAgICAgICAgICAgICAgIGRyYXdMZWZ0ID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChyaWdodCA+IGF4aXN4Lm1heCkgewogICAgICAgICAgICAgICAgcmlnaHQgPSBheGlzeC5tYXg7CiAgICAgICAgICAgICAgICBkcmF3UmlnaHQgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGJvdHRvbSA8IGF4aXN5Lm1pbikgewogICAgICAgICAgICAgICAgYm90dG9tID0gYXhpc3kubWluOwogICAgICAgICAgICAgICAgZHJhd0JvdHRvbSA9IGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodG9wID4gYXhpc3kubWF4KSB7CiAgICAgICAgICAgICAgICB0b3AgPSBheGlzeS5tYXg7CiAgICAgICAgICAgICAgICBkcmF3VG9wID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxlZnQgPSBheGlzeC5wMmMobGVmdCk7CiAgICAgICAgICAgIGJvdHRvbSA9IGF4aXN5LnAyYyhib3R0b20pOwogICAgICAgICAgICByaWdodCA9IGF4aXN4LnAyYyhyaWdodCk7CiAgICAgICAgICAgIHRvcCA9IGF4aXN5LnAyYyh0b3ApOwoKICAgICAgICAgICAgLy8gZmlsbCB0aGUgYmFyCiAgICAgICAgICAgIGlmIChmaWxsU3R5bGVDYWxsYmFjaykgewogICAgICAgICAgICAgICAgYy5maWxsU3R5bGUgPSBmaWxsU3R5bGVDYWxsYmFjayhib3R0b20sIHRvcCk7CiAgICAgICAgICAgICAgICBjLmZpbGxSZWN0KGxlZnQsIHRvcCwgcmlnaHQgLSBsZWZ0LCBib3R0b20gLSB0b3ApCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGRyYXcgb3V0bGluZQogICAgICAgICAgICBpZiAobGluZVdpZHRoID4gMCAmJiAoZHJhd0xlZnQgfHwgZHJhd1JpZ2h0IHx8IGRyYXdUb3AgfHwgZHJhd0JvdHRvbSkpIHsKICAgICAgICAgICAgICAgIGMuYmVnaW5QYXRoKCk7CgogICAgICAgICAgICAgICAgLy8gRklYTUU6IGlubGluZSBtb3ZlVG8gaXMgYnVnZ3kgd2l0aCBleGNhbnZhcwogICAgICAgICAgICAgICAgYy5tb3ZlVG8obGVmdCwgYm90dG9tKTsKICAgICAgICAgICAgICAgIGlmIChkcmF3TGVmdCkKICAgICAgICAgICAgICAgICAgICBjLmxpbmVUbyhsZWZ0LCB0b3ApOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGMubW92ZVRvKGxlZnQsIHRvcCk7CiAgICAgICAgICAgICAgICBpZiAoZHJhd1RvcCkKICAgICAgICAgICAgICAgICAgICBjLmxpbmVUbyhyaWdodCwgdG9wKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBjLm1vdmVUbyhyaWdodCwgdG9wKTsKICAgICAgICAgICAgICAgIGlmIChkcmF3UmlnaHQpCiAgICAgICAgICAgICAgICAgICAgYy5saW5lVG8ocmlnaHQsIGJvdHRvbSk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgYy5tb3ZlVG8ocmlnaHQsIGJvdHRvbSk7CiAgICAgICAgICAgICAgICBpZiAoZHJhd0JvdHRvbSkKICAgICAgICAgICAgICAgICAgICBjLmxpbmVUbyhsZWZ0LCBib3R0b20pOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGMubW92ZVRvKGxlZnQsIGJvdHRvbSk7CiAgICAgICAgICAgICAgICBjLnN0cm9rZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBkcmF3U2VyaWVzQmFycyhzZXJpZXMpIHsKICAgICAgICAgICAgZnVuY3Rpb24gcGxvdEJhcnMoZGF0YXBvaW50cywgYmFyTGVmdCwgYmFyUmlnaHQsIGZpbGxTdHlsZUNhbGxiYWNrLCBheGlzeCwgYXhpc3kpIHsKICAgICAgICAgICAgICAgIHZhciBwb2ludHMgPSBkYXRhcG9pbnRzLnBvaW50cywgcHMgPSBkYXRhcG9pbnRzLnBvaW50c2l6ZTsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBvaW50cy5sZW5ndGg7IGkgKz0gcHMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocG9pbnRzW2ldID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGRyYXdCYXIocG9pbnRzW2ldLCBwb2ludHNbaSArIDFdLCBwb2ludHNbaSArIDJdLCBiYXJMZWZ0LCBiYXJSaWdodCwgZmlsbFN0eWxlQ2FsbGJhY2ssIGF4aXN4LCBheGlzeSwgY3R4LCBzZXJpZXMuYmFycy5ob3Jpem9udGFsLCBzZXJpZXMuYmFycy5saW5lV2lkdGgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHgudHJhbnNsYXRlKHBsb3RPZmZzZXQubGVmdCwgcGxvdE9mZnNldC50b3ApOwoKICAgICAgICAgICAgLy8gRklYTUU6IGZpZ3VyZSBvdXQgYSB3YXkgdG8gYWRkIHNoYWRvd3MgKGZvciBpbnN0YW5jZSBhbG9uZyB0aGUgcmlnaHQgZWRnZSkKICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IHNlcmllcy5iYXJzLmxpbmVXaWR0aDsKICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gc2VyaWVzLmNvbG9yOwoKICAgICAgICAgICAgdmFyIGJhckxlZnQ7CgogICAgICAgICAgICBzd2l0Y2ggKHNlcmllcy5iYXJzLmFsaWduKSB7CiAgICAgICAgICAgICAgICBjYXNlICJsZWZ0IjoKICAgICAgICAgICAgICAgICAgICBiYXJMZWZ0ID0gMDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgInJpZ2h0IjoKICAgICAgICAgICAgICAgICAgICBiYXJMZWZ0ID0gLXNlcmllcy5iYXJzLmJhcldpZHRoOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBiYXJMZWZ0ID0gLXNlcmllcy5iYXJzLmJhcldpZHRoIC8gMjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGZpbGxTdHlsZUNhbGxiYWNrID0gc2VyaWVzLmJhcnMuZmlsbCA/IGZ1bmN0aW9uIChib3R0b20sIHRvcCkgeyByZXR1cm4gZ2V0RmlsbFN0eWxlKHNlcmllcy5iYXJzLCBzZXJpZXMuY29sb3IsIGJvdHRvbSwgdG9wKTsgfSA6IG51bGw7CiAgICAgICAgICAgIHBsb3RCYXJzKHNlcmllcy5kYXRhcG9pbnRzLCBiYXJMZWZ0LCBiYXJMZWZ0ICsgc2VyaWVzLmJhcnMuYmFyV2lkdGgsIGZpbGxTdHlsZUNhbGxiYWNrLCBzZXJpZXMueGF4aXMsIHNlcmllcy55YXhpcyk7CiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXRGaWxsU3R5bGUoZmlsbG9wdGlvbnMsIHNlcmllc0NvbG9yLCBib3R0b20sIHRvcCkgewogICAgICAgICAgICB2YXIgZmlsbCA9IGZpbGxvcHRpb25zLmZpbGw7CiAgICAgICAgICAgIGlmICghZmlsbCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAgICAgaWYgKGZpbGxvcHRpb25zLmZpbGxDb2xvcikKICAgICAgICAgICAgICAgIHJldHVybiBnZXRDb2xvck9yR3JhZGllbnQoZmlsbG9wdGlvbnMuZmlsbENvbG9yLCBib3R0b20sIHRvcCwgc2VyaWVzQ29sb3IpOwoKICAgICAgICAgICAgdmFyIGMgPSAkLmNvbG9yLnBhcnNlKHNlcmllc0NvbG9yKTsKICAgICAgICAgICAgYy5hID0gdHlwZW9mIGZpbGwgPT0gIm51bWJlciIgPyBmaWxsIDogMC40OwogICAgICAgICAgICBjLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICByZXR1cm4gYy50b1N0cmluZygpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gaW5zZXJ0TGVnZW5kKCkgewoKICAgICAgICAgICAgaWYgKG9wdGlvbnMubGVnZW5kLmNvbnRhaW5lciAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAkKG9wdGlvbnMubGVnZW5kLmNvbnRhaW5lcikuaHRtbCgiIik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlci5maW5kKCIubGVnZW5kIikucmVtb3ZlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghb3B0aW9ucy5sZWdlbmQuc2hvdykgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgZnJhZ21lbnRzID0gW10sIGVudHJpZXMgPSBbXSwgcm93U3RhcnRlZCA9IGZhbHNlLAogICAgICAgICAgICAgICAgbGYgPSBvcHRpb25zLmxlZ2VuZC5sYWJlbEZvcm1hdHRlciwgcywgbGFiZWw7CgogICAgICAgICAgICAvLyBCdWlsZCBhIGxpc3Qgb2YgbGVnZW5kIGVudHJpZXMsIHdpdGggZWFjaCBoYXZpbmcgYSBsYWJlbCBhbmQgYSBjb2xvcgoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZXJpZXMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICAgIHMgPSBzZXJpZXNbaV07CiAgICAgICAgICAgICAgICBpZiAocy5sYWJlbCkgewogICAgICAgICAgICAgICAgICAgIGxhYmVsID0gbGYgPyBsZihzLmxhYmVsLCBzKSA6IHMubGFiZWw7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxhYmVsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVudHJpZXMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogbGFiZWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogcy5jb2xvcgogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFNvcnQgdGhlIGxlZ2VuZCB1c2luZyBlaXRoZXIgdGhlIGRlZmF1bHQgb3IgYSBjdXN0b20gY29tcGFyYXRvcgoKICAgICAgICAgICAgaWYgKG9wdGlvbnMubGVnZW5kLnNvcnRlZCkgewogICAgICAgICAgICAgICAgaWYgKCQuaXNGdW5jdGlvbihvcHRpb25zLmxlZ2VuZC5zb3J0ZWQpKSB7CiAgICAgICAgICAgICAgICAgICAgZW50cmllcy5zb3J0KG9wdGlvbnMubGVnZW5kLnNvcnRlZCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMubGVnZW5kLnNvcnRlZCA9PSAicmV2ZXJzZSIpIHsKICAgICAgICAgICAgICAgIAllbnRyaWVzLnJldmVyc2UoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGFzY2VuZGluZyA9IG9wdGlvbnMubGVnZW5kLnNvcnRlZCAhPSAiZGVzY2VuZGluZyI7CiAgICAgICAgICAgICAgICAgICAgZW50cmllcy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEubGFiZWwgPT0gYi5sYWJlbCA/IDAgOiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYS5sYWJlbCA8IGIubGFiZWwpICE9IGFzY2VuZGluZyA/IDEgOiAtMSAgIC8vIExvZ2ljYWwgWE9SCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEdlbmVyYXRlIG1hcmt1cCBmb3IgdGhlIGxpc3Qgb2YgZW50cmllcywgaW4gdGhlaXIgZmluYWwgb3JkZXIKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZW50cmllcy5sZW5ndGg7ICsraSkgewoKICAgICAgICAgICAgICAgIHZhciBlbnRyeSA9IGVudHJpZXNbaV07CgogICAgICAgICAgICAgICAgaWYgKGkgJSBvcHRpb25zLmxlZ2VuZC5ub0NvbHVtbnMgPT0gMCkgewogICAgICAgICAgICAgICAgICAgIGlmIChyb3dTdGFydGVkKQogICAgICAgICAgICAgICAgICAgICAgICBmcmFnbWVudHMucHVzaCgnPC90cj4nKTsKICAgICAgICAgICAgICAgICAgICBmcmFnbWVudHMucHVzaCgnPHRyPicpOwogICAgICAgICAgICAgICAgICAgIHJvd1N0YXJ0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZyYWdtZW50cy5wdXNoKAogICAgICAgICAgICAgICAgICAgICc8dGQgY2xhc3M9ImxlZ2VuZENvbG9yQm94Ij48ZGl2IHN0eWxlPSJib3JkZXI6MXB4IHNvbGlkICcgKyBvcHRpb25zLmxlZ2VuZC5sYWJlbEJveEJvcmRlckNvbG9yICsgJztwYWRkaW5nOjFweCI+PGRpdiBzdHlsZT0id2lkdGg6NHB4O2hlaWdodDowO2JvcmRlcjo1cHggc29saWQgJyArIGVudHJ5LmNvbG9yICsgJztvdmVyZmxvdzpoaWRkZW4iPjwvZGl2PjwvZGl2PjwvdGQ+JyArCiAgICAgICAgICAgICAgICAgICAgJzx0ZCBjbGFzcz0ibGVnZW5kTGFiZWwiPicgKyBlbnRyeS5sYWJlbCArICc8L3RkPicKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChyb3dTdGFydGVkKQogICAgICAgICAgICAgICAgZnJhZ21lbnRzLnB1c2goJzwvdHI+Jyk7CgogICAgICAgICAgICBpZiAoZnJhZ21lbnRzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgdmFyIHRhYmxlID0gJzx0YWJsZSBzdHlsZT0iZm9udC1zaXplOnNtYWxsZXI7Y29sb3I6JyArIG9wdGlvbnMuZ3JpZC5jb2xvciArICciPicgKyBmcmFnbWVudHMuam9pbigiIikgKyAnPC90YWJsZT4nOwogICAgICAgICAgICBpZiAob3B0aW9ucy5sZWdlbmQuY29udGFpbmVyICE9IG51bGwpCiAgICAgICAgICAgICAgICAkKG9wdGlvbnMubGVnZW5kLmNvbnRhaW5lcikuaHRtbCh0YWJsZSk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdmFyIHBvcyA9ICIiLAogICAgICAgICAgICAgICAgICAgIHAgPSBvcHRpb25zLmxlZ2VuZC5wb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICBtID0gb3B0aW9ucy5sZWdlbmQubWFyZ2luOwogICAgICAgICAgICAgICAgaWYgKG1bMF0gPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBtID0gW20sIG1dOwogICAgICAgICAgICAgICAgaWYgKHAuY2hhckF0KDApID09ICJuIikKICAgICAgICAgICAgICAgICAgICBwb3MgKz0gJ3RvcDonICsgKG1bMV0gKyBwbG90T2Zmc2V0LnRvcCkgKyAncHg7JzsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKHAuY2hhckF0KDApID09ICJzIikKICAgICAgICAgICAgICAgICAgICBwb3MgKz0gJ2JvdHRvbTonICsgKG1bMV0gKyBwbG90T2Zmc2V0LmJvdHRvbSkgKyAncHg7JzsKICAgICAgICAgICAgICAgIGlmIChwLmNoYXJBdCgxKSA9PSAiZSIpCiAgICAgICAgICAgICAgICAgICAgcG9zICs9ICdyaWdodDonICsgKG1bMF0gKyBwbG90T2Zmc2V0LnJpZ2h0KSArICdweDsnOwogICAgICAgICAgICAgICAgZWxzZSBpZiAocC5jaGFyQXQoMSkgPT0gInciKQogICAgICAgICAgICAgICAgICAgIHBvcyArPSAnbGVmdDonICsgKG1bMF0gKyBwbG90T2Zmc2V0LmxlZnQpICsgJ3B4Oyc7CiAgICAgICAgICAgICAgICB2YXIgbGVnZW5kID0gJCgnPGRpdiBjbGFzcz0ibGVnZW5kIj4nICsgdGFibGUucmVwbGFjZSgnc3R5bGU9IicsICdzdHlsZT0icG9zaXRpb246YWJzb2x1dGU7JyArIHBvcyArJzsnKSArICc8L2Rpdj4nKS5hcHBlbmRUbyhwbGFjZWhvbGRlcik7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5sZWdlbmQuYmFja2dyb3VuZE9wYWNpdHkgIT0gMC4wKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gcHV0IGluIHRoZSB0cmFuc3BhcmVudCBiYWNrZ3JvdW5kCiAgICAgICAgICAgICAgICAgICAgLy8gc2VwYXJhdGVseSB0byBhdm9pZCBibGVuZGVkIGxhYmVscyBhbmQKICAgICAgICAgICAgICAgICAgICAvLyBsYWJlbCBib3hlcwogICAgICAgICAgICAgICAgICAgIHZhciBjID0gb3B0aW9ucy5sZWdlbmQuYmFja2dyb3VuZENvbG9yOwogICAgICAgICAgICAgICAgICAgIGlmIChjID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IG9wdGlvbnMuZ3JpZC5iYWNrZ3JvdW5kQ29sb3I7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjICYmIHR5cGVvZiBjID09ICJzdHJpbmciKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9ICQuY29sb3IucGFyc2UoYyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSAkLmNvbG9yLmV4dHJhY3QobGVnZW5kLCAnYmFja2dyb3VuZC1jb2xvcicpOwogICAgICAgICAgICAgICAgICAgICAgICBjLmEgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBjID0gYy50b1N0cmluZygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB2YXIgZGl2ID0gbGVnZW5kLmNoaWxkcmVuKCk7CiAgICAgICAgICAgICAgICAgICAgJCgnPGRpdiBzdHlsZT0icG9zaXRpb246YWJzb2x1dGU7d2lkdGg6JyArIGRpdi53aWR0aCgpICsgJ3B4O2hlaWdodDonICsgZGl2LmhlaWdodCgpICsgJ3B4OycgKyBwb3MgKydiYWNrZ3JvdW5kLWNvbG9yOicgKyBjICsgJzsiPiA8L2Rpdj4nKS5wcmVwZW5kVG8obGVnZW5kKS5jc3MoJ29wYWNpdHknLCBvcHRpb25zLmxlZ2VuZC5iYWNrZ3JvdW5kT3BhY2l0eSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgoKICAgICAgICAvLyBpbnRlcmFjdGl2ZSBmZWF0dXJlcwoKICAgICAgICB2YXIgaGlnaGxpZ2h0cyA9IFtdLAogICAgICAgICAgICByZWRyYXdUaW1lb3V0ID0gbnVsbDsKCiAgICAgICAgLy8gcmV0dXJucyB0aGUgZGF0YSBpdGVtIHRoZSBtb3VzZSBpcyBvdmVyLCBvciBudWxsIGlmIG5vbmUgaXMgZm91bmQKICAgICAgICBmdW5jdGlvbiBmaW5kTmVhcmJ5SXRlbShtb3VzZVgsIG1vdXNlWSwgc2VyaWVzRmlsdGVyKSB7CiAgICAgICAgICAgIHZhciBtYXhEaXN0YW5jZSA9IG9wdGlvbnMuZ3JpZC5tb3VzZUFjdGl2ZVJhZGl1cywKICAgICAgICAgICAgICAgIHNtYWxsZXN0RGlzdGFuY2UgPSBtYXhEaXN0YW5jZSAqIG1heERpc3RhbmNlICsgMSwKICAgICAgICAgICAgICAgIGl0ZW0gPSBudWxsLCBmb3VuZFBvaW50ID0gZmFsc2UsIGksIGosIHBzOwoKICAgICAgICAgICAgZm9yIChpID0gc2VyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgICAgICAgICBpZiAoIXNlcmllc0ZpbHRlcihzZXJpZXNbaV0pKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIHZhciBzID0gc2VyaWVzW2ldLAogICAgICAgICAgICAgICAgICAgIGF4aXN4ID0gcy54YXhpcywKICAgICAgICAgICAgICAgICAgICBheGlzeSA9IHMueWF4aXMsCiAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gcy5kYXRhcG9pbnRzLnBvaW50cywKICAgICAgICAgICAgICAgICAgICBteCA9IGF4aXN4LmMycChtb3VzZVgpLCAvLyBwcmVjb21wdXRlIHNvbWUgc3R1ZmYgdG8gbWFrZSB0aGUgbG9vcCBmYXN0ZXIKICAgICAgICAgICAgICAgICAgICBteSA9IGF4aXN5LmMycChtb3VzZVkpLAogICAgICAgICAgICAgICAgICAgIG1heHggPSBtYXhEaXN0YW5jZSAvIGF4aXN4LnNjYWxlLAogICAgICAgICAgICAgICAgICAgIG1heHkgPSBtYXhEaXN0YW5jZSAvIGF4aXN5LnNjYWxlOwoKICAgICAgICAgICAgICAgIHBzID0gcy5kYXRhcG9pbnRzLnBvaW50c2l6ZTsKICAgICAgICAgICAgICAgIC8vIHdpdGggaW52ZXJzZSB0cmFuc2Zvcm1zLCB3ZSBjYW4ndCB1c2UgdGhlIG1heHgvbWF4eQogICAgICAgICAgICAgICAgLy8gb3B0aW1pemF0aW9uLCBzYWRseQogICAgICAgICAgICAgICAgaWYgKGF4aXN4Lm9wdGlvbnMuaW52ZXJzZVRyYW5zZm9ybSkKICAgICAgICAgICAgICAgICAgICBtYXh4ID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgICAgICAgICAgIGlmIChheGlzeS5vcHRpb25zLmludmVyc2VUcmFuc2Zvcm0pCiAgICAgICAgICAgICAgICAgICAgbWF4eSA9IE51bWJlci5NQVhfVkFMVUU7CgogICAgICAgICAgICAgICAgaWYgKHMubGluZXMuc2hvdyB8fCBzLnBvaW50cy5zaG93KSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IHBvaW50cy5sZW5ndGg7IGogKz0gcHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHggPSBwb2ludHNbal0sIHkgPSBwb2ludHNbaiArIDFdOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoeCA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBGb3IgcG9pbnRzIGFuZCBsaW5lcywgdGhlIGN1cnNvciBtdXN0IGJlIHdpdGhpbiBhCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNlcnRhaW4gZGlzdGFuY2UgdG8gdGhlIGRhdGEgcG9pbnQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHggLSBteCA+IG1heHggfHwgeCAtIG14IDwgLW1heHggfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgLSBteSA+IG1heHkgfHwgeSAtIG15IDwgLW1heHkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlIGhhdmUgdG8gY2FsY3VsYXRlIGRpc3RhbmNlcyBpbiBwaXhlbHMsIG5vdCBpbgogICAgICAgICAgICAgICAgICAgICAgICAvLyBkYXRhIHVuaXRzLCBiZWNhdXNlIHRoZSBzY2FsZXMgb2YgdGhlIGF4ZXMgbWF5IGJlIGRpZmZlcmVudAogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZHggPSBNYXRoLmFicyhheGlzeC5wMmMoeCkgLSBtb3VzZVgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZHkgPSBNYXRoLmFicyhheGlzeS5wMmMoeSkgLSBtb3VzZVkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzdCA9IGR4ICogZHggKyBkeSAqIGR5OyAvLyB3ZSBzYXZlIHRoZSBzcXJ0CgogICAgICAgICAgICAgICAgICAgICAgICAvLyB1c2UgPD0gdG8gZW5zdXJlIGxhc3QgcG9pbnQgdGFrZXMgcHJlY2VkZW5jZQogICAgICAgICAgICAgICAgICAgICAgICAvLyAobGFzdCBnZW5lcmFsbHkgbWVhbnMgb24gdG9wIG9mKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGlzdCA8IHNtYWxsZXN0RGlzdGFuY2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNtYWxsZXN0RGlzdGFuY2UgPSBkaXN0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSA9IFtpLCBqIC8gcHNdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChzLmJhcnMuc2hvdyAmJiAhaXRlbSkgeyAvLyBubyBvdGhlciBwb2ludCBjYW4gYmUgbmVhcmJ5CgogICAgICAgICAgICAgICAgICAgIHZhciBiYXJMZWZ0LCBiYXJSaWdodDsKCiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChzLmJhcnMuYWxpZ24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAibGVmdCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXJMZWZ0ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJyaWdodCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXJMZWZ0ID0gLXMuYmFycy5iYXJXaWR0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFyTGVmdCA9IC1zLmJhcnMuYmFyV2lkdGggLyAyOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgYmFyUmlnaHQgPSBiYXJMZWZ0ICsgcy5iYXJzLmJhcldpZHRoOwoKICAgICAgICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgcG9pbnRzLmxlbmd0aDsgaiArPSBwcykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgeCA9IHBvaW50c1tqXSwgeSA9IHBvaW50c1tqICsgMV0sIGIgPSBwb2ludHNbaiArIDJdOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoeCA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBmb3IgYSBiYXIgZ3JhcGgsIHRoZSBjdXJzb3IgbXVzdCBiZSBpbnNpZGUgdGhlIGJhcgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VyaWVzW2ldLmJhcnMuaG9yaXpvbnRhbCA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAobXggPD0gTWF0aC5tYXgoYiwgeCkgJiYgbXggPj0gTWF0aC5taW4oYiwgeCkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteSA+PSB5ICsgYmFyTGVmdCAmJiBteSA8PSB5ICsgYmFyUmlnaHQpIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChteCA+PSB4ICsgYmFyTGVmdCAmJiBteCA8PSB4ICsgYmFyUmlnaHQgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteSA+PSBNYXRoLm1pbihiLCB5KSAmJiBteSA8PSBNYXRoLm1heChiLCB5KSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSA9IFtpLCBqIC8gcHNdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgICAgICAgIGkgPSBpdGVtWzBdOwogICAgICAgICAgICAgICAgaiA9IGl0ZW1bMV07CiAgICAgICAgICAgICAgICBwcyA9IHNlcmllc1tpXS5kYXRhcG9pbnRzLnBvaW50c2l6ZTsKCiAgICAgICAgICAgICAgICByZXR1cm4geyBkYXRhcG9pbnQ6IHNlcmllc1tpXS5kYXRhcG9pbnRzLnBvaW50cy5zbGljZShqICogcHMsIChqICsgMSkgKiBwcyksCiAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhSW5kZXg6IGosCiAgICAgICAgICAgICAgICAgICAgICAgICBzZXJpZXM6IHNlcmllc1tpXSwKICAgICAgICAgICAgICAgICAgICAgICAgIHNlcmllc0luZGV4OiBpIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gb25Nb3VzZU1vdmUoZSkgewogICAgICAgICAgICBpZiAob3B0aW9ucy5ncmlkLmhvdmVyYWJsZSkKICAgICAgICAgICAgICAgIHRyaWdnZXJDbGlja0hvdmVyRXZlbnQoInBsb3Rob3ZlciIsIGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChzKSB7IHJldHVybiBzWyJob3ZlcmFibGUiXSAhPSBmYWxzZTsgfSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBvbk1vdXNlTGVhdmUoZSkgewogICAgICAgICAgICBpZiAob3B0aW9ucy5ncmlkLmhvdmVyYWJsZSkKICAgICAgICAgICAgICAgIHRyaWdnZXJDbGlja0hvdmVyRXZlbnQoInBsb3Rob3ZlciIsIGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChzKSB7IHJldHVybiBmYWxzZTsgfSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBvbkNsaWNrKGUpIHsKICAgICAgICAgICAgdHJpZ2dlckNsaWNrSG92ZXJFdmVudCgicGxvdGNsaWNrIiwgZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAocykgeyByZXR1cm4gc1siY2xpY2thYmxlIl0gIT0gZmFsc2U7IH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gdHJpZ2dlciBjbGljayBvciBob3ZlciBldmVudCAodGhleSBzZW5kIHRoZSBzYW1lIHBhcmFtZXRlcnMKICAgICAgICAvLyBzbyB3ZSBzaGFyZSB0aGVpciBjb2RlKQogICAgICAgIGZ1bmN0aW9uIHRyaWdnZXJDbGlja0hvdmVyRXZlbnQoZXZlbnRuYW1lLCBldmVudCwgc2VyaWVzRmlsdGVyKSB7CiAgICAgICAgICAgIHZhciBvZmZzZXQgPSBldmVudEhvbGRlci5vZmZzZXQoKSwKICAgICAgICAgICAgICAgIGNhbnZhc1ggPSBldmVudC5wYWdlWCAtIG9mZnNldC5sZWZ0IC0gcGxvdE9mZnNldC5sZWZ0LAogICAgICAgICAgICAgICAgY2FudmFzWSA9IGV2ZW50LnBhZ2VZIC0gb2Zmc2V0LnRvcCAtIHBsb3RPZmZzZXQudG9wLAogICAgICAgICAgICBwb3MgPSBjYW52YXNUb0F4aXNDb29yZHMoeyBsZWZ0OiBjYW52YXNYLCB0b3A6IGNhbnZhc1kgfSk7CgogICAgICAgICAgICBwb3MucGFnZVggPSBldmVudC5wYWdlWDsKICAgICAgICAgICAgcG9zLnBhZ2VZID0gZXZlbnQucGFnZVk7CgogICAgICAgICAgICB2YXIgaXRlbSA9IGZpbmROZWFyYnlJdGVtKGNhbnZhc1gsIGNhbnZhc1ksIHNlcmllc0ZpbHRlcik7CgogICAgICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgICAgICAgLy8gZmlsbCBpbiBtb3VzZSBwb3MgZm9yIGFueSBsaXN0ZW5lcnMgb3V0IHRoZXJlCiAgICAgICAgICAgICAgICBpdGVtLnBhZ2VYID0gcGFyc2VJbnQoaXRlbS5zZXJpZXMueGF4aXMucDJjKGl0ZW0uZGF0YXBvaW50WzBdKSArIG9mZnNldC5sZWZ0ICsgcGxvdE9mZnNldC5sZWZ0LCAxMCk7CiAgICAgICAgICAgICAgICBpdGVtLnBhZ2VZID0gcGFyc2VJbnQoaXRlbS5zZXJpZXMueWF4aXMucDJjKGl0ZW0uZGF0YXBvaW50WzFdKSArIG9mZnNldC50b3AgKyBwbG90T2Zmc2V0LnRvcCwgMTApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAob3B0aW9ucy5ncmlkLmF1dG9IaWdobGlnaHQpIHsKICAgICAgICAgICAgICAgIC8vIGNsZWFyIGF1dG8taGlnaGxpZ2h0cwogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoaWdobGlnaHRzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGggPSBoaWdobGlnaHRzW2ldOwogICAgICAgICAgICAgICAgICAgIGlmIChoLmF1dG8gPT0gZXZlbnRuYW1lICYmCiAgICAgICAgICAgICAgICAgICAgICAgICEoaXRlbSAmJiBoLnNlcmllcyA9PSBpdGVtLnNlcmllcyAmJgogICAgICAgICAgICAgICAgICAgICAgICAgIGgucG9pbnRbMF0gPT0gaXRlbS5kYXRhcG9pbnRbMF0gJiYKICAgICAgICAgICAgICAgICAgICAgICAgICBoLnBvaW50WzFdID09IGl0ZW0uZGF0YXBvaW50WzFdKSkKICAgICAgICAgICAgICAgICAgICAgICAgdW5oaWdobGlnaHQoaC5zZXJpZXMsIGgucG9pbnQpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChpdGVtKQogICAgICAgICAgICAgICAgICAgIGhpZ2hsaWdodChpdGVtLnNlcmllcywgaXRlbS5kYXRhcG9pbnQsIGV2ZW50bmFtZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHBsYWNlaG9sZGVyLnRyaWdnZXIoZXZlbnRuYW1lLCBbIHBvcywgaXRlbSBdKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHRyaWdnZXJSZWRyYXdPdmVybGF5KCkgewogICAgICAgICAgICB2YXIgdCA9IG9wdGlvbnMuaW50ZXJhY3Rpb24ucmVkcmF3T3ZlcmxheUludGVydmFsOwogICAgICAgICAgICBpZiAodCA9PSAtMSkgeyAgICAgIC8vIHNraXAgZXZlbnQgcXVldWUKICAgICAgICAgICAgICAgIGRyYXdPdmVybGF5KCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghcmVkcmF3VGltZW91dCkKICAgICAgICAgICAgICAgIHJlZHJhd1RpbWVvdXQgPSBzZXRUaW1lb3V0KGRyYXdPdmVybGF5LCB0KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGRyYXdPdmVybGF5KCkgewogICAgICAgICAgICByZWRyYXdUaW1lb3V0ID0gbnVsbDsKCiAgICAgICAgICAgIC8vIGRyYXcgaGlnaGxpZ2h0cwogICAgICAgICAgICBvY3R4LnNhdmUoKTsKICAgICAgICAgICAgb3ZlcmxheS5jbGVhcigpOwogICAgICAgICAgICBvY3R4LnRyYW5zbGF0ZShwbG90T2Zmc2V0LmxlZnQsIHBsb3RPZmZzZXQudG9wKTsKCiAgICAgICAgICAgIHZhciBpLCBoaTsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGhpZ2hsaWdodHMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICAgIGhpID0gaGlnaGxpZ2h0c1tpXTsKCiAgICAgICAgICAgICAgICBpZiAoaGkuc2VyaWVzLmJhcnMuc2hvdykKICAgICAgICAgICAgICAgICAgICBkcmF3QmFySGlnaGxpZ2h0KGhpLnNlcmllcywgaGkucG9pbnQpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGRyYXdQb2ludEhpZ2hsaWdodChoaS5zZXJpZXMsIGhpLnBvaW50KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBvY3R4LnJlc3RvcmUoKTsKCiAgICAgICAgICAgIGV4ZWN1dGVIb29rcyhob29rcy5kcmF3T3ZlcmxheSwgW29jdHhdKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGhpZ2hsaWdodChzLCBwb2ludCwgYXV0bykgewogICAgICAgICAgICBpZiAodHlwZW9mIHMgPT0gIm51bWJlciIpCiAgICAgICAgICAgICAgICBzID0gc2VyaWVzW3NdOwoKICAgICAgICAgICAgaWYgKHR5cGVvZiBwb2ludCA9PSAibnVtYmVyIikgewogICAgICAgICAgICAgICAgdmFyIHBzID0gcy5kYXRhcG9pbnRzLnBvaW50c2l6ZTsKICAgICAgICAgICAgICAgIHBvaW50ID0gcy5kYXRhcG9pbnRzLnBvaW50cy5zbGljZShwcyAqIHBvaW50LCBwcyAqIChwb2ludCArIDEpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGkgPSBpbmRleE9mSGlnaGxpZ2h0KHMsIHBvaW50KTsKICAgICAgICAgICAgaWYgKGkgPT0gLTEpIHsKICAgICAgICAgICAgICAgIGhpZ2hsaWdodHMucHVzaCh7IHNlcmllczogcywgcG9pbnQ6IHBvaW50LCBhdXRvOiBhdXRvIH0pOwoKICAgICAgICAgICAgICAgIHRyaWdnZXJSZWRyYXdPdmVybGF5KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoIWF1dG8pCiAgICAgICAgICAgICAgICBoaWdobGlnaHRzW2ldLmF1dG8gPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHVuaGlnaGxpZ2h0KHMsIHBvaW50KSB7CiAgICAgICAgICAgIGlmIChzID09IG51bGwgJiYgcG9pbnQgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaGlnaGxpZ2h0cyA9IFtdOwogICAgICAgICAgICAgICAgdHJpZ2dlclJlZHJhd092ZXJsYXkoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHR5cGVvZiBzID09ICJudW1iZXIiKQogICAgICAgICAgICAgICAgcyA9IHNlcmllc1tzXTsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgcG9pbnQgPT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICAgIHZhciBwcyA9IHMuZGF0YXBvaW50cy5wb2ludHNpemU7CiAgICAgICAgICAgICAgICBwb2ludCA9IHMuZGF0YXBvaW50cy5wb2ludHMuc2xpY2UocHMgKiBwb2ludCwgcHMgKiAocG9pbnQgKyAxKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBpID0gaW5kZXhPZkhpZ2hsaWdodChzLCBwb2ludCk7CiAgICAgICAgICAgIGlmIChpICE9IC0xKSB7CiAgICAgICAgICAgICAgICBoaWdobGlnaHRzLnNwbGljZShpLCAxKTsKCiAgICAgICAgICAgICAgICB0cmlnZ2VyUmVkcmF3T3ZlcmxheSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBpbmRleE9mSGlnaGxpZ2h0KHMsIHApIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoaWdobGlnaHRzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgICAgICB2YXIgaCA9IGhpZ2hsaWdodHNbaV07CiAgICAgICAgICAgICAgICBpZiAoaC5zZXJpZXMgPT0gcyAmJiBoLnBvaW50WzBdID09IHBbMF0KICAgICAgICAgICAgICAgICAgICAmJiBoLnBvaW50WzFdID09IHBbMV0pCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZHJhd1BvaW50SGlnaGxpZ2h0KHNlcmllcywgcG9pbnQpIHsKICAgICAgICAgICAgdmFyIHggPSBwb2ludFswXSwgeSA9IHBvaW50WzFdLAogICAgICAgICAgICAgICAgYXhpc3ggPSBzZXJpZXMueGF4aXMsIGF4aXN5ID0gc2VyaWVzLnlheGlzLAogICAgICAgICAgICAgICAgaGlnaGxpZ2h0Q29sb3IgPSAodHlwZW9mIHNlcmllcy5oaWdobGlnaHRDb2xvciA9PT0gInN0cmluZyIpID8gc2VyaWVzLmhpZ2hsaWdodENvbG9yIDogJC5jb2xvci5wYXJzZShzZXJpZXMuY29sb3IpLnNjYWxlKCdhJywgMC41KS50b1N0cmluZygpOwoKICAgICAgICAgICAgaWYgKHggPCBheGlzeC5taW4gfHwgeCA+IGF4aXN4Lm1heCB8fCB5IDwgYXhpc3kubWluIHx8IHkgPiBheGlzeS5tYXgpCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICB2YXIgcG9pbnRSYWRpdXMgPSBzZXJpZXMucG9pbnRzLnJhZGl1cyArIHNlcmllcy5wb2ludHMubGluZVdpZHRoIC8gMjsKICAgICAgICAgICAgb2N0eC5saW5lV2lkdGggPSBwb2ludFJhZGl1czsKICAgICAgICAgICAgb2N0eC5zdHJva2VTdHlsZSA9IGhpZ2hsaWdodENvbG9yOwogICAgICAgICAgICB2YXIgcmFkaXVzID0gMS41ICogcG9pbnRSYWRpdXM7CiAgICAgICAgICAgIHggPSBheGlzeC5wMmMoeCk7CiAgICAgICAgICAgIHkgPSBheGlzeS5wMmMoeSk7CgogICAgICAgICAgICBvY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICBpZiAoc2VyaWVzLnBvaW50cy5zeW1ib2wgPT0gImNpcmNsZSIpCiAgICAgICAgICAgICAgICBvY3R4LmFyYyh4LCB5LCByYWRpdXMsIDAsIDIgKiBNYXRoLlBJLCBmYWxzZSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHNlcmllcy5wb2ludHMuc3ltYm9sKG9jdHgsIHgsIHksIHJhZGl1cywgZmFsc2UpOwogICAgICAgICAgICBvY3R4LmNsb3NlUGF0aCgpOwogICAgICAgICAgICBvY3R4LnN0cm9rZSgpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZHJhd0JhckhpZ2hsaWdodChzZXJpZXMsIHBvaW50KSB7CiAgICAgICAgICAgIHZhciBoaWdobGlnaHRDb2xvciA9ICh0eXBlb2Ygc2VyaWVzLmhpZ2hsaWdodENvbG9yID09PSAic3RyaW5nIikgPyBzZXJpZXMuaGlnaGxpZ2h0Q29sb3IgOiAkLmNvbG9yLnBhcnNlKHNlcmllcy5jb2xvcikuc2NhbGUoJ2EnLCAwLjUpLnRvU3RyaW5nKCksCiAgICAgICAgICAgICAgICBmaWxsU3R5bGUgPSBoaWdobGlnaHRDb2xvciwKICAgICAgICAgICAgICAgIGJhckxlZnQ7CgogICAgICAgICAgICBzd2l0Y2ggKHNlcmllcy5iYXJzLmFsaWduKSB7CiAgICAgICAgICAgICAgICBjYXNlICJsZWZ0IjoKICAgICAgICAgICAgICAgICAgICBiYXJMZWZ0ID0gMDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgInJpZ2h0IjoKICAgICAgICAgICAgICAgICAgICBiYXJMZWZ0ID0gLXNlcmllcy5iYXJzLmJhcldpZHRoOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBiYXJMZWZ0ID0gLXNlcmllcy5iYXJzLmJhcldpZHRoIC8gMjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgb2N0eC5saW5lV2lkdGggPSBzZXJpZXMuYmFycy5saW5lV2lkdGg7CiAgICAgICAgICAgIG9jdHguc3Ryb2tlU3R5bGUgPSBoaWdobGlnaHRDb2xvcjsKCiAgICAgICAgICAgIGRyYXdCYXIocG9pbnRbMF0sIHBvaW50WzFdLCBwb2ludFsyXSB8fCAwLCBiYXJMZWZ0LCBiYXJMZWZ0ICsgc2VyaWVzLmJhcnMuYmFyV2lkdGgsCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkgeyByZXR1cm4gZmlsbFN0eWxlOyB9LCBzZXJpZXMueGF4aXMsIHNlcmllcy55YXhpcywgb2N0eCwgc2VyaWVzLmJhcnMuaG9yaXpvbnRhbCwgc2VyaWVzLmJhcnMubGluZVdpZHRoKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdldENvbG9yT3JHcmFkaWVudChzcGVjLCBib3R0b20sIHRvcCwgZGVmYXVsdENvbG9yKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2Ygc3BlYyA9PSAic3RyaW5nIikKICAgICAgICAgICAgICAgIHJldHVybiBzcGVjOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIGFzc3VtZSB0aGlzIGlzIGEgZ3JhZGllbnQgc3BlYzsgSUUgY3VycmVudGx5IG9ubHkKICAgICAgICAgICAgICAgIC8vIHN1cHBvcnRzIGEgc2ltcGxlIHZlcnRpY2FsIGdyYWRpZW50IHByb3Blcmx5LCBzbyB0aGF0J3MKICAgICAgICAgICAgICAgIC8vIHdoYXQgd2Ugc3VwcG9ydCB0b28KICAgICAgICAgICAgICAgIHZhciBncmFkaWVudCA9IGN0eC5jcmVhdGVMaW5lYXJHcmFkaWVudCgwLCB0b3AsIDAsIGJvdHRvbSk7CgogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBzcGVjLmNvbG9ycy5sZW5ndGg7IGkgPCBsOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHNwZWMuY29sb3JzW2ldOwogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYyAhPSAic3RyaW5nIikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY28gPSAkLmNvbG9yLnBhcnNlKGRlZmF1bHRDb2xvcik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjLmJyaWdodG5lc3MgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvID0gY28uc2NhbGUoJ3JnYicsIGMuYnJpZ2h0bmVzcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjLm9wYWNpdHkgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvLmEgKj0gYy5vcGFjaXR5OwogICAgICAgICAgICAgICAgICAgICAgICBjID0gY28udG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKGkgLyAobCAtIDEpLCBjKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gZ3JhZGllbnQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8gQWRkIHRoZSBwbG90IGZ1bmN0aW9uIHRvIHRoZSB0b3AgbGV2ZWwgb2YgdGhlIGpRdWVyeSBvYmplY3QKCiAgICAkLnBsb3QgPSBmdW5jdGlvbihwbGFjZWhvbGRlciwgZGF0YSwgb3B0aW9ucykgewogICAgICAgIC8vdmFyIHQwID0gbmV3IERhdGUoKTsKICAgICAgICB2YXIgcGxvdCA9IG5ldyBQbG90KCQocGxhY2Vob2xkZXIpLCBkYXRhLCBvcHRpb25zLCAkLnBsb3QucGx1Z2lucyk7CiAgICAgICAgLy8od2luZG93LmNvbnNvbGUgPyBjb25zb2xlLmxvZyA6IGFsZXJ0KSgidGltZSB1c2VkIChtc2Vjcyk6ICIgKyAoKG5ldyBEYXRlKCkpLmdldFRpbWUoKSAtIHQwLmdldFRpbWUoKSkpOwogICAgICAgIHJldHVybiBwbG90OwogICAgfTsKCiAgICAkLnBsb3QudmVyc2lvbiA9ICIwLjguMyI7CgogICAgJC5wbG90LnBsdWdpbnMgPSBbXTsKCiAgICAvLyBBbHNvIGFkZCB0aGUgcGxvdCBmdW5jdGlvbiBhcyBhIGNoYWluYWJsZSBwcm9wZXJ0eQoKICAgICQuZm4ucGxvdCA9IGZ1bmN0aW9uKGRhdGEsIG9wdGlvbnMpIHsKICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAkLnBsb3QodGhpcywgZGF0YSwgb3B0aW9ucyk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIC8vIHJvdW5kIHRvIG5lYXJieSBsb3dlciBtdWx0aXBsZSBvZiBiYXNlCiAgICBmdW5jdGlvbiBmbG9vckluQmFzZShuLCBiYXNlKSB7CiAgICAgICAgcmV0dXJuIGJhc2UgKiBNYXRoLmZsb29yKG4gLyBiYXNlKTsKICAgIH0KCn0pKGpRdWVyeSk7Cjwvc2NyaXB0Pg0KCQk8c2NyaXB0IHR5cGU9ImFwcGxpY2F0aW9uL2phdmFzY3JpcHQiPi8qIEZsb3QgcGx1Z2luIGZvciByZW5kZXJpbmcgcGllIGNoYXJ0cy4KCkNvcHlyaWdodCAoYykgMjAwNy0yMDE0IElPTEEgYW5kIE9sZSBMYXVyc2VuLgpMaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCgpUaGUgcGx1Z2luIGFzc3VtZXMgdGhhdCBlYWNoIHNlcmllcyBoYXMgYSBzaW5nbGUgZGF0YSB2YWx1ZSwgYW5kIHRoYXQgZWFjaAp2YWx1ZSBpcyBhIHBvc2l0aXZlIGludGVnZXIgb3IgemVyby4gIE5lZ2F0aXZlIG51bWJlcnMgZG9uJ3QgbWFrZSBzZW5zZSBmb3IgYQpwaWUgY2hhcnQsIGFuZCBoYXZlIHVucHJlZGljdGFibGUgcmVzdWx0cy4gIFRoZSB2YWx1ZXMgZG8gTk9UIG5lZWQgdG8gYmUKcGFzc2VkIGluIGFzIHBlcmNlbnRhZ2VzOyB0aGUgcGx1Z2luIHdpbGwgY2FsY3VsYXRlIHRoZSB0b3RhbCBhbmQgcGVyLXNsaWNlCnBlcmNlbnRhZ2VzIGludGVybmFsbHkuCgoqIENyZWF0ZWQgYnkgQnJpYW4gTWVkZW5kb3JwCgoqIFVwZGF0ZWQgd2l0aCBjb250cmlidXRpb25zIGZyb20gYnRidXJuZXR0MywgQW50aG9ueSBBcmFndWVzIGFuZCBYYXZpIEl2YXJzCgpUaGUgcGx1Z2luIHN1cHBvcnRzIHRoZXNlIG9wdGlvbnM6CgoJc2VyaWVzOiB7CgkJcGllOiB7CgkJCXNob3c6IHRydWUvZmFsc2UKCQkJcmFkaXVzOiAwLTEgZm9yIHBlcmNlbnRhZ2Ugb2YgZnVsbHNpemUsIG9yIGEgc3BlY2lmaWVkIHBpeGVsIGxlbmd0aCwgb3IgJ2F1dG8nCgkJCWlubmVyUmFkaXVzOiAwLTEgZm9yIHBlcmNlbnRhZ2Ugb2YgZnVsbHNpemUgb3IgYSBzcGVjaWZpZWQgcGl4ZWwgbGVuZ3RoLCBmb3IgY3JlYXRpbmcgYSBkb251dCBlZmZlY3QKCQkJc3RhcnRBbmdsZTogMC0yIGZhY3RvciBvZiBQSSB1c2VkIGZvciBzdGFydGluZyBhbmdsZSAoaW4gcmFkaWFucykgaS5lIDMvMiBzdGFydHMgYXQgdGhlIHRvcCwgMCBhbmQgMiBoYXZlIHRoZSBzYW1lIHJlc3VsdAoJCQl0aWx0OiAwLTEgZm9yIHBlcmNlbnRhZ2UgdG8gdGlsdCB0aGUgcGllLCB3aGVyZSAxIGlzIG5vIHRpbHQsIGFuZCAwIGlzIGNvbXBsZXRlbHkgZmxhdCAobm90aGluZyB3aWxsIHNob3cpCgkJCW9mZnNldDogewoJCQkJdG9wOiBpbnRlZ2VyIHZhbHVlIHRvIG1vdmUgdGhlIHBpZSB1cCBvciBkb3duCgkJCQlsZWZ0OiBpbnRlZ2VyIHZhbHVlIHRvIG1vdmUgdGhlIHBpZSBsZWZ0IG9yIHJpZ2h0LCBvciAnYXV0bycKCQkJfSwKCQkJc3Ryb2tlOiB7CgkJCQljb2xvcjogYW55IGhleGlkZWNpbWFsIGNvbG9yIHZhbHVlIChvdGhlciBmb3JtYXRzIG1heSBvciBtYXkgbm90IHdvcmssIHNvIGJlc3QgdG8gc3RpY2sgd2l0aCBzb21ldGhpbmcgbGlrZSAnI0ZGRicpCgkJCQl3aWR0aDogaW50ZWdlciBwaXhlbCB3aWR0aCBvZiB0aGUgc3Ryb2tlCgkJCX0sCgkJCWxhYmVsOiB7CgkJCQlzaG93OiB0cnVlL2ZhbHNlLCBvciAnYXV0bycKCQkJCWZvcm1hdHRlcjogIGEgdXNlci1kZWZpbmVkIGZ1bmN0aW9uIHRoYXQgbW9kaWZpZXMgdGhlIHRleHQvc3R5bGUgb2YgdGhlIGxhYmVsIHRleHQKCQkJCXJhZGl1czogMC0xIGZvciBwZXJjZW50YWdlIG9mIGZ1bGxzaXplLCBvciBhIHNwZWNpZmllZCBwaXhlbCBsZW5ndGgKCQkJCWJhY2tncm91bmQ6IHsKCQkJCQljb2xvcjogYW55IGhleGlkZWNpbWFsIGNvbG9yIHZhbHVlIChvdGhlciBmb3JtYXRzIG1heSBvciBtYXkgbm90IHdvcmssIHNvIGJlc3QgdG8gc3RpY2sgd2l0aCBzb21ldGhpbmcgbGlrZSAnIzAwMCcpCgkJCQkJb3BhY2l0eTogMC0xCgkJCQl9LAoJCQkJdGhyZXNob2xkOiAwLTEgZm9yIHRoZSBwZXJjZW50YWdlIHZhbHVlIGF0IHdoaWNoIHRvIGhpZGUgbGFiZWxzIChpZiB0aGV5J3JlIHRvbyBzbWFsbCkKCQkJfSwKCQkJY29tYmluZTogewoJCQkJdGhyZXNob2xkOiAwLTEgZm9yIHRoZSBwZXJjZW50YWdlIHZhbHVlIGF0IHdoaWNoIHRvIGNvbWJpbmUgc2xpY2VzIChpZiB0aGV5J3JlIHRvbyBzbWFsbCkKCQkJCWNvbG9yOiBhbnkgaGV4aWRlY2ltYWwgY29sb3IgdmFsdWUgKG90aGVyIGZvcm1hdHMgbWF5IG9yIG1heSBub3Qgd29yaywgc28gYmVzdCB0byBzdGljayB3aXRoIHNvbWV0aGluZyBsaWtlICcjQ0NDJyksIGlmIG51bGwsIHRoZSBwbHVnaW4gd2lsbCBhdXRvbWF0aWNhbGx5IHVzZSB0aGUgY29sb3Igb2YgdGhlIGZpcnN0IHNsaWNlIHRvIGJlIGNvbWJpbmVkCgkJCQlsYWJlbDogYW55IHRleHQgdmFsdWUgb2Ygd2hhdCB0aGUgY29tYmluZWQgc2xpY2Ugc2hvdWxkIGJlIGxhYmVsZWQKCQkJfQoJCQloaWdobGlnaHQ6IHsKCQkJCW9wYWNpdHk6IDAtMQoJCQl9CgkJfQoJfQoKTW9yZSBkZXRhaWwgYW5kIHNwZWNpZmljIGV4YW1wbGVzIGNhbiBiZSBmb3VuZCBpbiB0aGUgaW5jbHVkZWQgSFRNTCBmaWxlLgoKKi8KCihmdW5jdGlvbigkKSB7CgoJLy8gTWF4aW11bSByZWRyYXcgYXR0ZW1wdHMgd2hlbiBmaXR0aW5nIGxhYmVscyB3aXRoaW4gdGhlIHBsb3QKCgl2YXIgUkVEUkFXX0FUVEVNUFRTID0gMTA7CgoJLy8gRmFjdG9yIGJ5IHdoaWNoIHRvIHNocmluayB0aGUgcGllIHdoZW4gZml0dGluZyBsYWJlbHMgd2l0aGluIHRoZSBwbG90CgoJdmFyIFJFRFJBV19TSFJJTksgPSAwLjk1OwoKCWZ1bmN0aW9uIGluaXQocGxvdCkgewoKCQl2YXIgY2FudmFzID0gbnVsbCwKCQkJdGFyZ2V0ID0gbnVsbCwKCQkJb3B0aW9ucyA9IG51bGwsCgkJCW1heFJhZGl1cyA9IG51bGwsCgkJCWNlbnRlckxlZnQgPSBudWxsLAoJCQljZW50ZXJUb3AgPSBudWxsLAoJCQlwcm9jZXNzZWQgPSBmYWxzZSwKCQkJY3R4ID0gbnVsbDsKCgkJLy8gaW50ZXJhY3RpdmUgdmFyaWFibGVzCgoJCXZhciBoaWdobGlnaHRzID0gW107CgoJCS8vIGFkZCBob29rIHRvIGRldGVybWluZSBpZiBwaWUgcGx1Z2luIGluIGVuYWJsZWQsIGFuZCB0aGVuIHBlcmZvcm0gbmVjZXNzYXJ5IG9wZXJhdGlvbnMKCgkJcGxvdC5ob29rcy5wcm9jZXNzT3B0aW9ucy5wdXNoKGZ1bmN0aW9uKHBsb3QsIG9wdGlvbnMpIHsKCQkJaWYgKG9wdGlvbnMuc2VyaWVzLnBpZS5zaG93KSB7CgoJCQkJb3B0aW9ucy5ncmlkLnNob3cgPSBmYWxzZTsKCgkJCQkvLyBzZXQgbGFiZWxzLnNob3cKCgkJCQlpZiAob3B0aW9ucy5zZXJpZXMucGllLmxhYmVsLnNob3cgPT0gImF1dG8iKSB7CgkJCQkJaWYgKG9wdGlvbnMubGVnZW5kLnNob3cpIHsKCQkJCQkJb3B0aW9ucy5zZXJpZXMucGllLmxhYmVsLnNob3cgPSBmYWxzZTsKCQkJCQl9IGVsc2UgewoJCQkJCQlvcHRpb25zLnNlcmllcy5waWUubGFiZWwuc2hvdyA9IHRydWU7CgkJCQkJfQoJCQkJfQoKCQkJCS8vIHNldCByYWRpdXMKCgkJCQlpZiAob3B0aW9ucy5zZXJpZXMucGllLnJhZGl1cyA9PSAiYXV0byIpIHsKCQkJCQlpZiAob3B0aW9ucy5zZXJpZXMucGllLmxhYmVsLnNob3cpIHsKCQkJCQkJb3B0aW9ucy5zZXJpZXMucGllLnJhZGl1cyA9IDMvNDsKCQkJCQl9IGVsc2UgewoJCQkJCQlvcHRpb25zLnNlcmllcy5waWUucmFkaXVzID0gMTsKCQkJCQl9CgkJCQl9CgoJCQkJLy8gZW5zdXJlIHNhbmUgdGlsdAoKCQkJCWlmIChvcHRpb25zLnNlcmllcy5waWUudGlsdCA+IDEpIHsKCQkJCQlvcHRpb25zLnNlcmllcy5waWUudGlsdCA9IDE7CgkJCQl9IGVsc2UgaWYgKG9wdGlvbnMuc2VyaWVzLnBpZS50aWx0IDwgMCkgewoJCQkJCW9wdGlvbnMuc2VyaWVzLnBpZS50aWx0ID0gMDsKCQkJCX0KCQkJfQoJCX0pOwoKCQlwbG90Lmhvb2tzLmJpbmRFdmVudHMucHVzaChmdW5jdGlvbihwbG90LCBldmVudEhvbGRlcikgewoJCQl2YXIgb3B0aW9ucyA9IHBsb3QuZ2V0T3B0aW9ucygpOwoJCQlpZiAob3B0aW9ucy5zZXJpZXMucGllLnNob3cpIHsKCQkJCWlmIChvcHRpb25zLmdyaWQuaG92ZXJhYmxlKSB7CgkJCQkJZXZlbnRIb2xkZXIudW5iaW5kKCJtb3VzZW1vdmUiKS5tb3VzZW1vdmUob25Nb3VzZU1vdmUpOwoJCQkJfQoJCQkJaWYgKG9wdGlvbnMuZ3JpZC5jbGlja2FibGUpIHsKCQkJCQlldmVudEhvbGRlci51bmJpbmQoImNsaWNrIikuY2xpY2sob25DbGljayk7CgkJCQl9CgkJCX0KCQl9KTsKCgkJcGxvdC5ob29rcy5wcm9jZXNzRGF0YXBvaW50cy5wdXNoKGZ1bmN0aW9uKHBsb3QsIHNlcmllcywgZGF0YSwgZGF0YXBvaW50cykgewoJCQl2YXIgb3B0aW9ucyA9IHBsb3QuZ2V0T3B0aW9ucygpOwoJCQlpZiAob3B0aW9ucy5zZXJpZXMucGllLnNob3cpIHsKCQkJCXByb2Nlc3NEYXRhcG9pbnRzKHBsb3QsIHNlcmllcywgZGF0YSwgZGF0YXBvaW50cyk7CgkJCX0KCQl9KTsKCgkJcGxvdC5ob29rcy5kcmF3T3ZlcmxheS5wdXNoKGZ1bmN0aW9uKHBsb3QsIG9jdHgpIHsKCQkJdmFyIG9wdGlvbnMgPSBwbG90LmdldE9wdGlvbnMoKTsKCQkJaWYgKG9wdGlvbnMuc2VyaWVzLnBpZS5zaG93KSB7CgkJCQlkcmF3T3ZlcmxheShwbG90LCBvY3R4KTsKCQkJfQoJCX0pOwoKCQlwbG90Lmhvb2tzLmRyYXcucHVzaChmdW5jdGlvbihwbG90LCBuZXdDdHgpIHsKCQkJdmFyIG9wdGlvbnMgPSBwbG90LmdldE9wdGlvbnMoKTsKCQkJaWYgKG9wdGlvbnMuc2VyaWVzLnBpZS5zaG93KSB7CgkJCQlkcmF3KHBsb3QsIG5ld0N0eCk7CgkJCX0KCQl9KTsKCgkJZnVuY3Rpb24gcHJvY2Vzc0RhdGFwb2ludHMocGxvdCwgc2VyaWVzLCBkYXRhcG9pbnRzKSB7CgkJCWlmICghcHJvY2Vzc2VkKQl7CgkJCQlwcm9jZXNzZWQgPSB0cnVlOwoJCQkJY2FudmFzID0gcGxvdC5nZXRDYW52YXMoKTsKCQkJCXRhcmdldCA9ICQoY2FudmFzKS5wYXJlbnQoKTsKCQkJCW9wdGlvbnMgPSBwbG90LmdldE9wdGlvbnMoKTsKCQkJCXBsb3Quc2V0RGF0YShjb21iaW5lKHBsb3QuZ2V0RGF0YSgpKSk7CgkJCX0KCQl9CgoJCWZ1bmN0aW9uIGNvbWJpbmUoZGF0YSkgewoKCQkJdmFyIHRvdGFsID0gMCwKCQkJCWNvbWJpbmVkID0gMCwKCQkJCW51bUNvbWJpbmVkID0gMCwKCQkJCWNvbG9yID0gb3B0aW9ucy5zZXJpZXMucGllLmNvbWJpbmUuY29sb3IsCgkJCQluZXdkYXRhID0gW107CgoJCQkvLyBGaXggdXAgdGhlIHJhdyBkYXRhIGZyb20gRmxvdCwgZW5zdXJpbmcgdGhlIGRhdGEgaXMgbnVtZXJpYwoKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgKytpKSB7CgoJCQkJdmFyIHZhbHVlID0gZGF0YVtpXS5kYXRhOwoKCQkJCS8vIElmIHRoZSBkYXRhIGlzIGFuIGFycmF5LCB3ZSdsbCBhc3N1bWUgdGhhdCBpdCdzIGEgc3RhbmRhcmQKCQkJCS8vIEZsb3QgeC15IHBhaXIsIGFuZCBhcmUgY29uY2VybmVkIG9ubHkgd2l0aCB0aGUgc2Vjb25kIHZhbHVlLgoKCQkJCS8vIE5vdGUgaG93IHdlIHVzZSB0aGUgb3JpZ2luYWwgYXJyYXksIHJhdGhlciB0aGFuIGNyZWF0aW5nIGEKCQkJCS8vIG5ldyBvbmU7IHRoaXMgaXMgbW9yZSBlZmZpY2llbnQgYW5kIHByZXNlcnZlcyBhbnkgZXh0cmEgZGF0YQoJCQkJLy8gdGhhdCB0aGUgdXNlciBtYXkgaGF2ZSBzdG9yZWQgaW4gaGlnaGVyIGluZGV4ZXMuCgoJCQkJaWYgKCQuaXNBcnJheSh2YWx1ZSkgJiYgdmFsdWUubGVuZ3RoID09IDEpIHsKICAgIAkJCQl2YWx1ZSA9IHZhbHVlWzBdOwoJCQkJfQoKCQkJCWlmICgkLmlzQXJyYXkodmFsdWUpKSB7CgkJCQkJLy8gRXF1aXZhbGVudCB0byAkLmlzTnVtZXJpYygpIGJ1dCBjb21wYXRpYmxlIHdpdGggalF1ZXJ5IDwgMS43CgkJCQkJaWYgKCFpc05hTihwYXJzZUZsb2F0KHZhbHVlWzFdKSkgJiYgaXNGaW5pdGUodmFsdWVbMV0pKSB7CgkJCQkJCXZhbHVlWzFdID0gK3ZhbHVlWzFdOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXZhbHVlWzFdID0gMDsKCQkJCQl9CgkJCQl9IGVsc2UgaWYgKCFpc05hTihwYXJzZUZsb2F0KHZhbHVlKSkgJiYgaXNGaW5pdGUodmFsdWUpKSB7CgkJCQkJdmFsdWUgPSBbMSwgK3ZhbHVlXTsKCQkJCX0gZWxzZSB7CgkJCQkJdmFsdWUgPSBbMSwgMF07CgkJCQl9CgoJCQkJZGF0YVtpXS5kYXRhID0gW3ZhbHVlXTsKCQkJfQoKCQkJLy8gU3VtIHVwIGFsbCB0aGUgc2xpY2VzLCBzbyB3ZSBjYW4gY2FsY3VsYXRlIHBlcmNlbnRhZ2VzIGZvciBlYWNoCgoJCQlmb3IgKHZhciBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyArK2kpIHsKCQkJCXRvdGFsICs9IGRhdGFbaV0uZGF0YVswXVsxXTsKCQkJfQoKCQkJLy8gQ291bnQgdGhlIG51bWJlciBvZiBzbGljZXMgd2l0aCBwZXJjZW50YWdlcyBiZWxvdyB0aGUgY29tYmluZQoJCQkvLyB0aHJlc2hvbGQ7IGlmIGl0IHR1cm5zIG91dCB0byBiZSBqdXN0IG9uZSwgd2Ugd29uJ3QgY29tYmluZS4KCgkJCWZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7ICsraSkgewoJCQkJdmFyIHZhbHVlID0gZGF0YVtpXS5kYXRhWzBdWzFdOwoJCQkJaWYgKHZhbHVlIC8gdG90YWwgPD0gb3B0aW9ucy5zZXJpZXMucGllLmNvbWJpbmUudGhyZXNob2xkKSB7CgkJCQkJY29tYmluZWQgKz0gdmFsdWU7CgkJCQkJbnVtQ29tYmluZWQrKzsKCQkJCQlpZiAoIWNvbG9yKSB7CgkJCQkJCWNvbG9yID0gZGF0YVtpXS5jb2xvcjsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCWZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7ICsraSkgewoJCQkJdmFyIHZhbHVlID0gZGF0YVtpXS5kYXRhWzBdWzFdOwoJCQkJaWYgKG51bUNvbWJpbmVkIDwgMiB8fCB2YWx1ZSAvIHRvdGFsID4gb3B0aW9ucy5zZXJpZXMucGllLmNvbWJpbmUudGhyZXNob2xkKSB7CgkJCQkJbmV3ZGF0YS5wdXNoKAoJCQkJCQkkLmV4dGVuZChkYXRhW2ldLCB7ICAgICAvKiBleHRlbmQgdG8gYWxsb3cga2VlcGluZyBhbGwgb3RoZXIgb3JpZ2luYWwgZGF0YSB2YWx1ZXMKCQkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5kIHVzaW5nIHRoZW0gZS5nLiBpbiBsYWJlbEZvcm1hdHRlci4gKi8KCQkJCQkJCWRhdGE6IFtbMSwgdmFsdWVdXSwKCQkJCQkJCWNvbG9yOiBkYXRhW2ldLmNvbG9yLAoJCQkJCQkJbGFiZWw6IGRhdGFbaV0ubGFiZWwsCgkJCQkJCQlhbmdsZTogdmFsdWUgKiBNYXRoLlBJICogMiAvIHRvdGFsLAoJCQkJCQkJcGVyY2VudDogdmFsdWUgLyAodG90YWwgLyAxMDApCgkJCQkJCX0pCgkJCQkJKTsKCQkJCX0KCQkJfQoKCQkJaWYgKG51bUNvbWJpbmVkID4gMSkgewoJCQkJbmV3ZGF0YS5wdXNoKHsKCQkJCQlkYXRhOiBbWzEsIGNvbWJpbmVkXV0sCgkJCQkJY29sb3I6IGNvbG9yLAoJCQkJCWxhYmVsOiBvcHRpb25zLnNlcmllcy5waWUuY29tYmluZS5sYWJlbCwKCQkJCQlhbmdsZTogY29tYmluZWQgKiBNYXRoLlBJICogMiAvIHRvdGFsLAoJCQkJCXBlcmNlbnQ6IGNvbWJpbmVkIC8gKHRvdGFsIC8gMTAwKQoJCQkJfSk7CgkJCX0KCgkJCXJldHVybiBuZXdkYXRhOwoJCX0KCgkJZnVuY3Rpb24gZHJhdyhwbG90LCBuZXdDdHgpIHsKCgkJCWlmICghdGFyZ2V0KSB7CgkJCQlyZXR1cm47IC8vIGlmIG5vIHNlcmllcyB3ZXJlIHBhc3NlZAoJCQl9CgoJCQl2YXIgY2FudmFzV2lkdGggPSBwbG90LmdldFBsYWNlaG9sZGVyKCkud2lkdGgoKSwKCQkJCWNhbnZhc0hlaWdodCA9IHBsb3QuZ2V0UGxhY2Vob2xkZXIoKS5oZWlnaHQoKSwKCQkJCWxlZ2VuZFdpZHRoID0gdGFyZ2V0LmNoaWxkcmVuKCkuZmlsdGVyKCIubGVnZW5kIikuY2hpbGRyZW4oKS53aWR0aCgpIHx8IDA7CgoJCQljdHggPSBuZXdDdHg7CgoJCQkvLyBXQVJOSU5HOiBIQUNLISBSRVdSSVRFIFRISVMgQ09ERSBBUyBTT09OIEFTIFBPU1NJQkxFIQoKCQkJLy8gV2hlbiBjb21iaW5pbmcgc21hbGxlciBzbGljZXMgaW50byBhbiAnb3RoZXInIHNsaWNlLCB3ZSBuZWVkIHRvCgkJCS8vIGFkZCBhIG5ldyBzZXJpZXMuICBTaW5jZSBGbG90IGdpdmVzIHBsdWdpbnMgbm8gd2F5IHRvIG1vZGlmeSB0aGUKCQkJLy8gbGlzdCBvZiBzZXJpZXMsIHRoZSBwaWUgcGx1Z2luIHVzZXMgYSBoYWNrIHdoZXJlIHRoZSBmaXJzdCBjYWxsCgkJCS8vIHRvIHByb2Nlc3NEYXRhcG9pbnRzIHJlc3VsdHMgaW4gYSBjYWxsIHRvIHNldERhdGEgd2l0aCB0aGUgbmV3CgkJCS8vIGxpc3Qgb2Ygc2VyaWVzLCB0aGVuIHN1YnNlcXVlbnQgcHJvY2Vzc0RhdGFwb2ludHMgZG8gbm90aGluZy4KCgkJCS8vIFRoZSBwbHVnaW4tZ2xvYmFsICdwcm9jZXNzZWQnIGZsYWcgaXMgdXNlZCB0byBjb250cm9sIHRoaXMgaGFjazsKCQkJLy8gaXQgc3RhcnRzIG91dCBmYWxzZSwgYW5kIGlzIHNldCB0byB0cnVlIGFmdGVyIHRoZSBmaXJzdCBjYWxsIHRvCgkJCS8vIHByb2Nlc3NEYXRhcG9pbnRzLgoKCQkJLy8gVW5mb3J0dW5hdGVseSB0aGlzIHR1cm5zIGZ1dHVyZSBzZXREYXRhIGNhbGxzIGludG8gbm8tb3BzOyB0aGV5CgkJCS8vIGNhbGwgcHJvY2Vzc0RhdGFwb2ludHMsIHRoZSBmbGFnIGlzIHRydWUsIGFuZCBub3RoaW5nIGhhcHBlbnMuCgoJCQkvLyBUbyBmaXggdGhpcyB3ZSdsbCBzZXQgdGhlIGZsYWcgYmFjayB0byBmYWxzZSBoZXJlIGluIGRyYXcsIHdoZW4KCQkJLy8gYWxsIHNlcmllcyBoYXZlIGJlZW4gcHJvY2Vzc2VkLCBzbyB0aGUgbmV4dCBzZXF1ZW5jZSBvZiBjYWxscyB0bwoJCQkvLyBwcm9jZXNzRGF0YXBvaW50cyBvbmNlIGFnYWluIHN0YXJ0cyBvdXQgd2l0aCBhIHNsaWNlLWNvbWJpbmUuCgkJCS8vIFRoaXMgaXMgcmVhbGx5IGEgaGFjazsgaW4gMC45IHdlIG5lZWQgdG8gZ2l2ZSBwbHVnaW5zIGEgcHJvcGVyCgkJCS8vIHdheSB0byBtb2RpZnkgc2VyaWVzIGJlZm9yZSBhbnkgcHJvY2Vzc2luZyBiZWdpbnMuCgoJCQlwcm9jZXNzZWQgPSBmYWxzZTsKCgkJCS8vIGNhbGN1bGF0ZSBtYXhpbXVtIHJhZGl1cyBhbmQgY2VudGVyIHBvaW50CgoJCQltYXhSYWRpdXMgPSAgTWF0aC5taW4oY2FudmFzV2lkdGgsIGNhbnZhc0hlaWdodCAvIG9wdGlvbnMuc2VyaWVzLnBpZS50aWx0KSAvIDI7CgkJCWNlbnRlclRvcCA9IGNhbnZhc0hlaWdodCAvIDIgKyBvcHRpb25zLnNlcmllcy5waWUub2Zmc2V0LnRvcDsKCQkJY2VudGVyTGVmdCA9IGNhbnZhc1dpZHRoIC8gMjsKCgkJCWlmIChvcHRpb25zLnNlcmllcy5waWUub2Zmc2V0LmxlZnQgPT0gImF1dG8iKSB7CgkJCQlpZiAob3B0aW9ucy5sZWdlbmQucG9zaXRpb24ubWF0Y2goInciKSkgewoJCQkJCWNlbnRlckxlZnQgKz0gbGVnZW5kV2lkdGggLyAyOwoJCQkJfSBlbHNlIHsKCQkJCQljZW50ZXJMZWZ0IC09IGxlZ2VuZFdpZHRoIC8gMjsKCQkJCX0KCQkJCWlmIChjZW50ZXJMZWZ0IDwgbWF4UmFkaXVzKSB7CgkJCQkJY2VudGVyTGVmdCA9IG1heFJhZGl1czsKCQkJCX0gZWxzZSBpZiAoY2VudGVyTGVmdCA+IGNhbnZhc1dpZHRoIC0gbWF4UmFkaXVzKSB7CgkJCQkJY2VudGVyTGVmdCA9IGNhbnZhc1dpZHRoIC0gbWF4UmFkaXVzOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJY2VudGVyTGVmdCArPSBvcHRpb25zLnNlcmllcy5waWUub2Zmc2V0LmxlZnQ7CgkJCX0KCgkJCXZhciBzbGljZXMgPSBwbG90LmdldERhdGEoKSwKCQkJCWF0dGVtcHRzID0gMDsKCgkJCS8vIEtlZXAgc2hyaW5raW5nIHRoZSBwaWUncyByYWRpdXMgdW50aWwgZHJhd1BpZSByZXR1cm5zIHRydWUsCgkJCS8vIGluZGljYXRpbmcgdGhhdCBhbGwgdGhlIGxhYmVscyBmaXQsIG9yIHdlIHRyeSB0b28gbWFueSB0aW1lcy4KCgkJCWRvIHsKCQkJCWlmIChhdHRlbXB0cyA+IDApIHsKCQkJCQltYXhSYWRpdXMgKj0gUkVEUkFXX1NIUklOSzsKCQkJCX0KCQkJCWF0dGVtcHRzICs9IDE7CgkJCQljbGVhcigpOwoJCQkJaWYgKG9wdGlvbnMuc2VyaWVzLnBpZS50aWx0IDw9IDAuOCkgewoJCQkJCWRyYXdTaGFkb3coKTsKCQkJCX0KCQkJfSB3aGlsZSAoIWRyYXdQaWUoKSAmJiBhdHRlbXB0cyA8IFJFRFJBV19BVFRFTVBUUykKCgkJCWlmIChhdHRlbXB0cyA+PSBSRURSQVdfQVRURU1QVFMpIHsKCQkJCWNsZWFyKCk7CgkJCQl0YXJnZXQucHJlcGVuZCgiPGRpdiBjbGFzcz0nZXJyb3InPkNvdWxkIG5vdCBkcmF3IHBpZSB3aXRoIGxhYmVscyBjb250YWluZWQgaW5zaWRlIGNhbnZhczwvZGl2PiIpOwoJCQl9CgoJCQlpZiAocGxvdC5zZXRTZXJpZXMgJiYgcGxvdC5pbnNlcnRMZWdlbmQpIHsKCQkJCXBsb3Quc2V0U2VyaWVzKHNsaWNlcyk7CgkJCQlwbG90Lmluc2VydExlZ2VuZCgpOwoJCQl9CgoJCQkvLyB3ZSdyZSBhY3R1YWxseSBkb25lIGF0IHRoaXMgcG9pbnQsIGp1c3QgZGVmaW5pbmcgaW50ZXJuYWwgZnVuY3Rpb25zIGF0IHRoaXMgcG9pbnQKCgkJCWZ1bmN0aW9uIGNsZWFyKCkgewoJCQkJY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXNXaWR0aCwgY2FudmFzSGVpZ2h0KTsKCQkJCXRhcmdldC5jaGlsZHJlbigpLmZpbHRlcigiLnBpZUxhYmVsLCAucGllTGFiZWxCYWNrZ3JvdW5kIikucmVtb3ZlKCk7CgkJCX0KCgkJCWZ1bmN0aW9uIGRyYXdTaGFkb3coKSB7CgoJCQkJdmFyIHNoYWRvd0xlZnQgPSBvcHRpb25zLnNlcmllcy5waWUuc2hhZG93LmxlZnQ7CgkJCQl2YXIgc2hhZG93VG9wID0gb3B0aW9ucy5zZXJpZXMucGllLnNoYWRvdy50b3A7CgkJCQl2YXIgZWRnZSA9IDEwOwoJCQkJdmFyIGFscGhhID0gb3B0aW9ucy5zZXJpZXMucGllLnNoYWRvdy5hbHBoYTsKCQkJCXZhciByYWRpdXMgPSBvcHRpb25zLnNlcmllcy5waWUucmFkaXVzID4gMSA/IG9wdGlvbnMuc2VyaWVzLnBpZS5yYWRpdXMgOiBtYXhSYWRpdXMgKiBvcHRpb25zLnNlcmllcy5waWUucmFkaXVzOwoKCQkJCWlmIChyYWRpdXMgPj0gY2FudmFzV2lkdGggLyAyIC0gc2hhZG93TGVmdCB8fCByYWRpdXMgKiBvcHRpb25zLnNlcmllcy5waWUudGlsdCA+PSBjYW52YXNIZWlnaHQgLyAyIC0gc2hhZG93VG9wIHx8IHJhZGl1cyA8PSBlZGdlKSB7CgkJCQkJcmV0dXJuOwkvLyBzaGFkb3cgd291bGQgYmUgb3V0c2lkZSBjYW52YXMsIHNvIGRvbid0IGRyYXcgaXQKCQkJCX0KCgkJCQljdHguc2F2ZSgpOwoJCQkJY3R4LnRyYW5zbGF0ZShzaGFkb3dMZWZ0LHNoYWRvd1RvcCk7CgkJCQljdHguZ2xvYmFsQWxwaGEgPSBhbHBoYTsKCQkJCWN0eC5maWxsU3R5bGUgPSAiIzAwMCI7CgoJCQkJLy8gY2VudGVyIGFuZCByb3RhdGUgdG8gc3RhcnRpbmcgcG9zaXRpb24KCgkJCQljdHgudHJhbnNsYXRlKGNlbnRlckxlZnQsY2VudGVyVG9wKTsKCQkJCWN0eC5zY2FsZSgxLCBvcHRpb25zLnNlcmllcy5waWUudGlsdCk7CgoJCQkJLy9yYWRpdXMgLT0gZWRnZTsKCgkJCQlmb3IgKHZhciBpID0gMTsgaSA8PSBlZGdlOyBpKyspIHsKCQkJCQljdHguYmVnaW5QYXRoKCk7CgkJCQkJY3R4LmFyYygwLCAwLCByYWRpdXMsIDAsIE1hdGguUEkgKiAyLCBmYWxzZSk7CgkJCQkJY3R4LmZpbGwoKTsKCQkJCQlyYWRpdXMgLT0gaTsKCQkJCX0KCgkJCQljdHgucmVzdG9yZSgpOwoJCQl9CgoJCQlmdW5jdGlvbiBkcmF3UGllKCkgewoKCQkJCXZhciBzdGFydEFuZ2xlID0gTWF0aC5QSSAqIG9wdGlvbnMuc2VyaWVzLnBpZS5zdGFydEFuZ2xlOwoJCQkJdmFyIHJhZGl1cyA9IG9wdGlvbnMuc2VyaWVzLnBpZS5yYWRpdXMgPiAxID8gb3B0aW9ucy5zZXJpZXMucGllLnJhZGl1cyA6IG1heFJhZGl1cyAqIG9wdGlvbnMuc2VyaWVzLnBpZS5yYWRpdXM7CgoJCQkJLy8gY2VudGVyIGFuZCByb3RhdGUgdG8gc3RhcnRpbmcgcG9zaXRpb24KCgkJCQljdHguc2F2ZSgpOwoJCQkJY3R4LnRyYW5zbGF0ZShjZW50ZXJMZWZ0LGNlbnRlclRvcCk7CgkJCQljdHguc2NhbGUoMSwgb3B0aW9ucy5zZXJpZXMucGllLnRpbHQpOwoJCQkJLy9jdHgucm90YXRlKHN0YXJ0QW5nbGUpOyAvLyBzdGFydCBhdCB0b3A7IC0tIFRoaXMgZG9lc24ndCB3b3JrIHByb3Blcmx5IGluIE9wZXJhCgoJCQkJLy8gZHJhdyBzbGljZXMKCgkJCQljdHguc2F2ZSgpOwoJCQkJdmFyIGN1cnJlbnRBbmdsZSA9IHN0YXJ0QW5nbGU7CgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHNsaWNlcy5sZW5ndGg7ICsraSkgewoJCQkJCXNsaWNlc1tpXS5zdGFydEFuZ2xlID0gY3VycmVudEFuZ2xlOwoJCQkJCWRyYXdTbGljZShzbGljZXNbaV0uYW5nbGUsIHNsaWNlc1tpXS5jb2xvciwgdHJ1ZSk7CgkJCQl9CgkJCQljdHgucmVzdG9yZSgpOwoKCQkJCS8vIGRyYXcgc2xpY2Ugb3V0bGluZXMKCgkJCQlpZiAob3B0aW9ucy5zZXJpZXMucGllLnN0cm9rZS53aWR0aCA+IDApIHsKCQkJCQljdHguc2F2ZSgpOwoJCQkJCWN0eC5saW5lV2lkdGggPSBvcHRpb25zLnNlcmllcy5waWUuc3Ryb2tlLndpZHRoOwoJCQkJCWN1cnJlbnRBbmdsZSA9IHN0YXJ0QW5nbGU7CgkJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBzbGljZXMubGVuZ3RoOyArK2kpIHsKCQkJCQkJZHJhd1NsaWNlKHNsaWNlc1tpXS5hbmdsZSwgb3B0aW9ucy5zZXJpZXMucGllLnN0cm9rZS5jb2xvciwgZmFsc2UpOwoJCQkJCX0KCQkJCQljdHgucmVzdG9yZSgpOwoJCQkJfQoKCQkJCS8vIGRyYXcgZG9udXQgaG9sZQoKCQkJCWRyYXdEb251dEhvbGUoY3R4KTsKCgkJCQljdHgucmVzdG9yZSgpOwoKCQkJCS8vIERyYXcgdGhlIGxhYmVscywgcmV0dXJuaW5nIHRydWUgaWYgdGhleSBmaXQgd2l0aGluIHRoZSBwbG90CgoJCQkJaWYgKG9wdGlvbnMuc2VyaWVzLnBpZS5sYWJlbC5zaG93KSB7CgkJCQkJcmV0dXJuIGRyYXdMYWJlbHMoKTsKCQkJCX0gZWxzZSByZXR1cm4gdHJ1ZTsKCgkJCQlmdW5jdGlvbiBkcmF3U2xpY2UoYW5nbGUsIGNvbG9yLCBmaWxsKSB7CgoJCQkJCWlmIChhbmdsZSA8PSAwIHx8IGlzTmFOKGFuZ2xlKSkgewoJCQkJCQlyZXR1cm47CgkJCQkJfQoKCQkJCQlpZiAoZmlsbCkgewoJCQkJCQljdHguZmlsbFN0eWxlID0gY29sb3I7CgkJCQkJfSBlbHNlIHsKCQkJCQkJY3R4LnN0cm9rZVN0eWxlID0gY29sb3I7CgkJCQkJCWN0eC5saW5lSm9pbiA9ICJyb3VuZCI7CgkJCQkJfQoKCQkJCQljdHguYmVnaW5QYXRoKCk7CgkJCQkJaWYgKE1hdGguYWJzKGFuZ2xlIC0gTWF0aC5QSSAqIDIpID4gMC4wMDAwMDAwMDEpIHsKCQkJCQkJY3R4Lm1vdmVUbygwLCAwKTsgLy8gQ2VudGVyIG9mIHRoZSBwaWUKCQkJCQl9CgoJCQkJCS8vY3R4LmFyYygwLCAwLCByYWRpdXMsIDAsIGFuZ2xlLCBmYWxzZSk7IC8vIFRoaXMgZG9lc24ndCB3b3JrIHByb3Blcmx5IGluIE9wZXJhCgkJCQkJY3R4LmFyYygwLCAwLCByYWRpdXMsY3VycmVudEFuZ2xlLCBjdXJyZW50QW5nbGUgKyBhbmdsZSAvIDIsIGZhbHNlKTsKCQkJCQljdHguYXJjKDAsIDAsIHJhZGl1cyxjdXJyZW50QW5nbGUgKyBhbmdsZSAvIDIsIGN1cnJlbnRBbmdsZSArIGFuZ2xlLCBmYWxzZSk7CgkJCQkJY3R4LmNsb3NlUGF0aCgpOwoJCQkJCS8vY3R4LnJvdGF0ZShhbmdsZSk7IC8vIFRoaXMgZG9lc24ndCB3b3JrIHByb3Blcmx5IGluIE9wZXJhCgkJCQkJY3VycmVudEFuZ2xlICs9IGFuZ2xlOwoKCQkJCQlpZiAoZmlsbCkgewoJCQkJCQljdHguZmlsbCgpOwoJCQkJCX0gZWxzZSB7CgkJCQkJCWN0eC5zdHJva2UoKTsKCQkJCQl9CgkJCQl9CgoJCQkJZnVuY3Rpb24gZHJhd0xhYmVscygpIHsKCgkJCQkJdmFyIGN1cnJlbnRBbmdsZSA9IHN0YXJ0QW5nbGU7CgkJCQkJdmFyIHJhZGl1cyA9IG9wdGlvbnMuc2VyaWVzLnBpZS5sYWJlbC5yYWRpdXMgPiAxID8gb3B0aW9ucy5zZXJpZXMucGllLmxhYmVsLnJhZGl1cyA6IG1heFJhZGl1cyAqIG9wdGlvbnMuc2VyaWVzLnBpZS5sYWJlbC5yYWRpdXM7CgoJCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgc2xpY2VzLmxlbmd0aDsgKytpKSB7CgkJCQkJCWlmIChzbGljZXNbaV0ucGVyY2VudCA+PSBvcHRpb25zLnNlcmllcy5waWUubGFiZWwudGhyZXNob2xkICogMTAwKSB7CgkJCQkJCQlpZiAoIWRyYXdMYWJlbChzbGljZXNbaV0sIGN1cnJlbnRBbmdsZSwgaSkpIHsKCQkJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJY3VycmVudEFuZ2xlICs9IHNsaWNlc1tpXS5hbmdsZTsKCQkJCQl9CgoJCQkJCXJldHVybiB0cnVlOwoKCQkJCQlmdW5jdGlvbiBkcmF3TGFiZWwoc2xpY2UsIHN0YXJ0QW5nbGUsIGluZGV4KSB7CgoJCQkJCQlpZiAoc2xpY2UuZGF0YVswXVsxXSA9PSAwKSB7CgkJCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCQkJfQoKCQkJCQkJLy8gZm9ybWF0IGxhYmVsIHRleHQKCgkJCQkJCXZhciBsZiA9IG9wdGlvbnMubGVnZW5kLmxhYmVsRm9ybWF0dGVyLCB0ZXh0LCBwbGYgPSBvcHRpb25zLnNlcmllcy5waWUubGFiZWwuZm9ybWF0dGVyOwoKCQkJCQkJaWYgKGxmKSB7CgkJCQkJCQl0ZXh0ID0gbGYoc2xpY2UubGFiZWwsIHNsaWNlKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXRleHQgPSBzbGljZS5sYWJlbDsKCQkJCQkJfQoKCQkJCQkJaWYgKHBsZikgewoJCQkJCQkJdGV4dCA9IHBsZih0ZXh0LCBzbGljZSk7CgkJCQkJCX0KCgkJCQkJCXZhciBoYWxmQW5nbGUgPSAoKHN0YXJ0QW5nbGUgKyBzbGljZS5hbmdsZSkgKyBzdGFydEFuZ2xlKSAvIDI7CgkJCQkJCXZhciB4ID0gY2VudGVyTGVmdCArIE1hdGgucm91bmQoTWF0aC5jb3MoaGFsZkFuZ2xlKSAqIHJhZGl1cyk7CgkJCQkJCXZhciB5ID0gY2VudGVyVG9wICsgTWF0aC5yb3VuZChNYXRoLnNpbihoYWxmQW5nbGUpICogcmFkaXVzKSAqIG9wdGlvbnMuc2VyaWVzLnBpZS50aWx0OwoKCQkJCQkJdmFyIGh0bWwgPSAiPHNwYW4gY2xhc3M9J3BpZUxhYmVsJyBpZD0ncGllTGFiZWwiICsgaW5kZXggKyAiJyBzdHlsZT0ncG9zaXRpb246YWJzb2x1dGU7dG9wOiIgKyB5ICsgInB4O2xlZnQ6IiArIHggKyAicHg7Jz4iICsgdGV4dCArICI8L3NwYW4+IjsKCQkJCQkJdGFyZ2V0LmFwcGVuZChodG1sKTsKCgkJCQkJCXZhciBsYWJlbCA9IHRhcmdldC5jaGlsZHJlbigiI3BpZUxhYmVsIiArIGluZGV4KTsKCQkJCQkJdmFyIGxhYmVsVG9wID0gKHkgLSBsYWJlbC5oZWlnaHQoKSAvIDIpOwoJCQkJCQl2YXIgbGFiZWxMZWZ0ID0gKHggLSBsYWJlbC53aWR0aCgpIC8gMik7CgoJCQkJCQlsYWJlbC5jc3MoInRvcCIsIGxhYmVsVG9wKTsKCQkJCQkJbGFiZWwuY3NzKCJsZWZ0IiwgbGFiZWxMZWZ0KTsKCgkJCQkJCS8vIGNoZWNrIHRvIG1ha2Ugc3VyZSB0aGF0IHRoZSBsYWJlbCBpcyBub3Qgb3V0c2lkZSB0aGUgY2FudmFzCgoJCQkJCQlpZiAoMCAtIGxhYmVsVG9wID4gMCB8fCAwIC0gbGFiZWxMZWZ0ID4gMCB8fCBjYW52YXNIZWlnaHQgLSAobGFiZWxUb3AgKyBsYWJlbC5oZWlnaHQoKSkgPCAwIHx8IGNhbnZhc1dpZHRoIC0gKGxhYmVsTGVmdCArIGxhYmVsLndpZHRoKCkpIDwgMCkgewoJCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCQl9CgoJCQkJCQlpZiAob3B0aW9ucy5zZXJpZXMucGllLmxhYmVsLmJhY2tncm91bmQub3BhY2l0eSAhPSAwKSB7CgoJCQkJCQkJLy8gcHV0IGluIHRoZSB0cmFuc3BhcmVudCBiYWNrZ3JvdW5kIHNlcGFyYXRlbHkgdG8gYXZvaWQgYmxlbmRlZCBsYWJlbHMgYW5kIGxhYmVsIGJveGVzCgoJCQkJCQkJdmFyIGMgPSBvcHRpb25zLnNlcmllcy5waWUubGFiZWwuYmFja2dyb3VuZC5jb2xvcjsKCgkJCQkJCQlpZiAoYyA9PSBudWxsKSB7CgkJCQkJCQkJYyA9IHNsaWNlLmNvbG9yOwoJCQkJCQkJfQoKCQkJCQkJCXZhciBwb3MgPSAidG9wOiIgKyBsYWJlbFRvcCArICJweDtsZWZ0OiIgKyBsYWJlbExlZnQgKyAicHg7IjsKCQkJCQkJCSQoIjxkaXYgY2xhc3M9J3BpZUxhYmVsQmFja2dyb3VuZCcgc3R5bGU9J3Bvc2l0aW9uOmFic29sdXRlO3dpZHRoOiIgKyBsYWJlbC53aWR0aCgpICsgInB4O2hlaWdodDoiICsgbGFiZWwuaGVpZ2h0KCkgKyAicHg7IiArIHBvcyArICJiYWNrZ3JvdW5kLWNvbG9yOiIgKyBjICsgIjsnPjwvZGl2PiIpCgkJCQkJCQkJLmNzcygib3BhY2l0eSIsIG9wdGlvbnMuc2VyaWVzLnBpZS5sYWJlbC5iYWNrZ3JvdW5kLm9wYWNpdHkpCgkJCQkJCQkJLmluc2VydEJlZm9yZShsYWJlbCk7CgkJCQkJCX0KCgkJCQkJCXJldHVybiB0cnVlOwoJCQkJCX0gLy8gZW5kIGluZGl2aWR1YWwgbGFiZWwgZnVuY3Rpb24KCQkJCX0gLy8gZW5kIGRyYXdMYWJlbHMgZnVuY3Rpb24KCQkJfSAvLyBlbmQgZHJhd1BpZSBmdW5jdGlvbgoJCX0gLy8gZW5kIGRyYXcgZnVuY3Rpb24KCgkJLy8gUGxhY2VkIGhlcmUgYmVjYXVzZSBpdCBuZWVkcyB0byBiZSBhY2Nlc3NlZCBmcm9tIG11bHRpcGxlIGxvY2F0aW9ucwoKCQlmdW5jdGlvbiBkcmF3RG9udXRIb2xlKGxheWVyKSB7CgkJCWlmIChvcHRpb25zLnNlcmllcy5waWUuaW5uZXJSYWRpdXMgPiAwKSB7CgoJCQkJLy8gc3VidHJhY3QgdGhlIGNlbnRlcgoKCQkJCWxheWVyLnNhdmUoKTsKCQkJCXZhciBpbm5lclJhZGl1cyA9IG9wdGlvbnMuc2VyaWVzLnBpZS5pbm5lclJhZGl1cyA+IDEgPyBvcHRpb25zLnNlcmllcy5waWUuaW5uZXJSYWRpdXMgOiBtYXhSYWRpdXMgKiBvcHRpb25zLnNlcmllcy5waWUuaW5uZXJSYWRpdXM7CgkJCQlsYXllci5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAiZGVzdGluYXRpb24tb3V0IjsgLy8gdGhpcyBkb2VzIG5vdCB3b3JrIHdpdGggZXhjYW52YXMsIGJ1dCBpdCB3aWxsIGZhbGwgYmFjayB0byB1c2luZyB0aGUgc3Ryb2tlIGNvbG9yCgkJCQlsYXllci5iZWdpblBhdGgoKTsKCQkJCWxheWVyLmZpbGxTdHlsZSA9IG9wdGlvbnMuc2VyaWVzLnBpZS5zdHJva2UuY29sb3I7CgkJCQlsYXllci5hcmMoMCwgMCwgaW5uZXJSYWRpdXMsIDAsIE1hdGguUEkgKiAyLCBmYWxzZSk7CgkJCQlsYXllci5maWxsKCk7CgkJCQlsYXllci5jbG9zZVBhdGgoKTsKCQkJCWxheWVyLnJlc3RvcmUoKTsKCgkJCQkvLyBhZGQgaW5uZXIgc3Ryb2tlCgoJCQkJbGF5ZXIuc2F2ZSgpOwoJCQkJbGF5ZXIuYmVnaW5QYXRoKCk7CgkJCQlsYXllci5zdHJva2VTdHlsZSA9IG9wdGlvbnMuc2VyaWVzLnBpZS5zdHJva2UuY29sb3I7CgkJCQlsYXllci5hcmMoMCwgMCwgaW5uZXJSYWRpdXMsIDAsIE1hdGguUEkgKiAyLCBmYWxzZSk7CgkJCQlsYXllci5zdHJva2UoKTsKCQkJCWxheWVyLmNsb3NlUGF0aCgpOwoJCQkJbGF5ZXIucmVzdG9yZSgpOwoKCQkJCS8vIFRPRE86IGFkZCBleHRyYSBzaGFkb3cgaW5zaWRlIGhvbGUgKHdpdGggYSBtYXNrKSBpZiB0aGUgcGllIGlzIHRpbHRlZC4KCQkJfQoJCX0KCgkJLy8tLSBBZGRpdGlvbmFsIEludGVyYWN0aXZlIHJlbGF0ZWQgZnVuY3Rpb25zIC0tCgoJCWZ1bmN0aW9uIGlzUG9pbnRJblBvbHkocG9seSwgcHQpIHsKCQkJZm9yKHZhciBjID0gZmFsc2UsIGkgPSAtMSwgbCA9IHBvbHkubGVuZ3RoLCBqID0gbCAtIDE7ICsraSA8IGw7IGogPSBpKQoJCQkJKChwb2x5W2ldWzFdIDw9IHB0WzFdICYmIHB0WzFdIDwgcG9seVtqXVsxXSkgfHwgKHBvbHlbal1bMV0gPD0gcHRbMV0gJiYgcHRbMV08IHBvbHlbaV1bMV0pKQoJCQkJJiYgKHB0WzBdIDwgKHBvbHlbal1bMF0gLSBwb2x5W2ldWzBdKSAqIChwdFsxXSAtIHBvbHlbaV1bMV0pIC8gKHBvbHlbal1bMV0gLSBwb2x5W2ldWzFdKSArIHBvbHlbaV1bMF0pCgkJCQkmJiAoYyA9ICFjKTsKCQkJcmV0dXJuIGM7CgkJfQoKCQlmdW5jdGlvbiBmaW5kTmVhcmJ5U2xpY2UobW91c2VYLCBtb3VzZVkpIHsKCgkJCXZhciBzbGljZXMgPSBwbG90LmdldERhdGEoKSwKCQkJCW9wdGlvbnMgPSBwbG90LmdldE9wdGlvbnMoKSwKCQkJCXJhZGl1cyA9IG9wdGlvbnMuc2VyaWVzLnBpZS5yYWRpdXMgPiAxID8gb3B0aW9ucy5zZXJpZXMucGllLnJhZGl1cyA6IG1heFJhZGl1cyAqIG9wdGlvbnMuc2VyaWVzLnBpZS5yYWRpdXMsCgkJCQl4LCB5OwoKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBzbGljZXMubGVuZ3RoOyArK2kpIHsKCgkJCQl2YXIgcyA9IHNsaWNlc1tpXTsKCgkJCQlpZiAocy5waWUuc2hvdykgewoKCQkJCQljdHguc2F2ZSgpOwoJCQkJCWN0eC5iZWdpblBhdGgoKTsKCQkJCQljdHgubW92ZVRvKDAsIDApOyAvLyBDZW50ZXIgb2YgdGhlIHBpZQoJCQkJCS8vY3R4LnNjYWxlKDEsIG9wdGlvbnMuc2VyaWVzLnBpZS50aWx0KTsJLy8gdGhpcyBhY3R1YWxseSBzZWVtcyB0byBicmVhayBldmVyeXRoaW5nIHdoZW4gaGVyZS4KCQkJCQljdHguYXJjKDAsIDAsIHJhZGl1cywgcy5zdGFydEFuZ2xlLCBzLnN0YXJ0QW5nbGUgKyBzLmFuZ2xlIC8gMiwgZmFsc2UpOwoJCQkJCWN0eC5hcmMoMCwgMCwgcmFkaXVzLCBzLnN0YXJ0QW5nbGUgKyBzLmFuZ2xlIC8gMiwgcy5zdGFydEFuZ2xlICsgcy5hbmdsZSwgZmFsc2UpOwoJCQkJCWN0eC5jbG9zZVBhdGgoKTsKCQkJCQl4ID0gbW91c2VYIC0gY2VudGVyTGVmdDsKCQkJCQl5ID0gbW91c2VZIC0gY2VudGVyVG9wOwoKCQkJCQlpZiAoY3R4LmlzUG9pbnRJblBhdGgpIHsKCQkJCQkJaWYgKGN0eC5pc1BvaW50SW5QYXRoKG1vdXNlWCAtIGNlbnRlckxlZnQsIG1vdXNlWSAtIGNlbnRlclRvcCkpIHsKCQkJCQkJCWN0eC5yZXN0b3JlKCk7CgkJCQkJCQlyZXR1cm4gewoJCQkJCQkJCWRhdGFwb2ludDogW3MucGVyY2VudCwgcy5kYXRhXSwKCQkJCQkJCQlkYXRhSW5kZXg6IDAsCgkJCQkJCQkJc2VyaWVzOiBzLAoJCQkJCQkJCXNlcmllc0luZGV4OiBpCgkJCQkJCQl9OwoJCQkJCQl9CgkJCQkJfSBlbHNlIHsKCgkJCQkJCS8vIGV4Y2FudmFzIGZvciBJRSBkb2Vzbjt0IHN1cHBvcnQgaXNQb2ludEluUGF0aCwgdGhpcyBpcyBhIHdvcmthcm91bmQuCgoJCQkJCQl2YXIgcDFYID0gcmFkaXVzICogTWF0aC5jb3Mocy5zdGFydEFuZ2xlKSwKCQkJCQkJCXAxWSA9IHJhZGl1cyAqIE1hdGguc2luKHMuc3RhcnRBbmdsZSksCgkJCQkJCQlwMlggPSByYWRpdXMgKiBNYXRoLmNvcyhzLnN0YXJ0QW5nbGUgKyBzLmFuZ2xlIC8gNCksCgkJCQkJCQlwMlkgPSByYWRpdXMgKiBNYXRoLnNpbihzLnN0YXJ0QW5nbGUgKyBzLmFuZ2xlIC8gNCksCgkJCQkJCQlwM1ggPSByYWRpdXMgKiBNYXRoLmNvcyhzLnN0YXJ0QW5nbGUgKyBzLmFuZ2xlIC8gMiksCgkJCQkJCQlwM1kgPSByYWRpdXMgKiBNYXRoLnNpbihzLnN0YXJ0QW5nbGUgKyBzLmFuZ2xlIC8gMiksCgkJCQkJCQlwNFggPSByYWRpdXMgKiBNYXRoLmNvcyhzLnN0YXJ0QW5nbGUgKyBzLmFuZ2xlIC8gMS41KSwKCQkJCQkJCXA0WSA9IHJhZGl1cyAqIE1hdGguc2luKHMuc3RhcnRBbmdsZSArIHMuYW5nbGUgLyAxLjUpLAoJCQkJCQkJcDVYID0gcmFkaXVzICogTWF0aC5jb3Mocy5zdGFydEFuZ2xlICsgcy5hbmdsZSksCgkJCQkJCQlwNVkgPSByYWRpdXMgKiBNYXRoLnNpbihzLnN0YXJ0QW5nbGUgKyBzLmFuZ2xlKSwKCQkJCQkJCWFyclBvbHkgPSBbWzAsIDBdLCBbcDFYLCBwMVldLCBbcDJYLCBwMlldLCBbcDNYLCBwM1ldLCBbcDRYLCBwNFldLCBbcDVYLCBwNVldXSwKCQkJCQkJCWFyclBvaW50ID0gW3gsIHldOwoKCQkJCQkJLy8gVE9ETzogcGVyaGFwcyBkbyBzb21lIG1hdGhtYXRpY2FsIHRyaWNrZXJ5IGhlcmUgd2l0aCB0aGUgWS1jb29yZGluYXRlIHRvIGNvbXBlbnNhdGUgZm9yIHBpZSB0aWx0PwoKCQkJCQkJaWYgKGlzUG9pbnRJblBvbHkoYXJyUG9seSwgYXJyUG9pbnQpKSB7CgkJCQkJCQljdHgucmVzdG9yZSgpOwoJCQkJCQkJcmV0dXJuIHsKCQkJCQkJCQlkYXRhcG9pbnQ6IFtzLnBlcmNlbnQsIHMuZGF0YV0sCgkJCQkJCQkJZGF0YUluZGV4OiAwLAoJCQkJCQkJCXNlcmllczogcywKCQkJCQkJCQlzZXJpZXNJbmRleDogaQoJCQkJCQkJfTsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJY3R4LnJlc3RvcmUoKTsKCQkJCX0KCQkJfQoKCQkJcmV0dXJuIG51bGw7CgkJfQoKCQlmdW5jdGlvbiBvbk1vdXNlTW92ZShlKSB7CgkJCXRyaWdnZXJDbGlja0hvdmVyRXZlbnQoInBsb3Rob3ZlciIsIGUpOwoJCX0KCgkJZnVuY3Rpb24gb25DbGljayhlKSB7CgkJCXRyaWdnZXJDbGlja0hvdmVyRXZlbnQoInBsb3RjbGljayIsIGUpOwoJCX0KCgkJLy8gdHJpZ2dlciBjbGljayBvciBob3ZlciBldmVudCAodGhleSBzZW5kIHRoZSBzYW1lIHBhcmFtZXRlcnMgc28gd2Ugc2hhcmUgdGhlaXIgY29kZSkKCgkJZnVuY3Rpb24gdHJpZ2dlckNsaWNrSG92ZXJFdmVudChldmVudG5hbWUsIGUpIHsKCgkJCXZhciBvZmZzZXQgPSBwbG90Lm9mZnNldCgpOwoJCQl2YXIgY2FudmFzWCA9IHBhcnNlSW50KGUucGFnZVggLSBvZmZzZXQubGVmdCk7CgkJCXZhciBjYW52YXNZID0gIHBhcnNlSW50KGUucGFnZVkgLSBvZmZzZXQudG9wKTsKCQkJdmFyIGl0ZW0gPSBmaW5kTmVhcmJ5U2xpY2UoY2FudmFzWCwgY2FudmFzWSk7CgoJCQlpZiAob3B0aW9ucy5ncmlkLmF1dG9IaWdobGlnaHQpIHsKCgkJCQkvLyBjbGVhciBhdXRvLWhpZ2hsaWdodHMKCgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IGhpZ2hsaWdodHMubGVuZ3RoOyArK2kpIHsKCQkJCQl2YXIgaCA9IGhpZ2hsaWdodHNbaV07CgkJCQkJaWYgKGguYXV0byA9PSBldmVudG5hbWUgJiYgIShpdGVtICYmIGguc2VyaWVzID09IGl0ZW0uc2VyaWVzKSkgewoJCQkJCQl1bmhpZ2hsaWdodChoLnNlcmllcyk7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQkvLyBoaWdobGlnaHQgdGhlIHNsaWNlCgoJCQlpZiAoaXRlbSkgewoJCQkJaGlnaGxpZ2h0KGl0ZW0uc2VyaWVzLCBldmVudG5hbWUpOwoJCQl9CgoJCQkvLyB0cmlnZ2VyIGFueSBob3ZlciBiaW5kIGV2ZW50cwoKCQkJdmFyIHBvcyA9IHsgcGFnZVg6IGUucGFnZVgsIHBhZ2VZOiBlLnBhZ2VZIH07CgkJCXRhcmdldC50cmlnZ2VyKGV2ZW50bmFtZSwgW3BvcywgaXRlbV0pOwoJCX0KCgkJZnVuY3Rpb24gaGlnaGxpZ2h0KHMsIGF1dG8pIHsKCQkJLy9pZiAodHlwZW9mIHMgPT0gIm51bWJlciIpIHsKCQkJLy8JcyA9IHNlcmllc1tzXTsKCQkJLy99CgoJCQl2YXIgaSA9IGluZGV4T2ZIaWdobGlnaHQocyk7CgoJCQlpZiAoaSA9PSAtMSkgewoJCQkJaGlnaGxpZ2h0cy5wdXNoKHsgc2VyaWVzOiBzLCBhdXRvOiBhdXRvIH0pOwoJCQkJcGxvdC50cmlnZ2VyUmVkcmF3T3ZlcmxheSgpOwoJCQl9IGVsc2UgaWYgKCFhdXRvKSB7CgkJCQloaWdobGlnaHRzW2ldLmF1dG8gPSBmYWxzZTsKCQkJfQoJCX0KCgkJZnVuY3Rpb24gdW5oaWdobGlnaHQocykgewoJCQlpZiAocyA9PSBudWxsKSB7CgkJCQloaWdobGlnaHRzID0gW107CgkJCQlwbG90LnRyaWdnZXJSZWRyYXdPdmVybGF5KCk7CgkJCX0KCgkJCS8vaWYgKHR5cGVvZiBzID09ICJudW1iZXIiKSB7CgkJCS8vCXMgPSBzZXJpZXNbc107CgkJCS8vfQoKCQkJdmFyIGkgPSBpbmRleE9mSGlnaGxpZ2h0KHMpOwoKCQkJaWYgKGkgIT0gLTEpIHsKCQkJCWhpZ2hsaWdodHMuc3BsaWNlKGksIDEpOwoJCQkJcGxvdC50cmlnZ2VyUmVkcmF3T3ZlcmxheSgpOwoJCQl9CgkJfQoKCQlmdW5jdGlvbiBpbmRleE9mSGlnaGxpZ2h0KHMpIHsKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBoaWdobGlnaHRzLmxlbmd0aDsgKytpKSB7CgkJCQl2YXIgaCA9IGhpZ2hsaWdodHNbaV07CgkJCQlpZiAoaC5zZXJpZXMgPT0gcykKCQkJCQlyZXR1cm4gaTsKCQkJfQoJCQlyZXR1cm4gLTE7CgkJfQoKCQlmdW5jdGlvbiBkcmF3T3ZlcmxheShwbG90LCBvY3R4KSB7CgoJCQl2YXIgb3B0aW9ucyA9IHBsb3QuZ2V0T3B0aW9ucygpOwoKCQkJdmFyIHJhZGl1cyA9IG9wdGlvbnMuc2VyaWVzLnBpZS5yYWRpdXMgPiAxID8gb3B0aW9ucy5zZXJpZXMucGllLnJhZGl1cyA6IG1heFJhZGl1cyAqIG9wdGlvbnMuc2VyaWVzLnBpZS5yYWRpdXM7CgoJCQlvY3R4LnNhdmUoKTsKCQkJb2N0eC50cmFuc2xhdGUoY2VudGVyTGVmdCwgY2VudGVyVG9wKTsKCQkJb2N0eC5zY2FsZSgxLCBvcHRpb25zLnNlcmllcy5waWUudGlsdCk7CgoJCQlmb3IgKHZhciBpID0gMDsgaSA8IGhpZ2hsaWdodHMubGVuZ3RoOyArK2kpIHsKCQkJCWRyYXdIaWdobGlnaHQoaGlnaGxpZ2h0c1tpXS5zZXJpZXMpOwoJCQl9CgoJCQlkcmF3RG9udXRIb2xlKG9jdHgpOwoKCQkJb2N0eC5yZXN0b3JlKCk7CgoJCQlmdW5jdGlvbiBkcmF3SGlnaGxpZ2h0KHNlcmllcykgewoKCQkJCWlmIChzZXJpZXMuYW5nbGUgPD0gMCB8fCBpc05hTihzZXJpZXMuYW5nbGUpKSB7CgkJCQkJcmV0dXJuOwoJCQkJfQoKCQkJCS8vb2N0eC5maWxsU3R5bGUgPSBwYXJzZUNvbG9yKG9wdGlvbnMuc2VyaWVzLnBpZS5oaWdobGlnaHQuY29sb3IpLnNjYWxlKG51bGwsIG51bGwsIG51bGwsIG9wdGlvbnMuc2VyaWVzLnBpZS5oaWdobGlnaHQub3BhY2l0eSkudG9TdHJpbmcoKTsKCQkJCW9jdHguZmlsbFN0eWxlID0gInJnYmEoMjU1LCAyNTUsIDI1NSwgIiArIG9wdGlvbnMuc2VyaWVzLnBpZS5oaWdobGlnaHQub3BhY2l0eSArICIpIjsgLy8gdGhpcyBpcyB0ZW1wb3JhcnkgdW50aWwgd2UgaGF2ZSBhY2Nlc3MgdG8gcGFyc2VDb2xvcgoJCQkJb2N0eC5iZWdpblBhdGgoKTsKCQkJCWlmIChNYXRoLmFicyhzZXJpZXMuYW5nbGUgLSBNYXRoLlBJICogMikgPiAwLjAwMDAwMDAwMSkgewoJCQkJCW9jdHgubW92ZVRvKDAsIDApOyAvLyBDZW50ZXIgb2YgdGhlIHBpZQoJCQkJfQoJCQkJb2N0eC5hcmMoMCwgMCwgcmFkaXVzLCBzZXJpZXMuc3RhcnRBbmdsZSwgc2VyaWVzLnN0YXJ0QW5nbGUgKyBzZXJpZXMuYW5nbGUgLyAyLCBmYWxzZSk7CgkJCQlvY3R4LmFyYygwLCAwLCByYWRpdXMsIHNlcmllcy5zdGFydEFuZ2xlICsgc2VyaWVzLmFuZ2xlIC8gMiwgc2VyaWVzLnN0YXJ0QW5nbGUgKyBzZXJpZXMuYW5nbGUsIGZhbHNlKTsKCQkJCW9jdHguY2xvc2VQYXRoKCk7CgkJCQlvY3R4LmZpbGwoKTsKCQkJfQoJCX0KCX0gLy8gZW5kIGluaXQgKHBsdWdpbiBib2R5KQoKCS8vIGRlZmluZSBwaWUgc3BlY2lmaWMgb3B0aW9ucyBhbmQgdGhlaXIgZGVmYXVsdCB2YWx1ZXMKCgl2YXIgb3B0aW9ucyA9IHsKCQlzZXJpZXM6IHsKCQkJcGllOiB7CgkJCQlzaG93OiBmYWxzZSwKCQkJCXJhZGl1czogImF1dG8iLAkvLyBhY3R1YWwgcmFkaXVzIG9mIHRoZSB2aXNpYmxlIHBpZSAoYmFzZWQgb24gZnVsbCBjYWxjdWxhdGVkIHJhZGl1cyBpZiA8PTEsIG9yIGhhcmQgcGl4ZWwgdmFsdWUpCgkJCQlpbm5lclJhZGl1czogMCwgLyogZm9yIGRvbnV0ICovCgkJCQlzdGFydEFuZ2xlOiAzLzIsCgkJCQl0aWx0OiAxLAoJCQkJc2hhZG93OiB7CgkJCQkJbGVmdDogNSwJLy8gc2hhZG93IGxlZnQgb2Zmc2V0CgkJCQkJdG9wOiAxNSwJLy8gc2hhZG93IHRvcCBvZmZzZXQKCQkJCQlhbHBoYTogMC4wMgkvLyBzaGFkb3cgYWxwaGEKCQkJCX0sCgkJCQlvZmZzZXQ6IHsKCQkJCQl0b3A6IDAsCgkJCQkJbGVmdDogImF1dG8iCgkJCQl9LAoJCQkJc3Ryb2tlOiB7CgkJCQkJY29sb3I6ICIjZmZmIiwKCQkJCQl3aWR0aDogMQoJCQkJfSwKCQkJCWxhYmVsOiB7CgkJCQkJc2hvdzogImF1dG8iLAoJCQkJCWZvcm1hdHRlcjogZnVuY3Rpb24obGFiZWwsIHNsaWNlKSB7CgkJCQkJCXJldHVybiAiPGRpdiBzdHlsZT0nZm9udC1zaXplOngtc21hbGw7dGV4dC1hbGlnbjpjZW50ZXI7cGFkZGluZzoycHg7Y29sb3I6IiArIHNsaWNlLmNvbG9yICsgIjsnPiIgKyBsYWJlbCArICI8YnIvPiIgKyBNYXRoLnJvdW5kKHNsaWNlLnBlcmNlbnQpICsgIiU8L2Rpdj4iOwoJCQkJCX0sCS8vIGZvcm1hdHRlciBmdW5jdGlvbgoJCQkJCXJhZGl1czogMSwJLy8gcmFkaXVzIGF0IHdoaWNoIHRvIHBsYWNlIHRoZSBsYWJlbHMgKGJhc2VkIG9uIGZ1bGwgY2FsY3VsYXRlZCByYWRpdXMgaWYgPD0xLCBvciBoYXJkIHBpeGVsIHZhbHVlKQoJCQkJCWJhY2tncm91bmQ6IHsKCQkJCQkJY29sb3I6IG51bGwsCgkJCQkJCW9wYWNpdHk6IDAKCQkJCQl9LAoJCQkJCXRocmVzaG9sZDogMAkvLyBwZXJjZW50YWdlIGF0IHdoaWNoIHRvIGhpZGUgdGhlIGxhYmVsIChpLmUuIHRoZSBzbGljZSBpcyB0b28gbmFycm93KQoJCQkJfSwKCQkJCWNvbWJpbmU6IHsKCQkJCQl0aHJlc2hvbGQ6IC0xLAkvLyBwZXJjZW50YWdlIGF0IHdoaWNoIHRvIGNvbWJpbmUgbGl0dGxlIHNsaWNlcyBpbnRvIG9uZSBsYXJnZXIgc2xpY2UKCQkJCQljb2xvcjogbnVsbCwJLy8gY29sb3IgdG8gZ2l2ZSB0aGUgbmV3IHNsaWNlIChhdXRvLWdlbmVyYXRlZCBpZiBudWxsKQoJCQkJCWxhYmVsOiAiT3RoZXIiCS8vIGxhYmVsIHRvIGdpdmUgdGhlIG5ldyBzbGljZQoJCQkJfSwKCQkJCWhpZ2hsaWdodDogewoJCQkJCS8vY29sb3I6ICIjZmZmIiwJCS8vIHdpbGwgYWRkIHRoaXMgZnVuY3Rpb25hbGl0eSBvbmNlIHBhcnNlQ29sb3IgaXMgYXZhaWxhYmxlCgkJCQkJb3BhY2l0eTogMC41CgkJCQl9CgkJCX0KCQl9Cgl9OwoKCSQucGxvdC5wbHVnaW5zLnB1c2goewoJCWluaXQ6IGluaXQsCgkJb3B0aW9uczogb3B0aW9ucywKCQluYW1lOiAicGllIiwKCQl2ZXJzaW9uOiAiMS4xIgoJfSk7Cgp9KShqUXVlcnkpOwo8L3NjcmlwdD4NCgkJPHNjcmlwdCB0eXBlPSJhcHBsaWNhdGlvbi9qYXZhc2NyaXB0Ij4vKiBGbG90IHBsdWdpbiBmb3IgYXV0b21hdGljYWxseSByZWRyYXdpbmcgcGxvdHMgYXMgdGhlIHBsYWNlaG9sZGVyIHJlc2l6ZXMuCgpDb3B5cmlnaHQgKGMpIDIwMDctMjAxNCBJT0xBIGFuZCBPbGUgTGF1cnNlbi4KTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgoKSXQgd29ya3MgYnkgbGlzdGVuaW5nIGZvciBjaGFuZ2VzIG9uIHRoZSBwbGFjZWhvbGRlciBkaXYgKHRocm91Z2ggdGhlIGpRdWVyeQpyZXNpemUgZXZlbnQgcGx1Z2luKSAtIGlmIHRoZSBzaXplIGNoYW5nZXMsIGl0IHdpbGwgcmVkcmF3IHRoZSBwbG90LgoKVGhlcmUgYXJlIG5vIG9wdGlvbnMuIElmIHlvdSBuZWVkIHRvIGRpc2FibGUgdGhlIHBsdWdpbiBmb3Igc29tZSBwbG90cywgeW91CmNhbiBqdXN0IGZpeCB0aGUgc2l6ZSBvZiB0aGVpciBwbGFjZWhvbGRlcnMuCgoqLwoKLyogSW5saW5lIGRlcGVuZGVuY3k6CiAqIGpRdWVyeSByZXNpemUgZXZlbnQgLSB2MS4xIC0gMy8xNC8yMDEwCiAqIGh0dHA6Ly9iZW5hbG1hbi5jb20vcHJvamVjdHMvanF1ZXJ5LXJlc2l6ZS1wbHVnaW4vCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMCAiQ293Ym95IiBCZW4gQWxtYW4KICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGFuZCBHUEwgbGljZW5zZXMuCiAqIGh0dHA6Ly9iZW5hbG1hbi5jb20vYWJvdXQvbGljZW5zZS8KICovCihmdW5jdGlvbigkLGUsdCl7IiQ6bm9tdW5nZSI7dmFyIGk9W10sbj0kLnJlc2l6ZT0kLmV4dGVuZCgkLnJlc2l6ZSx7fSksYSxyPWZhbHNlLHM9InNldFRpbWVvdXQiLHU9InJlc2l6ZSIsbT11KyItc3BlY2lhbC1ldmVudCIsbz0icGVuZGluZ0RlbGF5IixsPSJhY3RpdmVEZWxheSIsZj0idGhyb3R0bGVXaW5kb3ciO25bb109MjAwO25bbF09MjA7bltmXT10cnVlOyQuZXZlbnQuc3BlY2lhbFt1XT17c2V0dXA6ZnVuY3Rpb24oKXtpZighbltmXSYmdGhpc1tzXSl7cmV0dXJuIGZhbHNlfXZhciBlPSQodGhpcyk7aS5wdXNoKHRoaXMpO2UuZGF0YShtLHt3OmUud2lkdGgoKSxoOmUuaGVpZ2h0KCl9KTtpZihpLmxlbmd0aD09PTEpe2E9dDtoKCl9fSx0ZWFyZG93bjpmdW5jdGlvbigpe2lmKCFuW2ZdJiZ0aGlzW3NdKXtyZXR1cm4gZmFsc2V9dmFyIGU9JCh0aGlzKTtmb3IodmFyIHQ9aS5sZW5ndGgtMTt0Pj0wO3QtLSl7aWYoaVt0XT09dGhpcyl7aS5zcGxpY2UodCwxKTticmVha319ZS5yZW1vdmVEYXRhKG0pO2lmKCFpLmxlbmd0aCl7aWYocil7Y2FuY2VsQW5pbWF0aW9uRnJhbWUoYSl9ZWxzZXtjbGVhclRpbWVvdXQoYSl9YT1udWxsfX0sYWRkOmZ1bmN0aW9uKGUpe2lmKCFuW2ZdJiZ0aGlzW3NdKXtyZXR1cm4gZmFsc2V9dmFyIGk7ZnVuY3Rpb24gYShlLG4sYSl7dmFyIHI9JCh0aGlzKSxzPXIuZGF0YShtKXx8e307cy53PW4hPT10P246ci53aWR0aCgpO3MuaD1hIT09dD9hOnIuaGVpZ2h0KCk7aS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9aWYoJC5pc0Z1bmN0aW9uKGUpKXtpPWU7cmV0dXJuIGF9ZWxzZXtpPWUuaGFuZGxlcjtlLmhhbmRsZXI9YX19fTtmdW5jdGlvbiBoKHQpe2lmKHI9PT10cnVlKXtyPXR8fDF9Zm9yKHZhciBzPWkubGVuZ3RoLTE7cz49MDtzLS0pe3ZhciBsPSQoaVtzXSk7aWYobFswXT09ZXx8bC5pcygiOnZpc2libGUiKSl7dmFyIGY9bC53aWR0aCgpLGM9bC5oZWlnaHQoKSxkPWwuZGF0YShtKTtpZihkJiYoZiE9PWQud3x8YyE9PWQuaCkpe2wudHJpZ2dlcih1LFtkLnc9ZixkLmg9Y10pO3I9dHx8dHJ1ZX19ZWxzZXtkPWwuZGF0YShtKTtkLnc9MDtkLmg9MH19aWYoYSE9PW51bGwpe2lmKHImJih0PT1udWxsfHx0LXI8MWUzKSl7YT1lLnJlcXVlc3RBbmltYXRpb25GcmFtZShoKX1lbHNle2E9c2V0VGltZW91dChoLG5bb10pO3I9ZmFsc2V9fX1pZighZS5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUpe2UucmVxdWVzdEFuaW1hdGlvbkZyYW1lPWZ1bmN0aW9uKCl7cmV0dXJuIGUud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lfHxlLm1velJlcXVlc3RBbmltYXRpb25GcmFtZXx8ZS5vUmVxdWVzdEFuaW1hdGlvbkZyYW1lfHxlLm1zUmVxdWVzdEFuaW1hdGlvbkZyYW1lfHxmdW5jdGlvbih0LGkpe3JldHVybiBlLnNldFRpbWVvdXQoZnVuY3Rpb24oKXt0KChuZXcgRGF0ZSkuZ2V0VGltZSgpKX0sbltsXSl9fSgpfWlmKCFlLmNhbmNlbEFuaW1hdGlvbkZyYW1lKXtlLmNhbmNlbEFuaW1hdGlvbkZyYW1lPWZ1bmN0aW9uKCl7cmV0dXJuIGUud2Via2l0Q2FuY2VsUmVxdWVzdEFuaW1hdGlvbkZyYW1lfHxlLm1vekNhbmNlbFJlcXVlc3RBbmltYXRpb25GcmFtZXx8ZS5vQ2FuY2VsUmVxdWVzdEFuaW1hdGlvbkZyYW1lfHxlLm1zQ2FuY2VsUmVxdWVzdEFuaW1hdGlvbkZyYW1lfHxjbGVhclRpbWVvdXR9KCl9fSkoalF1ZXJ5LHRoaXMpOwoKKGZ1bmN0aW9uICgkKSB7CiAgICB2YXIgb3B0aW9ucyA9IHsgfTsgLy8gbm8gb3B0aW9ucwoKICAgIGZ1bmN0aW9uIGluaXQocGxvdCkgewogICAgICAgIGZ1bmN0aW9uIG9uUmVzaXplKCkgewogICAgICAgICAgICB2YXIgcGxhY2Vob2xkZXIgPSBwbG90LmdldFBsYWNlaG9sZGVyKCk7CgogICAgICAgICAgICAvLyBzb21lYm9keSBtaWdodCBoYXZlIGhpZGRlbiB1cyBhbmQgd2UgY2FuJ3QgcGxvdAogICAgICAgICAgICAvLyB3aGVuIHdlIGRvbid0IGhhdmUgdGhlIGRpbWVuc2lvbnMKICAgICAgICAgICAgaWYgKHBsYWNlaG9sZGVyLndpZHRoKCkgPT0gMCB8fCBwbGFjZWhvbGRlci5oZWlnaHQoKSA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgcGxvdC5yZXNpemUoKTsKICAgICAgICAgICAgcGxvdC5zZXR1cEdyaWQoKTsKICAgICAgICAgICAgcGxvdC5kcmF3KCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIGJpbmRFdmVudHMocGxvdCwgZXZlbnRIb2xkZXIpIHsKICAgICAgICAgICAgcGxvdC5nZXRQbGFjZWhvbGRlcigpLnJlc2l6ZShvblJlc2l6ZSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzaHV0ZG93bihwbG90LCBldmVudEhvbGRlcikgewogICAgICAgICAgICBwbG90LmdldFBsYWNlaG9sZGVyKCkudW5iaW5kKCJyZXNpemUiLCBvblJlc2l6ZSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHBsb3QuaG9va3MuYmluZEV2ZW50cy5wdXNoKGJpbmRFdmVudHMpOwogICAgICAgIHBsb3QuaG9va3Muc2h1dGRvd24ucHVzaChzaHV0ZG93bik7CiAgICB9CiAgICAKICAgICQucGxvdC5wbHVnaW5zLnB1c2goewogICAgICAgIGluaXQ6IGluaXQsCiAgICAgICAgb3B0aW9uczogb3B0aW9ucywKICAgICAgICBuYW1lOiAncmVzaXplJywKICAgICAgICB2ZXJzaW9uOiAnMS4wJwogICAgfSk7Cn0pKGpRdWVyeSk7Cjwvc2NyaXB0Pg0KCQk8c2NyaXB0IHR5cGU9ImFwcGxpY2F0aW9uL2phdmFzY3JpcHQiPg0KCQkJJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7DQoJCQkJdmFyIHJvdyA9IDA7DQoJCQkJdmFyIE1JTk9SX0FVVEhPUl9QRVJDRU5UQUdFID0gMS4wMDsNCgkJCQl2YXIgaXNSZXZlcnNlZCA9IGZhbHNlOw0KDQoJCQkJdmFyIGNvbG9yUm93cyA9IGZ1bmN0aW9uKCkgew0KCQkJCQkkKHRoaXMpLnJlbW92ZUNsYXNzKCJvZGQiKTsNCg0KCQkJCQlpZiAocm93KysgJSAyID09IDEpIHsNCgkJCQkJCSQodGhpcykuYWRkQ2xhc3MoIm9kZCIpOw0KCQkJCQl9DQoNCgkJCQkJaWYodGhpcyA9PSAkKHRoaXMpLnBhcmVudCgpLmZpbmQoInRyOnZpc2libGUiKS5nZXQoLTEpKSB7DQoJCQkJCQlyb3cgPSAwOw0KCQkJCQl9DQoJCQkJfQ0KDQoJCQkJLy8gRml4IGhlYWRlciBhbmQgc2V0IGl0IHRvIHRoZSByaWdodCB3aWR0aC4NCgkJCQl2YXIgcmVtYWluaW5nSGVhZGVyV2lkdGggPSAoJCgiZGl2LmxvZ28iKS53aWR0aCgpIC0gNCkgLSAoJCgiZGl2LmxvZ28gaW1nIikuaW5uZXJXaWR0aCgpICsgNDgpDQoJCQkJJCgiZGl2LmxvZ28gcCIpLmNzcygid2lkdGgiLCByZW1haW5pbmdIZWFkZXJXaWR0aCk7DQoNCgkJCQl2YXIgZmlsdGVyUmVzcG9uc2liaWxpdGllcyA9IGZ1bmN0aW9uKCkgew0KCQkJCQkkKCJ0YWJsZSNibGFtZSB0Ym9keSB0ciB0ZDpsYXN0LWNoaWxkIikuZmlsdGVyKGZ1bmN0aW9uKCkgew0KCQkJCQkJcmV0dXJuIHBhcnNlRmxvYXQodGhpcy5pbm5lckhUTUwpIDwgTUlOT1JfQVVUSE9SX1BFUkNFTlRBR0U7DQoJCQkJCX0pLnBhcmVudCgpLmZpbmQoInRkOmZpcnN0LWNoaWxkIikuZWFjaChmdW5jdGlvbigpIHsNCgkJCQkJCSQoImRpdiNyZXNwb25zaWJpbGl0aWVzIGRpdiBoMzpjb250YWlucyhcIiIgKyAkKHRoaXMpLnRleHQoKSArICJcIikiKS5wYXJlbnQoKS5oaWRlKCk7DQoJCQkJCX0pOw0KCQkJCX0NCg0KCQkJCXZhciBmaWx0ZXJUaW1lTGluZSA9IGZ1bmN0aW9uKCkgew0KCQkJCQkkKCJkaXYjdGltZWxpbmUgdGFibGUuZ2l0IHRib2R5IHRyIikuZmlsdGVyKGZ1bmN0aW9uKCkgew0KCQkJCQkJcmV0dXJuICQodGhpcykuZmluZCgidGQ6aGFzKGRpdikiKS5sZW5ndGggPT0gMDsNCgkJCQkJfSkuaGlkZSgpOw0KCQkJCX0NCg0KCQkJCSQoInRhYmxlI2NoYW5nZXMgdGJvZHkgdHIgdGQ6bGFzdC1jaGlsZCIpLmZpbHRlcihmdW5jdGlvbigpIHsNCgkJCQkJcmV0dXJuIHBhcnNlRmxvYXQodGhpcy5pbm5lckhUTUwpIDwgTUlOT1JfQVVUSE9SX1BFUkNFTlRBR0U7DQoJCQkJfSkucGFyZW50KCkuaGlkZSgpOw0KDQoJCQkJJCgidGFibGUjYmxhbWUgdGJvZHkgdHIgdGQ6bGFzdC1jaGlsZCIpLmZpbHRlcihmdW5jdGlvbigpIHsNCgkJCQkJcmV0dXJuIHBhcnNlRmxvYXQodGhpcy5pbm5lckhUTUwpIDwgTUlOT1JfQVVUSE9SX1BFUkNFTlRBR0U7DQoJCQkJfSkucGFyZW50KCkuaGlkZSgpOw0KDQoJCQkJJCgidGFibGUuZ2l0IHRib2R5IHRyOnZpc2libGUiKS5lYWNoKGNvbG9yUm93cyk7DQoNCgkJCQkkKCJ0YWJsZSNjaGFuZ2VzLCB0YWJsZSNibGFtZSIpLnRhYmxlc29ydGVyKHsNCgkJCQkJc29ydExpc3Q6IFtbMCwwXV0sDQoJCQkJCWhlYWRlcnM6IHsNCgkJCQkJCTA6IHsgc29ydGVyOiAidGV4dCIgfQ0KCQkJCQl9DQoJCQkJfSkuYmluZCgic29ydEVuZCIsIGZ1bmN0aW9uKCkgew0KCQkJCQkkKHRoaXMpLmZpbmQoInRib2R5IHRyOnZpc2libGUiKS5lYWNoKGNvbG9yUm93cyk7DQoJCQkJfSk7DQoNCgkJCQkkKCJ0YWJsZSNjaGFuZ2VzIHRoZWFkIHRyIHRoLCB0YWJsZSNibGFtZSB0aGVhZCB0ciB0aCIpLmNsaWNrKGZ1bmN0aW9uKCkgew0KCQkJCQkkKHRoaXMpLnBhcmVudCgpLmZpbmQoInRoIHN0cm9uZyIpLnJlbW92ZSgpOw0KCQkJCQl2YXIgcGFyZW50SW5kZXggPSAkKHRoaXMpLmluZGV4KCk7DQoNCgkJCQkJaWYgKHRoaXMuaXNSZXZlcnNlZCkgew0KCQkJCQkJJCh0aGlzKS5hcHBlbmQoIjxzdHJvbmc+ICZhbmQ7PC9zdHJvbmc+Iik7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQkkKHRoaXMpLmFwcGVuZCgiPHN0cm9uZz4gJm9yOzwvc3Ryb25nPiIpOw0KCQkJCQl9DQoJCQkJCXRoaXMuaXNSZXZlcnNlZCA9ICF0aGlzLmlzUmV2ZXJzZWQ7DQoJCQkJfSk7DQoNCgkJCQkkKCJ0YWJsZSNjaGFuZ2VzIHRoZWFkIHRyIHRoOmZpcnN0LWNoaWxkLCB0YWJsZSNibGFtZSB0aGVhZCB0ciB0aDpmaXJzdC1jaGlsZCIpLmVhY2goZnVuY3Rpb24oKSB7DQoJCQkJCXRoaXMuaXNSZXZlcnNlZCA9IHRydWU7DQoJCQkJCSQodGhpcykuYXBwZW5kKCI8c3Ryb25nPiAmb3I7PC9zdHJvbmc+Iik7DQoJCQkJfSk7DQoNCgkJCQkkKCJ0YWJsZS5naXQgdGZvb3QgdHIgdGQ6Zmlyc3QtY2hpbGQiKS5maWx0ZXIoZnVuY3Rpb24oKSB7DQoJCQkJCXRoaXMuaGlkZGVuQ291bnQgPSAkKHRoaXMpLnBhcmVudCgpLnBhcmVudCgpLnBhcmVudCgpLmZpbmQoInRib2R5IHRyOmhpZGRlbiIpLmxlbmd0aDsNCgkJCQkJcmV0dXJuIHRoaXMuaGlkZGVuQ291bnQgPiAwOw0KCQkJCX0pLmVhY2goZnVuY3Rpb24oKSB7DQoJCQkJCSQodGhpcykuYWRkQ2xhc3MoImhvdmVyYWJsZSIpOw0KCQkJCQl0aGlzLmlubmVySFRNTCA9ICJTaG93IG1pbm9yIGF1dGhvcnMgKCIgKyB0aGlzLmhpZGRlbkNvdW50ICsgIikgJm9yOyI7DQoJCQkJfSkuY2xpY2soZnVuY3Rpb24oKSB7DQoJCQkJCXRoaXMuY2xpY2tlZCA9ICF0aGlzLmNsaWNrZWQ7DQoNCgkJCQkJaWYgKHRoaXMuY2xpY2tlZCkgew0KCQkJCQkJdGhpcy5pbm5lckhUTUwgPSAiSGlkZSBtaW5vciBhdXRob3JzICgiICsgdGhpcy5oaWRkZW5Db3VudCArICIpICZhbmQ7IjsNCgkJCQkJCSQodGhpcykucGFyZW50KCkucGFyZW50KCkucGFyZW50KCkuZmluZCgidGJvZHkgdHIiKS5zaG93KCkuZWFjaChjb2xvclJvd3MpOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJdGhpcy5pbm5lckhUTUwgPSAiU2hvdyBtaW5vciBhdXRob3JzICgiICsgdGhpcy5oaWRkZW5Db3VudCArICIpICZvcjsiOw0KCQkJCQkJJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoKS5maW5kKCJ0Ym9keSB0ciB0ZDpsYXN0LWNoaWxkIikuZmlsdGVyKGZ1bmN0aW9uKCkgew0KCQkJCQkJCXJldHVybiBwYXJzZUZsb2F0KHRoaXMuaW5uZXJIVE1MKSA8IE1JTk9SX0FVVEhPUl9QRVJDRU5UQUdFOw0KCQkJCQkJfSkucGFyZW50KCkuaGlkZSgpOw0KCQkJCQkJJCgidGFibGUuZ2l0IHRib2R5IHRyOnZpc2libGUiKS5lYWNoKGNvbG9yUm93cyk7DQoJCQkJCX0NCgkJCQl9KTsNCg0KCQkJCWZpbHRlclJlc3BvbnNpYmlsaXRpZXMoKTsNCgkJCQl2YXIgaGlkZGVuUmVzcG9uc2liaWxpdGllc0NvdW50ID0gJCgiZGl2I3Jlc3BvbnNpYmlsaXRpZXMgZGl2IGgzOmhpZGRlbiIpLmxlbmd0aDsNCgkJCQlpZiAoaGlkZGVuUmVzcG9uc2liaWxpdGllc0NvdW50ID4gMCkgew0KCQkJCQkkKCJkaXYjcmVzcG9uc2liaWxpdGllcyBkaXYgaDM6dmlzaWJsZSIpLmVhY2goY29sb3JSb3dzKTsNCgkJCQkJJCgiZGl2I3Jlc3BvbnNpYmlsaXRpZXMiKS5wcmVwZW5kKCI8ZGl2IGNsYXNzPVwiYnV0dG9uXCI+U2hvdyBtaW5vciBhdXRob3JzICgiICsgaGlkZGVuUmVzcG9uc2liaWxpdGllc0NvdW50ICsgIikgJm9yOzwvZGl2PiIpOw0KDQoJCQkJCSQoImRpdiNyZXNwb25zaWJpbGl0aWVzIGRpdi5idXR0b24iKS5jbGljayhmdW5jdGlvbigpIHsNCgkJCQkJCXRoaXMuY2xpY2tlZCA9ICF0aGlzLmNsaWNrZWQ7DQoJCQkJCQlpZiAodGhpcy5jbGlja2VkKSB7DQoJCQkJCQkJdGhpcy5pbm5lckhUTUwgPSAiSGlkZSBtaW5vciBhdXRob3JzICgiICsgaGlkZGVuUmVzcG9uc2liaWxpdGllc0NvdW50ICsgIikgJmFuZDsiOw0KCQkJCQkJCSQoImRpdiNyZXNwb25zaWJpbGl0aWVzIGRpdiIpLnNob3coKTsNCgkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJdGhpcy5pbm5lckhUTUwgPSAiU2hvdyBtaW5vciBhdXRob3JzICgiICsgaGlkZGVuUmVzcG9uc2liaWxpdGllc0NvdW50ICsgIikgJm9yOyI7DQoJCQkJCQkJZmlsdGVyUmVzcG9uc2liaWxpdGllcygpOw0KCQkJCQkJfQ0KCQkJCQl9KTsNCgkJCQl9DQoNCg0KCQkJCWZpbHRlclRpbWVMaW5lKCk7DQoJCQkJdmFyIGhpZGRlblRpbWVsaW5lQ291bnQgPSAkKCJkaXYjdGltZWxpbmUgdGFibGUuZ2l0IHRib2R5IHRyOmhpZGRlbiIpLmxlbmd0aDsNCgkJCQlpZiAoaGlkZGVuVGltZWxpbmVDb3VudCA+IDApIHsNCgkJCQkJJCgiZGl2I3RpbWVsaW5lIHRhYmxlLmdpdCB0Ym9keSB0cjp2aXNpYmxlIikuZWFjaChjb2xvclJvd3MpOw0KCQkJCQkkKCJkaXYjdGltZWxpbmUiKS5wcmVwZW5kKCI8ZGl2IGNsYXNzPVwiYnV0dG9uXCI+U2hvdyByb3dzIHdpdGggbWlub3Igd29yayAoIiArIGhpZGRlblRpbWVsaW5lQ291bnQgKyAiKSAmb3I7PC9kaXY+Iik7DQoNCgkJCQkJJCgiZGl2I3RpbWVsaW5lIGRpdi5idXR0b24iKS5jbGljayhmdW5jdGlvbigpIHsNCgkJCQkJCXRoaXMuY2xpY2tlZCA9ICF0aGlzLmNsaWNrZWQ7DQoJCQkJCQlpZiAodGhpcy5jbGlja2VkKSB7DQoJCQkJCQkJdGhpcy5pbm5lckhUTUwgPSAiSGlkZSByb3dzIHdpdGggbWlub3Igd29yayAoIiArIGhpZGRlblRpbWVsaW5lQ291bnQgKyAiKSAmYW5kOyI7DQoJCQkJCQkJJCgiZGl2I3RpbWVsaW5lIHRhYmxlLmdpdCB0Ym9keSB0ciIpLnNob3coKS5lYWNoKGNvbG9yUm93cyk7DQoJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCXRoaXMuaW5uZXJIVE1MID0gIlNob3cgcm93cyB3aXRoIG1pbm9yIHdvcmsgKCIgKyBoaWRkZW5UaW1lbGluZUNvdW50ICsgIikgJm9yOyI7DQoJCQkJCQkJZmlsdGVyVGltZUxpbmUoKTsNCgkJCQkJCQkkKCJkaXYjdGltZWxpbmUgdGFibGUuZ2l0IHRib2R5IHRyOnZpc2libGUiKS5lYWNoKGNvbG9yUm93cyk7DQoJCQkJCQl9DQoJCQkJCX0pOw0KCQkJCX0NCg0KCQkJCSQoIiNibGFtZV9jaGFydCwgI2NoYW5nZXNfY2hhcnQiKS5iaW5kKCJwbG90aG92ZXIiLCBmdW5jdGlvbihldmVudCwgcG9zLCBvYmopIHsNCgkJCQkJaWYgKG9iaikgew0KCQkJCQkJdmFyIHNlbGVjdGlvbiA9ICJ0YWJsZSB0Ym9keSB0ciB0ZDpjb250YWlucyhcIiIgKyBvYmouc2VyaWVzLmxhYmVsICsgIlwiKSI7DQoJCQkJCQl2YXIgZWxlbWVudCA9ICQodGhpcykucGFyZW50KCkuZmluZChzZWxlY3Rpb24pOw0KDQoJCQkJCQlpZiAoZWxlbWVudCkgew0KCQkJCQkJCWlmICh0aGlzLmhvdmVyZWRFbGVtZW50ICYmIHRoaXMuaG92ZXJlZEVsZW1lbnQuaHRtbCgpICE9IGVsZW1lbnQucGFyZW50KCkuaHRtbCgpKSB7DQoJCQkJCQkJCXRoaXMuaG92ZXJlZEVsZW1lbnQucmVtb3ZlQ2xhc3MoInBpZWhvdmVyIik7DQoJCQkJCQkJfQ0KDQoJCQkJCQkJZWxlbWVudC5wYXJlbnQoKS5hZGRDbGFzcygicGllaG92ZXIiKTsNCgkJCQkJCQl0aGlzLmhvdmVyZWRFbGVtZW50ID0gZWxlbWVudC5wYXJlbnQoKTsNCgkJCQkJCX0NCgkJCQkJfSBlbHNlIGlmICh0aGlzLmhvdmVyZWRFbGVtZW50KSB7DQoJCQkJCQl0aGlzLmhvdmVyZWRFbGVtZW50LnJlbW92ZUNsYXNzKCJwaWVob3ZlciIpOw0KCQkJCQl9DQoJCQkJfSk7DQoNCgkJCQkvLyBNYWtlIHN1cmUgdGhlIHR3byBwaWUgY2hhcnRzIHVzZSB0aGUgc2FtZSBjb2xvcnMuDQoNCgkJCQl2YXIgYXV0aG9yX2NvbG9ycyA9IHt9Ow0KCQkJCSQuZWFjaChjaGFuZ2VzX3Bsb3QuZ2V0RGF0YSgpLCBmdW5jdGlvbihpLCB2KSB7DQoJCQkJCWF1dGhvcl9jb2xvcnNbdlsibGFiZWwiXV0gPSB2WyJjb2xvciJdOw0KCQkJCX0pOw0KDQoJCQkJJC5lYWNoKGJsYW1lX3Bsb3QuZ2V0RGF0YSgpLCBmdW5jdGlvbihpLCB2KSB7DQoJCQkJCWlmIChhdXRob3JfY29sb3JzW3ZbImxhYmVsIl1dICE9IHVuZGVmaW5lZCkgew0KCQkJCQkJdlsiY29sb3IiXSA9IGF1dGhvcl9jb2xvcnNbdlsibGFiZWwiXV07DQoJCQkJCX0NCgkJCQl9KTsNCg0KCQkJCWJsYW1lX3Bsb3Quc2V0dXBHcmlkKCk7DQoJCQkJYmxhbWVfcGxvdC5kcmF3KCk7DQoNCgkJCQkvLyBDb2xvciBpbiBtZXRyaWNzIGxldmVscy4NCg0KCQkJCSQoImRpdiNtZXRyaWNzIGRpdiBkaXYiKS5lYWNoKGZ1bmN0aW9uKCkgew0KCQkJCQl2YXIgcmdiID0gJCh0aGlzKS5jc3MoImJhY2tncm91bmQtY29sb3IiKS5tYXRjaCgvXGQrL2cpOw0KCQkJCQlyZ2JbMF0gPSBwYXJzZUludChyZ2JbMF0pOw0KCQkJCQlyZ2JbMV0gPSBwYXJzZUludChyZ2JbMV0pOw0KCQkJCQlyZ2JbMl0gPSBwYXJzZUludChyZ2JbMl0pOw0KDQoJCQkJCWlmICgkKHRoaXMpLmhhc0NsYXNzKCJtaW5pbWFsIikpIHsNCgkJCQkJCXJnYlswXSAtPSAxMDsNCgkJCQkJCXJnYlsxXSArPSAxMDsNCgkJCQkJCXJnYlsyXSAtPSAxMDsNCgkJCQkJfSBlbHNlIGlmICgkKHRoaXMpLmhhc0NsYXNzKCJtaW5vciIpKSB7DQoJCQkJCQlyZ2JbMV0gKz0gMTA7DQoJCQkJCX0gZWxzZSBpZiAoJCh0aGlzKS5oYXNDbGFzcygibWVkaXVtIikpIHsNCgkJCQkJCXJnYlswXSArPSAxMDsNCgkJCQkJCXJnYlsxXSArPSAxMDsNCgkJCQkJfSBlbHNlIGlmICgkKHRoaXMpLmhhc0NsYXNzKCJiYWQiKSkgew0KCQkJCQkJcmdiWzBdICs9IDEwOw0KCQkJCQkJcmdiWzFdIC09IDEwOw0KCQkJCQkJcmdiWzJdIC09IDEwOw0KCQkJCQl9IGVsc2UgaWYgKCQodGhpcykuaGFzQ2xhc3MoInNldmVyZSIpKSB7DQoJCQkJCQlyZ2JbMF0gKz0gMjA7DQoJCQkJCQlyZ2JbMV0gLT0gMjA7DQoJCQkJCQlyZ2JbMl0gLT0gMjA7DQoJCQkJCX0NCg0KCQkJCQkkKHRoaXMpLmNzcygiYmFja2dyb3VuZC1jb2xvciIsICJyZ2IoIiArIHJnYlswXSArICIsIiArIHJnYlsxXSArICIsIiArIHJnYlsyXSArICIpIik7DQoJCQkJfSk7DQoJCQl9KTsNCgkJPC9zY3JpcHQ+DQoJCTxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+DQoJCQlib2R5IHsNCgkJCQliYWNrZ3JvdW5kOiAtd2Via2l0LWxpbmVhci1ncmFkaWVudChsZWZ0LCAjOGY4YTlhLCAjZGFkMmQ3LCAjOGY4YTlhKTsNCgkJCQliYWNrZ3JvdW5kOiAtbW96LWxpbmVhci1ncmFkaWVudChsZWZ0LCAjOGY4YTlhLCAjZGFkMmQ3LCAjOGY4YTlhKTsNCgkJCX0NCgkJCWh0bWwsIGJvZHkgew0KCQkJCW1hcmdpbjogMDsNCgkJCQlmb250LWZhbWlseTogIkFyaWFsIjsNCgkJCX0NCgkJCWJvZHkgPiBkaXYgew0KCQkJCW1hcmdpbjogMCBhdXRvOw0KCQkJCXdpZHRoOiA1OGVtOw0KCQkJfQ0KCQkJZGl2LmJveCB7DQoJCQkJYm9yZGVyOiA0cHggc29saWQgI2RkZDsNCgkJCQliYWNrZ3JvdW5kLWNvbG9yOiAjZWVlOw0KCQkJCW1hcmdpbjogMC43NWVtOw0KCQkJCXBhZGRpbmc6IDVweDsNCgkJCQlmb250LXNpemU6IHNtYWxsOw0KCQkJCWJvcmRlci1yYWRpdXM6IDE1cHg7DQoJCQkJLW1vei1ib3JkZXItcmFkaXVzOiAxNXB4Ow0KCQkJCWJveC1zaGFkb3c6IDFweCAxcHggM3B4ICM2NjY7DQoJCQkJLW1vei1ib3gtc2hhZG93OiAxcHggMXB4IDNweCAjNjY2Ow0KCQkJfQ0KCQkJZGl2LmxvZ28gcCB7DQoJCQkJd2lkdGg6IDYwZW07DQoJCQkJZGlzcGxheTppbmxpbmUtYmxvY2s7DQoJCQkJdmVydGljYWwtYWxpZ246bWlkZGxlOw0KCQkJfQ0KCQkJZGl2LmxvZ28gaW1nIHsNCgkJCQl2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7DQoJCQkJcGFkZGluZzogMnB4IDEwcHggMnB4IDJweDsNCgkJCX0NCgkJCWJvZHkgPiBkaXYgew0KCQkJCWRpc3BsYXk6IGJsb2NrLWlubGluZTsNCgkJCX0NCgkJCWJvZHkgPiBkaXYgPiBkaXYgPiBkaXYgew0KCQkJCXBvc2l0aW9uOiByZWxhdGl2ZTsNCgkJCQl3aWR0aDogMTAwJTsNCgkJCQltaW4taGVpZ2h0OiAxNDBweDsNCgkJCX0NCgkJCXRhYmxlLmdpdCB7DQoJCQkJZm9udC1zaXplOiBzbWFsbDsNCgkJCQl3aWR0aDogNjUlOw0KCQkJCXBhZGRpbmctcmlnaHQ6IDVweDsNCgkJCX0NCgkJCXRhYmxlLmZ1bGwgew0KCQkJCXdpZHRoOiAxMDAlOw0KCQkJfQ0KCQkJdGFibGUuZ2l0IHRoLCB0YWJsZS5naXQgdGZvb3QgdHIgdGQgew0KCQkJCXBhZGRpbmc6IDAuM2VtOw0KCQkJCWJhY2tncm91bmQtY29sb3I6ICNkZGNlY2U7DQoJCQkJYm9yZGVyLXJhZGl1czogOHB4IDhweCAwcHggMHB4Ow0KCQkJCS1tb3otYm9yZGVyLXJhZGl1czogOHB4IDhweCAwcHggMHB4Ow0KCQkJfQ0KCQkJdGFibGUjY2hhbmdlcyB0aGVhZCB0ciB0aCwgdGFibGUjYmxhbWUgdGhlYWQgdHIgdGgsIHRhYmxlLmdpdCB0Zm9vdCB0ciB0ZCB7DQoJCQkJYm9yZGVyOiAxcHggc29saWQgI2VlZTsNCgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7DQoJCQl9DQoJCQl0YWJsZS5naXQgdGZvb3QgdHIgdGQgew0KCQkJCWJvcmRlci1yYWRpdXM6IDBweCAwcHggOHB4IDhweDsNCgkJCQktbW96LWJvcmRlci1yYWRpdXM6IDBweCAwcHggOHB4IDhweDsNCgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7DQoJCQl9DQoJCQl0YWJsZS5naXQgdGQsIHRhYmxlLmdpdCB0aCwgdGFibGUjdGltZWxpbmUgdGQsIHRhYmxlI3RpbWVsaW5lIHRoIHsNCgkJCQlwYWRkaW5nOiAwLjM1ZW07DQoJCQkJaGVpZ2h0OiAyZW07DQoJCQl9DQoJCQl0YWJsZS5naXQgdGQgZGl2Lmluc2VydCB7DQoJCQkJYmFja2dyb3VuZC1jb2xvcjogIzdhNzsNCgkJCX0NCgkJCXRhYmxlLmdpdCB0ZCBkaXYucmVtb3ZlIHsNCgkJCQliYWNrZ3JvdW5kLWNvbG9yOiAjYzY2Ow0KCQkJfQ0KCQkJdGFibGUuZ2l0IHRkIGRpdi5pbnNlcnQsIHRhYmxlLmdpdCB0ZCBkaXYucmVtb3ZlIHsNCgkJCQloZWlnaHQ6IDEwMCU7DQoJCQkJZmxvYXQ6IGxlZnQ7DQoJCQl9DQoJCQl0YWJsZS5naXQgdHIub2RkIHsNCgkJCQliYWNrZ3JvdW5kLWNvbG9yOiAjZGJkYmRiOw0KCQkJfQ0KCQkJdGFibGUuZ2l0IHRyLnBpZWhvdmVyIHsNCgkJCQliYWNrZ3JvdW5kLWNvbG9yOiAjZGRkZWNlOw0KCQkJfQ0KCQkJZGl2LmNoYXJ0IHsNCgkJCQlwb3NpdGlvbjogYWJzb2x1dGU7DQoJCQkJdG9wOiA1cHg7DQoJCQkJYm90dG9tOiA1cHg7DQoJCQkJcmlnaHQ6IDBweDsNCgkJCQl3aWR0aDogMzUlOw0KCQkJCW1pbi1oZWlnaHQ6IDEwMHB4Ow0KCQkJCW1heC1oZWlnaHQ6IDIxMHB4Ow0KCQkJCWZvbnQtc2l6ZTogeC1zbWFsbDsNCgkJCX0NCgkJCXAuZXJyb3Igew0KCQkJCWNvbG9yOiAjNzAwOw0KCQkJfQ0KCQkJdGFibGUjY2hhbmdlcyB0aGVhZCB0ciB0aDpob3ZlciwgdGFibGUjYmxhbWUgdGhlYWQgdHIgdGg6aG92ZXIsDQoJCQl0YWJsZSNjaGFuZ2VzIHRmb290IHRyIHRkLmhvdmVyYWJsZTpob3ZlciwgdGFibGUjYmxhbWUgdGZvb3QgdHIgdGQuaG92ZXJhYmxlOmhvdmVyLA0KCQkJZGl2LmJ1dHRvbjpob3ZlciwgZGl2I3Jlc3BvbnNpYmlsaXRpZXMgZGl2LmJ1dHRvbjpob3ZlciB7DQoJCQkJYmFja2dyb3VuZC1jb2xvcjogI2VkZGVkZTsNCgkJCQlib3JkZXI6IDFweCBzb2xpZCAjYmJiOw0KCQkJCWN1cnNvcjogaGFuZDsNCgkJCX0NCgkJCWRpdiNyZXNwb25zaWJpbGl0aWVzIGRpdiwgZGl2I3Jlc3BvbnNpYmlsaXRpZXMgZGl2IGRpdiwgZGl2I21ldHJpY3MgZGl2LCBkaXYjbWV0cmljcyBkaXYgZGl2IHsNCgkJCQltaW4taGVpZ2h0OiAwcHg7DQoJCQkJcGFkZGluZzogMC41ZW0gMC4yZW07DQoJCQkJd2lkdGg6IGF1dG87DQoJCQl9DQoJCQlkaXYjbWV0cmljcyBkaXYgew0KCQkJCWJhY2tncm91bmQtY29sb3I6ICNlZWU7DQoJCQl9DQoJCQlkaXYjcmVzcG9uc2liaWxpdGllcyBkaXYub2RkLCBkaXYjbWV0cmljcyBkaXYub2RkIHsNCgkJCQliYWNrZ3JvdW5kLWNvbG9yOiAjZGJkYmRiOw0KCQkJfQ0KCQkJZGl2I3Jlc3BvbnNpYmlsaXRpZXMgcCB7DQoJCQkJbWFyZ2luLWJvdHRvbTogMHB4Ow0KCQkJfQ0KCQkJdGQgaW1nLCBoMyBpbWcgew0KCQkJCWJvcmRlci1yYWRpdXM6IDNweCAzcHggM3B4IDNweDsNCgkJCQktbW96LWJvcmRlci1yYWRpdXM6IDNweCAzcHggM3B4IDNweDsNCgkJCQl2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOw0KCQkJCW1hcmdpbi1yaWdodDogMC40ZW07DQoJCQkJb3BhY2l0eTogMC44NTsNCgkJCX0NCgkJCXRkIGltZyB7DQoJCQkJd2lkdGg6IDIwcHg7DQoJCQkJaGVpZ2h0OiAyMHB4Ow0KCQkJfQ0KCQkJaDMgaW1nIHsNCgkJCQl3aWR0aDogMzJweDsNCgkJCQloZWlnaHQ6IDMycHg7DQoJCQl9DQoJCQloMywgaDQgew0KCQkJCWJvcmRlci1yYWRpdXM6IDhweCA4cHggOHB4IDhweDsNCgkJCQktbW96LWJvcmRlci1yYWRpdXM6IDhweCA4cHggOHB4IDhweDsNCgkJCQliYWNrZ3JvdW5kLWNvbG9yOiAjZGRjZWNlOw0KCQkJCW1hcmdpbi1ib3R0b206IDAuMmVtOw0KCQkJCW1hcmdpbi10b3A6IDAuNmVtOw0KCQkJfQ0KCQkJaDQgew0KCQkJCW1hcmdpbi10b3A6IDAuMmVtOw0KCQkJCXBhZGRpbmc6IDAuNWVtOw0KCQkJfQ0KCQkJZGl2LmJ1dHRvbiwgZGl2I3Jlc3BvbnNpYmlsaXRpZXMgZGl2LmJ1dHRvbiB7DQoJCQkJYm9yZGVyLXJhZGl1czogOHB4IDhweCA4cHggOHB4Ow0KCQkJCS1tb3otYm9yZGVyLXJhZGl1czogOHB4IDhweCA4cHggOHB4Ow0KCQkJCWJvcmRlcjogMXB4IHNvbGlkICNlZWU7DQoJCQkJZmxvYXQ6IHJpZ2h0Ow0KCQkJCXdpZHRoOiBhdXRvOw0KCQkJCXBhZGRpbmc6IDAuNWVtOw0KCQkJCWJhY2tncm91bmQtY29sb3I6ICNkZGNlY2U7DQoJCQkJbWluLWhlaWdodDogMDsNCgkJCX0NCgkJPC9zdHlsZT4NCgk8L2hlYWQ+DQoJPGJvZHk+DQoJCTxkaXY+PGRpdiBjbGFzcz0iYm94IGxvZ28iPg0KCQkJPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL2Vqd2EvZ2l0aW5zcGVjdG9yIj48aW1nIHNyYz0iZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFGQUFBQUJCQ0FZQUFBQkdteU9UQUFBQUNYQklXWE1BQUJjUkFBQVhFUUhLSnZNL0FBQVduRWxFUVZSNG5PMWNhWFJjeFpYK2JsVzlYclZac21Wc2c4RTJtOEdBd0JnSHM0TkRJQmdEU1F3SlN4S0dRSVlFT014aHp1UmtHVWFUYlFKSmhtR0FEQ0VKbVFGQ0FKTUF0aUZ3d2haMmcxZHMyYkl0MjdJc2ExZXJXNzIrcmU3OGVHcXB1OVd0bGpmd25EUGZPVDZXM3J1dlh0WDNidDI2ZGU4dEVjWUcvUi84T2ZmM3d1c3VnQXdBR3dEakFDRHZCY3lnbGpzdTlhM1kzUm5zaU5vQkNTT2dnbEtHU01xS01LbWdnaUlXTW16NEpVa29ZcEtCQUVseW9aU1FpZ2hLU0pLU0lVRlFVa2dwQ0VvSTczY2xwSVJtUllLRUlDaEJrQVJJaGxBQ1VGSkFNRUVSUVJKRENnakZCQ2tJa29nVUNCSU1TWUFTQWdMdytpTUlrb2tWQVpLSUJJRVVNeVFScENTdWhPTldSdU9aZGEvdTZQcnZ1MWFzMndnZ0NTQUd3RGxnQkhKam8zaXo2YzNRcEdqdjVhemthWlptNVdvbUltSWcvM014TkEvOXdDUFhLUCtMRWhnNjV6NXg0UmRuem5sZVVQN3pYS0FoUEZxYnhnMWkxdTdrbXZDa3VvcXJOdlhFZm4vVlV4OHNCZEFISUlMOUpKRUFqN3pJMnRlbnVSUi8yTlU0eW1XSWJMK3pBOG5qYXVnYWVhVHhpS2ducUVkYVp6RGwzeWR3VG1Pc0FSQ0JlZWliZ01Bby9CZ0hDRW5OSFRSOXd2eVhkL1orLzY1WG1qNEMwQVZnb0ZCdTIrM1hWY1ZhbTUzVGw2OU9sV3RUTUlPQUpzVWkrUUF6VFhlWjVSanlZdzVzbEk0VmdzclluWEwzOXhOaFFWT2Q3c0YxQ3laVjNnakFCNkFDZ0NxVXkvUzFmVnU2NlFmZmFEeC8xTDFDQ0R4eWkrcHJhajJUd0RNMHM4aTVsNk55bzhkRjViU2tQQm1lRmg5azBncFJaZXU2c0tTVGFnd0RBQVFBbzFCR0orTit4OWFwQ3hyZkxEdTlWWHR5UUlWTlo3WkxCRThieTA2Zkl2ZEhkRStQdm9seXVqazhmVDh4VVBTQ0krdHFubXZwaWdJUWhYZTFxeE1NbnRYMDFZWFhJaFFhc2IwTUFsekUyL3FXZmVZdkt3Y0JRUGtISVVsUW9DZ3Q1WmY2dlB0VXlCUVgrUmc1NnF4UmJHVTRPUFl2dncrTXlxQVlwWGxaYUtWMmsyV2VtK25hL2VXUlI3elpxVUZCYmZNcUFCNkJTZGlxWnB5dkxkT25zWmZKVDluKzVhS3NWbWhhcmdQK0QzVk5EUUwrYWxCbEpabmRiY2pFWWpCakpxWk1NZHF6c3NxUG9JS0E1MklXZVVkNSsxZGtlaDZpOW0rOEdGcDlkemI5dzVKYVpkdnpIVHRWRi9UNXQ0UkNldjJKTDI2MWNtV1ZOSklTUkR6a2FiRTN6MHRpekFHWHRYOUZ2c1luYi8vR2h4My9kTU5OMFEyckx6UmQxd2ZBMWNDWEhGRDN1aXZQL0YzRDgrOS9tSlVURnZ1TEx0VjdhLzhFUVVzaXJRUzVpc2dWSUpmR2FLTTQyYVh0SHdGTUFBdUN6djdMWGl2VHo3M0d1bXN2K056QStsV2ZqV2FjL3JhWStWTG5vUFhuaE9tOHJvQUFyTUZiWHBwL2RGVldWa2tIaFg1ZnNRNlY3S1RKY0JMRW5hWkVqeUZJS3lGbDBIVXJLMXdjN2dJeTYybVBhU0xIbU1vdXRDOHBCV3lEZ2tUQ0VWTENZSTRGMG81V3pJYjNlSGtUdkRkd1VvblRFcWFWZnF0OTRBZU5MWkhCN1BXUExtKzRRcHVabTF5aDV3RjREUUNVaEZaYWt5akcwVmoyejlLYTltaG4wMDZtRloySjVJWTNXdnQzZDlwQjgyZG5IbjVZbFU4ZWx3aUo4NnJTZWxMWWRZOTNtSVZtaU95V0JCaVAvV01hWUNkZ0J2M21MbE0vMWJ3N3RxcHg1WTdOdjFrNHAzN085T3FUcURwNFN6SnBxcHFFbVdRWEZWbE4zRXNpQ1VYa2xXMnBvQ0hkSmFkT3lUUzJSSWF2MTV3MEx4TmY4eTdTME1hSUxMUlNHTmM4R0JZeFhRZWJiZWYxUjNkRWZ2dmM5dTdkQUZJQUhHQ1FQLzk4OTNZQTI1di83cXkzcldyam15S1M2Z21tN1hNY0JtdXd5SDFQdnYzTG43Nzl3cTNhcmNYTE55OXYrbldmYWZiRGN4dnNtMS9kMkE5Z000Qm50bnpyd3B2amh2eFdaVFMxQ3k0bTh0ajJ1eGlLRWdqQ1JnVTAyRmJnaDV1dlAvOWxQVGpZcm1ZZGMzcHM0NXFGRmxNVWNFWnNvSkNqcG5BWis4ZTBrM25WUFpzNmYvL2M5dTQ5OE1nYkZSNDYvdEYzNHhWKzh5RjlXRTNHVXZJRFFkQlpyU3R1LzBZUVpTZTRSOVByVjYzWThIQ2ZhVVlBUklmZWtZZmpmdlg2YjBMVmxiOHpENnVWRXJDR0dObHZtM2pLNmV0ZnlHaGVxYTNVa1ptZXJqdXNUUEwrWk5PNkw5cFdScTNzR0hqczZ2ZmJoOVZTQ0RlUHdESHRINEc0WDd0OXIvY25scjJ6SjlxRGtkaGFVUnh4My90cGtQcVRXVi9aTDRFa2dYalUxQzM0M1FXcmRGRGhycmUzL3g3ZXh4bEVvWk9WZzVuM3YvS2dMK1NyU1FWOHF3U1YvVGJqQWpWQ24vWGF0bnRib3VaUHV5eDNtZkFIWC93NFl2NjVPV1BjZWZFWko2M0psVld1RUVZeGw3eVkvUU9BTHNmWi9jaW1qaTBvUTE0V3MrNTdhY091Zi96OE54dzV1SnBjZlM2OE9CMlhjbDlTWUJWaDlXcExMSldDcDFWV1VjRWN5SUR4WDJwcTdWbHlaN2QybWVYK0xpb2J2M3IrTjZ6Ky9sTk9lM0hEN1FBMlpLKy9jY21jNjYzdWppdVduejN6cnN2ZjJkRUdBSUwwNkNsY0JObVFsb2dJMmRhZnNGeDRXbEZTTTNKaEJIdzduSXBncHdDVjBKQVIrK2NFVkthNVA3NFJIbkZsUHhBQVFOT0hSdEE0M25YUk55NzVjczJaVmhWcG5sQjR2Y2F2ZHJCbGhUUzVKMld2ZWRIaUhJeGwvelFCU2FiRTNuYUlmTXBHeUhBUUF6eXl1S1IyTUFtT1pwdzRjdUtPWlJId1I0UnQxMXJRclFRNmJHLzdsMFh6Yll1bkNzTUlPSDM5SVcwb2ZQekZlVE5qc1JqYVlobk12ZmpTV25ONzA4Vk9Lc093T1pwOVJybGdKY0UwdEFzWk5aN3NEd1Jpd1V3MWZwSGRPb3VoZjJXMVVBZzUyVTQ1TzQxQzRvcTdNdWEwNm1BZHZEaGQyWGdjUEtIRG9GUVhlekUrMnRlRnhPcm8rSzZiU3M4QTJHWFdEbHZtQTJGQk9MWW1RUEdQL3VZSVlrNDdla2RWUUt3ZWZyZUFWS0Q4b1pTeWZ3VFNGWVFKODZkUHJGeloxaGVEWndmSEpKQWJsL2o2cFRqY2ppVjc5VkNrdTVUOVl6QUo4TlRxa0w4RzNtSTlyaWxzK01SNWFadFhHa0tjN1hoNWduMnpmMzdmay81dytHaElINlFVY0MwYmcvRWtPbnM2OFY3bklBV0YwVHNuVVAvYTFVM2JodTJ5SU8yVXM0RjVvNjEwZE9EbWs2ZWRDU0FFd0k4aThiUmM5UG44bDJRME5nVlpMOUJnb1VkTjMyek9oYW5UTmlmdXR0eVhybjF1elF2d1hKZGt1VEZ6NHhJZkNYbGJaM1A3TGcwTzdJOGJjL0lmMzN2L2hNZi85cmdJVk81d0xkUFh2VnYvOFRQUHIzejhxdmZhSHYvNXp1aGo4NDZZRUo4MXkvamVHK2NmTlJ6QUVocHlaSnJreCsrS3VqUlRRY2NlRVE3TStjNTV4ODhCVUEwZ2pCSWtSbjkrd3d6aG82ODB2OSs4UzRKbWxQSXhHRXo5NUU3c0QvaVhMMzVoM2NNQSt1RVJXTlk4REZRRS9qMnA4WEpOTExGd0h4enBvckFpWFJlaytudlBycC9VbXpldTJwcGdpRXp6REJQaTlPdzFRVjZxY0ZnTGlqV1lHNzR5U0lSbXBETW5YRGE5OXByN0wybTRBRUFkZ0NvVTJLditYMTYvd0NiNnljNzFiZThmQy81MlFicGcyUDR4bUhyaFR1enhCNVl2Zm1IOVdPUXBlT0YzQW9BUEdpK3Q2cjNudXNjc29zTjN2ZnB4eENmRVVWNTcrMCtpblJ3TUpKSVo2OFNsVFhrdVZGMWRmUktzdVNmdURLL1Fpc0I1QXk5bC8zSWtPTWhVTlhVZ05STTEvcy85NktMWnNYOStiZk1xZUc2SEF3QmRQL3JTSWpoMFVmK2FyVTJUVTVscmRXNzZOTWYrTVlPNkhMT3V6K2RmdnZqWlZVWEpHN2ozMm9hMGFkL1Myak80YVV0M2RNZXN1cXJwaDlWWG4xSmJFYnFzY3pEOVZQZmJHMXFPRGdjKzcvWDl3R2lnSU5GYjVWZkhyYnQ2L2dVTno2eDhBd0NhR3BmNHJFMTdMb0VndHo2QVRWbFpwY0ZLQWptNXlIeTJTcjNFQjRSa0xGR25OVXVNck1nZU5GZGFmWkd0Tlduek9xdkV0R0lHUlJSUGpQaEN5eFkvdDZZb2VZbjd2dDVnczM2NmZVLzBJYktkWTA2ZFB1bDhraEl0WGJHbXhMdk5EOHd4YU1IUjRVRDlVRWNQV0RURzF2Nm5GV2RPZFdPeDJ6Njg1TVF2Q25hYzVLb3RZV2xaaDltYTExM3libHRUVmxZUlErclJneHh6U3pmazVqTUJrQ1N5eEEyM1FTRGhna1R1NnBTYi8yQ0FldG11NjFPaFpZditWRnp6RXZkOXZjR1Y0dW4xNjl0K2ZIaG4velZLMEFTWE9VMUU2Z1JnSVFjVWxlcm8vdUtNbHo3cVduNzJ6THVoOVkxVmZtTnFsZCtvN3hxSWQvZWtuSmRzNGY1UHJxd2lDQVVTVk1wZWo1bStaTTZTVlBBQnRCaU9iQmRFdVJtZ0x0ZXE2ek44eXhhWElXL3QrdFpoOGdCQUVJV0cyampvR05xcS9XczVPYVVKTXFzcDdJWGZ4NWdLQmZrUEFrSHo2TFFnU0JBbzd6b1JXR3VtaUkvcklpSThObm1DbmwyOWZ1ZmQwenNqMTJiSk81QlRkRHpZOXIyYlA1ZmV1ZmxpTmpNVGc0ZE5kWTc5MWJLYm1yNHk3MFNJOERtd2VoL05MakNLd0VwREYvTkRTcm8wTkdJeVNjdmhtRnJPQUVsb2FKR1hwV2RRTjl0MUVSbGF0cWpFZ2pGTTNzZXRueXA1elhkZWRXRml6VHMzYWEwdENJbE1WMGNhQU5oWGM3TGQxYjZvTjJHdUFyQUtBRVRoS295OUtOOGdJc3F4Z1NQWG9RV0dOSkFaNUFMVW82MjZYbWtzdSt3UUp3OEFNcTF0WjFtdXpuRGRsRHRWUldpVFpxK2JEbk16ZzlXQTY4ek15Z3BpV1hJblVxNThneGxVM0FhU2dHRFNBRFJBQXdacSswS2haWXVYRi9mekVnL2QzS0JIeUx0QkNackEzaGJsRXljUEFGekhsS3gxT240Y29rSW9nTW5yUnlaeERKaGQweGtKcUFqUVVEUm1kUGxaQVlyZUp4TER6dmZ3WUxXanBaT3hDUVRxdE5LMVhVS1YxcnlIYm03UWp2UHMyaEh5cWo0dDRyS1FXbS95R1hMS3hLWk1Jd2s1aFloRTgyMVgzbVRIRTVmRmJiZHZhblZ3WlZaV01Pdmk4ZFRpUCtmYVB6Q1lpTVdvd1dxSEtSMU4rdnFVbU5oT1lzVmxwUmFNSWZKV2ZkeDY5N1JEaER3QU9PV01UYyttTEx5VmlVWm5XNUcrSTV4RW9qNjFkZlBsbG0zTEhYSHJpWVd2TmZkblpkV3dCZ0lBRVlQSGlOVVZqbzVBRUN4UWVGbXkwQWJkMUVOWWV2VXJteDlEQ1p1bkhmdlp0Ui92dXZ2SXpvSHI1U0ZDSHVDRjlJSG1YengxN2pHemJjYzVaMHRQd2oxNlFtV0diZjNpamV2YW9ybXlpcGdrZS9XamhkeVVyV1VoSmtFc1J3MmFHSktVZUdUaHM2c2ZoYWZCZWVRbDcvL0dYSWYwazZ2WDd4d2lEOVdIQ25tNVdIRGhSVExWM21hZlBMbTcwcGd3MGFaZ1NHSmRhNTZNWXBEU0RKMnpraFNyMHlwS0prbjRjdnpBa1lBRHk2VW4vUHF0YmdBUzNpWWtqenlYOUpPcjErejgxeU43RGwzeXR2Nzk1WGYwdnYvV3VXRHRKOER2SnBNWkxlaXk5VmVjdXZTVUY5WSttNVVUR08zRzVLS28vV09Bb3FUck0wSkdYdG5hMFFRZ0RpKzRDZ0NZOU5NL2QySWtJSnF2ZWRCUHJscC9hSlBYZE91Vmx5WmFXODZMTzNyUDduam1RUzNWclYzSnpCKzA2NmJkVFByTEgxdzBaM0pXVnRId0tqeDJJQ2JYL2tWY3E2YkRwUmNYL2FYcGx4aG43QzU2LzlmbXVxU2YvR2p0amgvTjZJNGVzdVFCUUxwemQwUEd0RzFtNTErdWZMODFhL08ycjEwOE44Rm04dmFXZ1lGNUFGWUFYbzIwMHNUanRuOEp4eldpZnJWdTBWK2EvZ05lemphR2N1VDk0bXR6MmVFblAxcXovY2RIZFE5Y2R5aVRCd0J3N0VwTmxMN2d6ZGE4QlVPRUFoSmdOYTErd3JBZnFJQlJpZldDZ2VXWDc4WVV1Mi8ycGY4QUlBMHY1RDVtSFRFL3MwUjJiMDR0YlcvcitjN00zdGpYNlJCYWJVdER4LzJDWnEzNndyenZHbjRmQUVDUUlEcytPSk1ZOFFsKzQ4SzFWelFzZ0ZDeFVRSFZIQlN6ZjBJRURQWERkelp1Z1JkQXpSUi9OT2U1cTVlNjdkKzdZbE5kMytBY0phblNQVVRyQVhPaGxXKzM3WnB6blZoMHJnbUE4ajBValVUaVJBQkl1eHhUREZMREJaWWxrTFYvTEtEU21qdmdCVThaNHp5a0lwUnNFM1hWR24yeGZSN1VKNGt6bmwvekJJQW54aVByVFdFZVNhV09WYjdMREsxOHc1VWdlNUVYcG1ySGtGdDg0K25SWHNBRmxNVVVDQkx2ZGJKL0xHeTdhOGtKV3ZxbUhCdjZ3eHZVQ0wzenppVU42ZmpnbDNRbVk1Q1FyNXo0K091dloyVVZEZGxBNzZoV2FTM1VBQVRERGZ1Tncyc01nNk8yTGVFbHN0UGxPaVNWT2lFMWtIemJHR09Yc3k5b3p6aXpZaG03NnFpcVFFdVZRTFRmMWhNbHc2N3h5V2o1cDB0anNIWFhWYW1CNk1sTzNZbHZiMTh5SlJodjNYNlhtVTVXZ1dFUmNPdXJGeDIvUHJ1ZEUxdzgrei9LL21YL3o4UlMzZmNzbkwwQVFCQmVTbk5NVXJwK2VOMUp3cWRzTVpnOFV2UFlPZVM5aFhhMVl3aVlDakFUR2hWdGljek1BZHV1Mjk5MmhXbFdhZFo5Snk1dHNnYVZ1Y1JPcHlZTzJ2cXBoRVVQRVZBN21FcWRPU3liZGFSTHBUUUw5eUJCMngyWU43bnlsbVByUWxYdzhzS2hVaDNoWjVaSTZlZWY3ZW1LL1Nac3lQbmVlL1orQldhQ3lJRENHYzUvMTR5d2IvdnNxdURISVVFalo5cG8vNzhSczA0R3BhamJjdGMxbDNJeWNVN2NkTnFGbnJZMEdKUTlSTEJpR1hjNHJTa0lwSndoemFBOFY3cjQ4WVZhSWFlNmFhdnZxV3NXL050eEU2c25BSmdNb0JKRmt1dVJOdi9ERGlqdWJHeWR3NHpBdmd5bVg5TzBMWVBtU1Z1aXlSTzJ4ZEt6TncxbUduWWxyUmtBMEdhNlIyK01wVS9MYUI1dU8yNDVFNW9HTTZjMXhUT25KU0FtN3NzN0JlbVhKY0ZJYkZoM3U1dE8xWkRHOGd2ZWZOTWgyMm9naHFqekdkdUdaVG5IRHl5bEhZVVp6L3FrVTB1UnVGeDZWY01mcjU0OWRTYTg1UHJ3SVBwL3V1U0UvbC9jOEdIR2NzT1JOemM2RTN4cTNsanRsMExFeGVUZGc0bHBXbXRVR2JJL1pJaTRyVjJmcmJXM0htbk50dGFHenNsSUdJTE1rS0RCSUZHY0hLZXNmUzZHaGhWTkh4cFZsZCszcXlZdHRhdHI3em52clpabEFDQmdiTGEwWHBGSmhJZUxMQXNkNmFGeGpxRFU4YTNhaEZuWlM1dzRmVnIxMUdjMmQreUNWeWVUQWdEYndRMncwc3VjVmR2T0NFbE1LbXh6dklpWWRwMEE2ZWxoWDB1RmtrbGJ3N2ZaZGs4ZTZ4bS9wTlNNc0gvN3Zyd3ZGeWYvYVhWengyOS9uRTYwdHN6OWNHSGtSZzJYWEZqUUxwTFYwNlNCSm1TVFN0NGlRang2RlM1WDVta05KcFIyWGFEd1FhMlJpYWJZRUtMRzFsejJGR3d4RUFETGNYdytJY3dLSlpQNWR3NHVPaHB2Q1ExczMvYXpQVXVmT0VZeEhFTXdBQUhOZ3NqZ29PT21QZ0M4NmdURlhwRmx3VHd0ZDN4cm56alpLeFN0cnZ5RU5vRDkyNXB2dGZwNlo2YTFXTXVNbHRycWFpRGdoNXN4b1RNWlZJTjNaV1dMVGVFODdHL1Y5djR3clVDMnFYVXc3dXJLU2luaUkveU5abElBcmlEUzRQMWZocTJCZ2ZxVVpVZk9PYS9sQjE1MGVxdytnbFNPQzVNWFRCalg4ZFdEaUJxZjdPdEl1MGUxSmN5amcwcW1MV2FmeTFwbHU1amJHVDlnU1lLVGNYVW9hdXRhVzhwd1dDQVdBZzhXYjcwMEpNRU1Ha3FYSXcvd3ByQmtYY2IrRlN2RkhZb2ZIc3dUbDVNRFJyZk5iTVJ0dHlicE9DRkZaQkZCWi92amFtOFh5ZENRUWpvVlNrWUhMS2QrUnlKOUhBRFUrcFE2S3V6ZmF3S0ZFRWxpUFhIMW9sT2VFNVJiTHdBQ2lhQ1ZTTjArLzdYbXJjQlFaUUxuYmJIMktiMTUwSEI0ME5lT0lOb0JJT2FpYnNkZzhoaUR5QWFBZXIvUlZTRmxQQ2hGQmdDT0N2dDNocVJJV2xvSGxCQlduVS90VTlXK3E0dzFHWjJlam5RYXVVbTJvYVVpSURVUE8rNXFyS3JPQTNCcVpiL0k3amFkcVhISHJmRkphVEdERXJZZGxrUk9qVTlHQUtCQ3lXVCtDZzNVQjR5ZXZlemZxRDZlK3R5cXZ3TDQ2M2dhVUk1bFJSSDBDYVNzVWVWcm42YjlBd0RUZFZYR2NYMXB4dzBBZ0NSeUp2blZubXBEN1ZkY2pMV3VmS2N0R29Xbkl3NEFjR09qV04veTF0ZHN4Nkd4S3RzSjdIUGFvMCtmODg2R0FRQlF0bW12dzRSUXZVaGI3SGphV0ZpQlZjYWxPWGlZSHZLM0FXaExPbTVJQ1hMOFFwUTl0VlFPamtEUXN0M2tqbGpLZ2hlS3N3Rmd4ZkpIQXBNblZGeE5nRjh3QU1xZnVzUFBhd1RKNExjeDlQZG1sRkxHNzJ5L2ZzOFV0RTZ3UHBKNXJITVduNno5eXlLc1pOay9nRE1lTUpoaUV2Vk4wZlIvd291b0p6RVV6N3g4ZFVkcXhWbEgzcnNwbXZKM3hvcUhPSVZrVWdDK2VzYlU0YjJ3bW43dnNvNXR0MzMyanVURThBUCthSHFuejdTcmg2b0UyUXM3RDA5ZEhpa01CNGlobGFHWVVrd29DQ1JvQmh6TGhoeGF5QS9HcWZLOWhTTW9NRUR1MUlqRGI5LzRTdE55ZU5uRWVLN01vbmQzdlRHZXR1N1pOZkxIamhRQUhQUGdYNWR0L2RabjI1Smg5eWZKZ0RnT0pHMndOZ0NHMWlWcW5CMlhBNGFzTU9LT0M4K09qSHcycmNIc2ZqTmVHNUtPNHh6UUdPQzRrWjBzUkhBYzdXcXQ5ZTQwL2ZJTHl6YzhBeUNCTXFkQXg0dGk1TkE3MTh5ZjM1ZXhqYVJqS3JjRWdYQUJTR0I1MjBETDBxYU9HRWJPRFdQMzk1ZE1pL1gwVEcwZGlBY2lTYlBrMzJmNXBQQkJXNnp0VjAzdC9mRDZaMks4aHhqL0h3Y2Yvd3ZQQkpaKzlNc3dnd0FBQUR0MFJWaDBRWFYwYUc5eUFFRmtZVzBnVjJGc1pHVnVZbVZ5Wnl3Z1ltRnpaV1FnYjI0Z2RHaGxJRWRwZENCTWIyZHZJR0o1SUVwaGMyOXVJRXh2Ym1kYkFsdXdBQUFBSldsVVdIUkRiM0I1Y21sbmFIUUFBQUFBQU1LcElESXdNVFVnUVdSaGJTQlhZV3hrWlc1aVpYSm42bEdPMkFBQUFzSnBWRmgwV0UxTU9tTnZiUzVoWkc5aVpTNTRiWEFBQUFBQUFEdy9lSEJoWTJ0bGRDQmlaV2RwYmowbjc3dS9KeUJwWkQwblZ6Vk5NRTF3UTJWb2FVaDZjbVZUZWs1VVkzcHJZemxrSno4K0NqeDRPbmh0Y0cxbGRHRWdlRzFzYm5NNmVEMG5ZV1J2WW1VNmJuTTZiV1YwWVM4bklIZzZlRzF3ZEdzOUowbHRZV2RsT2pwRmVHbG1WRzl2YkNBNUxqSTNKejRLUEhKa1pqcFNSRVlnZUcxc2JuTTZjbVJtUFNkb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eE9UazVMekF5THpJeUxYSmtaaTF6ZVc1MFlYZ3Ribk1qSno0S0NpQThjbVJtT2tSbGMyTnlhWEIwYVc5dUlISmtaanBoWW05MWREMG5Kd29nSUhodGJHNXpPbU5qUFNkb2RIUndPaTh2WTNKbFlYUnBkbVZqYjIxdGIyNXpMbTl5Wnk5dWN5TW5QZ29nSUR4all6cHNhV05sYm5ObFBrTnlaV0YwYVhabElFTnZiVzF2Ym5NZ1FYUjBjbWxpZFhScGIyNGdNeTR3SUZWdWNHOXlkR1ZrSUV4cFkyVnVjMlV1SUZSb2FYTWdiR2xqWlc1elpTQnNaWFJ6SUc5MGFHVnljeUJrYVhOMGNtbGlkWFJsTENCeVpXMXBlQ3dnZEhkbFlXc3NJR0Z1WkNCaWRXbHNaQ0IxY0c5dUlIbHZkWElnZDI5eWF5d2daWFpsYmlCamIyMXRaWEpqYVdGc2JIa3NJR0Z6SUd4dmJtY2dZWE1nZEdobGVTQmpjbVZrYVhRZ2VXOTFJR1p2Y2lCMGFHVWdiM0pwWjJsdVlXd2dZM0psWVhScGIyNHVJRlJvYVhNZ2FYTWdkR2hsSUcxdmMzUWdZV05qYjIxdGIyUmhkR2x1WnlCdlppQjBhR1VnUTBNZ2JHbGpaVzV6WlhNZ2IyWm1aWEpsWkM0Z1VtVmpiMjF0Wlc1a1pXUWdabTl5SUcxaGVHbHRkVzBnWkdsemMyVnRhVzVoZEdsdmJpQmhibVFnZFhObElHOW1JR3hwWTJWdWMyVmtJRzFoZEdWeWFXRnNjeTQ4TDJOak9teHBZMlZ1YzJVK0NpQThMM0prWmpwRVpYTmpjbWx3ZEdsdmJqNEtQQzl5WkdZNlVrUkdQZ284TDNnNmVHMXdiV1YwWVQ0S1BEOTRjR0ZqYTJWMElHVnVaRDBuY2ljL1B0QzlRK1VBQUFBQVNVVk9SSzVDWUlJPSIgLz48L2E+DQoJCQk8cD5TdGF0aXN0aWNhbCBpbmZvcm1hdGlvbiBmb3IgdGhlIHJlcG9zaXRvcnkgJ2U4MTg1NTA2LTM5MTMtNDk1Ni1hZWYzLTE2ODMyZmRjNmQyZScgd2FzIGdhdGhlcmVkIG9uIDIwMjQvMTIvMTQuPGJyPlRoZSBvdXRwdXQgaGFzIGJlZW4gZ2VuZXJhdGVkIGJ5IDxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9landhL2dpdGluc3BlY3RvciI+Z2l0aW5zcGVjdG9yPC9hPiAwLjUuMGRldi4gVGhlIHN0YXRpc3RpY2FsIGFuYWx5c2lzIHRvb2wgZm9yIGdpdCByZXBvc2l0b3JpZXMuPC9wPg0KCQk8L2Rpdj48L2Rpdj4NCgo8ZGl2PjxkaXYgY2xhc3M9ImJveCI+PHA+VGhlIGZvbGxvd2luZyBoaXN0b3JpY2FsIGNvbW1pdCBpbmZvcm1hdGlvbiwgYnkgYXV0aG9yLCB3YXMgZm91bmQuPC9wPjxkaXY+PHRhYmxlIGlkPSJjaGFuZ2VzIiBjbGFzcz0iZ2l0Ij48dGhlYWQ+PHRyPiA8dGg+QXV0aG9yPC90aD4gPHRoPkNvbW1pdHM8L3RoPiA8dGg+SW5zZXJ0aW9uczwvdGg+IDx0aD5EZWxldGlvbnM8L3RoPiA8dGg+JSBvZiBjaGFuZ2VzPC90aD48L3RyPjwvdGhlYWQ+PHRib2R5Pjx0ciA+PHRkPjxpbWcgc3JjPSJodHRwczovL3d3dy5ncmF2YXRhci5jb20vYXZhdGFyLzg2Njg5YjRjOTdlMmZkYTQ0MjI4NTdhNTcwYTE5NGRiP2RlZmF1bHQ9aWRlbnRpY29uJnNpemU9MjAiLz50YWxlZ3JpYXQ8L3RkPjx0ZD4yPC90ZD48dGQ+NDA1NTU4PC90ZD48dGQ+MTI0PC90ZD48dGQ+MTAwLjAwPC90ZD48L3RyPjx0Zm9vdD48dHI+IDx0ZCBjb2xzcGFuPSI1Ij4mbmJzcDs8L3RkPiA8L3RyPjwvdGZvb3Q+PC90Ym9keT48L3RhYmxlPjxkaXYgY2xhc3M9ImNoYXJ0IiBpZD0iY2hhbmdlc19jaGFydCI+PC9kaXY+PC9kaXY+PHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPiAgICBjaGFuZ2VzX3Bsb3QgPSAkLnBsb3QoJCgiI2NoYW5nZXNfY2hhcnQiKSwgW3tsYWJlbDogInRhbGVncmlhdCIsIGRhdGE6IDEwMC4wMH1dLCB7ICAgICAgICBzZXJpZXM6IHsgICAgICAgICAgICBwaWU6IHsgICAgICAgICAgICAgICAgaW5uZXJSYWRpdXM6IDAuNCwgICAgICAgICAgICAgICAgc2hvdzogdHJ1ZSwgICAgICAgICAgICAgICAgY29tYmluZTogeyAgICAgICAgICAgICAgICAgICAgdGhyZXNob2xkOiAwLjAxLCAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJNaW5vciBBdXRob3JzIiAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgfSAgICAgICAgfSwgZ3JpZDogeyAgICAgICAgICAgIGhvdmVyYWJsZTogdHJ1ZSAgICAgICAgfSAgICB9KTs8L3NjcmlwdD48L2Rpdj48L2Rpdj4KPGRpdj48ZGl2IGNsYXNzPSJib3giPjxwPkJlbG93IGFyZSB0aGUgbnVtYmVyIG9mIHJvd3MgZnJvbSBlYWNoIGF1dGhvciB0aGF0IGhhdmUgc3Vydml2ZWQgYW5kIGFyZSBzdGlsbCBpbnRhY3QgaW4gdGhlIGN1cnJlbnQgcmV2aXNpb24uPC9wPjxkaXY+PHRhYmxlIGlkPSJibGFtZSIgY2xhc3M9ImdpdCI+PHRoZWFkPjx0cj4gPHRoPkF1dGhvcjwvdGg+IDx0aD5Sb3dzPC90aD4gPHRoPlN0YWJpbGl0eTwvdGg+IDx0aD5BZ2U8L3RoPiA8dGg+JSBpbiBjb21tZW50czwvdGg+IDwvdHI+PC90aGVhZD48dGJvZHk+PHRyID48dGQ+PGltZyBzcmM9Imh0dHBzOi8vd3d3LmdyYXZhdGFyLmNvbS9hdmF0YXIvODY2ODliNGM5N2UyZmRhNDQyMjg1N2E1NzBhMTk0ZGI/ZGVmYXVsdD1pZGVudGljb24mc2l6ZT0yMCIvPnRhbGVncmlhdDwvdGQ+PHRkPjMyODc5NDwvdGQ+PHRkPjgxLjE8L3RkPjx0ZD4tMC4wPC90ZD48dGQ+MTIuMzg8L3RkPjx0ZCBzdHlsZT0iZGlzcGxheTogbm9uZSI+MTAwLjAwPC90ZD48L3RyPjx0Zm9vdD48dHI+IDx0ZCBjb2xzcGFuPSI1Ij4mbmJzcDs8L3RkPiA8L3RyPjwvdGZvb3Q+PC90Ym9keT48L3RhYmxlPjxkaXYgY2xhc3M9ImNoYXJ0IiBpZD0iYmxhbWVfY2hhcnQiPjwvZGl2PjwvZGl2PjxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4gICAgYmxhbWVfcGxvdCA9ICQucGxvdCgkKCIjYmxhbWVfY2hhcnQiKSwgW3tsYWJlbDogInRhbGVncmlhdCIsIGRhdGE6IDEwMC4wMH1dLCB7ICAgICAgICBzZXJpZXM6IHsgICAgICAgICAgICBwaWU6IHsgICAgICAgICAgICAgICAgaW5uZXJSYWRpdXM6IDAuNCwgICAgICAgICAgICAgICAgc2hvdzogdHJ1ZSwgICAgICAgICAgICAgICAgY29tYmluZTogeyAgICAgICAgICAgICAgICAgICAgdGhyZXNob2xkOiAwLjAxLCAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJNaW5vciBBdXRob3JzIiAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgfSAgICAgICAgfSwgZ3JpZDogeyAgICAgICAgICAgIGhvdmVyYWJsZTogdHJ1ZSAgICAgICAgfSAgICB9KTs8L3NjcmlwdD48L2Rpdj48L2Rpdj4KPGRpdj48ZGl2IGlkPSJ0aW1lbGluZSIgY2xhc3M9ImJveCI+PHA+VGhlIGZvbGxvd2luZyBoaXN0b3J5IHRpbWVsaW5lIGhhcyBiZWVuIGdhdGhlcmVkIGZyb20gdGhlIHJlcG9zaXRvcnkuPC9wPgo8dGFibGUgY2xhc3M9ImdpdCBmdWxsIj48dGhlYWQ+PHRyPjx0aD5BdXRob3I8L3RoPjx0aD4yMDIyVzM5PC90aD48dGg+MjAyMlc0MTwvdGg+PC90cj48L3RoZWFkPjx0Ym9keT48dHI+PHRkPjxpbWcgc3JjPSJodHRwczovL3d3dy5ncmF2YXRhci5jb20vYXZhdGFyLzg2Njg5YjRjOTdlMmZkYTQ0MjI4NTdhNTcwYTE5NGRiP2RlZmF1bHQ9aWRlbnRpY29uJnNpemU9MjAiLz50YWxlZ3JpYXQ8L3RkPjx0ZD48ZGl2IGNsYXNzPSJpbnNlcnQiPiZuYnNwOzwvZGl2PjxkaXYgY2xhc3M9Imluc2VydCI+Jm5ic3A7PC9kaXY+PGRpdiBjbGFzcz0iaW5zZXJ0Ij4mbmJzcDs8L2Rpdj48ZGl2IGNsYXNzPSJpbnNlcnQiPiZuYnNwOzwvZGl2PjxkaXYgY2xhc3M9Imluc2VydCI+Jm5ic3A7PC9kaXY+PGRpdiBjbGFzcz0iaW5zZXJ0Ij4mbmJzcDs8L2Rpdj48ZGl2IGNsYXNzPSJpbnNlcnQiPiZuYnNwOzwvZGl2PjxkaXYgY2xhc3M9Imluc2VydCI+Jm5ic3A7PC9kaXY+PGRpdiBjbGFzcz0iaW5zZXJ0Ij4mbmJzcDs8L2Rpdj48ZGl2IGNsYXNzPSJpbnNlcnQiPiZuYnNwOzwvZGl2PjxkaXYgY2xhc3M9Imluc2VydCI+Jm5ic3A7PC9kaXY+PGRpdiBjbGFzcz0iaW5zZXJ0Ij4mbmJzcDs8L2Rpdj48ZGl2IGNsYXNzPSJpbnNlcnQiPiZuYnNwOzwvZGl2PjxkaXYgY2xhc3M9Imluc2VydCI+Jm5ic3A7PC9kaXY+PGRpdiBjbGFzcz0iaW5zZXJ0Ij4mbmJzcDs8L2Rpdj48ZGl2IGNsYXNzPSJpbnNlcnQiPiZuYnNwOzwvZGl2PjxkaXYgY2xhc3M9Imluc2VydCI+Jm5ic3A7PC9kaXY+PGRpdiBjbGFzcz0iaW5zZXJ0Ij4mbmJzcDs8L2Rpdj48L3RkPjx0ZD48ZGl2IGNsYXNzPSJyZW1vdmUiPiZuYnNwOzwvZGl2PjxkaXYgY2xhc3M9InJlbW92ZSI+Jm5ic3A7PC9kaXY+PGRpdiBjbGFzcz0iaW5zZXJ0Ij4mbmJzcDs8L2Rpdj48ZGl2IGNsYXNzPSJpbnNlcnQiPiZuYnNwOzwvZGl2PjxkaXYgY2xhc3M9Imluc2VydCI+Jm5ic3A7PC9kaXY+PGRpdiBjbGFzcz0iaW5zZXJ0Ij4mbmJzcDs8L2Rpdj48ZGl2IGNsYXNzPSJpbnNlcnQiPiZuYnNwOzwvZGl2PjxkaXYgY2xhc3M9Imluc2VydCI+Jm5ic3A7PC9kaXY+PGRpdiBjbGFzcz0iaW5zZXJ0Ij4mbmJzcDs8L2Rpdj48ZGl2IGNsYXNzPSJpbnNlcnQiPiZuYnNwOzwvZGl2PjxkaXYgY2xhc3M9Imluc2VydCI+Jm5ic3A7PC9kaXY+PGRpdiBjbGFzcz0iaW5zZXJ0Ij4mbmJzcDs8L2Rpdj48ZGl2IGNsYXNzPSJpbnNlcnQiPiZuYnNwOzwvZGl2PjxkaXYgY2xhc3M9Imluc2VydCI+Jm5ic3A7PC9kaXY+PGRpdiBjbGFzcz0iaW5zZXJ0Ij4mbmJzcDs8L2Rpdj48ZGl2IGNsYXNzPSJpbnNlcnQiPiZuYnNwOzwvZGl2PjxkaXYgY2xhc3M9Imluc2VydCI+Jm5ic3A7PC9kaXY+PC90ZD48L3RyPjx0Zm9vdD48dHI+PHRkPjxzdHJvbmc+TW9kaWZpZWQgUm93czo8L3N0cm9uZz48L3RkPjx0ZD40MDQ4ODI8L3RkPjx0ZD44MDA8L3RkPjwvdHI+PC90Zm9vdD48L3Rib2R5PjwvdGFibGU+CjwvZGl2PjwvZGl2Pgo8ZGl2PjxkaXYgY2xhc3M9ImJveCIgaWQ9Im1ldHJpY3MiPjxkaXY+PGg0PlRoZSBmb2xsb3dpbmcgZmlsZXMgYXJlIHN1c3BpY2lvdXNseSBiaWcgKGluIG9yZGVyIG9mIHNldmVyaXR5KS48L2g0PjxkaXYgY2xhc3M9InNldmVyZSI+eGJvYXJkLTQuOS4xL2JhY2tlbmQuYyAoMTc1ODggZXN0aW1hdGVkIGxpbmVzIG9mIGNvZGUpPC9kaXY+PGRpdiBjbGFzcz0ic2V2ZXJlIG9kZCI+eGJvYXJkLTQuOS4xL3dpbmJvYXJkL3dpbmJvYXJkLmMgKDkzNzYgZXN0aW1hdGVkIGxpbmVzIG9mIGNvZGUpPC9kaXY+PGRpdiBjbGFzcz0ic2V2ZXJlIj54Ym9hcmQtNC45LjEvZGlhbG9ncy5jICgzMjkyIGVzdGltYXRlZCBsaW5lcyBvZiBjb2RlKTwvZGl2PjxkaXYgY2xhc3M9InNldmVyZSBvZGQiPnhib2FyZC00LjkuMS93aW5ib2FyZC93b3B0aW9ucy5jICgyOTMzIGVzdGltYXRlZCBsaW5lcyBvZiBjb2RlKTwvZGl2PjxkaXYgY2xhc3M9InNldmVyZSI+eGJvYXJkLTQuOS4xL21vdmVzLmMgKDI0ODYgZXN0aW1hdGVkIGxpbmVzIG9mIGNvZGUpPC9kaXY+PGRpdiBjbGFzcz0ic2V2ZXJlIG9kZCI+eGJvYXJkLTQuOS4xL3hhdy94Ym9hcmQuYyAoMjM0MyBlc3RpbWF0ZWQgbGluZXMgb2YgY29kZSk8L2Rpdj48ZGl2IGNsYXNzPSJzZXZlcmUiPnhib2FyZC00LjkuMS9ndGsveGJvYXJkLmMgKDIzMDEgZXN0aW1hdGVkIGxpbmVzIG9mIGNvZGUpPC9kaXY+PGRpdiBjbGFzcz0ic2V2ZXJlIG9kZCI+eGJvYXJkLTQuOS4xL2d0ay94b3B0aW9ucy5jICgxODE0IGVzdGltYXRlZCBsaW5lcyBvZiBjb2RlKTwvZGl2PjxkaXYgY2xhc3M9InNldmVyZSI+Z251Y2hlc3MtNi4yLjkvc3JjL2VuZ2luZS9ldmFsLmNwcCAoMTc2NSBlc3RpbWF0ZWQgbGluZXMgb2YgY29kZSk8L2Rpdj48ZGl2IGNsYXNzPSJzZXZlcmUgb2RkIj54Ym9hcmQtNC45LjEvYXJncy5oICgxNTg5IGVzdGltYXRlZCBsaW5lcyBvZiBjb2RlKTwvZGl2PjxkaXYgY2xhc3M9ImJhZCI+Z251Y2hlc3MtNi4yLjkvc3JjL2FkYXB0ZXIvYWRhcHRlci5jcHAgKDE0MTcgZXN0aW1hdGVkIGxpbmVzIG9mIGNvZGUpPC9kaXY+PGRpdiBjbGFzcz0iYmFkIG9kZCI+eGJvYXJkLTQuOS4xL3hhdy94b3B0aW9ucy5jICgxMzk0IGVzdGltYXRlZCBsaW5lcyBvZiBjb2RlKTwvZGl2PjxkaXYgY2xhc3M9ImJhZCI+eGJvYXJkLTQuOS4xL3dpbmJvYXJkL2phd3MuYyAoMTMxMSBlc3RpbWF0ZWQgbGluZXMgb2YgY29kZSk8L2Rpdj48ZGl2IGNsYXNzPSJiYWQgb2RkIj54Ym9hcmQtNC45LjEvbWVudXMuYyAoMTI0NiBlc3RpbWF0ZWQgbGluZXMgb2YgY29kZSk8L2Rpdj48ZGl2IGNsYXNzPSJiYWQiPnhib2FyZC00LjkuMS9ib2FyZC5jICgxMDg3IGVzdGltYXRlZCBsaW5lcyBvZiBjb2RlKTwvZGl2PjxkaXYgY2xhc3M9ImJhZCBvZGQiPmdudWNoZXNzLTYuMi45L3NyYy9lbmdpbmUvc2VhcmNoX2Z1bGwuY3BwICgxMDY1IGVzdGltYXRlZCBsaW5lcyBvZiBjb2RlKTwvZGl2PjxkaXYgY2xhc3M9ImJhZCI+eGJvYXJkLTQuOS4xL2RyYXcuYyAoMTA0MyBlc3RpbWF0ZWQgbGluZXMgb2YgY29kZSk8L2Rpdj48ZGl2IGNsYXNzPSJiYWQgb2RkIj54Ym9hcmQtNC45LjEvYm9vay5jICgxMDAzIGVzdGltYXRlZCBsaW5lcyBvZiBjb2RlKTwvZGl2PjxkaXYgY2xhc3M9Im1lZGl1bSI+eGJvYXJkLTQuOS4xL3ppcHB5LmMgKDk5MiBlc3RpbWF0ZWQgbGluZXMgb2YgY29kZSk8L2Rpdj48ZGl2IGNsYXNzPSJtZWRpdW0gb2RkIj54Ym9hcmQtNC45LjEvd2luYm9hcmQvd3NldHRpbmdzLmMgKDk2MSBlc3RpbWF0ZWQgbGluZXMgb2YgY29kZSk8L2Rpdj48ZGl2IGNsYXNzPSJtZWRpdW0iPnhib2FyZC00LjkuMS9wYXJzZXIuYyAoODQ0IGVzdGltYXRlZCBsaW5lcyBvZiBjb2RlKTwvZGl2PjxkaXYgY2xhc3M9Im1lZGl1bSBvZGQiPmdudWNoZXNzLTYuMi45L3NyYy9hZGFwdGVyL3VjaS5jcHAgKDgxMiBlc3RpbWF0ZWQgbGluZXMgb2YgY29kZSk8L2Rpdj48ZGl2IGNsYXNzPSJtZWRpdW0iPmdudWNoZXNzLTYuMi45L3NyYy9lbmdpbmUvc29ydC5jcHAgKDc5NyBlc3RpbWF0ZWQgbGluZXMgb2YgY29kZSk8L2Rpdj48ZGl2IGNsYXNzPSJiYWQgb2RkIj5jaGVzc0JvYXJkL2JvYXJkLmggKDc2OCBlc3RpbWF0ZWQgbGluZXMgb2YgY29kZSk8L2Rpdj48ZGl2IGNsYXNzPSJtaW5vciI+eGJvYXJkLTQuOS4xL3VzeXN0ZW0uYyAoNzQxIGVzdGltYXRlZCBsaW5lcyBvZiBjb2RlKTwvZGl2PjxkaXYgY2xhc3M9ImJhZCBvZGQiPnhib2FyZC00LjkuMS9jb21tb24uaCAoNzA0IGVzdGltYXRlZCBsaW5lcyBvZiBjb2RlKTwvZGl2PjxkaXYgY2xhc3M9Im1pbm9yIj5nbnVjaGVzcy02LjIuOS9zcmMvZW5naW5lL21vdmVfZ2VuLmNwcCAoNzAwIGVzdGltYXRlZCBsaW5lcyBvZiBjb2RlKTwvZGl2PjxkaXYgY2xhc3M9Im1pbm9yIG9kZCI+Z251Y2hlc3MtNi4yLjkvc3JjL2VuZ2luZS9tb3ZlX2RvLmNwcCAoNjU5IGVzdGltYXRlZCBsaW5lcyBvZiBjb2RlKTwvZGl2PjxkaXYgY2xhc3M9Im1pbm9yIj54Ym9hcmQtNC45LjEvZW5naW5lb3V0cHV0LmMgKDY1MiBlc3RpbWF0ZWQgbGluZXMgb2YgY29kZSk8L2Rpdj48ZGl2IGNsYXNzPSJiYWQgb2RkIj54Ym9hcmQtNC45LjEvd2luYm9hcmQvcmVzb3VyY2UuaCAoNjQ5IGVzdGltYXRlZCBsaW5lcyBvZiBjb2RlKTwvZGl2PjxkaXYgY2xhc3M9Im1pbmltYWwiPmdudWNoZXNzLTYuMi45L3NyYy9lbmdpbmUvbWF0ZXJpYWwuY3BwICg2MjEgZXN0aW1hdGVkIGxpbmVzIG9mIGNvZGUpPC9kaXY+PGRpdiBjbGFzcz0ibWluaW1hbCBvZGQiPnhib2FyZC00LjkuMS9nYW1lbGlzdC5jICg2MTYgZXN0aW1hdGVkIGxpbmVzIG9mIGNvZGUpPC9kaXY+PGRpdiBjbGFzcz0ibWluaW1hbCI+Z251Y2hlc3MtNi4yLjkvc3JjL2FkYXB0ZXIvcGduLmNwcCAoNjA0IGVzdGltYXRlZCBsaW5lcyBvZiBjb2RlKTwvZGl2PjxkaXYgY2xhc3M9Im1pbmltYWwgb2RkIj5nbnVjaGVzcy02LjIuOS9zcmMvZW5naW5lL3Byb3RvY29sLmNwcCAoNTkyIGVzdGltYXRlZCBsaW5lcyBvZiBjb2RlKTwvZGl2PjxkaXYgY2xhc3M9Im1pbmltYWwiPmdudWNoZXNzLTYuMi45L3NyYy9hZGFwdGVyL3Nhbi5jcHAgKDUyMiBlc3RpbWF0ZWQgbGluZXMgb2YgY29kZSk8L2Rpdj48ZGl2IGNsYXNzPSJtaW5pbWFsIG9kZCI+Z251Y2hlc3MtNi4yLjkvc3JjL2FkYXB0ZXIvYm9va19tYWtlLmNwcCAoNTEzIGVzdGltYXRlZCBsaW5lcyBvZiBjb2RlKTwvZGl2PjxkaXYgY2xhc3M9Im1lZGl1bSI+Z251Y2hlc3MtNi4yLjkvc3JjL2Zyb250ZW5kL2NvbW1vbi5oICg0OTAgZXN0aW1hdGVkIGxpbmVzIG9mIGNvZGUpPC9kaXY+PGRpdiBjbGFzcz0ibWluaW1hbCBvZGQiPnhib2FyZC00LjkuMS9iYWNrZW5kLmggKDMyMCBlc3RpbWF0ZWQgbGluZXMgb2YgY29kZSk8L2Rpdj48L2Rpdj48ZGl2PjxoND5UaGUgZm9sbG93aW5nIGZpbGVzIGhhdmUgYW4gZWxldmF0ZWQgY3ljbG9tYXRpYyBjb21wbGV4aXR5IChpbiBvcmRlciBvZiBzZXZlcml0eSk8L2g0PjxkaXYgY2xhc3M9InNldmVyZSI+eGJvYXJkLTQuOS4xL2JhY2tlbmQuYyAoNjczMCBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ic2V2ZXJlIG9kZCI+eGJvYXJkLTQuOS4xL3dpbmJvYXJkL3dpbmJvYXJkLmMgKDI5MzUgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9InNldmVyZSI+eGJvYXJkLTQuOS4xL21vdmVzLmMgKDg4MiBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ic2V2ZXJlIG9kZCI+eGJvYXJkLTQuOS4xL3dpbmJvYXJkL3dvcHRpb25zLmMgKDgyNSBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ic2V2ZXJlIj54Ym9hcmQtNC45LjEvZGlhbG9ncy5jICg2MTQgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9InNldmVyZSBvZGQiPmdudWNoZXNzLTYuMi45L3NyYy9hZGFwdGVyL2FkYXB0ZXIuY3BwICg1NjggaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9InNldmVyZSI+Z251Y2hlc3MtNi4yLjkvc3JjL2VuZ2luZS9ldmFsLmNwcCAoNTMzIGluIGN5Y2xvbWF0aWMgY29tcGxleGl0eSk8L2Rpdj48ZGl2IGNsYXNzPSJzZXZlcmUgb2RkIj54Ym9hcmQtNC45LjEvZ3RrL3hib2FyZC5jICg1MDggaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9InNldmVyZSI+eGJvYXJkLTQuOS4xL3hhdy94Ym9hcmQuYyAoNDkzIGluIGN5Y2xvbWF0aWMgY29tcGxleGl0eSk8L2Rpdj48ZGl2IGNsYXNzPSJzZXZlcmUgb2RkIj54Ym9hcmQtNC45LjEvZ3RrL3hvcHRpb25zLmMgKDQ2MCBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ic2V2ZXJlIj5nbnVjaGVzcy02LjIuOS9zcmMvZnJvbnRlbmQvbGV4cGduLmNjICg0NTEgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9InNldmVyZSBvZGQiPnhib2FyZC00LjkuMS96aXBweS5jICgzNzAgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9InNldmVyZSI+Z251Y2hlc3MtNi4yLjkvc3JjL2Zyb250ZW5kL2NtZC5jYyAoMzE3IGluIGN5Y2xvbWF0aWMgY29tcGxleGl0eSk8L2Rpdj48ZGl2IGNsYXNzPSJzZXZlcmUgb2RkIj5nbnVjaGVzcy02LjIuOS9zcmMvZW5naW5lL3NlYXJjaF9mdWxsLmNwcCAoMzE0IGluIGN5Y2xvbWF0aWMgY29tcGxleGl0eSk8L2Rpdj48ZGl2IGNsYXNzPSJzZXZlcmUiPmdudWNoZXNzLTYuMi45L3NyYy9lbmdpbmUvbW92ZV9nZW4uY3BwICgzMDIgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9InNldmVyZSBvZGQiPnhib2FyZC00LjkuMS9ib2FyZC5jICgzMDEgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9InNldmVyZSI+eGJvYXJkLTQuOS4xL3dpbmJvYXJkL2phd3MuYyAoMjkyIGluIGN5Y2xvbWF0aWMgY29tcGxleGl0eSk8L2Rpdj48ZGl2IGNsYXNzPSJzZXZlcmUgb2RkIj5nbnVjaGVzcy02LjIuOS9zcmMvYWRhcHRlci91Y2kuY3BwICgyODkgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9InNldmVyZSI+Z251Y2hlc3MtNi4yLjkvc3JjL2VuZ2luZS9tYXRlcmlhbC5jcHAgKDI3NSBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ic2V2ZXJlIG9kZCI+Z251Y2hlc3MtNi4yLjkvc3JjL2VuZ2luZS9zb3J0LmNwcCAoMjcxIGluIGN5Y2xvbWF0aWMgY29tcGxleGl0eSk8L2Rpdj48ZGl2IGNsYXNzPSJzZXZlcmUiPnhib2FyZC00LjkuMS94YXcveG9wdGlvbnMuYyAoMjYzIGluIGN5Y2xvbWF0aWMgY29tcGxleGl0eSk8L2Rpdj48ZGl2IGNsYXNzPSJzZXZlcmUgb2RkIj54Ym9hcmQtNC45LjEvd2luYm9hcmQvd3NldHRpbmdzLmMgKDI2MCBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ic2V2ZXJlIj5nbnVjaGVzcy02LjIuOS9zcmMvZnJvbnRlbmQvbW92ZS5jYyAoMjYwIGluIGN5Y2xvbWF0aWMgY29tcGxleGl0eSk8L2Rpdj48ZGl2IGNsYXNzPSJzZXZlcmUgb2RkIj5nbnVjaGVzcy02LjIuOS9zcmMvYWRhcHRlci9ib2FyZC5jcHAgKDI1NyBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ic2V2ZXJlIj5nbnVjaGVzcy02LjIuOS9zcmMvYWRhcHRlci9wZ24uY3BwICgyNDMgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9InNldmVyZSBvZGQiPmdudWNoZXNzLTYuMi45L3NyYy9lbmdpbmUvYm9hcmQuY3BwICgyMzIgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9InNldmVyZSI+eGJvYXJkLTQuOS4xL2dhbWVsaXN0LmMgKDIyOSBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ic2V2ZXJlIG9kZCI+Z251Y2hlc3MtNi4yLjkvc3JjL2VuZ2luZS9wcm90b2NvbC5jcHAgKDIyNSBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ic2V2ZXJlIj5nbnVjaGVzcy02LjIuOS9zcmMvZnJvbnRlbmQvZ2VubW92ZS5jYyAoMjE1IGluIGN5Y2xvbWF0aWMgY29tcGxleGl0eSk8L2Rpdj48ZGl2IGNsYXNzPSJzZXZlcmUgb2RkIj54Ym9hcmQtNC45LjEvcGFyc2VyLmMgKDIxMCBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ic2V2ZXJlIj5nbnVjaGVzcy02LjIuOS9zcmMvYWRhcHRlci9zYW4uY3BwICgxOTUgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9InNldmVyZSBvZGQiPnhib2FyZC00LjkuMS91c3lzdGVtLmMgKDE4OSBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ic2V2ZXJlIj54Ym9hcmQtNC45LjEvbWVudXMuYyAoMTc4IGluIGN5Y2xvbWF0aWMgY29tcGxleGl0eSk8L2Rpdj48ZGl2IGNsYXNzPSJzZXZlcmUgb2RkIj5nbnVjaGVzcy02LjIuOS9zcmMvZnJvbnRlbmQvb3V0cHV0LmNjICgxNzggaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9InNldmVyZSI+Z251Y2hlc3MtNi4yLjkvc3JjL2FkYXB0ZXIvZmVuLmNwcCAoMTY3IGluIGN5Y2xvbWF0aWMgY29tcGxleGl0eSk8L2Rpdj48ZGl2IGNsYXNzPSJzZXZlcmUgb2RkIj54Ym9hcmQtNC45LjEvcGdudGFncy5jICgxNjYgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9InNldmVyZSI+eGJvYXJkLTQuOS4xL2Jvb2suYyAoMTU4IGluIGN5Y2xvbWF0aWMgY29tcGxleGl0eSk8L2Rpdj48ZGl2IGNsYXNzPSJzZXZlcmUgb2RkIj54Ym9hcmQtNC45LjEvZHJhdy5jICgxNTQgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9InNldmVyZSI+Z251Y2hlc3MtNi4yLjkvc3JjL2VuZ2luZS9hdHRhY2suY3BwICgxNTIgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9ImJhZCBvZGQiPmdudWNoZXNzLTYuMi45L3NyYy9lbmdpbmUvcmVjb2cuY3BwICgxNTAgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9ImJhZCI+Z251Y2hlc3MtNi4yLjkvc3JjL2Zyb250ZW5kL2VwZC5jYyAoMTQ4IGluIGN5Y2xvbWF0aWMgY29tcGxleGl0eSk8L2Rpdj48ZGl2IGNsYXNzPSJiYWQgb2RkIj5nbnVjaGVzcy02LjIuOS9zcmMvYWRhcHRlci9ib29rX21ha2UuY3BwICgxMzkgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9ImJhZCI+eGJvYXJkLTQuOS4xL2VuZ2luZW91dHB1dC5jICgxMzYgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9ImJhZCBvZGQiPnhib2FyZC00LjkuMS93aW5ib2FyZC93Z2FtZWxpc3QuYyAoMTM1IGluIGN5Y2xvbWF0aWMgY29tcGxleGl0eSk8L2Rpdj48ZGl2IGNsYXNzPSJiYWQiPmdudWNoZXNzLTYuMi45L3NyYy9mcm9udGVuZC9lbmdpbmUuY2MgKDEyNyBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0iYmFkIG9kZCI+Z251Y2hlc3MtNi4yLjkvc3JjL2FkYXB0ZXIvbW92ZV9nZW4uY3BwICgxMjYgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9ImJhZCI+Z251Y2hlc3MtNi4yLjkvc3JjL2FkYXB0ZXIvYm9vay5jcHAgKDExNiBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0iYmFkIG9kZCI+eGJvYXJkLTQuOS4xL3dpbmJvYXJkL3djbGlwYnJkLmMgKDExMCBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0iYmFkIj5nbnVjaGVzcy02LjIuOS9zcmMvYWRhcHRlci9lcGQuY3BwICgxMTAgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9ImJhZCBvZGQiPmdudWNoZXNzLTYuMi45L3NyYy9lbmdpbmUvbW92ZV9jaGVjay5jcHAgKDEwOCBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0iYmFkIj5nbnVjaGVzcy02LjIuOS9zcmMvZW5naW5lL3Bhd24uY3BwICgxMDIgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9Im1lZGl1bSBvZGQiPmdudWNoZXNzLTYuMi45L3NyYy9mcm9udGVuZC9pbml0LmNjICg5OSBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ibWVkaXVtIj5nbnVjaGVzcy02LjIuOS9zcmMvZW5naW5lL21vdmVfZG8uY3BwICg5OCBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ibWVkaXVtIG9kZCI+Z251Y2hlc3MtNi4yLjkvc3JjL2FkYXB0ZXIvZ2FtZS5jcHAgKDk2IGluIGN5Y2xvbWF0aWMgY29tcGxleGl0eSk8L2Rpdj48ZGl2IGNsYXNzPSJtZWRpdW0iPmdudWNoZXNzLTYuMi45L3NyYy9lbmdpbmUvZmVuLmNwcCAoOTUgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9Im1lZGl1bSBvZGQiPnhib2FyZC00LjkuMS93aW5ib2FyZC93Y2hhdC5jICg5NCBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ibWVkaXVtIj54Ym9hcmQtNC45LjEvbmdhbWVsaXN0LmMgKDkzIGluIGN5Y2xvbWF0aWMgY29tcGxleGl0eSk8L2Rpdj48ZGl2IGNsYXNzPSJtZWRpdW0gb2RkIj5nbnVjaGVzcy02LjIuOS9zcmMvbWFpbi5jYyAoOTEgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9Im1lZGl1bSI+Z251Y2hlc3MtNi4yLjkvc3JjL2VuZ2luZS90cmFucy5jcHAgKDkxIGluIGN5Y2xvbWF0aWMgY29tcGxleGl0eSk8L2Rpdj48ZGl2IGNsYXNzPSJtZWRpdW0gb2RkIj5nbnVjaGVzcy02LjIuOS9zcmMvZnJvbnRlbmQvcGxheWVycy5jYyAoOTAgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9Im1lZGl1bSI+Z251Y2hlc3MtNi4yLjkvc3JjL2VuZ2luZS9tb3ZlX2V2YXNpb24uY3BwICg5MCBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ibWVkaXVtIG9kZCI+Z251Y2hlc3MtNi4yLjkvc3JjL2FkYXB0ZXIvcGFyc2UuY3BwICg4OSBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ibWVkaXVtIj5nbnVjaGVzcy02LjIuOS9zcmMvYWRhcHRlci9tb3ZlLmNwcCAoODkgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9Im1lZGl1bSBvZGQiPmdudWNoZXNzLTYuMi45L3NyYy9hZGFwdGVyL2Jvb2tfbWVyZ2UuY3BwICg4NiBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ibWVkaXVtIj5nbnVjaGVzcy02LjIuOS9zcmMvYWRhcHRlci9pby5jcHAgKDgzIGluIGN5Y2xvbWF0aWMgY29tcGxleGl0eSk8L2Rpdj48ZGl2IGNsYXNzPSJtZWRpdW0gb2RkIj54Ym9hcmQtNC45LjEvd2luYm9hcmQvd2VkaXR0YWdzLmMgKDgxIGluIGN5Y2xvbWF0aWMgY29tcGxleGl0eSk8L2Rpdj48ZGl2IGNsYXNzPSJtZWRpdW0iPmdudWNoZXNzLTYuMi45L3NyYy9hZGFwdGVyL21haW4uY3BwICg3OSBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ibWVkaXVtIG9kZCI+Z251Y2hlc3MtNi4yLjkvc3JjL2VuZ2luZS9tb3ZlX2xlZ2FsLmNwcCAoNzcgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9Im1pbm9yIj5nbnVjaGVzcy02LjIuOS9zcmMvZW5naW5lL3NlYXJjaC5jcHAgKDc1IGluIGN5Y2xvbWF0aWMgY29tcGxleGl0eSk8L2Rpdj48ZGl2IGNsYXNzPSJtaW5vciBvZGQiPmdudWNoZXNzLTYuMi45L3NyYy9mcm9udGVuZC91dGlsLmNjICg2OCBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ibWlub3IiPmdudWNoZXNzLTYuMi45L3NyYy9hZGFwdGVyL3V0aWwuY3BwICg2NyBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ibWlub3Igb2RkIj54Ym9hcmQtNC45LjEvd2luYm9hcmQvd3NuYXAuYyAoNjYgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9Im1pbm9yIj5nbnVjaGVzcy02LjIuOS9zcmMvZnJvbnRlbmQvcGduLmNjICg2MyBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ibWluaW1hbCBvZGQiPnhib2FyZC00LjkuMS93aW5ib2FyZC93ZXZhbGdyYXBoLmMgKDYxIGluIGN5Y2xvbWF0aWMgY29tcGxleGl0eSk8L2Rpdj48ZGl2IGNsYXNzPSJtaW5pbWFsIj5nbnVjaGVzcy02LjIuOS9zcmMvYWRhcHRlci9saW5lLmNwcCAoNjEgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9Im1pbmltYWwgb2RkIj5nbnVjaGVzcy02LjIuOS9zcmMvZW5naW5lL2Jvb2suY3BwICg2MCBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ibWluaW1hbCI+Z251Y2hlc3MtNi4yLjkvc3JjL2VuZ2luZS9zZWUuY3BwICg1NyBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ibWluaW1hbCBvZGQiPmdudWNoZXNzLTYuMi45L3NyYy9lbmdpbmUvbW92ZS5jcHAgKDU3IGluIGN5Y2xvbWF0aWMgY29tcGxleGl0eSk8L2Rpdj48ZGl2IGNsYXNzPSJtaW5pbWFsIj54Ym9hcmQtNC45LjEvd2luYm9hcmQvd2VuZ2luZW91dHB1dC5jICg1NiBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ibWluaW1hbCBvZGQiPmdudWNoZXNzLTYuMi45L3NyYy9lbmdpbmUvcHN0LmNwcCAoNTQgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5KTwvZGl2PjxkaXYgY2xhc3M9Im1pbmltYWwiPmdudWNoZXNzLTYuMi45L3NyYy9hZGFwdGVyL2xpc3QuY3BwICg1NCBpbiBjeWNsb21hdGljIGNvbXBsZXhpdHkpPC9kaXY+PGRpdiBjbGFzcz0ibWluaW1hbCBvZGQiPmdudWNoZXNzLTYuMi45L3NyYy9hZGFwdGVyL2F0dGFjay5jcHAgKDU0IGluIGN5Y2xvbWF0aWMgY29tcGxleGl0eSk8L2Rpdj48L2Rpdj48ZGl2PjxoND5UaGUgZm9sbG93aW5nIGZpbGVzIGhhdmUgYW4gZWxldmF0ZWQgY3ljbG9tYXRpYyBjb21wbGV4aXR5IGRlbnNpdHkgKGluIG9yZGVyIG9mIHNldmVyaXR5KTwvaDQ+PGRpdiBjbGFzcz0ibWluaW1hbCI+eGJvYXJkLTQuOS4xL3BnbnRhZ3MuYyAoMC43NjUgaW4gY3ljbG9tYXRpYyBjb21wbGV4aXR5IGRlbnNpdHkpPC9kaXY+PC9kaXY+PC9kaXY+PC9kaXY+CjxkaXY+PGRpdiBjbGFzcz0iYm94IiBpZD0icmVzcG9uc2liaWxpdGllcyI+PHA+VGhlIGZvbGxvd2luZyByZXNwb25zaWJpbGl0aWVzLCBieSBhdXRob3IsIHdlcmUgZm91bmQgaW4gdGhlIGN1cnJlbnQgcmV2aXNpb24gb2YgdGhlIHJlcG9zaXRvcnkgKGNvbW1lbnRzIGFyZSBleGNsdWRlZCBmcm9tIHRoZSBsaW5lIGNvdW50LCBpZiBwb3NzaWJsZSkuPC9wPjxkaXY+PGgzPjxpbWcgc3JjPSJodHRwczovL3d3dy5ncmF2YXRhci5jb20vYXZhdGFyLzg2Njg5YjRjOTdlMmZkYTQ0MjI4NTdhNTcwYTE5NGRiP2RlZmF1bHQ9aWRlbnRpY29uJnNpemU9MzIiLz50YWxlZ3JpYXQgaXMgbW9zdGx5IHJlc3BvbnNpYmxlIGZvcjwvaDM+PGRpdj54Ym9hcmQtNC45LjEvYmFja2VuZC5jICgxNzU5MiBlbG9jKTwvZGl2PjxkaXYgY2xhc3M9Im9kZCI+eGJvYXJkLTQuOS4xL3dpbmJvYXJkL3dpbmJvYXJkLmMgKDkzNzYgZWxvYyk8L2Rpdj48ZGl2Pnhib2FyZC00LjkuMS90ZXhpbmZvLnRleCAoNjg0OCBlbG9jKTwvZGl2PjxkaXYgY2xhc3M9Im9kZCI+Z251Y2hlc3MtNi4yLjkvZG9jL3RleGluZm8udGV4ICg2ODQ4IGVsb2MpPC9kaXY+PGRpdj54Ym9hcmQtNC45LjEveGJvYXJkLmluZm8gKDYwNTIgZWxvYyk8L2Rpdj48ZGl2IGNsYXNzPSJvZGQiPnhib2FyZC00LjkuMS94Ym9hcmQubWFuICg1NzE4IGVsb2MpPC9kaXY+PGRpdj54Ym9hcmQtNC45LjEveGJvYXJkLnRleGkgKDUwNzkgZWxvYyk8L2Rpdj48ZGl2IGNsYXNzPSJvZGQiPmdudWNoZXNzLTYuMi45L3NyYy9mcm9udGVuZC9sZXhwZ24uY2MgKDM0NTcgZWxvYyk8L2Rpdj48ZGl2Pnhib2FyZC00LjkuMS9kaWFsb2dzLmMgKDMyOTIgZWxvYyk8L2Rpdj48ZGl2IGNsYXNzPSJvZGQiPnhib2FyZC00LjkuMS93aW5ib2FyZC93b3B0aW9ucy5jICgyOTMzIGVsb2MpPC9kaXY+PC9kaXY+PC9kaXY+PC9kaXY+Cgk8L2JvZHk+DQo8L2h0bWw+DQoK"}
